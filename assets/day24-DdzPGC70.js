import{G as F,P as I,C as O}from"./index-BHE0gmfy.js";const i={radius1:100,radius2:100,piRational:3,piIrrational:Math.PI,timeStep:.06,maxTheta:Math.PI*60,maxTrailLength:15e3,depthPerTheta:8,perspective:800,initialRotationX:.05,initialZoom:.08,maxZoom:1.5,wheelZoomSpeed:.08,autoZoomSpeed:8e-4,jitterAmount:.6,grainDensity:.25,scratchChance:.012,dustChance:6e-4,flickerSpeed:.08,flickerIntensity:.1,chromaMaxOffset:4,chromaStartProgress:.05,rationalFlashInterval:Math.PI*8,rationalFlashDuration:12,maxJitterMultiplier:4,frameSkipChance:.03,lineVibrateAmount:2,contrastBoost:1.4,crushBlacks:20,blowWhites:235};class X extends F{constructor(t){super(t),this.backgroundColor="#000"}init(){super.init(),I.init(this.ctx),this.theta=0,this.isRational=!1,this.isAnimating=!0,this.scale=Math.min(this.width,this.height)/500,this.centerX=this.width/2,this.centerY=this.height/2,this.camera=new O({perspective:i.perspective,rotationX:i.initialRotationX,rotationY:Math.PI,inertia:!0,friction:.92,sensitivity:.004,clampX:!1,clampY:!1}),this.camera.enableMouseControl(this.canvas),this.trail=[],this.zoom=i.initialZoom,this.targetZoom=i.initialZoom,this.userZoomed=!1,this.zoomResumeTimer=null,this.rationalFlashFrames=0,this.lastFlashTheta=0,this.skipFrame=!1,this.vibrateOffset={x:0,y:0},this.grainCanvas=document.createElement("canvas"),this.grainCanvas.width=this.width,this.grainCanvas.height=this.height,this.grainCtx=this.grainCanvas.getContext("2d"),this._dblClickHandler||(this._dblClickHandler=()=>{this.isRational=!this.isRational,this.trail=[],this.theta=0,this.zoom=i.initialZoom,this.targetZoom=i.initialZoom,this.userZoomed=!1,this.zoomResumeTimer&&(clearTimeout(this.zoomResumeTimer),this.zoomResumeTimer=null)},this.canvas.addEventListener("dblclick",this._dblClickHandler)),this._wheelHandler||(this._wheelHandler=t=>{t.preventDefault(),this.userZoomed=!0,this.zoomResumeTimer&&clearTimeout(this.zoomResumeTimer),this.zoomResumeTimer=setTimeout(()=>{this.userZoomed=!1},2e3);const h=t.deltaY>0?-.08:i.wheelZoomSpeed;this.targetZoom=Math.max(.05,this.targetZoom+h)},this.canvas.addEventListener("wheel",this._wheelHandler,{passive:!1})),this._keyHandler||(this._keyHandler=t=>{t.code==="Space"&&(t.preventDefault(),this.isAnimating=!this.isAnimating)},this.canvas.addEventListener("keydown",this._keyHandler)),this.canvas.tabIndex=0,this.canvas.focus()}get piValue(){return this.isRational?i.piRational:i.piIrrational}calculatePosition(t){const h=this.piValue,b=i.radius1*this.scale,a=i.radius2*this.scale,r=b*Math.cos(t)+a*Math.cos(h*t),c=b*Math.sin(t)+a*Math.sin(h*t),n=t*i.depthPerTheta;return{x:r,y:c,z:n}}jitter(t){return t+(Math.random()-.5)*i.jitterAmount}update(t){if(super.update(t),this.camera.update(t),this.zoom+=(this.targetZoom-this.zoom)*.05,!this.isAnimating)return;this.theta+=i.timeStep,!this.userZoomed&&this.targetZoom<i.maxZoom&&(this.targetZoom+=i.autoZoomSpeed,this.targetZoom=Math.min(this.targetZoom,i.maxZoom)),!this.isRational&&this.rationalFlashFrames>0&&this.rationalFlashFrames--,!this.isRational&&this.theta-this.lastFlashTheta>=i.rationalFlashInterval&&(this.rationalFlashFrames=i.rationalFlashDuration,this.lastFlashTheta=this.theta),this.skipFrame=Math.random()<i.frameSkipChance,this.vibrateOffset={x:(Math.random()-.5)*i.lineVibrateAmount,y:(Math.random()-.5)*i.lineVibrateAmount};const h=this.calculatePosition(this.theta);this.currentPos=h,this.trail.push({x:h.x,y:h.y,z:h.z,theta:this.theta}),this.trail.length>i.maxTrailLength&&this.trail.shift()}renderGrain(){const t=this.grainCtx;t.clearRect(0,0,this.width,this.height);const h=Math.floor(this.width*this.height*i.grainDensity/80);for(let a=0;a<h;a++){const r=Math.random()*this.width,c=Math.random()*this.height,n=Math.random()*2.5+.5,M=Math.random()>.8?i.blowWhites+Math.random()*20:Math.random()*i.crushBlacks,y=Math.random()*.5+.15;t.fillStyle=`rgba(${M}, ${M}, ${M}, ${y})`,t.fillRect(r,c,n,n)}if(Math.random()<i.scratchChance){const a=Math.random()*this.width,r=Math.random()*this.height*.7+this.height*.2,c=Math.random()*(this.height-r);t.strokeStyle=`rgba(200, 200, 200, ${Math.random()*.3+.1})`,t.lineWidth=Math.random()*1.5+.5,t.beginPath(),t.moveTo(a,c);for(let n=c;n<c+r;n+=10)t.lineTo(a+(Math.random()-.5)*2,n);t.stroke()}const b=Math.floor(this.width*this.height*i.dustChance);for(let a=0;a<b;a++){const r=Math.random()*this.width,c=Math.random()*this.height,n=Math.random()*4+2;t.fillStyle=`rgba(0, 0, 0, ${Math.random()*.6+.2})`,t.beginPath(),t.arc(r,c,n,0,Math.PI*2),t.fill()}if(Math.random()<.03){const a=Math.random()*this.height,r=Math.random()*8+2;t.fillStyle=`rgba(255, 255, 255, ${Math.random()*.1})`,t.fillRect(0,a,this.width,r)}}render(){const t=this.ctx;if(this.skipFrame)return;const h=Math.min(1,this.theta/i.maxTheta),b=i.flickerIntensity*(1+h*.5),a=1-Math.random()*b*(.5+.5*Math.sin(this.theta*i.flickerSpeed*10)),r=1+(i.maxJitterMultiplier-1)*h;if(t.fillStyle=`rgb(${i.crushBlacks}, ${i.crushBlacks}, ${i.crushBlacks})`,t.fillRect(0,0,this.width,this.height),t.fillStyle="#000",t.fillRect(0,0,this.width,this.height),t.lineCap="round",t.lineJoin="round",this.trail.length>1){const d=this.trail[0].z,M=this.trail[this.trail.length-1].z,y=(d+M)/2,g=this.trail.map(e=>{const s=this.camera.project(e.x,e.y,e.z-y);return{sx:this.centerX+s.x*this.zoom,sy:this.centerY+s.y*this.zoom,scale:s.scale*this.zoom,z:s.z,theta:e.theta}}),P=Math.max(0,(h-i.chromaStartProgress)/(1-i.chromaStartProgress)),m=i.chromaMaxOffset*Math.pow(P,1.2),f=Math.min(255,Math.floor(80*i.contrastBoost)),x=Math.min(255,Math.floor(255*i.contrastBoost));t.globalCompositeOperation="lighter";const $=[{color:`rgba(${x}, ${f}, ${f}, ${.7*a})`,offsetX:-m,offsetY:-m*.5},{color:`rgba(${f}, ${x}, ${f}, ${.7*a})`,offsetX:0,offsetY:0},{color:`rgba(${f}, ${f}, ${x}, ${.7*a})`,offsetX:m,offsetY:m*.5}];for(const e of $){t.beginPath();for(let s=0;s<g.length;s++){const l=g[s];m*(.5+.5*l.scale);const p=e.offsetX*(.3+.7*(l.theta/i.maxTheta)),S=e.offsetY*(.3+.7*(l.theta/i.maxTheta)),u=l.sx+p+this.vibrateOffset.x+(Math.random()-.5)*i.jitterAmount*r*.3,o=l.sy+S+this.vibrateOffset.y+(Math.random()-.5)*i.jitterAmount*r*.3;s===0?t.moveTo(u,o):t.lineTo(u,o)}t.strokeStyle=e.color,t.lineWidth=1,t.stroke()}t.globalCompositeOperation="source-over",t.globalCompositeOperation="lighter";for(let e=0;e<g.length;e+=50){const s=g[e],l=Math.max(.1,Math.min(1,s.scale)),p=Math.max(.5,2*s.scale),S=s.theta/i.maxTheta,u=m*S;t.fillStyle=`rgba(255, 100, 100, ${l*.25*a})`,t.beginPath(),t.arc(s.sx-u,s.sy-u*.5,p,0,Math.PI*2),t.fill(),t.fillStyle=`rgba(100, 255, 100, ${l*.25*a})`,t.beginPath(),t.arc(s.sx,s.sy,p,0,Math.PI*2),t.fill(),t.fillStyle=`rgba(100, 100, 255, ${l*.25*a})`,t.beginPath(),t.arc(s.sx+u,s.sy+u*.5,p,0,Math.PI*2),t.fill()}if(t.globalCompositeOperation="source-over",this.rationalFlashFrames>0&&!this.isRational){const e=this.rationalFlashFrames/i.rationalFlashDuration,s=i.piRational,l=i.radius1*this.scale,p=i.radius2*this.scale;t.globalCompositeOperation="screen",t.strokeStyle=`rgba(255, 255, 200, ${.6*e*a})`,t.lineWidth=2,t.beginPath();const S=Math.PI*2*s;for(let o=0;o<=S;o+=.1){const k=l*Math.cos(o)+p*Math.cos(s*o),T=l*Math.sin(o)+p*Math.sin(s*o),w=o*i.depthPerTheta,v=this.camera.project(k,T,w-y),z=this.centerX+v.x*this.zoom,C=this.centerY+v.y*this.zoom;o===0?t.moveTo(z,C):t.lineTo(z,C)}if(t.stroke(),t.globalCompositeOperation="source-over",Math.floor(this.lastFlashTheta)%2===0){const o=Math.min(this.width,this.height)*.5;t.font=`bold ${o}px serif`,t.textAlign="center",t.textBaseline="middle",t.fillStyle=`rgba(255, 0, 0, ${.8*e*a})`,t.fillText("π",this.centerX+(Math.random()-.5)*20,this.centerY+(Math.random()-.5)*20)}else{const o="3141592653589793238462643383279502884197169399375105820974944592307816406286",k=Math.floor(100*e);for(let T=0;T<k;T++){const w=o[Math.floor(Math.random()*o.length)],v=Math.random()*this.width,z=Math.random()*this.height,C=24+Math.random()*72;t.font=`bold ${C}px monospace`;const Z=Math.floor(Math.random()*100+50);t.fillStyle=`rgba(${Z}, ${Z}, ${Z}, ${.5+Math.random()*.4})`,t.fillText(w,v,z)}}t.globalCompositeOperation="source-over"}}if(this.currentPos&&this.trail.length>1){const d=this.trail[0].z,M=this.trail[this.trail.length-1].z,y=(d+M)/2,g=this.camera.project(this.currentPos.x,this.currentPos.y,this.currentPos.z-y),P=.7+.3*Math.sin(this.theta*8),m=Math.max(2,4*g.scale*this.zoom),f=this.centerX+g.x*this.zoom,x=this.centerY+g.y*this.zoom,$=this.theta/i.maxTheta,e=Math.max(0,($-i.chromaStartProgress)/(1-i.chromaStartProgress)),s=i.chromaMaxOffset*e*$;t.globalCompositeOperation="lighter",t.fillStyle=`rgba(255, 120, 120, ${P*a})`,t.beginPath(),t.arc(f-s,x-s*.5,m,0,Math.PI*2),t.fill(),t.fillStyle=`rgba(120, 255, 120, ${P*a})`,t.beginPath(),t.arc(f,x,m,0,Math.PI*2),t.fill(),t.fillStyle=`rgba(120, 120, 255, ${P*a})`,t.beginPath(),t.arc(f+s,x+s*.5,m,0,Math.PI*2),t.fill(),t.globalCompositeOperation="source-over"}if(Math.random()>.5&&this.renderGrain(),t.drawImage(this.grainCanvas,0,0),Math.random()<.06){const d=t.createRadialGradient(this.centerX,this.centerY,this.width*.2,this.centerX,this.centerY,this.width*.55);d.addColorStop(0,"rgba(0, 0, 0, 0)"),d.addColorStop(1,"rgba(0, 0, 0, 0.25)"),t.fillStyle=d,t.fillRect(0,0,this.width,this.height)}t.font="12px monospace",t.fillStyle=`rgba(150, 150, 150, ${.5*a})`;const c=this.isRational?"π ≈ 3":"π = 3.14159265...";t.fillText(c,20,30),t.fillStyle=`rgba(120, 120, 120, ${.4*a})`,t.fillText("z(θ) = e^(θi) + e^(πθi)",20,48);const n=(this.theta/(Math.PI*2)).toFixed(1);t.fillStyle=`rgba(150, 150, 150, ${.4*a})`,t.fillText(`${n} revolutions`,20,66),this.isRational?(t.fillStyle=`rgba(100, 255, 100, ${.4*a})`,t.fillText("it would close...",20,84)):(t.fillStyle=`rgba(255, 100, 100, ${.4*a})`,t.fillText("it will never close.",20,84)),t.fillStyle=`rgba(100, 100, 100, ${.3*a})`,t.fillText("drag to orbit • scroll to zoom • double-click to toggle π",20,this.height-20)}}function j(R){const t=new X(R);return t.start(),{stop:()=>t.stop(),game:t}}export{j as default};
