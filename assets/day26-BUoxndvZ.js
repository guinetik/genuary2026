import{G as S,P as y,C as D,c as R}from"./gcanvas.es-BF2N4r4i.js";const n={background:"#000",maxDepth:3,particleBaseSize:20,particleMinSize:2,particleShape:"square",colors:{stroke:"#0f0"},camera:{perspective:800,rotationX:.5,rotationY:-.6,inertia:!0,friction:.92,clampX:!1},animation:{autoRotateSpeed:.15,attractStrength:8,damping:.92,scatterForce:800,buildDelay:.003}};function z(d,e,t,s,a,i,r=[]){if(a>=i)return r.push({x:d,y:e,z:t,size:s,depth:a}),r;const u=s/3,h=s/3;for(let o=-1;o<=1;o++)for(let c=-1;c<=1;c++)for(let l=-1;l<=1;l++){if((o===0?1:0)+(c===0?1:0)+(l===0?1:0)>=2)continue;const g=d+o*h,p=e+c*h,f=t+l*h;z(g,p,f,u,a+1,i,r)}return r}class P extends S{constructor(e){super(e),this.backgroundColor=n.background}init(){super.init(),y.init(this.ctx),this.camera=new D({perspective:n.camera.perspective,rotationX:n.camera.rotationX,rotationY:n.camera.rotationY,inertia:n.camera.inertia,friction:n.camera.friction,clampX:n.camera.clampX}),this.camera.enableMouseControl(this.canvas),this.time=0,this.globalRotation=0,this.zoom=1,this.targetZoom=1,this.buildTime=0,this.cubesSpawned=0,this.generateTargets(),this.createParticleSystem(),this.canvas.addEventListener("dblclick",()=>{this.scatterParticles()}),this.canvas.addEventListener("wheel",e=>{e.preventDefault();const t=e.deltaY>0?.9:1.1;this.targetZoom=Math.max(.3,Math.min(15,this.targetZoom*t))},{passive:!1})}generateTargets(){const t=Math.min(this.width,this.height)*.35,s=z(0,0,0,t,0,n.maxDepth);s.sort((a,i)=>a.depth-i.depth),this.cubes=s.map((a,i)=>({...a,spawnDelay:i*n.animation.buildDelay,spawned:!1})),console.log(`Menger Sponge: ${this.cubes.length} cubes/particles`)}createParticleSystem(){const e=(t,s)=>{if(!t.alive||t.custom.targetX===void 0)return;const a=this.globalRotation,i=Math.cos(a),r=Math.sin(a),u=t.custom.targetX*i-t.custom.targetZ*r,h=t.custom.targetX*r+t.custom.targetZ*i,o=t.custom.targetY,c=u*this.zoom,l=o*this.zoom,m=h*this.zoom,g=c-t.x,p=l-t.y,f=m-t.z,b=n.animation.attractStrength;t.vx+=g*b*s,t.vy+=p*b*s,t.vz+=f*b*s;const M=n.animation.damping;t.vx*=M,t.vy*=M,t.vz*=M,t.x+=t.vx*s,t.y+=t.vy*s,t.z+=t.vz*s;const v=Math.sqrt(t.vx**2+t.vy**2+t.vz**2);if(!t.custom.settled&&v<50){t.custom.settled=!0;const w=40+t.custom.depth/n.maxDepth*20,x=this.hslToRgb(135/360,1,w/100);t.color.r=x.r,t.color.g=x.g,t.color.b=x.b}else t.custom.settled||(t.color.r=255,t.color.g=255,t.color.b=255)};this.particles=new R(this,{camera:this.camera,depthSort:!0,maxParticles:1e4,blendMode:"source-over",updaters:[e]}),this.pipeline.add(this.particles)}hslToRgb(e,t,s){let a,i,r;if(t===0)a=i=r=s;else{const u=(c,l,m)=>(m<0&&(m+=1),m>1&&(m-=1),m<.16666666666666666?c+(l-c)*6*m:m<.5?l:m<.6666666666666666?c+(l-c)*(.6666666666666666-m)*6:c),h=s<.5?s*(1+t):s+t-s*t,o=2*s-h;a=u(o,h,e+1/3),i=u(o,h,e),r=u(o,h,e-1/3)}return{r:Math.round(a*255),g:Math.round(i*255),b:Math.round(r*255)}}spawnCube(e){const t=Math.max(this.width,this.height)*.8,s=Math.random()*Math.PI*2,a=Math.acos(2*Math.random()-1),i=t*(.3+Math.random()*.7),r=i*Math.sin(a)*Math.cos(s),u=i*Math.sin(a)*Math.sin(s),h=i*Math.cos(a),o=this.particles.acquire();o.x=r,o.y=u,o.z=h,o.vx=-r*.5,o.vy=-u*.5,o.vz=-h*.5;const c=e.size/(Math.min(this.width,this.height)*.35);o.size=Math.max(n.particleMinSize,n.particleBaseSize*c),o.color.r=255,o.color.g=255,o.color.b=255,o.color.a=1,o.shape=n.particleShape,o.age=0,o.lifetime=1/0,o.alive=!0,o.custom.targetX=e.x,o.custom.targetY=e.y,o.custom.targetZ=e.z,o.custom.depth=e.depth,o.custom.cubeSize=e.size,o.custom.baseSize=o.size,this.particles.particles.push(o),e.spawned=!0,this.cubesSpawned++}scatterParticles(){for(const e of this.particles.particles){if(!e.alive)continue;e.custom.settled=!1;const t=Math.random()*Math.PI*2,s=Math.acos(2*Math.random()-1),a=n.animation.scatterForce*(.5+Math.random());e.vx+=a*Math.sin(s)*Math.cos(t),e.vy+=a*Math.sin(s)*Math.sin(t),e.vz+=a*Math.cos(s)}}update(e){super.update(e),this.time+=e,this.buildTime+=e,this.camera.update(e),this.globalRotation+=n.animation.autoRotateSpeed*e,this.zoom+=(this.targetZoom-this.zoom)*.15;for(const t of this.cubes)!t.spawned&&this.buildTime>=t.spawnDelay&&this.spawnCube(t)}clear(){this.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.ctx.fillRect(0,0,this.width,this.height)}render(){super.render();const e=this.ctx;e.fillStyle=n.colors.stroke,e.font="12px monospace",e.textAlign="left",e.fillText(`MENGER SPONGE | Depth: ${n.maxDepth} | Cubes: ${this.cubesSpawned}/${this.cubes.length}`,10,this.height-10),e.textAlign="right",e.fillText(`Zoom: ${this.zoom.toFixed(1)}x | Dbl-click to scatter`,this.width-10,this.height-10)}onResize(){if(this.cubes){const e=this.cubes.map(a=>a.spawned),t=this.cubesSpawned;this.generateTargets();for(let a=0;a<Math.min(e.length,this.cubes.length);a++)this.cubes[a].spawned=e[a];this.cubesSpawned=t;let s=0;for(const a of this.cubes){if(!a.spawned)continue;const i=this.particles.particles;if(s<i.length&&i[s].alive){i[s].custom.targetX=a.x,i[s].custom.targetY=a.y,i[s].custom.targetZ=a.z,i[s].custom.depth=a.depth;const r=a.size/(Math.min(this.width,this.height)*.35);i[s].custom.baseSize=Math.max(n.particleMinSize,n.particleBaseSize*r),s++}}}}}function Y(d){const e=new P(d);return e.start(),{stop:()=>e.stop(),game:e}}export{Y as default};
