import{G as F,d as C,P as X,C as H,H as D,X as G,e as B,p as U,J as Y,Z as W,_ as j,$ as P,a0 as O,a1 as V}from"./index-QcdZ2uQe.js";import{CONFIG as c,TAU as R}from"./day25.config-DJwhhKHN.js";import{MOLECULES as k,PRIMORDIAL_KEYS as E,REACTIONS as K}from"./day25.chemistry-fLO6Y1II.js";import{Molecule3D as $}from"./day25.molecule-DOGdhILh.js";import{LegendUI as A}from"./day25.ui-BD5CHnuz.js";import{Lightning as q}from"./day25.lightning-CnC6hs7M.js";class _ extends F{constructor(t){super(t),this.backgroundColor=c.bgColor}init(){super.init(),C.init(this),X.init(this.ctx),this.camera=new H({perspective:c.perspective,rotationX:.2,rotationY:0,inertia:!0,friction:.95,clampX:!1,clampY:!1}),this.camera.enableMouseControl(this.canvas),this.canvas.removeEventListener("dblclick",this.camera._boundHandlers.dblclick),this.molecules=[],this.cx=this.width/2,this.cy=this.height/2,this.reactionLog=[],this.totalTime=0,this.stats={reactions:0,maxTier:0},this.discovered=new Set,this.tierRequirements={0:["water","methane","ammonia","hydrogen","carbonDioxide","hydrogenSulfide"],1:["formaldehyde","hydrogenCyanide"],2:["glycine","alanine","serine","asparticAcid","cysteine"],3:["diglycine"]},this.showInfo=!1,this.showLegend=!1,this.lastInteractionTime=0,this.idleSpawnTimer=0,this.worldWidth=this.width*c.worldWidthRatio,this.worldHeight=this.height*c.worldHeightRatio,this.moleculeCount=C.responsive(14,24,50);const t=C.responsive(15,25,50),s=C.responsive(25,40,80);console.log(`[Day25] Screen: ${C.isMobile?"mobile":C.isTablet?"tablet":"desktop"}, molecules: ${this.moleculeCount}`),this.bubbles=[];for(let a=0;a<t;a++)this.bubbles.push(this.createBubble(!0));this.particles=[];for(let a=0;a<s;a++)this.particles.push(this.createParticle());this.reactionBursts=[];for(let a=0;a<this.moleculeCount;a++)this.spawnMolecule(!0);this.leftVent=null,this.rightVent=null,this.loadThermalVents(),this.createLightning(),this.createUI();let e=null;const l=(a,i,r)=>{if(!r)return!1;const d=r.x-r.width/2,u=r.y-r.height/2;return a>=d&&a<=d+r.width&&i>=u&&i<=u+r.height},h=(a,i)=>l(a,i,this.legendUI);this.setCameraDragEnabled=a=>{if(!this.camera._boundHandlers)return;const i=this.camera._boundHandlers;a?(this.canvas.addEventListener("mousedown",i.mousedown),this.canvas.addEventListener("mousemove",i.mousemove),this.canvas.addEventListener("mouseup",i.mouseup),i.touchstart&&(this.canvas.addEventListener("touchstart",i.touchstart),this.canvas.addEventListener("touchmove",i.touchmove),this.canvas.addEventListener("touchend",i.touchend))):(this.canvas.removeEventListener("mousedown",i.mousedown),this.canvas.removeEventListener("mousemove",i.mousemove),this.canvas.removeEventListener("mouseup",i.mouseup),i.touchstart&&(this.canvas.removeEventListener("touchstart",i.touchstart),this.canvas.removeEventListener("touchmove",i.touchmove),this.canvas.removeEventListener("touchend",i.touchend)))};const n=a=>{const i=this.canvas.getBoundingClientRect(),r=a.touches?a.touches[0]:a,d=r.clientX-i.left,u=r.clientY-i.top;this.showLegend&&this.legendUI&&this.legendUI.visible&&(h(d,u)||(this.showLegend=!1,this.legendUI.visible=!1,this.legendBtn.toggle(!1),this.setCameraDragEnabled(!0)))};this.canvas.addEventListener("mousedown",n,!0),this.canvas.addEventListener("touchstart",n,!0),this.canvas.addEventListener("mousedown",a=>{e={x:a.clientX,y:a.clientY}}),this.mouseWorld={x:0,y:0,z:0,active:!1},this.canvas.addEventListener("mousemove",a=>{const i=this.canvas.getBoundingClientRect(),r=a.clientX-i.left-this.width/2,d=a.clientY-i.top-this.height/2,u=Math.cos(-this.camera.rotationX),p=Math.sin(-this.camera.rotationX),b=Math.cos(-this.camera.rotationY),g=Math.sin(-this.camera.rotationY);let o=r,m=d,f=0,y=m*u-f*p,v=m*p+f*u;m=y,f=v;let w=o*b+f*g;v=-o*g+f*b,o=w,f=v,this.mouseWorld.x=o,this.mouseWorld.y=m,this.mouseWorld.z=f,this.mouseWorld.active=!0}),this.canvas.addEventListener("mouseleave",()=>{this.mouseWorld.active=!1}),this.canvas.addEventListener("mouseup",a=>{if(this.showLegend&&this.legendUI&&this.legendUI.visible){e=null;return}if(e){const S=a.clientX-e.x,x=a.clientY-e.y;if(Math.abs(S)>5||Math.abs(x)>5){e=null;return}}e=null;const i=this.canvas.getBoundingClientRect(),r=a.clientX-i.left-this.width/2,d=a.clientY-i.top-this.height/2,u=Math.cos(-this.camera.rotationX),p=Math.sin(-this.camera.rotationX),b=Math.cos(-this.camera.rotationY),g=Math.sin(-this.camera.rotationY);let o=r,m=d,f=(Math.random()-.5)*80,y=m*u-f*p,v=m*p+f*u;m=y,f=v;let w=o*b+f*g;v=-o*g+f*b,o=w,f=v,this.lastInteractionTime=this.totalTime,this.idleSpawnTimer=0;const M=this.pickSmartMolecule(),z=this.spawnMolecule(!1,o,m,f,M,!0);z&&(this.reactionLog.unshift({text:`+ ${z.label} (${z.name})`,time:2}),this.reactionLog.length>5&&this.reactionLog.pop())}),this._keyHandler=a=>{(a.key==="r"||a.key==="R")&&this.restart()},window.addEventListener("keydown",this._keyHandler)}restart(){this.molecules=[],this.stats={reactions:0,maxTier:0},this.discovered=new Set,this.reactionLog=[],this.totalTime=0,this.lastInteractionTime=0,this.idleSpawnTimer=0,this.lightning&&(this.lightning.timer=c.lightningInterval,this.lightning.flash=null),this.reactionBursts=[],this.clearMoleculeFilter(),this.showLegend&&(this.showLegend=!1,this.legendUI.visible=!1,this.legendBtn.toggle(!1)),this.showStats&&(this.showStats=!1,this.statsScene.visible=!1,this.statsBtn.toggle(!1)),this.setCameraDragEnabled(!0),this.camera.rotationX=.2,this.camera.rotationY=0;for(let t=0;t<this.moleculeCount;t++)this.spawnMolecule(!0);this.reactionLog.unshift({text:"~ Simulation restarted",time:3}),console.log("[Day25] Simulation restarted")}createBubble(t=!1){const e=Math.random()<.5?this.width*.08:this.width*.92,l=this.width*.05;return{x:e+(Math.random()-.5)*l,y:t?Math.random()*this.height:this.height+Math.random()*20,size:2+Math.random()*6,speed:40+Math.random()*60,wobblePhase:Math.random()*R,wobbleSpeed:1.5+Math.random()*2.5,alpha:.15+Math.random()*.35}}createParticle(){const t=Math.random()<.3;return{x:Math.random()*this.width,y:Math.random()*this.height,z:(Math.random()-.5)*400,size:1+Math.random()*2,vx:(Math.random()-.5)*8,vy:(Math.random()-.5)*4-2,alpha:.04+Math.random()*.12,hue:t?160+Math.random()*40:190+Math.random()*30}}async loadThermalVents(){const t=this.height*.4/2048,s=2048*t;try{this.leftVent=await D.fromURL("./thermal-vent.svg",{x:0,y:this.height-s*.85,scale:t,centerPath:!1,color:"#000"}),this.rightVent=await D.fromURL("./thermal-vent.svg",{x:this.width,y:this.height-s*.85,scale:t,centerPath:!1,color:"#000",scaleX:-1}),console.log("[Day25] Thermal vents loaded")}catch(e){console.warn("[Day25] Failed to load thermal vents:",e)}}createLightning(){this.lightning=new q(this,{interval:c.lightningInterval,variance:c.lightningVariance,radius:c.lightningRadius,energy:c.lightningEnergy,zIndex:100,onStrike:(t,s,e,l)=>{const h=this.width/2,n=this.height/2;for(const a of this.molecules){const i=this.camera.project(a.x,a.y,a.z),r=h+i.x,d=n+i.y,u=r-t,p=d-s,b=Math.sqrt(u*u+p*p);if(b<e){const g=1-b/e;a.temperature=Math.min(1,a.temperature+l*g),a.flash=Math.max(a.flash,g*.5)}}this.lightningCull(t,s),this.lightningSpawn(t,s)}}),this.pipeline.add(this.lightning)}lightningCull(t,s){if(this.molecules.length<15)return;const e={};for(const r of this.molecules)e[r.templateKey]=(e[r.templateKey]||0)+1;const l=[],h=this.width/2,n=this.height/2;for(let r=0;r<this.molecules.length;r++){const d=this.molecules[r],u=e[d.templateKey],p=u>5,b=d.tier===0&&this.stats.maxTier>=2&&u>3;if(p||b){const g=this.camera.project(d.x,d.y,d.z),o=Math.sqrt(Math.pow(h+g.x-t,2)+Math.pow(n+g.y-s,2));l.push({index:r,dist:o,key:d.templateKey})}}l.sort((r,d)=>r.dist-d.dist);const a=new Set,i={};for(const r of l){if(a.size>=3)break;(i[r.key]||0)>=2||(a.add(r.index),i[r.key]=(i[r.key]||0)+1,e[r.key]--)}a.size>0&&(this.molecules=this.molecules.filter((r,d)=>!a.has(d)))}lightningSpawn(t,s){if(this.stats.maxTier<2||Math.random()>.15)return;const e=["serine","cysteine","asparticAcid","diglycine"];this.stats.maxTier>=3&&e.push("adenine","cytosine","guanine","uracil");const l=e[Math.floor(Math.random()*e.length)],h=t-this.width/2+(Math.random()-.5)*50,n=s-this.height/2+(Math.random()-.5)*50,a=(Math.random()-.5)*100,i=new $(this,l,{x:h,y:n,z:a});i.temperature=.8,i.flash=1,i.vx=(Math.random()-.5)*30,i.vy=(Math.random()-.5)*30,i.vz=(Math.random()-.5)*30,this.molecules.push(i),this.discovered.add(l),this.stats.maxTier=Math.max(this.stats.maxTier,i.tier),this.reactionLog.unshift({text:`⚡ ${i.label} synthesized!`,time:3}),this.reactionLog.length>5&&this.reactionLog.pop()}createUI(){const t=C.isMobile,s=t?36:44,e=t?'16px "Fira Code", monospace':'18px "Fira Code", monospace',l=this.height-60,h=20;this.buttonBar=new G(this,{anchor:"bottom-left",spacing:10,x:h,y:l}),this.pipeline.add(this.buttonBar),this.infoBtn=new B(this,{text:"i",width:s,height:s,font:e,startToggled:this.showInfo,onToggle:n=>{this.showInfo=n}}),this.buttonBar.add(this.infoBtn),this.legendBtn=new B(this,{text:"?",width:s,height:s,font:e,startToggled:this.showLegend,onToggle:n=>{this.showLegend=n,this.legendUI&&(this.legendUI.visible=n),this.setCameraDragEnabled(!n)}}),this.buttonBar.add(this.legendBtn),this.showStats=!1,this.moleculeFilter=null,this.statsBtn=new B(this,{text:"#",width:s,height:s,font:e,startToggled:this.showStats,onToggle:n=>{this.showStats=n,this.statsScene&&(this.statsScene.visible=n),n||this.clearMoleculeFilter()}}),this.buttonBar.add(this.statsBtn),this.createLegendDialog(),this.createStatsDialog()}createLegendDialog(){this.legendUI=new A(this),this.pipeline.add(this.legendUI)}createStatsDialog(){const t=C.isMobile,s=t?70:90,e=18,l=2,h=t?8:10,n=l*s+40,a=t?380:480;this.statsScene=new U(this,{width:n,height:a}),this.statsScene.x=this.width-n/2-20,this.statsScene.y=this.height/2,this.statsScene.visible=!1;const i=new Y({width:n,height:a,color:"rgba(0, 10, 15, 0.95)",stroke:"#999",lineWidth:2}),r=W.create(this,i,{name:"statsBackground"});this.statsScene.add(r);const d=new j(this,{spacing:10,padding:10});this.statsScene.add(d);const u=new P(this,"MOLECULE COUNTS",{font:`bold ${h+2}px "Fira Code", monospace`,color:"#0f0",align:"center",baseline:"middle"});d.add(u);const p=new O(this,{columns:l,spacing:4,padding:4});d.add(p),this.statsButtons={};const b=Object.keys(k);for(const g of b){const o=k[g],m=new B(this,{text:`${o.name}: 0`,width:s,height:e,font:`${h}px "Fira Code", monospace`,startToggled:!1,onToggle:f=>{if(f){this.setMoleculeFilter(g);for(const[y,v]of Object.entries(this.statsButtons))y!==g&&v.toggled&&v.toggle(!1)}else this.clearMoleculeFilter()}});m._moleculeKey=g,this.statsButtons[g]=m,p.add(m)}this.pipeline.add(this.statsScene)}updateStatsLabels(){if(!this.showStats||!this.statsButtons)return;const t={};for(const s of this.molecules)t[s.templateKey]=(t[s.templateKey]||0)+1;for(const s of Object.keys(k)){const e=k[s],l=t[s]||0,h=this.statsButtons[s];h&&h.label&&(h.label.text=`${e.name}: ${l}`)}}setMoleculeFilter(t){this.moleculeFilter=t;for(const s of this.molecules)s.dimmed=s.templateKey!==t}clearMoleculeFilter(){this.moleculeFilter=null;for(const t of this.molecules)t.dimmed=!1;if(this.statsButtons)for(const t of Object.values(this.statsButtons))t.toggled&&t.toggle(!1)}spawnMolecule(t=!1,s,e,l,h,n=!1){const a=Math.min(c.maxMolecules,(this.moleculeCount||c.baseMolecules)*3);if(!n&&this.molecules.length>=a)return null;const i=h||(t?E[Math.floor(Math.random()*E.length)]:Object.keys(k)[Math.floor(Math.random()*Object.keys(k).length)]),r=s??(Math.random()-.5)*this.worldWidth,d=e??(Math.random()-.5)*this.worldHeight,u=l??(Math.random()-.5)*c.worldDepth,p=new $(this,i,{x:r,y:d,z:u});return this.moleculeFilter&&(p.dimmed=i!==this.moleculeFilter),this.molecules.push(p),this.discovered.add(i),p}isTierDiscovered(t){const s=this.tierRequirements[t];return s?s.every(e=>this.discovered.has(e)):!0}areNucleobasesUnlocked(){return this.isTierDiscovered(0)&&this.isTierDiscovered(1)&&this.isTierDiscovered(2)&&this.isTierDiscovered(3)}pickSmartMolecule(){const t={};for(const h of this.molecules)t[h.templateKey]=(t[h.templateKey]||0)+1;const s=["formaldehyde","hydrogenCyanide","glycine","methane","ammonia","water","carbonDioxide","hydrogenSulfide","hydrogen","alanine"];for(const h of s)if((t[h]||0)===0)return console.log("[Spawner] ZERO:",h),h;for(const h of s){const n=t[h]||0;if(n<3)return console.log("[Spawner] LOW (<3):",h,n),h}for(const h of s){const n=t[h]||0;if(n<8)return console.log("[Spawner] MED (<8):",h,n),h}let e=s[0],l=t[s[0]]||0;for(const h of s){const n=t[h]||0;n<l&&(e=h,l=n)}return console.log("[Spawner] LOWEST:",e,l),e}spawnFromOffscreen(){const t=Math.min(c.maxMolecules,this.moleculeCount*3);if(this.molecules.length>=t)return null;const s=this.pickSmartMolecule(),e=Math.random()<.5,l=100,h=e?-this.worldWidth/2-l:this.worldWidth/2+l,n=(Math.random()-.5)*this.worldHeight*.8,a=(Math.random()-.5)*c.worldDepth*.6,i=new $(this,s,{x:h,y:n,z:a});return i.vx=e?15+Math.random()*10:-15-Math.random()*10,i.vy=(Math.random()-.5)*5,i.vz=(Math.random()-.5)*5,i.temperature=.5,this.moleculeFilter&&(i.dimmed=s!==this.moleculeFilter),this.molecules.push(i),i}spawnReactionBurst(t,s,e,l){const h=Math.floor(12+l*25),n=250+l*200;for(let a=0;a<h;a++){const i=Math.random()*R,r=Math.acos(2*Math.random()-1),d=n*(.6+Math.random()*.4);this.reactionBursts.push({x:t,y:s,z:e,vx:Math.sin(r)*Math.cos(i)*d,vy:Math.sin(r)*Math.sin(i)*d,vz:Math.cos(r)*d,life:1,size:1.5+Math.random()*2})}}checkReactions(){const t=new Set,s=[];for(let e=0;e<this.molecules.length;e++){const l=this.molecules[e];if(!(l.reactionCooldown>0||t.has(e)))for(let h=e+1;h<this.molecules.length;h++){const n=this.molecules[h];if(n.reactionCooldown>0||t.has(h))continue;const a=n.x-l.x,i=n.y-l.y,r=n.z-l.z;if(Math.sqrt(a*a+i*i+r*r)>c.reactionDistance)continue;const u=(l.temperature+n.temperature)/2;for(const p of K){const[b,g]=p.reactants;if(!(l.templateKey===b&&n.templateKey===g||l.templateKey===g&&n.templateKey===b)||p.products.some(x=>["adenine","cytosine","uracil","guanine"].includes(x))&&!this.areNucleobasesUnlocked())continue;const f=c.baseReactionChance*(u/p.minTemp);if(u<p.minTemp*.8||Math.random()>f)continue;t.add(e),t.add(h);const y=(l.x+n.x)/2,v=(l.y+n.y)/2,w=(l.z+n.z)/2;for(const x of p.products){if(!k[x])continue;const L=(Math.random()-.5)*20,T=new $(this,x,{x:y+L,y:v+L,z:w+L});T.temperature=u,T.flash=1,T.reactionCooldown=c.reactionCooldown,T.vx=(l.vx+n.vx)/2+(Math.random()-.5)*15,T.vy=(l.vy+n.vy)/2+(Math.random()-.5)*15,T.vz=(l.vz+n.vz)/2+(Math.random()-.5)*15,this.moleculeFilter&&(T.dimmed=x!==this.moleculeFilter),s.push(T),this.discovered.add(x),this.stats.maxTier=Math.max(this.stats.maxTier,T.tier)}this.spawnReactionBurst(y,v,w,p.energy),this.stats.reactions++;const M=x=>`${x.label} (${x.name})`,z=[M(l),M(n)].join(" + "),S=p.products.map(x=>{const L=k[x];return L?`${L.label} (${L.name})`:x}).join(" + ");this.reactionLog.unshift({text:`${z} → ${S}`,time:4}),this.reactionLog.length>5&&this.reactionLog.pop(),Math.random()<.5&&this.spawnFromOffscreen();break}}}this.molecules=this.molecules.filter((e,l)=>!t.has(l));for(const e of s)this.molecules.push(e)}applySeparation(t){const s=c.separationPadding,e=c.separationStiffness,l=c.collisionDamping;for(let h=0;h<this.molecules.length;h++){const n=this.molecules[h],a=n.boundingRadius+s;for(let i=h+1;i<this.molecules.length;i++){const r=this.molecules[i],d=r.boundingRadius+s,u=r.x-n.x,p=r.y-n.y,b=r.z-n.z,g=u*u+p*p+b*b,o=a+d;if(g<o*o&&g>.001){const m=Math.sqrt(g),f=o-m,y=u/m,v=p/m,w=b/m,M=f*e*.5;n.x-=y*M,n.y-=v*M,n.z-=w*M,r.x+=y*M,r.y+=v*M,r.z+=w*M;const z=n.vx*y+n.vy*v+n.vz*w,S=r.vx*y+r.vy*v+r.vz*w;if(z>S){const L=(z-S)*l;n.vx-=y*L*.5,n.vy-=v*L*.5,n.vz-=w*L*.5,r.vx+=y*L*.5,r.vy+=v*L*.5,r.vz+=w*L*.5}}}}}heatTransfer(){for(let t=0;t<this.molecules.length;t++){const s=this.molecules[t];for(let e=t+1;e<this.molecules.length;e++){const l=this.molecules[e],h=l.x-s.x,n=l.y-s.y,a=l.z-s.z,i=Math.sqrt(h*h+n*n+a*a);if(i<c.heatTransferDist){const r=V(s.temperature,l.temperature,i,c.heatTransferDist,c.heatTransferRate,1);s.temperature=Math.max(0,Math.min(1,s.temperature+r)),l.temperature=Math.max(0,Math.min(1,l.temperature-r))}}}}update(t){if(super.update(t),this.camera.update(t),this.totalTime+=t,this.totalTime-this.lastInteractionTime>=c.idleSpawnDelay&&(this.idleSpawnTimer+=t,this.idleSpawnTimer>=c.idleSpawnInterval)){this.idleSpawnTimer=0;const e=this.spawnFromOffscreen();e&&(this.reactionLog.unshift({text:`~ ${e.label} drifted in`,time:2}),this.reactionLog.length>5&&this.reactionLog.pop())}for(const e of this.bubbles)e.y-=e.speed*t,e.wobblePhase+=e.wobbleSpeed*t,e.x+=Math.sin(e.wobblePhase)*.5,e.y<-20&&Object.assign(e,this.createBubble(!1));for(const e of this.particles)e.x+=e.vx*t,e.y+=e.vy*t,e.vx+=(Math.sin(this.totalTime*.5+e.y*.01)*2-e.vx*.1)*t,e.vy+=(Math.cos(this.totalTime*.3+e.x*.01)*1-e.vy*.1)*t,e.x<0&&(e.x=this.width),e.x>this.width&&(e.x=0),e.y<0&&(e.y=this.height),e.y>this.height&&(e.y=0);for(const e of this.reactionBursts)e.x+=e.vx*t,e.y+=e.vy*t,e.z+=e.vz*t,e.life-=t*2.5,e.vx*=.98,e.vy*=.98,e.vz*=.98;this.reactionBursts=this.reactionBursts.filter(e=>e.life>0);for(const e of this.molecules){e.update(t);const l=50,h=80,n=c.worldDepth/2;e.x<-this.worldWidth/2-l&&(e.vx+=h*t),e.x>this.worldWidth/2+l&&(e.vx-=h*t),e.y<-this.worldHeight/2-l&&(e.vy+=h*t),e.y>this.worldHeight/2+l&&(e.vy-=h*t),e.z<-n&&(e.vz+=h*.6*t),e.z>n&&(e.vz-=h*.6*t);const a=(e.y+this.worldHeight/2)/this.worldHeight;if(a>c.heatZone){const i=(a-c.heatZone)/(1-c.heatZone);e.temperature=Math.min(1,e.temperature+c.heatRate*i*t)}else if(a<c.coolZone){const i=(c.coolZone-a)/c.coolZone;e.temperature=Math.max(0,e.temperature-c.heatRate*i*t)}else{const i=(c.neutralTemp-e.temperature)*.02*t;e.temperature+=i}if(this.mouseWorld.active){const i=e.x-this.mouseWorld.x,r=e.y-this.mouseWorld.y,d=i*i+r*r,u=150,p=400;if(d<u*u&&d>1){const g=Math.sqrt(d),o=(1-g/u)*p*t;e.vx+=i/g*o,e.vy+=r/g*o,e.vz+=(Math.random()-.5)*o*.3}const b=c.mouseHeatRadius*c.mouseHeatRadius;if(d<b&&d>1){const g=Math.sqrt(d),o=Math.pow(1-g/c.mouseHeatRadius,c.mouseHeatFalloff);e.temperature=Math.min(1,e.temperature+c.mouseHeatRate*o*t)}}}this.applySeparation(t),this.heatTransfer(),this.checkReactions();for(const e of this.reactionLog)e.time-=t;this.reactionLog=this.reactionLog.filter(e=>e.time>0),this.updateStatsLabels()}render(){const t=this.ctx,s=this.width,e=this.height,l=s/2,h=e/2,n=t.createLinearGradient(0,0,0,e);n.addColorStop(0,"#000508"),n.addColorStop(.3,"#001015"),n.addColorStop(.6,"#001a1a"),n.addColorStop(.85,"#002020"),n.addColorStop(1,"#001515"),t.fillStyle=n,t.fillRect(0,0,s,e),t.globalAlpha=.015;const a=this.totalTime*c.causticSpeed;for(let o=0;o<4;o++){const m=o*1.5+a*.5,f=s*(.2+o*.2)+Math.sin(m)*s*.05,y=t.createLinearGradient(f,0,f+s*.1,e*.6);y.addColorStop(0,"rgba(100, 200, 255, 0.8)"),y.addColorStop(.5,"rgba(50, 150, 200, 0.3)"),y.addColorStop(1,"transparent"),t.fillStyle=y,t.fillRect(f-20,0,40,e*.6)}t.globalAlpha=1;const i=s*.08,r=t.createRadialGradient(i,e+30,0,i,e+30,e*.45);r.addColorStop(0,`rgba(255, 100, 20, ${c.ventGlow*.6})`),r.addColorStop(.2,`rgba(255, 60, 10, ${c.ventGlow*.4})`),r.addColorStop(.5,`rgba(100, 40, 10, ${c.ventGlow*.2})`),r.addColorStop(1,"transparent"),t.fillStyle=r,t.fillRect(0,0,s,e);const d=s*.92,u=t.createRadialGradient(d,e+30,0,d,e+30,e*.45);u.addColorStop(0,`rgba(255, 80, 15, ${c.ventGlow*.5})`),u.addColorStop(.2,`rgba(255, 50, 10, ${c.ventGlow*.35})`),u.addColorStop(.5,`rgba(80, 30, 10, ${c.ventGlow*.15})`),u.addColorStop(1,"transparent"),t.fillStyle=u,t.fillRect(0,0,s,e),t.globalAlpha=.02;const p=100;for(let o=0;o<3;o++){const m=o*2.1+a,f=s*(.3+o*.2)+Math.sin(m)*s*.15,y=e*(.3+o*.1)+Math.cos(m*.7)*e*.1,v=t.createRadialGradient(f,y,0,f,y,p);v.addColorStop(0,"rgba(0, 255, 150, 1)"),v.addColorStop(.5,"rgba(0, 200, 100, 0.5)"),v.addColorStop(1,"transparent"),t.fillStyle=v,t.fillRect(0,0,s,e)}t.globalAlpha=1;for(const o of this.bubbles){const m=t.createRadialGradient(o.x-o.size*.3,o.y-o.size*.3,0,o.x,o.y,o.size);m.addColorStop(0,`rgba(200, 230, 255, ${o.alpha*.4})`),m.addColorStop(.4,`rgba(150, 200, 230, ${o.alpha*.15})`),m.addColorStop(.8,`rgba(100, 180, 220, ${o.alpha*.1})`),m.addColorStop(1,`rgba(80, 150, 200, ${o.alpha*.05})`),t.fillStyle=m,t.beginPath(),t.arc(o.x,o.y,o.size,0,R),t.fill(),t.strokeStyle=`rgba(180, 220, 255, ${o.alpha*.3})`,t.lineWidth=.5,t.stroke(),t.fillStyle=`rgba(255, 255, 255, ${o.alpha*.6})`,t.beginPath(),t.arc(o.x-o.size*.3,o.y-o.size*.35,o.size*.2,0,R),t.fill()}this.leftVent&&this.leftVent.render(),this.rightVent&&this.rightVent.render();for(const o of this.particles){const m=.5+(o.z+200)/400*.5;t.fillStyle=`hsla(${o.hue}, ${o.hue>150?60:30}%, ${o.hue>150?60:70}%, ${o.alpha*m})`,t.beginPath(),t.arc(o.x,o.y,o.size*m,0,R),t.fill()}const b=[...this.molecules].sort((o,m)=>{const f=this.camera.project(o.x,o.y,o.z),y=this.camera.project(m.x,m.y,m.z);return f.z-y.z});for(const o of b)o.dimmed&&(t.globalAlpha=.15),o.render(l,h),o.dimmed&&(t.globalAlpha=1);t.globalCompositeOperation="lighter";for(const o of this.reactionBursts){const m=this.camera.project(o.x,o.y,o.z);if(m.scale<=0)continue;const f=l+m.x,y=h+m.y,v=o.size*m.scale,w=o.life;t.fillStyle=`rgba(255, 255, 255, ${w})`,t.beginPath(),t.arc(f,y,v,0,R),t.fill()}t.globalCompositeOperation="source-over";const g=t.createRadialGradient(l,h,Math.min(s,e)*.35,l,h,Math.max(s,e)*.85);if(g.addColorStop(0,"transparent"),g.addColorStop(.7,"rgba(0, 5, 15, 0.3)"),g.addColorStop(1,"rgba(0, 2, 8, 0.7)"),t.fillStyle=g,t.fillRect(0,0,s,e),this.showInfo){const o=C.isMobile,m=o?9:11,f=o?14:18,y=o?s-30:s*.5;t.font=`${m}px "Fira Code", monospace`,t.textAlign="left";let v=25;for(const M of this.reactionLog){const z=Math.min(1,M.time);t.fillStyle=`rgba(0, 255, 100, ${z*.9})`;let S=M.text;if(o&&t.measureText(S).width>y){for(;t.measureText(S+"…").width>y&&S.length>10;)S=S.slice(0,-1);S+="…"}t.fillText(S,15,v),v+=f}t.fillStyle="rgba(0, 255, 120, 0.7)",t.textAlign="right",t.fillText(`Molecules: ${this.molecules.length}`,s-15,25),t.fillText(`Reactions: ${this.stats.reactions}`,s-15,25+f);const w=["Primordial","Precursors","Amino Acids","Peptides","Nucleobases"];t.fillText(`Max tier: ${w[this.stats.maxTier]||"???"}`,s-15,25+f*2)}this.pipeline.render(t),this.legendUI&&this.legendUI.renderPreview(t)}stop(){this._keyHandler&&window.removeEventListener("keydown",this._keyHandler),super.stop()}}function st(I){const t=new _(I);return t.start(),{stop:()=>t.stop(),game:t}}export{st as default};
