import{G as J,P as N,T as K,d as Q,I as U,z as $,t as tt,e as et,h as ot,f as st}from"./gcanvas.es-Cc1M3jca.js";const t={render:{scaleFactor:2,blendMode:"screen"},ui:{buttonWidth:96,buttonHeight:34,buttonOffsetX:16,buttonOffsetY:16,onLabel:"LIGHTS:ON",offLabel:"LIGHTS:OFF"},physics:{gravity:52e-6,buoyancyStrength:18e-5,maxSpeed:88e-5,dampingX:.995,dampingY:.998,driftSpeedMin:.165,driftSpeedRange:.165,driftAmountMin:55e-7,driftAmountRange:44e-7,wobbleForce:11e-6,wobbleZoneTop:.2,wobbleZoneBottom:.7,repulsionStrength:4e-5,repulsionRange:2.5,chaosStrength:8e-6,chaosTempFactor:1.5},temperature:{tempRate:.008,heatZoneY:.85,coolZoneY:.15,heatZoneMultiplier:2,coolZoneMultiplier:.8,middleZoneMultiplier:.03,transitionWidth:.25,heatTransferRate:.005,heatTransferRange:1.8},spawning:{initialSpawnMin:2,initialSpawnRange:2,spawnMin:3,spawnRange:3,spawnOffsetY:.01,spawnOffsetYRange:.01,spawnOffsetX:.02,initialRadius:.005,targetRadiusMin:.04,targetRadiusRange:.025,growthRate:.0165,growthThreshold:.7,initialRiseVelocity:-22e-5,maxBlobs:5,poolClearThreshold:.75},boundaries:{left:.1,right:.9,top:-.1,bounce:-.3,removalY:1.15},deformation:{stretchBase:.75,stretchTempFactor:.5,wobble1Speed:1.32,wobble1Amount:.12,wobble2Speed:.88,wobble2PhaseFactor:1.7,wobble2Amount:.08},metaballs:{threshold:1,edgeWidth:.15,poolGlowStart:.7,poolGlowBoost:.4,brightnessBase:.35,brightnessTempFactor:1,glowMax:.2,glowFactor:.1,glowR:50,glowG:90,glowB:35},lights:{heatTransitionSpeed:.4,coolDownRate:.015,poolCoolRate:.008},palette:{hue1:.33,hue2:.39}};function P(O){return Math.max(0,Math.min(1,O))}class it extends J{constructor(o){super(o),this.backgroundColor="#000"}init(){super.init(),N.init(this.ctx),this.container=this.canvas.parentElement,this.container&&this.enableFluidSize(this.container),this.time=0,this.lastSpawnTime=0,this.spawnInterval=t.spawning.initialSpawnMin+Math.random()*t.spawning.initialSpawnRange,this.lampOn=!0,this.heatLevel=1,this.poolTemp=1,this.handleResize(),this.shuffleColors(),this.poolBlobs=[{x:.2,y:1.02,r:.06},{x:.35,y:1,r:.065},{x:.5,y:1.02,r:.07},{x:.65,y:1,r:.065},{x:.8,y:1.02,r:.06}],this.blobs=[{x:.5,y:.6,vx:0,vy:-2e-4,r:.05,targetR:.05,temp:.8}],this.powerButton=new K(this,{text:t.ui.onLabel,width:t.ui.buttonWidth,height:t.ui.buttonHeight,startToggled:!0,colorDefaultBg:"#000",colorStroke:"#1a1a1a",colorText:"#aaffaa",colorActiveBg:"rgba(0, 255, 0, 0.05)",colorActiveStroke:"#0f0",colorActiveText:"#0f0",onToggle:o=>{this.lampOn=o,this.powerButton.label.text=o?t.ui.onLabel:t.ui.offLabel}}),Q(this.powerButton,{anchor:st.TOP_LEFT,anchorOffsetX:t.ui.buttonOffsetX,anchorOffsetY:t.ui.buttonOffsetY}),this.pipeline.add(this.lavaImage),this.pipeline.add(this.powerButton)}handleResize(){this._lastCanvasW=this.width,this._lastCanvasH=this.height,this.renderWidth=Math.max(1,Math.floor(this.width/t.render.scaleFactor)),this.renderHeight=Math.max(1,Math.floor(this.height/t.render.scaleFactor)),this.imageData=N.img.createImageData(this.renderWidth,this.renderHeight),this.lavaImage?(this.lavaImage.shape.bitmap=this.imageData,this.lavaImage.width=this.width,this.lavaImage.height=this.height):this.lavaImage=new U(this,this.imageData,{x:0,y:0,width:this.width,height:this.height,anchor:"top-left"})}shuffleColors(){const o=t.palette.hue1,p=t.palette.hue2;this.colors={blob1:this.hslToRgb(o,.95,.55),blob2:this.hslToRgb(p,.9,.5),bgTop:this.hslToRgb(o,.5,.04),bgBottom:this.hslToRgb(p,.55,.08)}}hslToRgb(o,p,e){const a=(1-Math.abs(2*e-1))*p,g=a*(1-Math.abs(o*6%2-1)),d=e-a/2;let s,r,h;return o<1/6?[s,r,h]=[a,g,0]:o<2/6?[s,r,h]=[g,a,0]:o<3/6?[s,r,h]=[0,a,g]:o<4/6?[s,r,h]=[0,g,a]:o<5/6?[s,r,h]=[g,0,a]:[s,r,h]=[a,0,g],[Math.floor((s+d)*255),Math.floor((r+d)*255),Math.floor((h+d)*255)]}update(o){super.update(o),this.time+=o,(this.width!==this._lastCanvasW||this.height!==this._lastCanvasH)&&this.handleResize();const p=this.lampOn?1:0;this.heatLevel+=(p-this.heatLevel)*t.lights.heatTransitionSpeed*o*60,this.heatLevel=P(this.heatLevel),this.lampOn?this.poolTemp+=(1-this.poolTemp)*t.lights.poolCoolRate*2*o*60:this.poolTemp+=(0-this.poolTemp)*t.lights.poolCoolRate*o*60,this.poolTemp=P(this.poolTemp),this.lampOn&&this.poolTemp>.7&&this.time-this.lastSpawnTime>this.spawnInterval&&!this.blobs.some(a=>a.y>t.spawning.poolClearThreshold&&!a.growing)&&(this.spawnBlob(),this.lastSpawnTime=this.time,this.spawnInterval=t.spawning.spawnMin+Math.random()*t.spawning.spawnRange),this.updateBlobs(o),this.renderLava(),this.lavaImage.shape.bitmap=this.imageData,this.lavaImage.x=0,this.lavaImage.y=0,this.lavaImage.width=this.width,this.lavaImage.height=this.height}render(){this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.globalCompositeOperation=t.render.blendMode,this.pipeline.render(),this.ctx.globalCompositeOperation="source-over"}spawnBlob(){const o=this.poolBlobs[Math.floor(Math.random()*this.poolBlobs.length)];this.blobs.push({x:o.x+(Math.random()-.5)*t.spawning.spawnOffsetX,y:o.y+t.spawning.spawnOffsetY+Math.random()*t.spawning.spawnOffsetYRange,vx:0,vy:0,r:t.spawning.initialRadius,targetR:t.spawning.targetRadiusMin+Math.random()*t.spawning.targetRadiusRange,temp:1,growing:!0}),this.blobs.length>t.spawning.maxBlobs&&this.blobs.shift()}updateBlobs(o){const p={heatZone:t.temperature.heatZoneY,coolZone:t.temperature.coolZoneY,rate:t.temperature.tempRate,transitionWidth:t.temperature.transitionWidth,heatMultiplier:t.temperature.heatZoneMultiplier*this.heatLevel,coolMultiplier:t.temperature.coolZoneMultiplier+(1-this.heatLevel)*2,middleMultiplier:t.temperature.middleZoneMultiplier+(1-this.heatLevel)*.3};for(const e of this.blobs){e.temp=$(e.y,e.temp,p),this.lampOn||(e.temp-=t.lights.coolDownRate*o*60,e.temp=Math.max(0,e.temp)),e.vy-=tt(e.temp,.5,t.physics.buoyancyStrength),e.vy+=et(e.r,t.spawning.targetRadiusMin,t.physics.gravity),e.targetR&&e.r<e.targetR&&(e.r+=(e.targetR-e.r)*t.spawning.growthRate,e.growing&&e.r>e.targetR*t.spawning.growthThreshold&&(e.growing=!1,e.vy=t.spawning.initialRiseVelocity));for(const s of this.blobs){if(s===e)continue;const r=s.x-e.x,h=s.y-e.y,f=Math.sqrt(r*r+h*h),F=e.r+s.r,W=F*t.temperature.heatTransferRange;e.temp+=ot(e.temp,s.temp,f,W,t.temperature.heatTransferRate);const I=F*t.physics.repulsionRange;if(f<I&&f>.001){const b=1-f/I,w=b*b*t.physics.repulsionStrength,v=1/f;e.vx-=r*v*w*1.5,e.vy-=h*v*w*.3}}e.temp=P(e.temp);const a=t.physics.chaosStrength*(.3+e.temp*t.physics.chaosTempFactor);e.vx+=(Math.random()-.5)*a,e.vy+=(Math.random()-.5)*a*.5,e.vx*=t.physics.dampingX,e.vy*=t.physics.dampingY,e.driftPhase||(e.driftPhase=Math.random()*Math.PI*2),e.driftSpeed||(e.driftSpeed=t.physics.driftSpeedMin+Math.random()*t.physics.driftSpeedRange),e.driftAmount||(e.driftAmount=t.physics.driftAmountMin+Math.random()*t.physics.driftAmountRange);const g=Math.sin(this.time*e.driftSpeed+e.driftPhase)*e.driftAmount;e.vx+=g,(e.y<t.physics.wobbleZoneTop||e.y>t.physics.wobbleZoneBottom)&&(e.vx+=(Math.random()-.5)*t.physics.wobbleForce),e.x+=e.vx,e.y+=e.vy,e.x<t.boundaries.left&&(e.x=t.boundaries.left,e.vx*=t.boundaries.bounce),e.x>t.boundaries.right&&(e.x=t.boundaries.right,e.vx*=t.boundaries.bounce),e.y<t.boundaries.top&&(e.y=t.boundaries.top,e.vy*=t.boundaries.bounce,e.temp=0),e.y>t.boundaries.removalY&&e.vy>0&&!e.growing&&(e.removeMe=!0);const d=Math.sqrt(e.vx*e.vx+e.vy*e.vy);d>t.physics.maxSpeed&&(e.vx=e.vx/d*t.physics.maxSpeed,e.vy=e.vy/d*t.physics.maxSpeed)}this.blobs=this.blobs.filter(e=>!e.removeMe)}renderLava(){const o=this.imageData.data,p=this.renderWidth,e=this.renderHeight,a=1/p,g=1/e,d=.4+this.heatLevel*.6,s=.12+this.heatLevel*.88,r=this.poolTemp,h=this.poolBlobs.map(i=>({x:i.x,y:i.y,rSq:i.r*i.r})),f=this.blobs.map(i=>{const c=i.driftPhase||0,x=.3+i.temp*.7,M=Math.sin(this.time*t.deformation.wobble1Speed+c)*t.deformation.wobble1Amount*x,R=Math.sin(this.time*t.deformation.wobble2Speed+c*t.deformation.wobble2PhaseFactor)*t.deformation.wobble2Amount*x,y=t.deformation.stretchBase+i.temp*t.deformation.stretchTempFactor+M,T=1+R;return{x:i.x,y:i.y,rSq:i.r*i.r,temp:i.temp,invStretch:1/y,stretchSkew:y*T}}),F=this.colors.bgBottom[0]-this.colors.bgTop[0],W=this.colors.bgBottom[1]-this.colors.bgTop[1],I=this.colors.bgBottom[2]-this.colors.bgTop[2],b=this.colors.blob1,w=this.colors.blob2,v=this.colors.bgTop,Z=t.metaballs.threshold,q=Z-t.metaballs.edgeWidth,V=1/t.metaballs.edgeWidth;for(let i=0;i<e;i++){const c=i*g,x=c>t.metaballs.poolGlowStart?(c-t.metaballs.poolGlowStart)/(1-t.metaballs.poolGlowStart):0,M=x*x*t.metaballs.poolGlowBoost*this.heatLevel,R=(v[0]+F*c+b[0]*M)*s,y=(v[1]+W*c+b[1]*M*.6)*s,T=(v[2]+I*c+b[2]*M*.3)*s;for(let D=0;D<p;D++){const k=D*a,m=i*p+D<<2;let u=0,C=0;for(let n=0;n<h.length;n++){const l=h[n],S=l.x-k,B=l.y-c,H=S*S+B*B+1e-4,L=l.rSq/H;u+=L,C+=L*r}for(let n=0;n<f.length;n++){const l=f[n],S=l.x-k,B=l.y-c,H=S*S*l.stretchSkew+B*B*l.invStretch+1e-4,L=l.rSq/H;u+=L,C+=L*l.temp}if(u<q){o[m]=R,o[m+1]=y,o[m+2]=T,o[m+3]=255;continue}u>0&&(C/=u);const X=c,j=C*this.heatLevel,A=(t.metaballs.brightnessBase+X*t.metaballs.brightnessTempFactor)*(.5+j*.5)*s,G=X*d,Y=1-G,z=(b[0]*Y+w[0]*G)*A,_=(b[1]*Y+w[1]*G)*A,E=(b[2]*Y+w[2]*G)*A;if(u>=Z){const n=Math.min((u-Z)*t.metaballs.glowFactor*this.heatLevel,t.metaballs.glowMax*this.heatLevel);o[m]=Math.min(255,z+n*t.metaballs.glowR),o[m+1]=Math.min(255,_+n*t.metaballs.glowG),o[m+2]=Math.min(255,E+n*t.metaballs.glowB)}else{const n=(u-q)*V,l=n*n*(3-2*n);o[m]=R+(z-R)*l,o[m+1]=y+(_-y)*l,o[m+2]=T+(E-T)*l}o[m+3]=255}}}}function nt(O){const o=new it(O);return o.start(),{stop:()=>o.stop(),game:o}}export{nt as default};
