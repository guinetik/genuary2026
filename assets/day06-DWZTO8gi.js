import{G as nt,d as st,P as ot,e as ht,f as rt,g as lt,I as ct,z as pt,t as mt,h as ut,i as dt}from"./index-B6QQFJuW.js";const e={render:{blendMode:"screen",dithering:1.2},ui:{buttonWidth:96,buttonHeight:34,buttonOffsetX:16,buttonOffsetY:16,onLabel:"LIGHTS:ON",offLabel:"LIGHTS:OFF"},colorTransition:{speed:.8},mouse:{radius:.15,pushForce:8e-4,heatBoost:.3},physics:{gravity:52e-6,buoyancyStrength:18e-5,maxSpeed:88e-5,dampingX:.995,dampingY:.998,driftSpeedMin:.165,driftSpeedRange:.165,driftAmountMin:55e-7,driftAmountRange:44e-7,wobbleForce:11e-6,wobbleZoneTop:.2,wobbleZoneBottom:.7,repulsionStrength:4e-5,repulsionRange:2.5,chaosStrength:8e-6,chaosTempFactor:1.5},temperature:{tempRate:.008,heatZoneY:.85,coolZoneY:.15,heatZoneMultiplier:2,coolZoneMultiplier:.8,middleZoneMultiplier:.03,transitionWidth:.25,heatTransferRate:.005,heatTransferRange:1.8},spawning:{initialSpawnMin:2,initialSpawnRange:2,spawnMin:3,spawnRange:3,spawnOffsetY:.01,spawnOffsetYRange:.01,spawnOffsetX:.02,initialRadius:.005,targetRadiusMin:.04,targetRadiusRange:.025,growthRate:.0165,growthThreshold:.7,initialRiseVelocity:-22e-5,maxBlobs:8,poolClearThreshold:.75},boundaries:{left:.1,right:.9,top:-.1,bounce:-.3,removalY:1.15},deformation:{stretchBase:.75,stretchTempFactor:.5,wobble1Speed:1.32,wobble1Amount:.12,wobble2Speed:.88,wobble2PhaseFactor:1.7,wobble2Amount:.08},metaballs:{threshold:1,edgeWidth:.18,poolGlowStart:.7,poolGlowBoost:.5,brightnessBase:.4,brightnessTempFactor:1.2,glowMax:.35,glowFactor:.15,hotspotIntensity:.4,hotspotRadius:.3,specularIntensity:.25,specularSize:.15,specularOffset:.3},lights:{heatTransitionSpeed:.4,coolDownRate:.015,poolCoolRate:.008},palettes:[{hue1:.33,hue2:.39,name:"terminal"},{hue1:.05,hue2:.08,name:"lava"},{hue1:.58,hue2:.65,name:"ocean"},{hue1:.75,hue2:.82,name:"cosmic"},{hue1:.12,hue2:.16,name:"sunset"},{hue1:.45,hue2:.52,name:"aqua"},{hue1:.92,hue2:.02,name:"cherry"}]};function Z(G){return Math.max(0,Math.min(1,G))}class gt extends nt{constructor(s){super(s),this.backgroundColor="#000"}init(){super.init(),st.init(this),ot.init(this.ctx),this.container=this.canvas.parentElement,this.container&&this.enableFluidSize(this.container),this.time=0,this.lastSpawnTime=0,this.spawnInterval=e.spawning.initialSpawnMin+Math.random()*e.spawning.initialSpawnRange,this.lampOn=!0,this.heatLevel=1,this.poolTemp=1,this.currentPaletteIndex=0,this.currentHue1=e.palettes[0].hue1,this.currentHue2=e.palettes[0].hue2,this.targetHue1=this.currentHue1,this.targetHue2=this.currentHue2,this.colorTransitionProgress=1,this.handleResize(),this.updateColors(),this.mouseX=-1,this.mouseY=-1,this.mouseActive=!1,this.canvas.addEventListener("mousemove",s=>{const i=this.canvas.getBoundingClientRect();this.mouseX=(s.clientX-i.left)/i.width,this.mouseY=(s.clientY-i.top)/i.height,this.mouseActive=!0}),this.canvas.addEventListener("mouseleave",()=>{this.mouseActive=!1}),this.canvas.addEventListener("click",s=>{const i=this.canvas.getBoundingClientRect(),t=s.clientX-i.left,o=s.clientY-i.top,c=e.ui.buttonOffsetX+e.ui.buttonWidth+20,m=e.ui.buttonOffsetY+e.ui.buttonHeight+20;t<c&&o<m||this.cycleColor()}),this.poolBlobs=[{x:.2,y:1.02,r:.06},{x:.35,y:1,r:.065},{x:.5,y:1.02,r:.07},{x:.65,y:1,r:.065},{x:.8,y:1.02,r:.06}],this.blobs=[{x:.5,y:.6,vx:0,vy:-2e-4,r:.05,targetR:.05,temp:.8}],this.powerButton=new ht(this,{text:e.ui.onLabel,width:e.ui.buttonWidth,height:e.ui.buttonHeight,startToggled:!0,colorDefaultBg:"#000",colorStroke:"#1a1a1a",colorText:"#aaffaa",colorActiveBg:"rgba(0, 255, 0, 0.05)",colorActiveStroke:"#0f0",colorActiveText:"#0f0",onToggle:s=>{this.lampOn=s,this.powerButton.label.text=s?e.ui.onLabel:e.ui.offLabel}}),rt(this.powerButton,{anchor:lt.TOP_LEFT,anchorOffsetX:e.ui.buttonOffsetX,anchorOffsetY:e.ui.buttonOffsetY}),this.pipeline.add(this.lavaImage),this.pipeline.add(this.powerButton)}handleResize(){this._lastCanvasW=this.width,this._lastCanvasH=this.height;const s=st.responsive(1.5,2,3);this.renderWidth=Math.max(1,Math.floor(this.width/s)),this.renderHeight=Math.max(1,Math.floor(this.height/s)),this.imageData=ot.img.createImageData(this.renderWidth,this.renderHeight),this.lavaImage?(this.lavaImage.shape.bitmap=this.imageData,this.lavaImage.width=this.width,this.lavaImage.height=this.height):this.lavaImage=new ct(this,this.imageData,{x:0,y:0,width:this.width,height:this.height,anchor:"top-left"})}cycleColor(){this.currentHue1=this.targetHue1,this.currentHue2=this.targetHue2,this.currentPaletteIndex=(this.currentPaletteIndex+1)%e.palettes.length;const s=e.palettes[this.currentPaletteIndex];this.targetHue1=s.hue1,this.targetHue2=s.hue2,this.colorTransitionProgress=0}updateColors(){const s=(c,m,n)=>{let a=m-c;a>.5&&(a-=1),a<-.5&&(a+=1);let h=c+a*n;return h<0&&(h+=1),h>1&&(h-=1),h},i=this.colorTransitionProgress,t=s(this.currentHue1,this.targetHue1,i),o=s(this.currentHue2,this.targetHue2,i);this.colors={blob1:this.hslToRgb(t,.95,.55),blob2:this.hslToRgb(o,.9,.5),bgTop:this.hslToRgb(t,.5,.04),bgBottom:this.hslToRgb(o,.55,.08),hue1:t,hue2:o}}hslToRgb(s,i,t){const o=(1-Math.abs(2*t-1))*i,c=o*(1-Math.abs(s*6%2-1)),m=t-o/2;let n,a,h;return s<1/6?[n,a,h]=[o,c,0]:s<2/6?[n,a,h]=[c,o,0]:s<3/6?[n,a,h]=[0,o,c]:s<4/6?[n,a,h]=[0,c,o]:s<5/6?[n,a,h]=[c,0,o]:[n,a,h]=[o,0,c],[Math.floor((n+m)*255),Math.floor((a+m)*255),Math.floor((h+m)*255)]}update(s){super.update(s),this.time+=s,(this.width!==this._lastCanvasW||this.height!==this._lastCanvasH)&&this.handleResize();const i=this.lampOn?1:0;this.heatLevel+=(i-this.heatLevel)*e.lights.heatTransitionSpeed*s*60,this.heatLevel=Z(this.heatLevel),this.lampOn?this.poolTemp+=(1-this.poolTemp)*e.lights.poolCoolRate*2*s*60:this.poolTemp+=(0-this.poolTemp)*e.lights.poolCoolRate*s*60,this.poolTemp=Z(this.poolTemp),this.colorTransitionProgress<1&&(this.colorTransitionProgress+=e.colorTransition.speed*s,this.colorTransitionProgress=Z(this.colorTransitionProgress),this.updateColors()),this.lampOn&&this.poolTemp>.7&&this.time-this.lastSpawnTime>this.spawnInterval&&!this.blobs.some(o=>o.y>e.spawning.poolClearThreshold&&!o.growing)&&(this.spawnBlob(),this.lastSpawnTime=this.time,this.spawnInterval=e.spawning.spawnMin+Math.random()*e.spawning.spawnRange),this.updateBlobs(s),this.renderLava(),this.lavaImage.shape.bitmap=this.imageData,this.lavaImage.x=0,this.lavaImage.y=0,this.lavaImage.width=this.width,this.lavaImage.height=this.height}render(){const s=this.ctx,i=this.width,t=this.height;if(s.fillStyle="#000",s.fillRect(0,0,i,t),s.globalCompositeOperation=e.render.blendMode,this.pipeline.render(),s.globalCompositeOperation="source-over",this.heatLevel>.1){const o=s.createLinearGradient(0,0,i*.4,0),c=.04*this.heatLevel;o.addColorStop(0,`rgba(255, 255, 255, ${c})`),o.addColorStop(.3,`rgba(255, 255, 255, ${c*.5})`),o.addColorStop(1,"rgba(255, 255, 255, 0)"),s.fillStyle=o,s.fillRect(0,0,i*.4,t);const m=s.createRadialGradient(i/2,t/2,Math.min(i,t)*.2,i/2,t/2,Math.max(i,t)*.7);m.addColorStop(0,"rgba(0, 0, 0, 0)"),m.addColorStop(1,`rgba(0, 0, 0, ${.3*this.heatLevel})`),s.fillStyle=m,s.fillRect(0,0,i,t)}}spawnBlob(){const s=this.poolBlobs[Math.floor(Math.random()*this.poolBlobs.length)];if(this.blobs.push({x:s.x+(Math.random()-.5)*e.spawning.spawnOffsetX,y:s.y+e.spawning.spawnOffsetY+Math.random()*e.spawning.spawnOffsetYRange,vx:0,vy:0,r:e.spawning.initialRadius,targetR:e.spawning.targetRadiusMin+Math.random()*e.spawning.targetRadiusRange,temp:1,growing:!0}),this.blobs.length>e.spawning.maxBlobs){const t=this.blobs.findIndex((o,c)=>c<this.blobs.length-1&&o.y>.85&&!o.growing);if(t!==-1)this.blobs.splice(t,1);else{const o=this.blobs.findIndex(c=>!c.growing);o!==-1&&this.blobs.splice(o,1)}}}updateBlobs(s){const i={heatZone:e.temperature.heatZoneY,coolZone:e.temperature.coolZoneY,rate:e.temperature.tempRate,transitionWidth:e.temperature.transitionWidth,heatMultiplier:e.temperature.heatZoneMultiplier*this.heatLevel,coolMultiplier:e.temperature.coolZoneMultiplier+(1-this.heatLevel)*2,middleMultiplier:e.temperature.middleZoneMultiplier+(1-this.heatLevel)*.3};for(const t of this.blobs){if(t.temp=pt(t.y,t.temp,i),this.lampOn||(t.temp-=e.lights.coolDownRate*s*60,t.temp=Math.max(0,t.temp)),t.vy-=mt(t.temp,.5,e.physics.buoyancyStrength),t.vy+=ut(t.r,e.spawning.targetRadiusMin,e.physics.gravity),t.squish=0,t.squishAngle=0,this.mouseActive&&this.lampOn){const n=t.x-this.mouseX,a=t.y-this.mouseY,h=Math.sqrt(n*n+a*a),f=e.mouse.radius;if(h<f&&h>.001){const v=1-h/f,S=v*v,M=e.mouse.pushForce*S;t.vx+=n/h*M,t.vy+=a/h*M,t.temp=Math.min(1,t.temp+e.mouse.heatBoost*v*s),t.squish=S*.4,t.squishAngle=Math.atan2(a,n)}}t.targetR&&t.r<t.targetR&&(t.r+=(t.targetR-t.r)*e.spawning.growthRate,t.growing&&t.r>t.targetR*e.spawning.growthThreshold&&(t.growing=!1,t.vy=e.spawning.initialRiseVelocity));for(const n of this.blobs){if(n===t)continue;const a=n.x-t.x,h=n.y-t.y,f=Math.sqrt(a*a+h*h),v=t.r+n.r,S=v*e.temperature.heatTransferRange;t.temp+=dt(t.temp,n.temp,f,S,e.temperature.heatTransferRate);const M=v*e.physics.repulsionRange;if(f<M&&f>.001){const W=1-f/M,g=W*W*e.physics.repulsionStrength,B=1/f;t.vx-=a*B*g*1.5,t.vy-=h*B*g*.3}}t.temp=Z(t.temp);const o=e.physics.chaosStrength*(.3+t.temp*e.physics.chaosTempFactor);t.vx+=(Math.random()-.5)*o,t.vy+=(Math.random()-.5)*o*.5,t.vx*=e.physics.dampingX,t.vy*=e.physics.dampingY,t.driftPhase||(t.driftPhase=Math.random()*Math.PI*2),t.driftSpeed||(t.driftSpeed=e.physics.driftSpeedMin+Math.random()*e.physics.driftSpeedRange),t.driftAmount||(t.driftAmount=e.physics.driftAmountMin+Math.random()*e.physics.driftAmountRange);const c=Math.sin(this.time*t.driftSpeed+t.driftPhase)*t.driftAmount;t.vx+=c,(t.y<e.physics.wobbleZoneTop||t.y>e.physics.wobbleZoneBottom)&&(t.vx+=(Math.random()-.5)*e.physics.wobbleForce),t.x+=t.vx,t.y+=t.vy,t.x<e.boundaries.left&&(t.x=e.boundaries.left,t.vx*=e.boundaries.bounce),t.x>e.boundaries.right&&(t.x=e.boundaries.right,t.vx*=e.boundaries.bounce),t.y<e.boundaries.top&&(t.y=e.boundaries.top,t.vy*=e.boundaries.bounce,t.temp=0),t.y>e.boundaries.removalY&&t.vy>0&&!t.growing&&(t.removeMe=!0);const m=Math.sqrt(t.vx*t.vx+t.vy*t.vy);m>e.physics.maxSpeed&&(t.vx=t.vx/m*e.physics.maxSpeed,t.vy=t.vy/m*e.physics.maxSpeed)}this.blobs=this.blobs.filter(t=>!t.removeMe)}renderLava(){const s=this.imageData.data,i=this.renderWidth,t=this.renderHeight,o=1/i,c=1/t,m=.4+this.heatLevel*.6,n=.12+this.heatLevel*.88,a=e.render.dithering,h=this.poolTemp,f=this.poolBlobs.map(r=>({x:r.x,y:r.y,rSq:r.r*r.r})),v=this.blobs.map(r=>{const b=r.driftPhase||0,O=.3+r.temp*.7,A=Math.sin(this.time*e.deformation.wobble1Speed+b)*e.deformation.wobble1Amount*O,D=Math.sin(this.time*e.deformation.wobble2Speed+b*e.deformation.wobble2PhaseFactor)*e.deformation.wobble2Amount*O;let I=e.deformation.stretchBase+r.temp*e.deformation.stretchTempFactor+A,F=1+D;const x=r.squish||0,T=r.squishAngle||0,d=Math.cos(T),w=Math.sin(T),L=1+x*.8,C=1-x*.5;return{x:r.x,y:r.y,r:r.r,rSq:r.r*r.r,temp:r.temp,invStretch:1/(I*C),stretchSkew:I*F*L,squish:x,squishAngle:T,cosA:d,sinA:w,specX:r.x-r.r*e.metaballs.specularOffset,specY:r.y-r.r*e.metaballs.specularOffset*1.5}}),S=this.colors.bgBottom[0]-this.colors.bgTop[0],M=this.colors.bgBottom[1]-this.colors.bgTop[1],W=this.colors.bgBottom[2]-this.colors.bgTop[2],g=this.colors.blob1,B=this.colors.blob2,k=this.colors.bgTop,z=e.metaballs.threshold,$=z-e.metaballs.edgeWidth,it=1/e.metaballs.edgeWidth;for(let r=0;r<t;r++){const b=r*c,O=b>e.metaballs.poolGlowStart?(b-e.metaballs.poolGlowStart)/(1-e.metaballs.poolGlowStart):0,A=O*O*e.metaballs.poolGlowBoost*this.heatLevel,D=(k[0]+S*b+g[0]*A)*n,I=(k[1]+M*b+g[1]*A*.6)*n,F=(k[2]+W*b+g[2]*A*.3)*n;for(let x=0;x<i;x++){const T=x*o,d=r*i+x<<2;let w=0,L=0;for(let p=0;p<f.length;p++){const l=f[p],u=l.x-T,y=l.y-b,q=u*u+y*y+1e-4,R=l.rSq/q;w+=R,L+=R*h}let C=999,Y=null,N=0;for(let p=0;p<v.length;p++){const l=v[p],u=l.x-T,y=l.y-b,q=u*u*l.stretchSkew+y*y*l.invStretch+1e-4,R=l.rSq/q;w+=R,L+=R*l.temp;const H=Math.sqrt(u*u+y*y);H<C&&(C=H,Y=l);const P=l.specX-T,Q=l.specY-b,U=Math.sqrt(P*P+Q*Q),tt=l.r*e.metaballs.specularSize;if(U<tt){const et=1-U/tt;N+=et*et*l.temp}}if(w<$){const p=(Math.random()-.5)*a;s[d]=Math.max(0,Math.min(255,D+p)),s[d+1]=Math.max(0,Math.min(255,I+p)),s[d+2]=Math.max(0,Math.min(255,F+p)),s[d+3]=255;continue}w>0&&(L/=w);const V=b,at=L*this.heatLevel,E=(e.metaballs.brightnessBase+V*e.metaballs.brightnessTempFactor)*(.5+at*.5)*n,X=V*m,_=1-X,j=(g[0]*_+B[0]*X)*E,J=(g[1]*_+B[1]*X)*E,K=(g[2]*_+B[2]*X)*E;if(w>=z){const p=Math.min((w-z)*e.metaballs.glowFactor*this.heatLevel,e.metaballs.glowMax*this.heatLevel);let l=0;if(Y&&C<Y.r*e.metaballs.hotspotRadius){const P=1-C/(Y.r*e.metaballs.hotspotRadius);l=P*P*Y.temp*e.metaballs.hotspotIntensity*this.heatLevel}const u=Math.min(N*e.metaballs.specularIntensity*this.heatLevel,.6),y=p*g[0]*.4,q=p*g[1]*.5,R=p*g[2]*.3,H=(Math.random()-.5)*a;s[d]=Math.min(255,Math.max(0,j+y+l*80+u*200+H)),s[d+1]=Math.min(255,Math.max(0,J+q+l*120+u*220+H)),s[d+2]=Math.min(255,Math.max(0,K+R+l*40+u*180+H))}else{const p=(w-$)*it,l=p*p*(3-2*p),u=(Math.random()-.5)*a;s[d]=Math.max(0,Math.min(255,D+(j-D)*l+u)),s[d+1]=Math.max(0,Math.min(255,I+(J-I)*l+u)),s[d+2]=Math.max(0,Math.min(255,F+(K-F)*l+u))}s[d+3]=255}}}}function ft(G){const s=new gt(G);return s.start(),{stop:()=>s.stop(),game:s}}export{ft as default};
