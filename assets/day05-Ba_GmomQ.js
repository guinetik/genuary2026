import{G as L,P as W,N as S,C as A,U as D,b as E,E as O,c as k}from"./gcanvas.es-BBvhR3Fu.js";const s={fontSize:140,fontFamily:"Franklin Gothic Medium",fontWeight:"bold",fingerprintSpacing:6,fingerprintThickness:.55,fingerprintCurve:.4,maxParticles:18e3,particleSize:{min:1.6,max:2.2},sampleStep:2,dashLength:4,dashWidth:.8,initialRings:3,rippleBaseRadius:50,rippleSpacing:70,rippleParticlesBase:35,rippleParticlesGrowth:4,rippleSpeed:.4,rippleEccentricity:.6,flagWaveSpeed:.8,flagWaveAmplitude:10,flagWaveFrequency:.004,flagWaveSecondary:.2,spawnDuration:2,gDelay:0,driftDuration:8,breatheAmount:.8,breatheSpeed:1.2,pulsePeriod:1.2,pulseStrength:12,pulseVibration:3,shockwaveSpeed:350,shockwaveStrength:15,perspective:800,sensitivity:.003,mouseRadius:180,mousePush:800};class T extends k{drawParticle(t,a,u,c,e){var o,r,h;const i=((o=a.color)==null?void 0:o.a)??1,n=a.size*e;if(!(n<.3||i<=0))if((r=a.custom)!=null&&r.isLetter&&((h=a.custom)==null?void 0:h.angle)!==void 0){const{r:l,g:m,b:g}=a.color,d=a.custom.angle,f=a.custom.glow||0,p=a.custom.dashScale??1,M=n*.5,v=n*s.dashLength,w=M+(v-M)*p,b=n*.8,P=n*s.dashWidth,R=b+(P-b)*p;t.save(),t.translate(u,c),t.rotate(d),t.lineCap="round",t.strokeStyle=`rgba(${Math.floor(l)},${Math.floor(m)},${Math.floor(g)},${i})`,t.lineWidth=Math.max(.5,R),t.beginPath(),t.moveTo(-w/2,0),t.lineTo(w/2,0),t.stroke(),f>.15&&(t.strokeStyle=`rgba(255,255,255,${i*.4*f})`,t.lineWidth=R*2,t.stroke()),t.restore()}else super.drawParticle(t,a,u,c,e)}}class I extends L{constructor(t){super(t),this.backgroundColor="#000"}init(){super.init(),W.init(this.ctx),this.time=0,this.mouseX=-9999,this.mouseY=-9999,this.pulseStartTime=s.gDelay+s.spawnDuration,this.lastPulseBeat=0,this.shockwaves=[],this.currentRingCount=s.initialRings,S.seed(42),this.camera=new A({perspective:s.perspective,rotationX:0,rotationY:0,sensitivity:s.sensitivity,inertia:!0,friction:.95,clampX:!1}),this.camera.enableMouseControl(this.canvas),this.textBounds=this.calculateTextBounds("GENUARY"),this.orbitOrigin={x:this.textBounds.letterCenters[0].x,y:this.textBounds.letterCenters[0].y},this.globalOffset={x:-this.orbitOrigin.x,y:-this.orbitOrigin.y},this.targetPositions=this.calculateTargetPositions("GENUARY");const t=this.createRippleUpdater(),a=this.createSpawnUpdater(),u=this.createBreatheUpdater(),c=this.createMouseUpdater(),e=this.createPulseUpdater();this.particles=new T(this,{camera:this.camera,depthSort:!0,maxParticles:s.maxParticles,blendMode:"screen",updaters:[t,a,u,c,e,D.velocity,D.damping(.94)]});const i=new E({rate:0,lifetime:{min:999,max:999},size:s.particleSize,color:{r:200,g:200,b:200,a:.8}});this.particles.addEmitter("text",i),this.spawnLetterParticles(),this.spawnRippleParticles(),this.pipeline.add(this.particles),console.log(`[Day5] GENUARY: ${this.targetPositions.length} letter + ${this.particles.particleCount-this.targetPositions.length} ripple particles`),this._onMouseMove=n=>{const o=this.canvas.getBoundingClientRect();this.mouseX=n.clientX-o.left,this.mouseY=n.clientY-o.top},this._onMouseLeave=()=>{this.mouseX=-9999,this.mouseY=-9999},this.canvas.addEventListener("mousemove",this._onMouseMove),this.canvas.addEventListener("mouseleave",this._onMouseLeave)}calculateTextBounds(t){const a=document.createElement("canvas"),u=a.getContext("2d"),c=t.length*s.fontSize*.7,e=s.fontSize*1.5,i=30;a.width=c+i*2,a.height=e+i*2,u.fillStyle="#000",u.fillRect(0,0,a.width,a.height);const n=`${s.fontWeight} ${s.fontSize}px ${s.fontFamily}`;u.font=n;const r=u.measureText(t).width;a.width=r+i*2,a.height=e+i*2,u.fillStyle="#000",u.fillRect(0,0,a.width,a.height),u.font=n,u.fillStyle="#fff",u.textBaseline="top";const h=(a.height-s.fontSize)/2;u.fillText(t,i,h);const l=u.getImageData(0,0,a.width,a.height),m=[];let g=i;for(const d of t){const f=u.measureText(d).width;m.push({x:g+f/2-a.width/2,y:0,width:f}),g+=f}return this.fontBitmap={imageData:l,width:a.width,height:a.height,offsetX:-a.width/2,offsetY:-a.height/2},{letterCenters:m}}calculateTargetPositions(t){const a=[],{imageData:u,width:c,height:e,offsetX:i,offsetY:n}=this.fontBitmap,{letterCenters:o}=this.textBounds,r=s.sampleStep;for(let h=0;h<e;h+=r)for(let l=0;l<c;l+=r){const m=Math.floor(l),d=(Math.floor(h)*c+m)*4;if(u.data[d]>128){const p=l+i,M=h+n;let v=0,w=o[0].x,b=0;for(let x=0;x<o.length;x++){const y=o[x];if(p>=y.x-y.width/2&&p<y.x+y.width/2){v=x,w=y.x,b=y.y;break}(x===o.length-1||p<o[x+1].x-o[x+1].width/2)&&(v=x,w=y.x,b=y.y)}const P=S.simplex2(p*.015,M*.005);let R=!0;{const x=p-w,y=M-b,Y=Math.sqrt(x*x+y*y),C=Math.atan2(y,x),z=Y+C*s.fingerprintCurve*15+P*3,B=Math.sin(z*(Math.PI*2/s.fingerprintSpacing));R=Math.abs(B)<s.fingerprintThickness}if(R){const x=P*8,y=.75+Math.random()*.25,Y=p-w,C=M-b,z=Math.atan2(C,Y)+Math.PI/2+P*.2;a.push({x:p,y:M,z:x,brightness:y,phase:(p+M)*.02,angle:z,letterIndex:v,letterCenterX:w,letterCenterY:b})}}}return a}spawnLetterParticles(){const t=this.particles.getEmitter("text"),a=this.orbitOrigin.x,u=this.orbitOrigin.y;for(const c of this.targetPositions){const e=this.particles.acquire();t.emit(e);const i=c.x-a,n=c.y-u,o=Math.atan2(n,i),r=Math.sqrt(i*i+(n/s.rippleEccentricity)**2),h=Math.max(s.rippleBaseRadius,r*.8),l=o+(Math.random()-.5)*.5,m=h+s.rippleSpacing+(Math.random()-.5)*20;e.x=a+Math.cos(l)*m,e.y=u+Math.sin(l)*m*s.rippleEccentricity,e.z=(Math.random()-.5)*10,e.custom.targetX=c.x,e.custom.targetY=c.y,e.custom.targetZ=c.z,e.custom.letterCenterX=c.letterCenterX,e.custom.letterCenterY=c.letterCenterY,e.custom.phase=c.phase,e.custom.brightness=c.brightness,e.custom.baseBrightness=c.brightness,e.custom.isLetter=!0,e.custom.letterIndex=c.letterIndex,e.custom.glow=0,e.custom.targetAngle=c.angle,e.custom.startAngle=o+(Math.random()-.5)*.3,e.custom.angle=e.custom.startAngle,e.custom.targetDashScale=1,e.custom.dashScale=0;const g=s.gDelay+c.letterIndex*s.pulsePeriod,d=Math.random()*.3;e.custom.spawnDelay=g+d,e.custom.spawnProgress=0,e.color.r=255,e.color.g=255,e.color.b=255,e.color.a=0,e.custom.targetSize=s.particleSize.min+Math.random()*(s.particleSize.max-s.particleSize.min),e.size=2,this.particles.particles.push(e)}}spawnRippleParticles(){for(let t=0;t<s.initialRings;t++)this.spawnRing(t)}spawnRingAtCenter(){const t=this.particles.getEmitter("text"),a=this.orbitOrigin.x,u=this.orbitOrigin.y,c=s.rippleParticlesBase;for(let e=0;e<c;e++){const i=this.particles.acquire();t.emit(i);const n=e/c*Math.PI*2+Math.random()*.1;i.x=a+Math.cos(n)*10,i.y=u+Math.sin(n)*10*s.rippleEccentricity,i.z=(Math.random()-.5)*10,i.custom.isLetter=!1,i.custom.isRipple=!0,i.custom.originX=a,i.custom.originY=u,i.custom.angle=n,i.custom.ringIndex=0,i.custom.orbitDirection=1,i.custom.targetRadius=s.rippleBaseRadius,i.custom.currentRadius=10,i.custom.expandSpeed=s.shockwaveSpeed*.8,i.custom.expanding=!0;const o=.5+Math.random()*.4;i.custom.brightness=o;const r=Math.floor(180+o*60);i.color.r=r,i.color.g=r,i.color.b=r,i.color.a=.6+o*.3,i.size=1.8+Math.random()*.6,this.particles.particles.push(i)}}spawnRing(t){const a=this.particles.getEmitter("text"),u=this.orbitOrigin.x,c=this.orbitOrigin.y,e=s.rippleBaseRadius+t*s.rippleSpacing,i=s.rippleParticlesBase+t*s.rippleParticlesGrowth;for(let n=0;n<i;n++){const o=this.particles.acquire();a.emit(o);const r=n/i*Math.PI*2+Math.random()*.1;o.x=u+Math.cos(r)*10,o.y=c+Math.sin(r)*10*s.rippleEccentricity,o.z=(Math.random()-.5)*10,o.custom.isLetter=!1,o.custom.isRipple=!0,o.custom.originX=u,o.custom.originY=c,o.custom.angle=r,o.custom.ringIndex=t,o.custom.orbitDirection=1,o.custom.targetRadius=e,o.custom.currentRadius=10,o.custom.expandSpeed=s.shockwaveSpeed*.8,o.custom.expanding=!0;const h=.5+Math.random()*.4;o.custom.brightness=h;const l=Math.floor(180+h*60);o.color.r=l,o.color.g=l,o.color.b=l,o.color.a=.6+h*.3,o.size=1.8+Math.random()*.6,this.particles.particles.push(o)}}createRippleUpdater(){return(t,a,u)=>{if(!t.custom.isRipple)return;const c=Math.sqrt(this.width*this.width+this.height*this.height)*1;if(t.custom.currentRadius>c){t.custom.dead=!0;return}t.custom.expanding&&(t.custom.currentRadius+=t.custom.expandSpeed*a,t.custom.currentRadius>=t.custom.targetRadius&&(t.custom.currentRadius=t.custom.targetRadius,t.custom.expanding=!1)),t.custom.rx=t.custom.currentRadius,t.custom.ry=t.custom.currentRadius*s.rippleEccentricity,t.custom.angle+=s.rippleSpeed*t.custom.orbitDirection*a/(1+t.custom.ringIndex*.05);const e=t.custom.originX+Math.cos(t.custom.angle)*t.custom.rx,i=t.custom.originY+Math.sin(t.custom.angle)*t.custom.ry,o=Math.max(0,e- -500),r=Math.min(1,o/800),h=S.simplex3(e*.002,i*.002,this.time*.4),l=S.simplex2(this.time*.8,t.custom.ringIndex*.3),m=1+h*.5+l*.3,g=Math.sin(this.time*s.flagWaveSpeed*m+e*s.flagWaveFrequency)*s.flagWaveAmplitude*r,d=Math.sin(this.time*s.flagWaveSpeed*1.7+e*s.flagWaveFrequency*2.3+h*2)*s.flagWaveAmplitude*s.flagWaveSecondary*r,f=S.simplex3(e*.008,i*.008,this.time*.8)*3*r,p=e+f*.15,M=i+g+d+f*.5;t.x+=(p-t.x)*.12,t.y+=(M-t.y)*.12}}createSpawnUpdater(){return(t,a,u)=>{if(!t.custom.isLetter)return;if(this.time-t.custom.spawnDelay<0){t.color.a=0;return}if(t.custom.startX===void 0&&(t.custom.startX=t.x,t.custom.startY=t.y,t.custom.startZ=t.z),t.custom.spawnProgress>=1)return;t.custom.spawnProgress=Math.min(1,(t.custom.spawnProgress||0)+a/s.spawnDuration);const e=O.easeOutElastic(t.custom.spawnProgress),i=O.easeOutQuad(t.custom.spawnProgress);t.x=t.custom.startX+(t.custom.targetX-t.custom.startX)*e,t.y=t.custom.startY+(t.custom.targetY-t.custom.startY)*e,t.z=t.custom.startZ+((t.custom.targetZ||0)-t.custom.startZ)*i,t.custom.angle=t.custom.startAngle+(t.custom.targetAngle-t.custom.startAngle)*e,t.custom.dashScale=i;const n=1,o=t.custom.targetSize||s.particleSize.min;t.size=n+(o-n)*i,t.color.a=t.custom.brightness*Math.min(1,i*1.5);const r=Math.floor(180+t.custom.brightness*75),h=Math.floor(255-(255-r)*e);t.color.r=h,t.color.g=h,t.color.b=h}}easeOutQuad(t){return 1-(1-t)*(1-t)}createBreatheUpdater(){return(t,a,u)=>{if(!t.custom.isLetter||t.custom.spawnProgress<1)return;const c=t.custom.phase||0,e=Math.sin(this.time*s.breatheSpeed+c)*s.breatheAmount,i=t.custom.targetX+e,n=t.custom.targetY+e*.5,r=.15*(1-(t.custom.mousePush||0)*.7);t.x+=(i-t.x)*r,t.y+=(n-t.y)*r,t.vx*=.8,t.vy*=.8;const h=S.simplex3(t.x*.01,t.y*.01,this.time*.3)*.08;t.custom.angle+=h*a}}createMouseUpdater(){return(t,a,u)=>{if(this.mouseX<0){t.custom.mousePush=0;return}const c=this.camera.project(t.x,t.y,t.z),e=this.width/2+c.x,i=this.height/2+c.y,n=e-this.mouseX,o=i-this.mouseY,r=Math.sqrt(n*n+o*o);if(r<s.mouseRadius&&r>1){const h=1-r/s.mouseRadius,l=h*h*s.mousePush,m=n/r*l*a,g=o/r*l*a;t.x+=m,t.y+=g,t.vx+=m*.5,t.vy+=g*.5,t.custom.mousePush=h,t.custom.isLetter&&(t.custom.brightness=Math.min(1,t.custom.baseBrightness+.4),t.custom.glow=Math.min(1,(t.custom.glow||0)+a*6))}else t.custom.mousePush=Math.max(0,(t.custom.mousePush||0)-a*8),t.custom.isLetter&&t.custom.spawnProgress>=1&&(t.custom.brightness=t.custom.baseBrightness,t.custom.glow=Math.max(0,(t.custom.glow||0)-a*4));if(t.custom.isLetter){const h=Math.floor(180+t.custom.brightness*75);t.color.r=h,t.color.g=h,t.color.b=h}}}createPulseUpdater(){return(t,a,u)=>{var c;if(!(this.time<s.gDelay)){for(const e of this.particles.particles)(c=e.custom)!=null&&c.isRipple&&e.custom.expanding&&((e.custom.currentRadius-10)/(e.custom.targetRadius-10),e.custom.currentRadius<s.rippleBaseRadius+s.rippleSpacing);if(t.custom.isLetter&&t.custom.spawnProgress>=1){const e=t.custom.targetX-this.orbitOrigin.x,i=t.custom.targetY-this.orbitOrigin.y,n=Math.sqrt(e*e+i*i)||1;let o=0;for(const f of this.shockwaves){const p=Math.abs(n-f.radius),M=120;if(p<M){const v=1-p/M,w=(this.time-f.startTime)/s.pulsePeriod,b=Math.max(0,1-w*.5);o=Math.max(o,O.easeOutElastic(v)*b)}}const r=s.pulseStrength*o;let h=0,l=0;if(o>.1){const f=s.pulseVibration*o;h=(Math.random()-.5)*f,l=(Math.random()-.5)*f}const m=t.custom.targetX+e/n*r+h,g=t.custom.targetY+i/n*r+l;t.x+=(m-t.x)*.18,t.y+=(g-t.y)*.18;const d=o*30;t.color.r=Math.min(255,180+t.custom.brightness*75+d),t.color.g=Math.min(255,180+t.custom.brightness*75+d),t.color.b=Math.min(255,180+t.custom.brightness*75+d)}if(t.custom.isRipple){const e=t.x-this.orbitOrigin.x,i=t.y-this.orbitOrigin.y,n=Math.sqrt(e*e+i*i)||1;for(const o of this.shockwaves){const r=Math.abs(n-o.radius),h=60;if(r<h){const l=1-r/h,m=(this.time-o.startTime)/s.pulsePeriod,g=Math.max(0,1-m),d=s.shockwaveStrength*l*g*a;t.x+=e/n*d,t.y+=i/n*d,t.color.a=Math.min(1,(t.color.a||.6)+.15*l*g)}}}}}}easeOutCubic(t){return 1-Math.pow(1-t,3)}stop(){super.stop(),this.camera&&this.camera.disableMouseControl(),this._onMouseMove&&this.canvas.removeEventListener("mousemove",this._onMouseMove),this._onMouseLeave&&this.canvas.removeEventListener("mouseleave",this._onMouseLeave)}update(t){var i;super.update(t),this.time+=t,this.camera.update(t);const a=Math.min(1,this.time/s.driftDuration),u=this.easeInOutQuad(a),c=-this.orbitOrigin.x,e=-this.orbitOrigin.y;if(this.globalOffset.x=c*(1-u),this.globalOffset.y=e*(1-u),this.time>=s.gDelay){const n=this.time-s.gDelay,o=Math.floor(n/s.pulsePeriod);if(o>this.lastPulseBeat){this.lastPulseBeat=o,this.shockwaves.push({startTime:this.time,radius:0});for(const r of this.particles.particles)(i=r.custom)!=null&&i.isRipple&&(r.custom.targetRadius+=s.rippleSpacing,r.custom.expanding=!0);this.particles.particles.length<s.maxParticles&&this.spawnRingAtCenter()}this.shockwaves=this.shockwaves.filter(r=>(r.radius=(this.time-r.startTime)*s.shockwaveSpeed,r.radius<1500)).slice(-5),this.particles.particles=this.particles.particles.filter(r=>{var h;return!((h=r.custom)!=null&&h.dead)})}}easeInOutQuad(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}render(){this.ctx.fillStyle="rgba(0, 0, 0, 0.6)",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.save(),this.ctx.translate(this.globalOffset.x,this.globalOffset.y),this.pipeline.render(this.ctx),this.ctx.restore()}}function q(X){const t=new I(X);return t.start(),{stop:()=>t.stop(),game:t}}export{q as default};
