import{G as ie,P as U,C as ae,S as re,a as D,F as Z}from"./index-QcdZ2uQe.js";const s={perspective:600,defaultTiltX:.095,defaultTiltY:0,wallHeight:320,wallY:250,wallZ:350,wallExtent:5e3,buildingExtraHeightMin:40,buildingExtraHeightMax:160,buildingDepth:16,buildingBaseColors:["#121212","#161616","#1b1b1b"],buildingTrimColor:"#242424",buildingShadowColor:"#0f0f0f",buildingEdgeColor:"#2a2a2a",buildingCorniceHeight:16,buildingRoofStepMin:18,buildingRoofStepMax:50,buildingRoofInsetMin:40,buildingRoofInsetMax:120,buildingWindowWidth:46,buildingWindowHeight:30,buildingWindowGapX:26,buildingWindowGapY:24,buildingWindowInsetX:36,buildingWindowInsetY:40,buildingWindowLitChance:.45,buildingWindowDarkColor:"rgba(8, 8, 8, 0.85)",starCount:80,moonSize:40,sidewalkY:250,curbHeight:25,streetNearZ:-100,gutterZ:120,sidewalkZ:180,sectionWidth:500,visibleSections:16,scrollSpeed:140,lampSpacing:1e3,lampHeight:450,lampRange:2500,slabWidth:150,slabRange:2500,runnerSrc:"./spritesheet_small.png",runnerFrameWidth:120,runnerFrameHeight:120,runnerColumns:10,runnerRows:5,runnerFrameCount:50,runnerFrameRate:10,runnerScale:1.1,runnerBlendMode:"xor",wallColor:"#1a1a1a",sidewalkColor:"#3a3a3a",gutterColor:"#222",streetColor:"#2a2a2a",slabLineColor:"#555",hue:135};class le extends ie{constructor(e){super(e),this.backgroundColor="#000"}init(){super.init(),U.init(this.ctx),this.camera=new ae({perspective:s.perspective,rotationX:s.defaultTiltX,rotationY:s.defaultTiltY,sensitivity:.003,inertia:!1,clampX:!0,minRotationX:0,maxRotationX:.5}),this.camera.enableMouseControl(this.canvas),this.cameraReturning=!1,this._setupCameraReturn(),this.time=0,this.scrollOffset=0,this.stars=[];for(let e=0;e<s.starCount;e++)this.stars.push({x:Math.random(),y:Math.random()*.3,size:Math.random()*2+1,twinkle:Math.random()*Math.PI*2});this.sectionCache=new Map,this.patternGenerators=this._getPatternGenerators(),this._loadRunner()}async _loadRunner(){this.runner=new re(this,{src:s.runnerSrc,frameWidth:s.runnerFrameWidth,frameHeight:s.runnerFrameHeight,columns:s.runnerColumns,rows:s.runnerRows,frameCount:s.runnerFrameCount,frameRate:s.runnerFrameRate,loop:!0,autoPlay:!0,smoothing:!1}),await this.runner.load()}_seededRandom(e){const t=Math.sin(e*9999)*1e4;return t-Math.floor(t)}_getBuildingSpec(e){const t=e*91.73,o=s.buildingExtraHeightMin+Math.floor(this._seededRandom(t)*(s.buildingExtraHeightMax-s.buildingExtraHeightMin)),n=Math.floor(this._seededRandom(t*1.1)*s.buildingBaseColors.length),a=this._seededRandom(t*1.2)>.55?s.buildingRoofStepMin+Math.floor(this._seededRandom(t*1.3)*(s.buildingRoofStepMax-s.buildingRoofStepMin)):0,r=s.buildingRoofInsetMin+Math.floor(this._seededRandom(t*1.4)*(s.buildingRoofInsetMax-s.buildingRoofInsetMin));return{height:s.wallHeight+o,baseColor:s.buildingBaseColors[n],roofStepHeight:a,roofInset:r,windowSeed:t*3.33}}_drawQuad(e,t,o,n,a,r,h,f){const i=this._orderScreenQuad([{x:t+n.x,y:o+n.y},{x:t+a.x,y:o+a.y},{x:t+r.x,y:o+r.y},{x:t+h.x,y:o+h.y}]);e.beginPath(),e.moveTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y),e.lineTo(i[2].x,i[2].y),e.lineTo(i[3].x,i[3].y),e.closePath(),e.fillStyle=f,e.fill()}_orderScreenQuad(e){const t=e.reduce((o,n)=>(o.x+=n.x,o.y+=n.y,o),{x:0,y:0});return t.x/=e.length,t.y/=e.length,e.slice().sort((o,n)=>Math.atan2(o.y-t.y,o.x-t.x)-Math.atan2(n.y-t.y,n.x-t.x))}_fillScreenQuad(e,t,o){const n=this._orderScreenQuad(t);e.beginPath(),e.moveTo(n[0].x,n[0].y),e.lineTo(n[1].x,n[1].y),e.lineTo(n[2].x,n[2].y),e.lineTo(n[3].x,n[3].y),e.closePath(),e.fillStyle=o,e.fill()}_renderBuildingDetails(e,t,o,n,a,r,h,f,i){const w=this._getBuildingSpec(n),b=h+s.buildingCorniceHeight,l=this.camera.project(a,h,i),m=this.camera.project(r,h,i),j=this.camera.project(r,b,i),M=this.camera.project(a,b,i);if(this._drawQuad(e,t,o,l,m,j,M,s.buildingTrimColor),w.roofStepHeight>0){const W=a+w.roofInset,z=r-w.roofInset,X=h-w.roofStepHeight,L=h,E=this.camera.project(W,X,i),O=this.camera.project(z,X,i),$=this.camera.project(z,L,i),Q=this.camera.project(W,L,i);this._drawQuad(e,t,o,E,O,$,Q,s.buildingTrimColor)}const y=this.camera.project(a,h,i),p=this.camera.project(a,f,i),S=this.camera.project(r,h,i),d=this.camera.project(r,f,i),F=Math.max(1,2*((y.scale+S.scale)*.5));e.strokeStyle=s.buildingEdgeColor,e.lineWidth=F,e.beginPath(),e.moveTo(t+y.x,o+y.y),e.lineTo(t+p.x,o+p.y),e.moveTo(t+S.x,o+S.y),e.lineTo(t+d.x,o+d.y),e.stroke();const I=s.buildingWindowInsetX,Y=s.buildingWindowInsetY+s.buildingCorniceHeight,u=r-a-I*2,k=f-h-Y*2,c=s.buildingWindowWidth,_=s.buildingWindowHeight,T=s.buildingWindowGapX,C=s.buildingWindowGapY,R=Math.max(1,Math.floor((u+T)/(c+T))),g=Math.max(1,Math.floor((k+C)/(_+C))),P=R*c+(R-1)*T,B=g*_+(g-1)*C,x=a+I+(u-P)*.5,v=h+Y+(k-B)*.5,H=`hsla(${s.hue}, 70%, 65%, 0.85)`;for(let W=0;W<g;W++){const z=v+W*(_+C),X=z+_;for(let L=0;L<R;L++){const E=x+L*(c+T),O=E+c,$=w.windowSeed+W*13.1+L*7.7,G=this._seededRandom($)<s.buildingWindowLitChance?H:s.buildingWindowDarkColor,N=this.camera.project(E,z,i),J=this.camera.project(O,z,i),A=this.camera.project(O,X,i),q=this.camera.project(E,X,i);this._drawQuad(e,t,o,N,J,A,q,G)}}}_getPatternGenerators(){return[(e,t,o,n)=>D.checkerboard(e,e,{cellSize:4+Math.floor(this._seededRandom(n*1.1)*12),color1:o,color2:t}),(e,t,o,n)=>D.solidGrid(e,e,{spacing:4+Math.floor(this._seededRandom(n*1.2)*10),background:o,foreground:t}),(e,t,o,n)=>D.stripes(e,e,{spacing:3+Math.floor(this._seededRandom(n*1.3)*8),thickness:1+Math.floor(this._seededRandom(n*1.4)*4),background:o,foreground:t}),(e,t,o,n)=>D.mesh(e,e,{spacing:4+Math.floor(this._seededRandom(n*1.5)*10),lineWidth:1+Math.floor(this._seededRandom(n*1.6)*3),background:o,foreground:t}),(e,t,o,n)=>D.dotPattern(e,e,{dotSize:2+Math.floor(this._seededRandom(n*1.7)*6),spacing:4+Math.floor(this._seededRandom(n*1.8)*10),dotColor:t,background:o}),(e,t,o,n)=>D.cross(e,e,{size:6+Math.floor(this._seededRandom(n*1.9)*10),thickness:1+Math.floor(this._seededRandom(n*2)*4),spacing:8+Math.floor(this._seededRandom(n*2.1)*16),background:o,foreground:t})]}_hslToRgba(e,t,o,n=255){t/=100,o/=100;const a=h=>(h+e/30)%12,r=h=>o-t*Math.min(o,1-o)*Math.max(-1,Math.min(a(h)-3,Math.min(9-a(h),1)));return[Math.round(255*r(0)),Math.round(255*r(8)),Math.round(255*r(4)),n]}_getColorPalette(e){const t=[{hues:[120,140,160],sat:[60,90],light:[30,55]},{hues:[170,190,200],sat:[70,100],light:[35,50]},{hues:[300,320,340],sat:[60,85],light:[35,55]},{hues:[200,220,240],sat:[65,95],light:[30,50]},{hues:[20,35,50],sat:[80,100],light:[40,60]},{hues:[260,280,300],sat:[55,85],light:[30,50]},{hues:[160,175,190],sat:[70,95],light:[25,45]},{hues:[70,90,110],sat:[75,100],light:[35,55]}],o=Math.floor(this._seededRandom(e)*t.length);return t[o]}_pickFromPalette(e,t){const o=e.hues[Math.floor(this._seededRandom(t*1.1)*e.hues.length)],n=e.sat[0]+this._seededRandom(t*1.2)*(e.sat[1]-e.sat[0]),a=e.light[0]+this._seededRandom(t*1.3)*(e.light[1]-e.light[0]);return{hue:o,sat:n,light:a}}async _generateSection(e){if(this.sectionCache.has(e))return this.sectionCache.get(e);const t=e*12345.6789,o=32,n=256,a=document.createElement("canvas");a.width=n,a.height=n;const r=a.getContext("2d");r.imageSmoothingEnabled=!1;const h=this._getColorPalette(t*.5),f=this._seededRandom(t*.6)>.5?this._getColorPalette(t*.7):h,i=this._pickFromPalette(h,t),w=this._hslToRgba(i.hue,i.sat,i.light),b=this._hslToRgba(i.hue,20,8),l=Math.floor(this._seededRandom(t*1)*this.patternGenerators.length),m=this.patternGenerators[l](o,w,b,t),j=await U.img.createImageBitmapFromPixels(m,o,o);for(let Y=0;Y<n;Y+=o)for(let u=0;u<n;u+=o)r.drawImage(j,u,Y,o,o);const M=[[2,2],[2,3],[3,2],[3,3],[4,4],[2,4],[4,2]],y=Math.floor(this._seededRandom(t*2)*M.length),[p,S]=M[y],d=n/p,F=n/S;for(let Y=0;Y<S;Y++)for(let u=0;u<p;u++){const k=t*(Y*10+u+3);if(this._seededRandom(k)>.4){const c=this._pickFromPalette(f,k*2),_=this._hslToRgba(c.hue,c.sat,c.light),T=this._hslToRgba(c.hue,25,12),C=Math.floor(this._seededRandom(k*2.1)*this.patternGenerators.length),R=this.patternGenerators[C](o,_,T,k),g=await U.img.createImageBitmapFromPixels(R,o,o),P=2,B=u*d+P,x=Y*F+P,v=d-P*2,H=F-P*2;for(let W=x;W<x+H;W+=o)for(let z=B;z<B+v;z+=o){const X=Math.min(o,B+v-z),L=Math.min(o,x+H-W);r.drawImage(g,0,0,X,L,z,W,X,L)}}}const I=this._seededRandom(t*4)>.5?1+Math.floor(this._seededRandom(t*4.1)*2):0;for(let Y=0;Y<I;Y++){const u=t*(Y+5),k=Math.floor(this._seededRandom(u*1)*6),c=48+Math.floor(this._seededRandom(u*1.1)*80);let _;k===0?_=Z.sierpinski(c,c,5+Math.floor(this._seededRandom(u*1.2)*3)):k===1?_=Z.sierpinskiCarpet(c,c,3+Math.floor(this._seededRandom(u*1.3)*2)):k===2?_=Z.julia(c,c,30,-.8+this._seededRandom(u*1.4)*.6,.1+this._seededRandom(u*1.5)*.4):k===3?_=Z.mandelbrot(c,c,40,-2.2+this._seededRandom(u*1.6)*.5,-1.5+this._seededRandom(u*1.7)*.5,-1+this._seededRandom(u*1.8)*.5,1+this._seededRandom(u*1.9)*.5):k===4?_=Z.newton(c,c,30):_=Z.koch(c,c,4);const T=this._pickFromPalette(h,u*2),C=new Uint8ClampedArray(c*c*4);for(let x=0;x<_.length;x++){const v=_[x],H=20+v/255*50,[W,z,X]=this._hslToRgba(T.hue,T.sat,H);C[x*4]=W,C[x*4+1]=z,C[x*4+2]=X,C[x*4+3]=v>20?180:0}const R=await U.img.createImageBitmapFromPixels(C,c,c),g=Math.floor(this._seededRandom(u*3)*(n-c)),P=Math.floor(this._seededRandom(u*3.1)*(n-c)),B=1+this._seededRandom(u*3.2)*1.5;r.globalAlpha=.6+this._seededRandom(u*3.3)*.3,r.drawImage(R,g,P,c*B,c*B),r.globalAlpha=1}return this.sectionCache.set(e,a),a}_setupCameraReturn(){this.canvas.addEventListener("mouseup",()=>{this.cameraReturning=!0}),this.canvas.addEventListener("mouseleave",()=>{this.cameraReturning=!0}),this.canvas.addEventListener("mousedown",()=>{this.cameraReturning=!1})}update(e){if(super.update(e),this.time+=e,this.scrollOffset+=s.scrollSpeed*e,this.cameraReturning&&!this.camera._isDragging){const o=3*e;this.camera.rotationX+=(s.defaultTiltX-this.camera.rotationX)*o,this.camera.rotationY+=(s.defaultTiltY-this.camera.rotationY)*o,Math.abs(this.camera.rotationX-s.defaultTiltX)<.001&&Math.abs(this.camera.rotationY-s.defaultTiltY)<.001&&(this.camera.rotationX=s.defaultTiltX,this.camera.rotationY=s.defaultTiltY,this.cameraReturning=!1)}const t=.25;this.camera.rotationY=Math.max(-t,Math.min(t,this.camera.rotationY)),this.camera.update(e),this.runner&&this.runner.loaded&&this.runner.update(e)}render(){const e=this.ctx,t=this.width,o=this.height,n=t/2,a=o/2;e.fillStyle="#000",e.fillRect(0,0,t,o),this._renderSky(e,t,o),this._renderSidewalk(e,n,a,t,o),this._renderWall(e,n,a),this._renderPatternSections(e,n,a),this._renderRunner(e,n,a),this._renderLampPosts(e,n,a)}_renderSky(e,t,o){const a=-this.camera.rotationY*t*.5,r=-this.camera.rotationX*o*.3;for(const l of this.stars){const m=Math.sin(this.time*3+l.twinkle)*.5+.5,j=Math.floor((.3+m*.7)*4)/4,M=Math.floor((l.x*t+a)/4)*4,y=Math.floor((l.y*o+r)/4)*4,p=Math.max(4,Math.floor(l.size/4)*4),S=Math.floor(j*3)*85;e.fillStyle=`rgb(${S}, ${S}, ${Math.min(255,S+20)})`,e.fillRect(M,y,p,p)}const h=Math.floor((t*.8+a)/4)*4,f=Math.floor((o*.12+r)/4)*4,i=s.moonSize,w=6;for(let l=w;l>=0;l--){const m=i+l*4*3,j=Math.floor((1-l/w)*4)/16;e.fillStyle=`rgba(150, 180, 220, ${j})`;for(let M=f-m;M<f+m;M+=4)for(let y=h-m;y<h+m;y+=4){const p=y-h,S=M-f,d=Math.sqrt(p*p+S*S);d<m&&d>=m-4*3&&e.fillRect(y,M,4,4)}}const b=["#e8e8f0","#d0d0e0","#b8b8d0"];for(let l=f-i-4;l<f+i+4;l+=4)for(let m=h-i-4;m<h+i+4;m+=4){const j=m-h,M=l-f,y=Math.sqrt(j*j+M*M);if(y<i){const p=(m/4+l/4)%3;e.fillStyle=b[p],e.fillRect(m,l,4,4)}else y<i+4*2&&(m/4+l/4)%2===0&&(e.fillStyle=b[2],e.fillRect(m,l,4,4))}}_renderWall(e,t,o){const a=s.wallExtent,r=s.wallY-s.wallHeight,h=s.wallY,f=s.wallZ,i=this.camera.project(-5e3,r,f),w=this.camera.project(a,r,f),b=this.camera.project(a,h,f),l=this.camera.project(-5e3,h,f);e.beginPath(),e.moveTo(t+i.x,o+i.y),e.lineTo(t+w.x,o+w.y),e.lineTo(t+b.x,o+b.y),e.lineTo(t+l.x,o+l.y),e.closePath(),e.fillStyle=s.wallColor,e.fill()}_renderPatternSections(e,t,o){const n=s.sectionWidth,a=s.wallY,r=s.wallZ-s.buildingDepth,h=Math.floor(this.scrollOffset/n)-3,f=s.visibleSections;for(let i=0;i<f;i++){const w=h+i,b=w*n-this.scrollOffset,l=b+n,m=this._getBuildingSpec(w),j=s.wallY-m.height,M=this.camera.project(b,j,r),y=this.camera.project(l,j,r),p=this.camera.project(l,a,r),S=this.camera.project(b,a,r);this._drawQuad(e,t,o,M,y,p,S,m.baseColor);const d=a-s.buildingCorniceHeight,F=this.camera.project(b,d,r),I=this.camera.project(l,d,r),Y=this.camera.project(l,a,r),u=this.camera.project(b,a,r);this._drawQuad(e,t,o,F,I,Y,u,s.buildingShadowColor);const k=Math.min(M.x,S.x),c=Math.max(y.x,p.x);if(t+c<-50||t+k>this.width+50)continue;let _=this.sectionCache.get(w);_===void 0&&(this._generateSection(w),_=null);const T={x:t+M.x,y:o+M.y},C={x:t+y.x,y:o+y.y},R={x:t+p.x,y:o+p.y},g={x:t+S.x,y:o+S.y};if(_){e.save(),e.beginPath(),e.moveTo(T.x,T.y),e.lineTo(C.x,C.y),e.lineTo(R.x,R.y),e.lineTo(g.x,g.y),e.closePath(),e.clip();const P=Math.min(T.x,C.x,R.x,g.x),B=Math.max(T.x,C.x,R.x,g.x),x=Math.min(T.y,C.y,R.y,g.y),v=Math.max(T.y,C.y,R.y,g.y);e.imageSmoothingEnabled=!1,e.drawImage(_,P,x,B-P,v-x),e.restore()}else{const P=w*12345.6789,B=s.hue+(this._seededRandom(P*2.4)-.5)*40;e.beginPath(),e.moveTo(T.x,T.y),e.lineTo(C.x,C.y),e.lineTo(R.x,R.y),e.lineTo(g.x,g.y),e.closePath(),e.fillStyle=`hsl(${B}, 60%, 20%)`,e.fill()}this._renderBuildingDetails(e,t,o,w,b,l,j,a,r),e.strokeStyle="#000",e.lineWidth=5,e.beginPath(),e.moveTo(T.x,T.y),e.lineTo(g.x,g.y),e.stroke()}}_renderSidewalk(e,t,o,n,a){const r=s.sidewalkY,h=r+s.curbHeight,f=s.wallZ,i=s.sidewalkZ,w=s.gutterZ,b=s.streetNearZ,l=s.wallExtent,m=this.camera.project(-l,r,f),j=this.camera.project(l,r,f),M=t+m.x,y=t+j.x,p=o+m.y,S=o+j.y,d=M<=y,F=d?M:y,I=d?p:S,Y=d?y:M,u=d?S:p;e.save(),e.beginPath(),e.moveTo(0,a),e.lineTo(n,a),e.lineTo(Y,u),e.lineTo(F,I),e.closePath(),e.clip();const k=this.camera.project(-l,h,b),c=this.camera.project(l,h,b),_=this.camera.project(-l,h,w),T=this.camera.project(l,h,w);e.fillStyle=s.streetColor;const C=Math.min(o+k.y,o+c.y),R=Math.max(0,Math.min(a,Math.floor(C)));e.fillRect(0,R,n,a-R),this._fillScreenQuad(e,[{x:t+k.x,y:o+k.y},{x:t+c.x,y:o+c.y},{x:t+T.x,y:o+T.y},{x:t+_.x,y:o+_.y}],s.streetColor);const g=this.camera.project(-l,h,w),P=this.camera.project(l,h,w),B=this.camera.project(-l,h,i),x=this.camera.project(l,h,i);this._fillScreenQuad(e,[{x:t+g.x,y:o+g.y},{x:t+P.x,y:o+P.y},{x:t+x.x,y:o+x.y},{x:t+B.x,y:o+B.y}],s.gutterColor);const v=this.camera.project(-l,r,i),H=this.camera.project(l,r,i),W=this.camera.project(-l,h,i),z=this.camera.project(l,h,i);this._fillScreenQuad(e,[{x:t+v.x,y:o+v.y},{x:t+H.x,y:o+H.y},{x:t+z.x,y:o+z.y},{x:t+W.x,y:o+W.y}],"#333"),e.strokeStyle="#444",e.lineWidth=2,e.beginPath(),e.moveTo(t+v.x,o+v.y),e.lineTo(t+H.x,o+H.y),e.stroke();const X=this.camera.project(-l,r,i),L=this.camera.project(l,r,i),E=this.camera.project(-l,r,f),O=this.camera.project(l,r,f);this._fillScreenQuad(e,[{x:t+X.x,y:o+X.y},{x:t+L.x,y:o+L.y},{x:t+O.x,y:o+O.y},{x:t+E.x,y:o+E.y}],s.sidewalkColor);const $=s.slabWidth,Q=3;e.fillStyle=s.slabLineColor;const G=this._orderScreenQuad([{x:t+X.x,y:o+X.y},{x:t+L.x,y:o+L.y},{x:t+O.x,y:o+O.y},{x:t+E.x,y:o+E.y}]);e.save(),e.beginPath(),e.moveTo(G[0].x,G[0].y),e.lineTo(G[1].x,G[1].y),e.lineTo(G[2].x,G[2].y),e.lineTo(G[3].x,G[3].y),e.closePath(),e.clip();const N=s.slabRange,J=Math.floor((this.scrollOffset-N)/$)*$;for(let A=J;A<this.scrollOffset+N;A+=$){const q=A-this.scrollOffset,ee=this.camera.project(q,r,i),se=this.camera.project(q,r,f),ne=Math.floor((t+ee.x)/Q)*Q,te=Math.floor((o+ee.y)/Q)*Q,oe=Math.floor((o+se.y)/Q)*Q;for(let K=Math.min(te,oe);K<=Math.max(te,oe);K+=Q)e.fillRect(ne,K,Q,Q)}e.restore(),e.restore()}_renderRunner(e,t,o){if(!this.runner||!this.runner.loaded)return;const n=0,a=(s.sidewalkZ+s.wallZ)/2,r=s.sidewalkY,h=this.camera.project(n,r,a),f=h.scale*s.runnerScale,i=t+h.x,w=o+h.y,b=this.runner.currentShape;if(!b||!b._bitmap)return;const l=b._bitmap,m=s.runnerFrameWidth*f,j=s.runnerFrameHeight*f;e.save(),e.imageSmoothingEnabled=!1;const M=i-m/2,y=w-j,p=2;e.globalCompositeOperation="source-over",e.filter="brightness(0) invert(1)";for(let S=-p;S<=p;S+=p)for(let d=-p;d<=p;d+=p)S===0&&d===0||e.drawImage(l,M+S,y+d,m,j);e.filter="none",e.globalCompositeOperation=s.runnerBlendMode,e.drawImage(l,M,y,m,j),e.restore()}_renderLampPosts(e,t,o){const n=s.lampSpacing,a=s.sidewalkY,r=(s.sidewalkZ+s.wallZ)/2,h=s.lampRange,f=Math.floor((this.scrollOffset-h)/n),i=Math.ceil((this.scrollOffset+h)/n);for(let w=f;w<=i;w++){const b=w*n-this.scrollOffset+100,l=this.camera.project(b,a,r);if(Math.abs(l.x)>this.width)continue;const m=this.camera.project(b,a,r),j=this.camera.project(b,a-s.lampHeight,r);e.strokeStyle="#444",e.lineWidth=Math.max(2,5*m.scale),e.beginPath(),e.moveTo(t+m.x,o+m.y),e.lineTo(t+j.x,o+j.y),e.stroke();const M=r-50,y=this.camera.project(b,a-s.lampHeight+20,M);e.lineWidth=Math.max(1,3*m.scale),e.beginPath(),e.moveTo(t+j.x,o+j.y),e.lineTo(t+y.x,o+y.y),e.stroke();const p=this.camera.project(b,a-s.lampHeight+35,M),S=60*p.scale,d=6,F=Math.floor((t+p.x)/d)*d,I=Math.floor((o+p.y)/d)*d,Y=4;for(let R=Y;R>=0;R--){const g=S/Y*(R+1),P=(1-R/Y)*.6,B=70-R*10;e.fillStyle=`hsla(${s.hue}, 100%, ${B}%, ${P})`;for(let x=I-g;x<I+g;x+=d)for(let v=F-g;v<F+g;v+=d){const H=v-F,W=x-I,z=Math.sqrt(H*H+W*W);z<g&&z>=g-S/Y&&e.fillRect(v,x,d,d)}}e.fillStyle=`hsla(${s.hue}, 100%, 80%, 0.9)`,e.fillRect(F-d,I-d,d*2,d*2);const u=this.camera.project(b-80,a,M+20),k=this.camera.project(b+80,a,M+20),c=Math.abs(k.x-u.x),_=Math.max(d*2,30*p.scale),T=Math.floor((t+p.x-c/2)/d)*d,C=Math.floor((o+u.y-_/2)/d)*d;e.fillStyle=`hsla(${s.hue}, 70%, 40%, 0.2)`;for(let R=C;R<C+_;R+=d)for(let g=T;g<T+c;g+=d){const P=Math.min(g-T,T+c-g-d)/c,B=Math.min(R-C,C+_-R-d)/_;(Math.min(P,B)>.1||(g/d+R/d)%2===0)&&e.fillRect(g,R,d,d)}}}stop(){super.stop(),this.camera&&this.camera.disableMouseControl()}}function de(V){const e=new le(V);return e.start(),{stop:()=>e.stop(),game:e}}export{de as default};
