import{G as F,T as $,E as d,P as y}from"./index-CyJvuFm5.js";const h={birdDensity:12e-5,minBirds:60,maxSpeed:180,maxForce:4,separationDist:25,alignmentDist:50,cohesionDist:80,separationWeight:1.8,alignmentWeight:1,cohesionWeight:1,mouseAvoidWeight:2.5,mouseAvoidDist:120,birdSizeRatio:.015,cycleDuration:60,sky:{dawn:{top:"#4a3f6b",bottom:"#f4a460",sun:"#ff6b4a"},day:{top:"#e8e0d0",bottom:"#f5f0e6",sun:"#f4d03f"},dusk:{top:"#4a3055",bottom:"#ff7f50",sun:"#ff4500"},night:{top:"#0a0a1a",bottom:"#1a1a3a"}},colors:["#c41e3a","#1e5aa8","#d4a84b","#2d5a45","#8b4557","#4a6fa5","#c9722e"]};class A{constructor(e,t,s){this.x=e,this.y=t,this.vx=(Math.random()-.5)*h.maxSpeed,this.vy=(Math.random()-.5)*h.maxSpeed,this.ax=0,this.ay=0,this.angle=Math.atan2(this.vy,this.vx),this.targetAngle=this.angle,this.color=s,this.wingPhase=Math.random()*Math.PI*2}applyForce(e,t){this.ax+=e,this.ay+=t}separate(e){let t=0,s=0,o=0;for(const i of e){if(i===this)continue;const a=this.x-i.x,r=this.y-i.y,n=Math.sqrt(a*a+r*r);n<h.separationDist&&n>0&&(t+=a/n/n,s+=r/n/n,o++)}if(o>0){const i=Math.sqrt(t*t+s*s);if(i>0){t=t/i*h.maxSpeed-this.vx,s=s/i*h.maxSpeed-this.vy;const a=Math.sqrt(t*t+s*s);a>h.maxForce&&(t=t/a*h.maxForce,s=s/a*h.maxForce)}}return{x:t*h.separationWeight,y:s*h.separationWeight}}align(e){let t=0,s=0,o=0;for(const i of e){if(i===this)continue;const a=i.x-this.x,r=i.y-this.y;Math.sqrt(a*a+r*r)<h.alignmentDist&&(t+=i.vx,s+=i.vy,o++)}if(o>0){t/=o,s/=o;const i=Math.sqrt(t*t+s*s);i>0&&(t=t/i*h.maxSpeed,s=s/i*h.maxSpeed);let a=t-this.vx,r=s-this.vy;const n=Math.sqrt(a*a+r*r);return n>h.maxForce&&(a=a/n*h.maxForce,r=r/n*h.maxForce),{x:a*h.alignmentWeight,y:r*h.alignmentWeight}}return{x:0,y:0}}cohere(e){let t=0,s=0,o=0;for(const i of e){if(i===this)continue;const a=i.x-this.x,r=i.y-this.y;Math.sqrt(a*a+r*r)<h.cohesionDist&&(t+=i.x,s+=i.y,o++)}return o>0?(t/=o,s/=o,this.seek(t,s,h.cohesionWeight)):{x:0,y:0}}seek(e,t,s=1){let o=e-this.x,i=t-this.y;const a=Math.sqrt(o*o+i*i);if(a>0){o=o/a*h.maxSpeed,i=i/a*h.maxSpeed;let r=o-this.vx,n=i-this.vy;const c=Math.sqrt(r*r+n*n);return c>h.maxForce&&(r=r/c*h.maxForce,n=n/c*h.maxForce),{x:r*s,y:n*s}}return{x:0,y:0}}flee(e,t,s=1,o=100){const i=this.x-e,a=this.y-t,r=Math.sqrt(i*i+a*a);if(r<o&&r>0){const n=(1-r/o)*s,c=Math.sqrt(i*i+a*a);return{x:i/c*h.maxForce*n,y:a/c*h.maxForce*n}}return{x:0,y:0}}update(e,t,s){this.vx+=this.ax,this.vy+=this.ay;const o=Math.sqrt(this.vx*this.vx+this.vy*this.vy);o>h.maxSpeed&&(this.vx=this.vx/o*h.maxSpeed,this.vy=this.vy/o*h.maxSpeed),this.x+=this.vx*e,this.y+=this.vy*e,this.x<-50&&(this.x=t+50),this.x>t+50&&(this.x=-50),this.y<-50&&(this.y=s+50),this.y>s+50&&(this.y=-50),this.targetAngle=Math.atan2(this.vy,this.vx);let i=this.targetAngle-this.angle;for(;i>Math.PI;)i-=Math.PI*2;for(;i<-Math.PI;)i+=Math.PI*2;this.angle+=i*.15,this.wingPhase+=e*8,this.ax=0,this.ay=0}}class D extends F{constructor(e){super(e),this.backgroundColor=h.bgColor}init(){super.init(),this.birdSize=Math.min(this.width,this.height)*h.birdSizeRatio;const e=this.width*this.height,t=Math.max(h.minBirds,Math.floor(e*h.birdDensity));this.birds=[];for(let s=0;s<t;s++){const o=Math.random()*this.width,i=Math.random()*this.height,a=h.colors[s%h.colors.length];this.birds.push(new A(o,i,a))}this.mouseX=this.width/2,this.mouseY=this.height/2,this.mouseActive=!1,this.canvas.addEventListener("mousemove",s=>{const o=this.canvas.getBoundingClientRect();this.mouseX=(s.clientX-o.left)*(this.width/o.width),this.mouseY=(s.clientY-o.top)*(this.height/o.height),this.mouseActive=!0}),this.canvas.addEventListener("mouseleave",()=>{this.mouseActive=!1}),this.canvas.addEventListener("click",()=>{for(const s of this.birds){const o=s.x-this.mouseX,i=s.y-this.mouseY,a=Math.sqrt(o*o+i*i)||1,r=o/a*h.maxSpeed*1.2,n=i/a*h.maxSpeed*1.2,c=s.vx,p=s.vy;$.to(s,{vx:c+r,vy:p+n},.4,d.easeOutBack)}}),this.canvas.addEventListener("touchmove",s=>{s.preventDefault();const o=this.canvas.getBoundingClientRect(),i=s.touches[0];this.mouseX=(i.clientX-o.left)*(this.width/o.width),this.mouseY=(i.clientY-o.top)*(this.height/o.height),this.mouseActive=!0},{passive:!1}),this.canvas.addEventListener("touchend",()=>{this.mouseActive=!1}),this.time=h.cycleDuration*.2}update(e){super.update(e),this.time+=e;for(const t of this.birds){const s=t.separate(this.birds),o=t.align(this.birds),i=t.cohere(this.birds);if(t.applyForce(s.x,s.y),t.applyForce(o.x,o.y),t.applyForce(i.x,i.y),this.mouseActive){const a=t.flee(this.mouseX,this.mouseY,h.mouseAvoidWeight,h.mouseAvoidDist);t.applyForce(a.x,a.y)}t.update(e,this.width,this.height)}}render(){const e=this.ctx,t=this.width,s=this.height,o=this.time%h.cycleDuration/h.cycleDuration,i=this.getSkyColors(o),a=e.createLinearGradient(0,0,0,s);if(a.addColorStop(0,i.top),a.addColorStop(1,i.bottom),e.fillStyle=a,e.fillRect(0,0,t,s),o>.8||o<.2){const M=o>.5?Math.min(1,(o-.8)/.15):Math.min(1,(.2-o)/.15);this.drawStars(e,t,s,M)}const r=Math.min(t,s)*.07,n=t*.5,c=s*2,p=t*.9,f=s*1.9,b=o,v=Math.PI*1.15-b*Math.PI*1.3,S=n+Math.cos(v)*p,l=c-Math.sin(v)*f;l<s+r*2&&this.drawSun(e,S,l,r,i.celestial);const u=(o+.5)%1,g=Math.PI*1.15-u*Math.PI*1.3,x=n+Math.cos(g)*p*.9,m=c-Math.sin(g)*f*1;m<s+r*2&&this.drawMoon(e,x,m,r*.85),this.birdSize=Math.min(t,s)*h.birdSizeRatio,this.dayProgress=o;for(const M of this.birds)this.drawOrigamiBird(e,M)}toRgba(e,t){if(e.startsWith("#")){const s=parseInt(e.slice(1,3),16),o=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16);return`rgba(${s}, ${o}, ${i}, ${t})`}if(e.startsWith("rgb(")){const s=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(s)return`rgba(${s[1]}, ${s[2]}, ${s[3]}, ${t})`}return`rgba(200, 200, 200, ${t})`}lerpColor(e,t,s){const o=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16),r=parseInt(t.slice(1,3),16),n=parseInt(t.slice(3,5),16),c=parseInt(t.slice(5,7),16),p=Math.round(o+(r-o)*s),f=Math.round(i+(n-i)*s),b=Math.round(a+(c-a)*s);return`rgb(${p}, ${f}, ${b})`}getSkyColors(e){const t=h.sky;if(e<.15){const s=e/.15;return{top:this.lerpColor(t.night.top,t.dawn.top,s),bottom:this.lerpColor(t.night.bottom,t.dawn.bottom,s),celestial:t.dawn.sun}}else if(e<.35){const s=(e-.15)/.2;return{top:this.lerpColor(t.dawn.top,t.day.top,s),bottom:this.lerpColor(t.dawn.bottom,t.day.bottom,s),celestial:this.lerpColor(t.dawn.sun,t.day.sun,s)}}else{if(e<.65)return{top:t.day.top,bottom:t.day.bottom,celestial:t.day.sun};if(e<.85){const s=(e-.65)/.2;return{top:this.lerpColor(t.day.top,t.dusk.top,s),bottom:this.lerpColor(t.day.bottom,t.dusk.bottom,s),celestial:this.lerpColor(t.day.sun,t.dusk.sun,s)}}else{const s=(e-.85)/.15;return{top:this.lerpColor(t.dusk.top,t.night.top,s),bottom:this.lerpColor(t.dusk.bottom,t.night.bottom,s),celestial:t.dusk.sun}}}}drawStars(e,t,s,o){for(let a=0;a<60;a++){const r=a*7919%1e3/1e3*t,n=a*6271%1e3/1e3*s*.6,c=a*3571%100/100*2+.5,p=(Math.sin(this.time*3+a)+1)/2,f=d.smootherstep(p)*.6+.4,b=o*f*.8;y.shapes.fillCircle(r,n,c,`rgba(255, 255, 255, ${b})`)}}drawSun(e,t,s,o,i){const a=e.createRadialGradient(t,s,0,t,s,o*4);a.addColorStop(0,this.toRgba(i,.3)),a.addColorStop(.5,this.toRgba(i,.1)),a.addColorStop(1,this.toRgba(i,0)),e.fillStyle=a,e.beginPath(),e.arc(t,s,o*4,0,Math.PI*2),e.fill();const r=e.createRadialGradient(t,s,0,t,s,o*2);r.addColorStop(0,this.toRgba(i,.5)),r.addColorStop(.6,this.toRgba(i,.2)),r.addColorStop(1,this.toRgba(i,0)),e.fillStyle=r,e.beginPath(),e.arc(t,s,o*2,0,Math.PI*2),e.fill();const n=e.createRadialGradient(t,s,0,t,s,o);n.addColorStop(0,"#fffbe6"),n.addColorStop(.5,i),n.addColorStop(1,this.toRgba(i,.8)),e.fillStyle=n,e.beginPath(),e.arc(t,s,o,0,Math.PI*2),e.fill()}drawMoon(e,t,s,o){const i=e.createRadialGradient(t,s,0,t,s,o*3);i.addColorStop(0,"rgba(200, 210, 230, 0.3)"),i.addColorStop(.5,"rgba(200, 210, 230, 0.1)"),i.addColorStop(1,"rgba(200, 210, 230, 0)"),e.fillStyle=i,e.beginPath(),e.arc(t,s,o*3,0,Math.PI*2),e.fill();const a=e.createRadialGradient(t-o*.3,s-o*.3,0,t,s,o);a.addColorStop(0,"#f8f8ff"),a.addColorStop(.8,"#e8e8f0"),a.addColorStop(1,"#d0d0e0"),e.fillStyle=a,e.beginPath(),e.arc(t,s,o,0,Math.PI*2),e.fill(),e.fillStyle="rgba(180, 180, 200, 0.3)",e.beginPath(),e.arc(t-o*.3,s+o*.2,o*.15,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t+o*.25,s-o*.25,o*.1,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t+o*.1,s+o*.4,o*.12,0,Math.PI*2),e.fill()}darkenColor(e,t){if(e.startsWith("#")){let s=parseInt(e.slice(1,3),16),o=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16);return s=Math.round(s*(1-t)),o=Math.round(o*(1-t)),i=Math.round(i*(1-t)),`rgb(${s}, ${o}, ${i})`}return e}lightenColor(e,t){if(e.startsWith("#")){let s=parseInt(e.slice(1,3),16),o=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16);return s=Math.min(255,Math.round(s+(255-s)*t)),o=Math.min(255,Math.round(o+(255-o)*t)),i=Math.min(255,Math.round(i+(255-i)*t)),`rgb(${s}, ${o}, ${i})`}return e}drawOrigamiBird(e,t){const s=this.birdSize,i=1+Math.sqrt(t.vx*t.vx+t.vy*t.vy)/h.maxSpeed*.3,a=1/Math.sqrt(i),r=(Math.sin(t.wingPhase)+1)/2,n=d.smoothstep(r);let c=t.color;const p=this.dayProgress||.5;if(p>.85||p<.15){const k=p>.5?Math.min(1,(p-.85)/.1):Math.min(1,(.15-p)/.1);c=this.lerpColor(t.color,"#1a1a2e",k*.85)}else if(p<.25||p>.75){const k=p<.5?1-(p-.15)/.1:(p-.75)/.1,W=p<.5?"#ff9966":"#ff6644";c=this.lerpColor(t.color,W,Math.max(0,k)*.3)}const f=this.darkenColor(c,.15),b=c,v=this.lightenColor(c,.1),S=this.darkenColor(c,.05);y.save(),y.translateTo(t.x,t.y),y.rotate(t.angle),y.scale(i,a);const l=s/50,u={p1:{x:-40*l,y:-45*l},p2:{x:15*l,y:5*l},p3:{x:-15*l,y:20*l}},g={p1:{x:-15*l,y:50*l},p2:{x:15*l,y:-5*l},p3:{x:-10*l,y:15*l}},x={p1:{x:15*l,y:5*l},p2:{x:-5*l,y:20*l},p3:{x:-30*l,y:-50*l}},m={p1:{x:15*l,y:-5*l},p2:{x:-10*l,y:15*l},p3:{x:5*l,y:50*l}},M={p1:{x:d.lerp(u.p1.x,g.p1.x,n),y:d.lerp(u.p1.y,g.p1.y,n)},p2:{x:d.lerp(u.p2.x,g.p2.x,n),y:d.lerp(u.p2.y,g.p2.y,n)},p3:{x:d.lerp(u.p3.x,g.p3.x,n),y:d.lerp(u.p3.y,g.p3.y,n)}},w={p1:{x:d.lerp(x.p1.x,m.p1.x,n),y:d.lerp(x.p1.y,m.p1.y,n)},p2:{x:d.lerp(x.p2.x,m.p2.x,n),y:d.lerp(x.p2.y,m.p2.y,n)},p3:{x:d.lerp(x.p3.x,m.p3.x,n),y:d.lerp(x.p3.y,m.p3.y,n)}},R=d.lerp(0,3*l,n),P={p1:{x:-50*l,y:R},p2:{x:20*l,y:-10*l},p3:{x:15*l,y:5*l-R*.5}},I={p1:{x:20*l,y:-10*l},p2:{x:50*l,y:0},p3:{x:15*l,y:3*l}};y.shapes.polygon([M.p1,M.p2,M.p3],v,null,null),y.shapes.polygon([P.p1,P.p2,P.p3],f,null,null),y.shapes.polygon([I.p1,I.p2,I.p3],b,null,null),y.shapes.polygon([w.p1,w.p2,w.p3],S,null,null),y.restore()}}function X(C){const e=new D(C);return e.start(),{stop:()=>e.stop(),game:e}}export{X as default};
