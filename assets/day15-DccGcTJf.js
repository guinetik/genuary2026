import{G as B,P as L,C as T,r as q,s as j,E as A}from"./gcanvas.es-CMQjSjBY.js";const a={bhRadiusRatio:.045,bhMass:1,starCountBase:225,starCountPerMegapixel:800,starFieldRadius:1200,lensRadiusMultiplier:8,lensStrengthMultiplier:2.5,lensFalloff:.007,occlusionRadius:2.6,diskInnerRadius:1.8,diskOuterRadius:8,diskParticles:3e3,diskThickness:.15,baseOrbitalSpeed:.6,colorHot:{r:255,g:250,b:220},colorMid:{r:255,g:160,b:50},colorCool:{r:180,g:40,b:20},particleSizeMin:.5,particleSizeMax:1,particleScale:.0025,perspective:800,initialTilt:.4},F=[{size:1.5,brightness:1},{size:1,brightness:.7},{size:.6,brightness:.5}];class G extends B{constructor(s){super(s),this.backgroundColor="#000"}init(){super.init(),L.init(this.ctx);const s=Math.min(this.width,this.height),h=this.width*this.height/1e6;this.baseScale=s,this.bhRadius=s*a.bhRadiusRatio,this.starCount=Math.floor(a.starCountBase+a.starCountPerMegapixel*h),this.lensEffectRadius=this.bhRadius*a.lensRadiusMultiplier,this.lensStrength=this.bhRadius*a.lensStrengthMultiplier;const o=Math.max(1,s/600);this.camera=new T({perspective:a.perspective*o,rotationX:a.initialTilt,rotationY:0,sensitivity:.004,inertia:!0,friction:.92,clampX:!1,autoRotate:!0,autoRotateSpeed:.08,autoRotateAxis:"y"}),this.camera.enableMouseControl(this.canvas),this.time=0,this.lensingStrength=1,this.mouseX=this.width/2,this.mouseY=this.height/2,this.mouseDownPos=null,this.isDragging=!1,this.initStarfield(),this.initAccretionDisk(),this.initFallingMatter(),this.canvas.addEventListener("mousemove",i=>{const t=this.canvas.getBoundingClientRect();this.mouseX=i.clientX-t.left,this.mouseY=i.clientY-t.top}),this.canvas.addEventListener("mousedown",i=>{const t=this.canvas.getBoundingClientRect();this.mouseDownPos={x:i.clientX-t.left,y:i.clientY-t.top},this.isDragging=!1}),this.canvas.addEventListener("mousemove",i=>{if(this.mouseDownPos){const t=this.canvas.getBoundingClientRect(),e=i.clientX-t.left-this.mouseDownPos.x,n=i.clientY-t.top-this.mouseDownPos.y;Math.sqrt(e*e+n*n)>5&&(this.isDragging=!0)}}),this.canvas.addEventListener("mouseup",i=>{!this.isDragging&&this.mouseDownPos&&this.spawnMatterAtMouse(),this.mouseDownPos=null,this.isDragging=!1}),this.canvas.addEventListener("touchstart",i=>{if(i.touches.length===1){const t=this.canvas.getBoundingClientRect(),e=i.touches[0];this.mouseX=e.clientX-t.left,this.mouseY=e.clientY-t.top,this.mouseDownPos={x:this.mouseX,y:this.mouseY},this.isDragging=!1}}),this.canvas.addEventListener("touchmove",i=>{if(i.touches.length===1&&this.mouseDownPos){const t=this.canvas.getBoundingClientRect(),e=i.touches[0],n=e.clientX-t.left-this.mouseDownPos.x,u=e.clientY-t.top-this.mouseDownPos.y;Math.sqrt(n*n+u*u)>10&&(this.isDragging=!0)}}),this.canvas.addEventListener("touchend",i=>{!this.isDragging&&this.mouseDownPos&&this.spawnMatterAtMouse(),this.mouseDownPos=null,this.isDragging=!1})}initStarfield(){this.stars=[];for(let s=0;s<this.starCount;s++){const r=Math.random()*Math.PI*2,h=Math.acos(2*Math.random()-1),o=a.starFieldRadius*(.5+Math.random()*.5),i=F[Math.floor(Math.random()*F.length)];this.stars.push({x:o*Math.sin(h)*Math.cos(r),y:o*Math.sin(h)*Math.sin(r),z:o*Math.cos(h),type:i,twinkleSpeed:1+Math.random()*2,twinklePhase:Math.random()*Math.PI*2})}}initAccretionDisk(){this.diskParticles=[];const s=this.bhRadius*a.diskInnerRadius,r=this.bhRadius*a.diskOuterRadius;for(let h=0;h<a.diskParticles;h++){const o=Math.pow(Math.random(),.5),i=s+(r-s)*o,t=Math.random()*Math.PI*2,e=q(i,a.bhMass,a.baseOrbitalSpeed,r),n=(Math.random()-.5)*this.bhRadius*a.diskThickness;this.diskParticles.push({angle:t,distance:i,yOffset:n,speed:e,size:a.particleSizeMin+Math.random()*(a.particleSizeMax-a.particleSizeMin),baseColor:this.getHeatColor(i,s,r)})}}getHeatColor(s,r,h){const o=Math.max(0,Math.min(1,(s-r)/(h-r)));let i,t,e;if(o<.5){const n=o*2;i=a.colorHot.r+(a.colorMid.r-a.colorHot.r)*n,t=a.colorHot.g+(a.colorMid.g-a.colorHot.g)*n,e=a.colorHot.b+(a.colorMid.b-a.colorHot.b)*n}else{const n=(o-.5)*2;i=a.colorMid.r+(a.colorCool.r-a.colorMid.r)*n,t=a.colorMid.g+(a.colorCool.g-a.colorMid.g)*n,e=a.colorMid.b+(a.colorCool.b-a.colorMid.b)*n}return{r:Math.round(i),g:Math.round(t),b:Math.round(e)}}initFallingMatter(){this.fallingParticles=[]}spawnMatterAtMouse(){const s=this.width/2,r=this.height/2,h=this.mouseX-s,o=this.mouseY-r,i=350,t=this.camera.perspective/(this.camera.perspective-i);let e=h/t,n=o/t,u=-i;const l=Math.cos(-this.camera.rotationX),d=Math.sin(-this.camera.rotationX);let g=n*l-u*d,c=n*d+u*l;const M=Math.cos(-this.camera.rotationY),f=Math.sin(-this.camera.rotationY);let p=e*M-c*f,m=e*f+c*M,b=g;this.fallingParticles.push({x:p,y:b,z:m,vx:0,vy:0,vz:0,size:4+Math.random()*3,age:0,maxAge:20}),this.fallingParticles.length>50&&(this.fallingParticles=this.fallingParticles.slice(-40))}update(s){super.update(s),this.time+=s,this.camera.update(s);for(let i=this.diskParticles.length-1;i>=0;i--){const t=this.diskParticles[i];t.angle+=t.speed*s,t.age!==void 0&&(t.age+=s,t.age>t.maxAge&&this.diskParticles.splice(i,1))}const r=300,h=500,o=this.bhRadius*2;for(let i=this.fallingParticles.length-1;i>=0;i--){const t=this.fallingParticles[i],e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);if(e>1){const n=Math.max(0,Math.min(1,e/h)),u=1-A.easeInExpo(n),l=r*(1+u*50),d=-t.x/e,g=-t.y/e,c=-t.z/e;t.vx+=d*l*s,t.vy+=g*l*s,t.vz+=c*l*s,t.vx+=g*l*s*.1,t.vy+=-d*l*s*.1}t.x+=t.vx*s,t.y+=t.vy*s,t.z+=t.vz*s,t.age+=s,(e<o||t.age>t.maxAge)&&this.fallingParticles.splice(i,1)}}render(){const s=this.ctx,r=this.width,h=this.height,o=r/2,i=h/2;s.fillStyle="rgba(0, 0, 0, 0.12)",s.fillRect(0,0,r,h),this.renderStarfield(s,o,i),this.renderFallingMatter(s,o,i),this.renderDisk(s,o,i),this.renderBlackHole(s,o,i)}renderStarfield(s,r,h){const o=this.time;for(const i of this.stars){const t=this.camera.project(i.x,i.y,i.z);if(t.scale<=0)continue;let e=t.x,n=t.y;if(t.z>0&&this.lensingStrength>0){const m=j(e,n,this.lensEffectRadius,this.lensStrength*this.lensingStrength,a.lensFalloff,5);e=m.x,n=m.y}const u=Math.sqrt(e*e+n*n),l=this.bhRadius*a.occlusionRadius;if(u<l)continue;const d=r+e,g=h+n;if(d<-10||d>this.width+10||g<-10||g>this.height+10)continue;const M=.5+.5*Math.sin(o*i.twinkleSpeed+i.twinklePhase);if(M<.1)continue;const f=i.type.size*t.scale*i.type.brightness,p=Math.round(180+i.type.brightness*75);s.globalAlpha=M*.8,s.fillStyle=`rgb(${p}, ${p}, ${p})`,s.beginPath(),s.arc(d,g,Math.max(.5,f),0,Math.PI*2),s.fill()}s.globalAlpha=1}renderDisk(s,r,h){const o=[],i=Math.abs(Math.sin(this.camera.rotationX));for(const t of this.diskParticles){const e=Math.cos(t.angle)*t.distance,n=t.yOffset,u=Math.sin(t.angle)*t.distance,l=Math.cos(this.camera.rotationY),d=Math.sin(this.camera.rotationY);let g=e*l-u*d,c=e*d+u*l;const M=Math.cos(this.camera.rotationX),f=Math.sin(this.camera.rotationX);let p=n*M-c*f;c=n*f+c*M;const m=Math.sqrt(g*g+p*p),b=c>0;if(this.lensingStrength>0&&m<this.bhRadius*6){const P=this.bhRadius*1.8,y=Math.exp(-m/(this.bhRadius*1.8)),H=y*1.2*this.lensingStrength,I=t.angle+this.camera.rotationY,$=Math.sin(I)>0,E=1-i;if(m>0){let D=H;!$&&b&&(D*=1-E*.6);const C=(m+P*D)/m;g*=C,p*=C}if(i>.05){const D=this.bhRadius*5,C=g/D,X=Math.max(0,Math.cos(C*Math.PI*.5)),O=b?Math.min(1,c/(this.bhRadius*3)):Math.min(1,Math.abs(c)/(this.bhRadius*3)),Y=this.bhRadius*2*y*O*i;b?$?p-=Y*X:p+=Y*X*.5:p+=Y*X*.4}}const v=this.camera.perspective/(this.camera.perspective+c);if(c<-this.camera.perspective+10)continue;const k=g*v,R=p*v,S=1+Math.cos(t.angle+this.camera.rotationY)*.4;let w=1;if(t.age!==void 0){const P=t.age/t.maxAge;w=1-Math.pow(P,2)}o.push({x:k,y:R,z:c,scale:v,color:t.baseColor,doppler:S,alpha:w,size:t.size})}o.sort((t,e)=>e.z-t.z);for(const t of o){const{r:e,g:n,b:u}=t.color,l=this.baseScale*a.particleScale*t.scale*t.size;if(l<.1)continue;const d=Math.min(255,Math.round(e*t.doppler)),g=Math.min(255,Math.round(n*t.doppler)),c=Math.min(255,Math.round(u*t.doppler)),M=Math.max(0,Math.min(1,t.alpha*t.doppler*.8));s.fillStyle=`rgba(${d}, ${g}, ${c}, ${M})`,s.beginPath(),s.arc(r+t.x,h+t.y,l,0,Math.PI*2),s.fill(),t.doppler>1.1&&t.alpha>.5&&(s.globalCompositeOperation="screen",s.fillStyle=`rgba(${d}, ${g}, ${c}, ${M*.3})`,s.beginPath(),s.arc(r+t.x,h+t.y,l*1.5,0,Math.PI*2),s.fill(),s.globalCompositeOperation="source-over")}}renderFallingMatter(s,r,h){if(!this.fallingParticles||this.fallingParticles.length===0)return;const o=400,i=250;for(const t of this.fallingParticles){const e=this.camera.project(t.x,t.y,t.z);if(!e||e.scale<=0)continue;const n=r+e.x,u=h+e.y;if(n<-50||n>this.width+50||u<-50||u>this.height+50)continue;const l=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),d=Math.min(1,l/o),g=255,c=Math.round(200*d),M=Math.round(150*d*d),p=Math.pow(d,.5)*.9,m=Math.max(1,t.size*e.scale),b=Math.max(0,1-l/i),v=1+A.easeInExpo(b)*15,k=1/(1+b*2),R=-n+r,z=-u+h,S=Math.sqrt(R*R+z*z)||1,w=Math.atan2(z/S,R/S);s.save(),s.translate(n,u),s.rotate(w);const P=m*v,y=m*k;s.globalCompositeOperation="screen",s.fillStyle=`rgba(${g}, ${c}, ${M}, ${p*.2})`,s.beginPath(),s.ellipse(0,0,P*1.5,y*2,0,0,Math.PI*2),s.fill(),s.globalCompositeOperation="source-over",s.fillStyle=`rgba(${g}, ${c}, ${M}, ${p})`,s.beginPath(),s.ellipse(0,0,P,y,0,0,Math.PI*2),s.fill(),v>2&&(s.fillStyle=`rgba(255, 255, 255, ${p*.6})`,s.beginPath(),s.ellipse(P*.6,0,P*.3,y*.5,0,0,Math.PI*2),s.fill()),s.restore()}}renderBlackHole(s,r,h){}}function Z(x){const s=new G(x);return s.start(),{stop:()=>s.stop(),game:s}}export{Z as default};
