import{G as u,P as y}from"./gcanvas.es-Dc5p5ZkO.js";const n={colors:{bg:"#0a0a0a",frame:"#1a1a1a",frameBorder:"#333",screen:"#111a11",screenBorder:"#0f0",line:"#0f0",grid:"rgba(0, 255, 0, 0.08)",knob:"#222",knobHighlight:"#444",knobRing:"#0f0",text:"#0f0",textDim:"rgba(0, 255, 0, 0.4)"},frame:{padding:.08,cornerRadius:20,knobSize:.07,knobY:.84},line:{width:2,maxPoints:1e4,sensitivity:.3},grid:{spacing:20},knob:{friction:.92,maxSpeed:15},sand:{gravity:400,maxParticles:500,friction:.98}};class v extends u{constructor(t){super(t),this.backgroundColor=n.colors.bg}init(){super.init(),y.init(this.ctx),this.updateDimensions(),this.points=[],this.cursorX=this.screenCx,this.cursorY=this.screenCy,this.points.push({x:this.cursorX,y:this.cursorY}),this.leftKnob={angle:0,velocity:0,dragging:!1,lastAngle:0},this.rightKnob={angle:0,velocity:0,dragging:!1,lastAngle:0},this.shakeHistory=[],this.lastShakeTime=0,this.sandParticles=[],this.isClearing=!1,this.mouseX=0,this.mouseY=0,this.dragStartAngle=0,this.setupEvents()}updateDimensions(){const t=this.width,s=this.height,e=Math.min(t,s),o=e*n.frame.padding;this.screenX=o*2,this.screenY=o*1.5,this.screenW=t-o*4,this.screenH=s*.68;const r=n.grid.spacing,i=this.screenX+this.screenW/2,h=this.screenY+this.screenH/2;this.screenCx=Math.round((i-this.screenX)/r)*r+this.screenX,this.screenCy=Math.round((h-this.screenY)/r)*r+this.screenY,this.knobRadius=e*n.frame.knobSize,this.knobY=s*n.frame.knobY,this.leftKnobX=t*.2,this.rightKnobX=t*.8}setupEvents(){this.canvas.addEventListener("mousedown",t=>this.onPointerDown(t)),this.canvas.addEventListener("mousemove",t=>this.onPointerMove(t)),this.canvas.addEventListener("mouseup",()=>this.onPointerUp()),this.canvas.addEventListener("mouseleave",()=>this.onPointerUp()),this.canvas.addEventListener("touchstart",t=>{t.preventDefault(),this.onPointerDown(t.touches[0])}),this.canvas.addEventListener("touchmove",t=>{t.preventDefault(),this.onPointerMove(t.touches[0])}),this.canvas.addEventListener("touchend",()=>this.onPointerUp()),window.addEventListener("keydown",t=>this.onKeyDown(t))}onPointerDown(t){const s=this.canvas.getBoundingClientRect(),e=t.clientX-s.left,o=t.clientY-s.top;if(this.mouseX=e,this.mouseY=o,Math.sqrt((e-this.leftKnobX)**2+(o-this.knobY)**2)<this.knobRadius*1.5){this.leftKnob.dragging=!0,this.dragStartAngle=Math.atan2(o-this.knobY,e-this.leftKnobX),this.leftKnob.lastAngle=this.leftKnob.angle;return}if(Math.sqrt((e-this.rightKnobX)**2+(o-this.knobY)**2)<this.knobRadius*1.5){this.rightKnob.dragging=!0,this.dragStartAngle=Math.atan2(o-this.knobY,e-this.rightKnobX),this.rightKnob.lastAngle=this.rightKnob.angle;return}}onPointerMove(t){const s=this.canvas.getBoundingClientRect(),e=t.clientX-s.left,o=t.clientY-s.top,r=Date.now();if(this.shakeHistory.push({x:e,y:o,time:r}),this.shakeHistory=this.shakeHistory.filter(i=>r-i.time<500),this.detectShake()&&this.clearScreen(),this.leftKnob.dragging){let h=Math.atan2(o-this.knobY,e-this.leftKnobX)-this.dragStartAngle;h>Math.PI&&(h-=Math.PI*2),h<-Math.PI&&(h+=Math.PI*2),this.leftKnob.angle=this.leftKnob.lastAngle+h,this.leftKnob.velocity=h*.5}if(this.rightKnob.dragging){let h=Math.atan2(o-this.knobY,e-this.rightKnobX)-this.dragStartAngle;h>Math.PI&&(h-=Math.PI*2),h<-Math.PI&&(h+=Math.PI*2),this.rightKnob.angle=this.rightKnob.lastAngle+h,this.rightKnob.velocity=h*.5}this.mouseX=e,this.mouseY=o}onPointerUp(){this.leftKnob.dragging=!1,this.rightKnob.dragging=!1}onKeyDown(t){switch(t.key){case"ArrowLeft":this.leftKnob.velocity-=.15,t.preventDefault();break;case"ArrowRight":this.leftKnob.velocity+=.15,t.preventDefault();break;case"ArrowUp":this.rightKnob.velocity-=.15,t.preventDefault();break;case"ArrowDown":this.rightKnob.velocity+=.15,t.preventDefault();break;case"c":case"C":this.clearScreen();break;case"s":case"S":this.exportSVG();break}}detectShake(){if(this.shakeHistory.length<10)return!1;let t=0,s=0,e=0;for(let r=1;r<this.shakeHistory.length;r++){const i=this.shakeHistory[r].x-this.shakeHistory[r-1].x,h=this.shakeHistory[r].y-this.shakeHistory[r-1].y;t+=Math.abs(i)+Math.abs(h),e!==0&&Math.sign(i)!==Math.sign(e)&&s++,e=i}const o=Date.now();return t>500&&s>6&&o-this.lastShakeTime>1e3?(this.lastShakeTime=o,!0):!1}clearScreen(){if(this.isClearing||this.points.length<2)return;this.isClearing=!0,this.shakeOffset=20,this.shakeDecay=.85,this.sandParticles=[];const t=Math.max(1,Math.floor(this.points.length/n.sand.maxParticles));for(let s=0;s<this.points.length;s+=t){const e=this.points[s];this.sandParticles.push({x:e.x,y:e.y,vx:(Math.random()-.5)*50,vy:(Math.random()-.5)*20,size:n.line.width+Math.random()*2,alpha:1})}this.points=[],this.cursorX=this.screenCx,this.cursorY=this.screenCy,this.points.push({x:this.cursorX,y:this.cursorY})}exportSVG(){if(this.points.length<2)return;let t=`M ${this.points[0].x.toFixed(2)} ${this.points[0].y.toFixed(2)}`;for(let i=1;i<this.points.length;i++)t+=` L ${this.points[i].x.toFixed(2)} ${this.points[i].y.toFixed(2)}`;const s=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" 
     width="${this.screenW}" 
     height="${this.screenH}" 
     viewBox="${this.screenX} ${this.screenY} ${this.screenW} ${this.screenH}">
  <title>Etch-a-Sketch Export - Genuary 2026 Day 22</title>
  <desc>Single continuous line - pen plotter ready</desc>
  <path d="${t}" 
        fill="none" 
        stroke="#000" 
        stroke-width="1" 
        stroke-linecap="round" 
        stroke-linejoin="round"/>
</svg>`,e=new Blob([s],{type:"image/svg+xml"}),o=URL.createObjectURL(e),r=document.createElement("a");r.href=o,r.download="etch-a-sketch-day22.svg",r.click(),URL.revokeObjectURL(o),console.log("[Day22] SVG exported - pen plotter ready!")}update(t){super.update(t),this.shakeOffset>.5?this.shakeOffset*=this.shakeDecay:this.shakeOffset=0,this.updateSandParticles(t);const s=n.knob.friction,e=n.knob.maxSpeed;this.leftKnob.dragging||(this.leftKnob.velocity*=s),this.leftKnob.velocity=Math.max(-e,Math.min(e,this.leftKnob.velocity)),this.leftKnob.angle+=this.leftKnob.velocity*t*10,this.rightKnob.dragging||(this.rightKnob.velocity*=s),this.rightKnob.velocity=Math.max(-e,Math.min(e,this.rightKnob.velocity)),this.rightKnob.angle+=this.rightKnob.velocity*t*10;const o=n.line.sensitivity*Math.min(this.screenW,this.screenH),r=this.leftKnob.velocity*o*t,i=this.rightKnob.velocity*o*t;if(Math.abs(r)>.01||Math.abs(i)>.01){this.cursorX+=r,this.cursorY+=i,this.cursorX=Math.max(this.screenX+5,Math.min(this.screenX+this.screenW-5,this.cursorX)),this.cursorY=Math.max(this.screenY+5,Math.min(this.screenY+this.screenH-5,this.cursorY));const h=this.points[this.points.length-1];Math.sqrt((this.cursorX-h.x)**2+(this.cursorY-h.y)**2)>1&&(this.points.push({x:this.cursorX,y:this.cursorY}),this.points.length>n.line.maxPoints&&this.points.shift())}}updateSandParticles(t){if(this.sandParticles.length===0){this.isClearing&&(this.isClearing=!1);return}const s=n.sand.gravity,e=n.sand.friction,o=this.screenY+this.screenH;for(let r=this.sandParticles.length-1;r>=0;r--){const i=this.sandParticles[r];i.vy+=s*t,i.vx*=e,i.x+=i.vx*t,i.y+=i.vy*t,i.y>o-i.size&&(i.y=o-i.size,i.vy*=-.3,i.vx*=.8),i.y>=o-i.size-5&&Math.abs(i.vy)<20&&(i.alpha-=t*2),(i.alpha<=0||i.y>this.height)&&this.sandParticles.splice(r,1)}}render(){const t=this.ctx,s=this.width,e=this.height;if(t.fillStyle=n.colors.bg,t.fillRect(0,0,s,e),t.save(),this.shakeOffset>0){const o=(Math.random()-.5)*this.shakeOffset*2,r=(Math.random()-.5)*this.shakeOffset*2;t.translate(o,r)}this.drawFrame(t,s,e),this.drawScreen(t),this.drawLine(t),this.drawSand(t),this.drawCursor(t),this.drawKnob(t,this.leftKnobX,this.knobY,this.leftKnob,"X"),this.drawKnob(t,this.rightKnobX,this.knobY,this.rightKnob,"Y"),t.restore(),this.drawInstructions(t,s,e)}drawFrame(t,s,e){const o=n.frame.cornerRadius;t.fillStyle=n.colors.frame,t.strokeStyle=n.colors.frameBorder,t.lineWidth=2,t.beginPath(),t.roundRect(10,10,s-20,e-20,o),t.fill(),t.stroke(),t.fillStyle=n.colors.text,t.font='bold 16px "Fira Code", monospace',t.textAlign="center",t.fillText("ETCH-A-SKETCH",s/2,35),t.font='10px "Fira Code", monospace',t.fillStyle=n.colors.textDim,t.fillText("GENUARY 2026",s/2,50)}drawScreen(t){t.fillStyle=n.colors.screen,t.strokeStyle=n.colors.screenBorder,t.lineWidth=2,t.beginPath(),t.roundRect(this.screenX,this.screenY,this.screenW,this.screenH,8),t.fill(),t.stroke(),t.save(),t.beginPath(),t.rect(this.screenX,this.screenY,this.screenW,this.screenH),t.clip(),t.strokeStyle=n.colors.grid,t.lineWidth=1;const s=n.grid.spacing;for(let e=this.screenX;e<=this.screenX+this.screenW;e+=s)t.beginPath(),t.moveTo(e,this.screenY),t.lineTo(e,this.screenY+this.screenH),t.stroke();for(let e=this.screenY;e<=this.screenY+this.screenH;e+=s)t.beginPath(),t.moveTo(this.screenX,e),t.lineTo(this.screenX+this.screenW,e),t.stroke();t.restore(),t.save(),t.globalAlpha=.03;for(let e=this.screenY;e<this.screenY+this.screenH;e+=3)t.fillStyle="#0f0",t.fillRect(this.screenX,e,this.screenW,1);t.restore()}drawSand(t){if(this.sandParticles.length!==0){t.save(),t.beginPath(),t.rect(this.screenX,this.screenY,this.screenW,this.screenH),t.clip();for(const s of this.sandParticles)t.globalAlpha=s.alpha,t.fillStyle=n.colors.line,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill(),t.globalAlpha=s.alpha*.3,t.beginPath(),t.arc(s.x,s.y,s.size*2,0,Math.PI*2),t.fill();t.restore()}}drawLine(t){if(!(this.points.length<2)){t.save(),t.beginPath(),t.rect(this.screenX,this.screenY,this.screenW,this.screenH),t.clip(),t.strokeStyle=n.colors.line,t.lineWidth=n.line.width,t.lineCap="round",t.lineJoin="round",t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(let s=1;s<this.points.length;s++)t.lineTo(this.points[s].x,this.points[s].y);t.stroke(),t.strokeStyle="rgba(0, 255, 0, 0.3)",t.lineWidth=n.line.width+4,t.stroke(),t.restore()}}drawCursor(t){t.strokeStyle=n.colors.line,t.lineWidth=1,t.globalAlpha=.8,t.beginPath(),t.moveTo(this.cursorX-6,this.cursorY),t.lineTo(this.cursorX+6,this.cursorY),t.moveTo(this.cursorX,this.cursorY-6),t.lineTo(this.cursorX,this.cursorY+6),t.stroke(),t.fillStyle=n.colors.line,t.beginPath(),t.arc(this.cursorX,this.cursorY,3,0,Math.PI*2),t.fill(),t.globalAlpha=1}drawKnob(t,s,e,o,r){const i=this.knobRadius,h=o.dragging;t.beginPath(),t.arc(s,e,i+4,0,Math.PI*2),t.fillStyle=h?n.colors.knobRing:n.colors.frameBorder,t.fill();const a=t.createRadialGradient(s-i*.3,e-i*.3,0,s,e,i);a.addColorStop(0,n.colors.knobHighlight),a.addColorStop(1,n.colors.knob),t.beginPath(),t.arc(s,e,i,0,Math.PI*2),t.fillStyle=a,t.fill(),t.strokeStyle=n.colors.frameBorder,t.lineWidth=2;const d=8;for(let c=0;c<d;c++){const l=o.angle+c/d*Math.PI*2,b=i*.5,p=i*.85;t.beginPath(),t.moveTo(s+Math.cos(l)*b,e+Math.sin(l)*b),t.lineTo(s+Math.cos(l)*p,e+Math.sin(l)*p),t.stroke()}const f=o.angle;t.fillStyle=n.colors.knobRing,t.beginPath(),t.arc(s+Math.cos(f)*i*.7,e+Math.sin(f)*i*.7,4,0,Math.PI*2),t.fill(),t.fillStyle=n.colors.textDim,t.font='12px "Fira Code", monospace',t.textAlign="center",t.fillText(r,s,e+i+20)}drawInstructions(t,s,e){t.fillStyle=n.colors.textDim,t.font='10px "Fira Code", monospace',t.textAlign="center",t.fillText("Drag knobs or use arrow keys • Shake or [C] to clear • [S] to export SVG",s/2,e-15)}onResize(){this.updateDimensions()}}function k(g){const t=new v(g);return t.start(),{stop:()=>t.stop(),game:t}}export{k as default};
