import{CONFIG as a}from"./day31.config-BSqBXNjO.js";const r="ｱｲｳｴｵｶｷｸｹｺｻｼｽｾｿﾀﾁﾂﾃﾄﾅﾆﾇﾈﾉﾊﾋﾌﾍﾎﾏﾐﾑﾒﾓﾔﾕﾖﾗﾘﾙﾚﾛﾜﾝ0123456789ABCDEF<>{}[]";class p{constructor(t,e,h){this.x=t,this.numRows=e,this.cellH=h,this.reset()}reset(){this.y=-Math.random()*20,this.speed=.3+Math.random()*.4,this.tailLen=8+Math.floor(Math.random()*12),this.chars=[];for(let t=0;t<this.tailLen;t++)this.chars.push(r[Math.floor(Math.random()*r.length)])}update(){if(this.y+=this.speed,Math.random()<.05){const t=Math.floor(Math.random()*this.chars.length);this.chars[t]=r[Math.floor(Math.random()*r.length)]}this.y-this.tailLen>this.numRows&&this.reset()}}class M{constructor(){this.drops=[],this.active=!1,this.alpha=0,this.timer=0,this.phase="waiting",this.cellW=a.matrixCellW||14,this.cellH=a.matrixCellH||20}init(t,e){this.drops=[];const h=Math.ceil(t/this.cellW),s=Math.ceil(e/this.cellH);for(let i=0;i<h;i++)Math.random()<.4&&this.drops.push(new p(i*this.cellW,s,this.cellH));this.timer=a.matrixInitialDelay||10,this.phase="waiting"}update(t){var e,h,s;switch(this.timer-=t,this.phase){case"waiting":this.timer<=0&&(this.phase="fading_in",this.timer=a.matrixFadeTime||2);break;case"fading_in":this.alpha=1-this.timer/(a.matrixFadeTime||2),this.timer<=0&&(this.phase="active",this.alpha=1,this.timer=a.matrixDuration||8);break;case"active":this.timer<=0&&(this.phase="fading_out",this.timer=a.matrixFadeTime||2);break;case"fading_out":this.alpha=this.timer/(a.matrixFadeTime||2),this.timer<=0&&(this.phase="waiting",this.alpha=0,this.timer=(((e=a.matrixInterval)==null?void 0:e.min)||15)+Math.random()*((((h=a.matrixInterval)==null?void 0:h.max)||30)-(((s=a.matrixInterval)==null?void 0:s.min)||15)));break}if(this.alpha>0)for(const i of this.drops)i.update()}render(t,e,h){if(!(this.alpha<=0)){t.save(),t.globalAlpha=this.alpha*(a.matrixOpacity||.3),t.font=`${this.cellH-4}px 'Fira Code', monospace`,t.textBaseline="top";for(const s of this.drops)for(let i=0;i<s.chars.length;i++){const l=(Math.floor(s.y)-i)*this.cellH;if(l<0||l>h)continue;const m=s.chars[i],o=1-i/s.tailLen;if(i===0)t.fillStyle=`rgba(200, 255, 200, ${o})`;else{const c=Math.floor(180*o);t.fillStyle=`rgba(0, ${c}, 50, ${o*.8})`}t.fillText(m,s.x,l)}t.restore()}}}export{M as MatrixRain};
