import{G as w,P as M,C as S,H as v,c as P}from"./index-Qp5ATCeA.js";const h={background:"#000",maxDepth:3,particleBaseSize:20,particleMinSize:2,particleShape:"square",colors:{stroke:"#0f0"},camera:{perspective:800,rotationX:.5,rotationY:-.6,inertia:!0,friction:.92,clampX:!1},animation:{autoRotateSpeed:.15,attractStrength:8,damping:.92,scatterForce:800,buildDelay:.001,maxSponges:7}},z=[{x:1,y:0,z:0},{x:-1,y:0,z:0},{x:0,y:-1,z:0},{x:0,y:1,z:0},{x:0,y:0,z:1},{x:0,y:0,z:-1},{x:1,y:-1,z:0},{x:-1,y:-1,z:0},{x:1,y:1,z:0},{x:-1,y:1,z:0},{x:1,y:0,z:1},{x:-1,y:0,z:1},{x:1,y:0,z:-1},{x:-1,y:0,z:-1},{x:0,y:-1,z:1},{x:0,y:-1,z:-1},{x:0,y:1,z:1},{x:0,y:1,z:-1}];function b(g,t,e,o,n,i,a=[]){if(n>=i)return a.push({x:g,y:t,z:e,size:o,depth:n}),a;const l=o/3,c=o/3;for(let r=-1;r<=1;r++)for(let s=-1;s<=1;s++)for(let p=-1;p<=1;p++){if((r===0?1:0)+(s===0?1:0)+(p===0?1:0)>=2)continue;const m=g+r*c,y=t+s*c,f=e+p*c;b(m,y,f,l,n+1,i,a)}return a}class C extends w{constructor(t){super(t),this.backgroundColor=h.background}init(){super.init(),M.init(this.ctx),this.camera=new S({perspective:h.camera.perspective,rotationX:h.camera.rotationX,rotationY:h.camera.rotationY,inertia:h.camera.inertia,friction:h.camera.friction,clampX:h.camera.clampX,autoRotate:!0,autoRotateSpeed:h.animation.autoRotateSpeed,autoRotateAxis:"y"}),this.camera.enableMouseControl(this.canvas),this.time=0,this.zoom=1,this.targetZoom=1,this.buildTime=0,this.cubesSpawned=0,this.spongeCount=0,this.totalParticles=0,this.isYolo=!1,this.existingPositions=new Set,this.positionTolerance=.1,this.nextCubeIndex=0,this.generateTargets(),this.createParticleSystem(),this.canvas.addEventListener("dblclick",()=>{this.scatterParticles()}),this._onKeyDown=t=>{t.key==="r"||t.key==="R"?this.restart():(t.key==="y"||t.key==="Y")&&this.yoloMode()},window.addEventListener("keydown",this._onKeyDown),this.gesture=new v(this.canvas,{onZoom:t=>{const e=t>0?1.1:.9;this.targetZoom=Math.max(.3,Math.min(15,this.targetZoom*e))},onTap:()=>{this.scatterParticles()}})}stop(){super.stop(),this.gesture&&this.gesture.destroy(),this.particles&&this.particles.destroy(),this._onKeyDown&&window.removeEventListener("keydown",this._onKeyDown)}restart(){this.particles.clear(),this.time=0,this.buildTime=0,this.cubesSpawned=0,this.spongeCount=0,this.nextCubeIndex=0,this.zoom=1,this.targetZoom=1,this.isYolo=!1,this.existingPositions.clear(),this.cubes=[],this.generateTargets(),console.log("Restarted")}yoloMode(){this.restart(),this.isYolo=!0,console.log("YOLO MODE - no limits!")}generateTargets(){const e=Math.min(this.width,this.height)*.35,o=b(0,0,0,e,0,h.maxDepth);o.sort((i,a)=>i.depth-a.depth);const n=this.positionTolerance;this.cubes=o.map((i,a)=>{const l=`${Math.round(i.x/n)},${Math.round(i.y/n)},${Math.round(i.z/n)}`;return this.existingPositions.add(l),{x:i.x,y:i.y,z:i.z,size:i.size,spawnDelay:a*h.animation.buildDelay,spawned:!1}}),console.log(`Menger Sponge: ${this.cubes.length} cubes/particles`)}createParticleSystem(){this._strength=h.animation.attractStrength,this._damping=h.animation.damping;const t=(e,o)=>{if(!e.alive)return;const n=e.custom;if(n.targetX===void 0)return;const i=this.zoom,a=n.targetX*i-e.x,l=n.targetY*i-e.y,c=n.targetZ*i-e.z,r=this._strength*o,s=this._damping;e.vx=(e.vx+a*r)*s,e.vy=(e.vy+l*r)*s,e.vz=(e.vz+c*r)*s,e.x+=e.vx*o,e.y+=e.vy*o,e.z+=e.vz*o};this.particles=new P(this,{camera:this.camera,depthSort:!0,maxParticles:5e4,blendMode:"source-over",useWebGL:!0,webglShape:"softSquare",webglBlendMode:"alpha",depthShading:!0,depthShadingMin:.25,depthShadingMax:1,updaters:[t]}),this.pipeline.add(this.particles),console.log(`Particle rendering: ${this.particles.isWebGL?"WebGL (GPU)":"Canvas 2D (CPU)"}`)}spawnCube(t){const e=this._spawnRadius||(this._spawnRadius=Math.max(this.width,this.height)*.8),o=Math.random()*Math.PI*2,n=Math.acos(2*Math.random()-1),i=e*(.3+Math.random()*.7),a=Math.sin(n),l=i*a*Math.cos(o),c=i*a*Math.sin(o),r=i*Math.cos(n),s=this.particles.acquire();s.x=l,s.y=c,s.z=r,s.vx=-l*.5,s.vy=-c*.5,s.vz=-r*.5;const p=this._baseSizeRef||(this._baseSizeRef=Math.min(this.width,this.height)*.35);s.size=Math.max(h.particleMinSize,h.particleBaseSize*t.size/p),s.color.r=0,s.color.g=255,s.color.b=0,s.color.a=1,s.shape=h.particleShape,s.age=0,s.lifetime=1/0,s.alive=!0,s.custom.targetX=t.x,s.custom.targetY=t.y,s.custom.targetZ=t.z,this.particles.particles.push(s),t.spawned=!0,this.cubesSpawned++}scatterParticles(){const t=this.particles.particles,e=h.animation.scatterForce;for(let o=0,n=t.length;o<n;o++){const i=t[o];if(!i.alive)continue;const a=Math.random()*Math.PI*2,l=Math.acos(2*Math.random()-1),c=e*(.5+Math.random()),r=Math.sin(l);i.vx+=c*r*Math.cos(a),i.vy+=c*r*Math.sin(a),i.vz+=c*Math.cos(l)}}update(t){for(super.update(t),this.time+=t,this.buildTime+=t,this.camera.update(t),this.zoom+=(this.targetZoom-this.zoom)*.15;this.nextCubeIndex<this.cubes.length;){const e=this.cubes[this.nextCubeIndex];if(this.buildTime>=e.spawnDelay)this.spawnCube(e),this.nextCubeIndex++;else break}this.nextCubeIndex>=this.cubes.length&&this.spawnNextSponge()}spawnNextSponge(){if(!this.isYolo&&this.spongeCount>=h.animation.maxSponges-1)return;this.spongeCount++,this.totalParticles+=this.cubesSpawned;const e=Math.min(this.width,this.height)*.35,o=e,n=Math.floor(this.spongeCount/z.length)+1,i=(this.spongeCount-1)%z.length,a=z[i],l=a.x*o*n,c=a.y*o*n,r=a.z*o*n,s=b(l,c,r,e,0,h.maxDepth),p=this.positionTolerance,x=this.existingPositions,m=[];for(const d of s){const u=`${Math.round(d.x/p)},${Math.round(d.y/p)},${Math.round(d.z/p)}`;x.has(u)||(x.add(u),m.push(d))}m.sort((d,u)=>d.depth-u.depth);const y=this.buildTime;for(let d=0;d<m.length;d++){const u=m[d];this.cubes.push({x:u.x,y:u.y,z:u.z,size:u.size,spawnDelay:y+d*h.animation.buildDelay,spawned:!1})}const f=s.length-m.length;console.log(`Sponge #${this.spongeCount+1} | New: ${m.length} | Shared: ${f}`)}clear(){this.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.ctx.fillRect(0,0,this.width,this.height)}render(){super.render();const t=this.ctx;t.fillStyle=h.colors.stroke,t.font="12px monospace",t.textAlign="left";const e=this.particles.isWebGL?"WebGL":"Canvas",o=this.isYolo?"YOLO MODE":`Sponges: ${this.spongeCount+1}`;t.fillText(`MENGER SPONGE | ${o} | Particles: ${this.cubesSpawned} | ${e}`,10,this.height-10),t.textAlign="right",t.fillText(`Zoom: ${this.zoom.toFixed(1)}x | Dbl-click: scatter | R: restart | Y: yolo`,this.width-10,20)}onResize(){this._spawnRadius=null,this._baseSizeRef=null}}function R(g){const t=new C(g);return t.start(),{stop:()=>t.stop(),game:t}}export{R as default};
