import{p as A,d as P,L as X,Z,Y as H,_ as x,$ as T,e as L}from"./index-DMqzgpv5.js";import{TAU as k}from"./day25.config-DJwhhKHN.js";import{MOLECULES as z,ATOMS as Y}from"./day25.chemistry-fLO6Y1II.js";class O extends A{constructor(t,d={}){const g=P.isMobile,p=g?160:220,o=g?180:260,a=p+o+30,u=g?380:480;super(t,{width:a,height:u,...d}),this.listWidth=p,this.previewWidth=o,this.dialogWidth=a,this.dialogHeight=u,this.fontSize=g?10:12,this.itemHeight=g?22:28,this.x=t.width/2,this.y=t.height/2,this.visible=!1,this.selectedMoleculeKey="water",this.moleculeButtons=[],this.previewRotX=0,this.previewRotY=0,this.previewRotZ=0,this.spinSpeedX=(Math.random()-.5)*.015,this.spinSpeedY=(Math.random()-.5)*.02+.01,this.spinSpeedZ=(Math.random()-.5)*.01,this._createUI()}_createUI(){const{listWidth:t,previewWidth:d,dialogWidth:g,dialogHeight:p,fontSize:o,itemHeight:a}=this,u=new X({width:g,height:p,color:"rgba(0, 10, 15, 0.95)",stroke:"#999",lineWidth:2}),v=Z.create(this.game,u,{name:"legendBackground"});this.add(v);const y=new H(this.game,{spacing:10,padding:10,align:"start",debug:!0,width:g,height:p,autoSize:!1});this.add(y);const w=new x(this.game,{spacing:4,padding:5,width:t,scrollable:!0,debug:!0,debugColor:"#999",viewportHeight:p-40});y.add(w);const S=new T(this.game,"MOLECULES",{font:`bold ${o+2}px "Fira Code", monospace`,color:"#0f0",align:"left",baseline:"middle"});w.add(S);const $=["Primordial","Precursors","Amino Acids","Peptides","Nucleobases"],f={};for(const[l,e]of Object.entries(z)){const s=e.tier;f[s]||(f[s]=[]),f[s].push({key:l,mol:e})}for(let l=0;l<=4;l++){const e=f[l];if(!e)continue;const s=new T(this.game,`─ ${$[l]} ─`,{font:`${o-1}px "Fira Code", monospace`,color:"#CCC",align:"left",baseline:"middle"});w.add(s);for(const{key:i,mol:m}of e){const h=new L(this.game,{text:m.name,width:t-10,height:a,font:`${o}px "Fira Code", monospace`,startToggled:i===this.selectedMoleculeKey,onToggle:r=>{if(r){this.selectedMoleculeKey=i,this.previewRotX=0,this.previewRotY=0,this.previewRotZ=0,this.spinSpeedX=(Math.random()-.5)*.015,this.spinSpeedY=(Math.random()-.5)*.02+.01,this.spinSpeedZ=(Math.random()-.5)*.01;for(const c of this.moleculeButtons)c!==h&&c.toggled&&c.toggle(!1)}}});h._moleculeKey=i,this.moleculeButtons.push(h),w.add(h)}}const b=new x(this.game,{spacing:10,padding:10,width:d,debug:!0,debugColor:"#999",height:p-40,autoSize:!1});y.add(b),this.previewTitle=new T(this.game,"Water",{font:`bold ${o+2}px "Fira Code", monospace`,color:"#0f0",align:"center",baseline:"middle"}),b.add(this.previewTitle),this.previewAreaWidth=d-10,this.previewAreaHeight=p-80,this.previewPaneX=t+20,this.previewPaneY=35}renderPreview(t){if(!this.visible||!this.selectedMoleculeKey)return;const d=z[this.selectedMoleculeKey];if(!d)return;this.previewTitle&&(this.previewTitle.text=`${d.label}`);const g=this.x-this.width/2,p=this.y-this.height/2,o=g+this.previewPaneX+this.previewAreaWidth/2,a=p+this.previewPaneY+this.previewAreaHeight/2;this.previewRotX+=this.spinSpeedX,this.previewRotY+=this.spinSpeedY,this.previewRotZ+=this.spinSpeedZ;let u=0;for(const e of d.atoms){const s=Math.sqrt(e.x**2+e.y**2+e.z**2),i=Y[e.element];u=Math.max(u,s+((i==null?void 0:i.radius)||10))}const v=Math.min(this.previewAreaWidth,this.previewAreaHeight)/(u*2.5),y=Math.cos(this.previewRotX),w=Math.sin(this.previewRotX),S=Math.cos(this.previewRotY),$=Math.sin(this.previewRotY),f=Math.cos(this.previewRotZ),b=Math.sin(this.previewRotZ),l=d.atoms.map((e,s)=>{let i=e.x,m=e.y,h=e.z,r=i*f-m*b,c=i*b+m*f;i=r,m=c,r=i*S-h*$;let M=i*$+h*S;i=r,h=M,c=m*y-h*w,M=m*w+h*y,m=c,h=M;const n=Y[e.element];return{index:s,x:i*v,y:m*v,z:h*v,radius:((n==null?void 0:n.radius)||10)*v*.8,hue:(n==null?void 0:n.hue)??135,sat:(n==null?void 0:n.sat)??50,light:(n==null?void 0:n.light)??50,element:e.element}});l.sort((e,s)=>e.z-s.z),t.lineCap="round";for(const e of d.bonds){const s=l.find(r=>r.index===e.from),i=l.find(r=>r.index===e.to);if(!s||!i)continue;const h=40+(s.z+i.z)/2*.3;if(t.strokeStyle=`hsl(135, 50%, ${h}%)`,t.lineWidth=e.order===1?2:1.5,e.order===1)t.beginPath(),t.moveTo(o+s.x,a+s.y),t.lineTo(o+i.x,a+i.y),t.stroke();else{const r=i.x-s.x,c=i.y-s.y,M=Math.sqrt(r*r+c*c),n=-c/M*2,W=r/M*2;for(let C=0;C<e.order;C++){const R=(C-(e.order-1)/2)*3;t.beginPath(),t.moveTo(o+s.x+n*R,a+s.y+W*R),t.lineTo(o+i.x+n*R,a+i.y+W*R),t.stroke()}}}for(const e of l){const s=Math.min(90,Math.max(20,e.light+e.z*.5)),i=t.createRadialGradient(o+e.x-e.radius*.3,a+e.y-e.radius*.3,0,o+e.x,a+e.y,e.radius);i.addColorStop(0,`hsl(${e.hue}, ${e.sat+20}%, ${s+20}%)`),i.addColorStop(.5,`hsl(${e.hue}, ${e.sat}%, ${s}%)`),i.addColorStop(1,`hsl(${e.hue}, ${e.sat+10}%, ${s-15}%)`),t.fillStyle=i,t.beginPath(),t.arc(o+e.x,a+e.y,e.radius,0,k),t.fill(),t.strokeStyle=`hsla(${e.hue}, ${e.sat}%, ${s-10}%, 0.5)`,t.lineWidth=.5,t.stroke()}t.fillStyle="#888",t.font='11px "Fira Code", monospace',t.textAlign="center",t.fillText(d.name,o,a+this.previewAreaHeight/2-10)}}export{O as LegendUI};
