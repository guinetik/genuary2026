import{G as X,P as Y}from"./gcanvas.es-Dc5p5ZkO.js";const M={colors:{bg:"#000"},segments:300,baseRadius:.6,growthDuration:8,hueSpeed:20,glowSize:40,cometLength:30};class E extends X{constructor(t){super(t),this.backgroundColor=M.colors.bg}init(){super.init(),Y.init(this.ctx),this.container=this.canvas.parentElement,this.container&&this.enableFluidSize(this.container),this.time=0,this.mouseX=.5,this.mouseY=.5,this.size=.05,this.targetSize=.05,this.snakeLength=20,this.maxSnakeLength=350,this.isOuroboros=!1,this.ouroborosBlend=0,this.perfection=0,this.eatPulse=0,this.totalEaten=0,this.eatAngleOffset=0,this.coils=1,this.targetCoils=1,this.lungeOffset=0,this.targetLungeOffset=0,this.phaseOffset=0,this.currentRadius=0,this.hueOffset=Math.random()*360,this.screenFlash=0,this.particles=[],this.maxHistory=400,this.history=[];for(let t=0;t<this.maxHistory;t++)this.history.push({x:0,y:0});this.headX=0,this.headY=0,this.headAngle=0,this.targetX=0,this.targetY=0,this.canvas.addEventListener("mousemove",t=>{const s=this.canvas.getBoundingClientRect();this.mouseX=(t.clientX-s.left)/s.width,this.mouseY=(t.clientY-s.top)/s.height,this.targetX=(this.mouseX-.5)*1.4,this.targetY=(this.mouseY-.5)*1.4}),this.canvas.addEventListener("click",t=>{this.isOuroboros&&this.doEat(t)}),this.canvas.addEventListener("touchstart",t=>{t.preventDefault(),this.isOuroboros&&this.doEat(t.touches[0])}),this.canvas.addEventListener("touchmove",t=>{t.preventDefault();const s=t.touches[0],h=this.canvas.getBoundingClientRect();this.mouseX=(s.clientX-h.left)/h.width,this.mouseY=(s.clientY-h.top)/h.height})}doEat(){this.eatPulse=1,this.screenFlash=1,this.targetLungeOffset+=.5,this.targetCoils+=.08,this.totalEaten+=1;const t=this.getSnakePoint(1,this.time),s=this.projectPoint(t),h=this.width/2,n=this.height/2,i=Math.min(this.width,this.height)*.7,f=h+s.x*i,o=n+s.y*i;for(let l=0;l<25;l++){const e=Math.random()*Math.PI*2,a=100+Math.random()*200;this.particles.push({x:f,y:o,vx:Math.cos(e)*a,vy:Math.sin(e)*a,life:1,maxLife:1,hue:this.hueOffset+this.totalEaten*25+Math.random()*60,size:4+Math.random()*8})}}update(t){super.update(t),this.time+=t;const s=M.hueSpeed+this.totalEaten*3;this.hueOffset=(this.hueOffset+s*t)%360;const h=(this.maxSnakeLength-20)/M.growthDuration;if(!this.isOuroboros&&this.snakeLength<this.maxSnakeLength&&(this.snakeLength=Math.min(this.maxSnakeLength,this.snakeLength+t*h)),this.targetSize=Math.min(1,.05+this.snakeLength/this.maxSnakeLength*.95),this.size+=(this.targetSize-this.size)*.02,this.isOuroboros){this.ouroborosBlend=Math.min(1,this.ouroborosBlend+t*.8);const n=Math.min(1,this.totalEaten/15);this.perfection+=(n-this.perfection)*t*.5,this.lungeOffset+=(this.targetLungeOffset-this.lungeOffset)*t*5,this.coils+=(this.targetCoils-this.coils)*t*2;const i=M.baseRadius*this.size;this.currentRadius+=(i-this.currentRadius)*t*2}this.eatPulse>0&&(this.eatPulse=Math.max(0,this.eatPulse-t*3)),this.screenFlash>0&&(this.screenFlash=Math.max(0,this.screenFlash-t*4));for(let n=this.particles.length-1;n>=0;n--){const i=this.particles[n];i.x+=i.vx*t,i.y+=i.vy*t,i.vx*=.96,i.vy*=.96,i.life-=t*1.5,i.life<=0&&this.particles.splice(n,1)}if(!this.isOuroboros){const n=this.targetX-this.headX,i=this.targetY-this.headY;let o=Math.atan2(i,n)-this.headAngle;for(;o>Math.PI;)o-=Math.PI*2;for(;o<-Math.PI;)o+=Math.PI*2;this.headAngle+=o*.08;const l=Math.sin(this.time*8)*.4,e=this.headAngle+l,a=.012*(.5+this.size*.5);this.headX+=Math.cos(e)*a,this.headY+=Math.sin(e)*a,this.history.unshift({x:this.headX,y:this.headY});const r=Math.floor(this.snakeLength)+10;for(;this.history.length>r;)this.history.pop();if(this.snakeLength>=this.maxSnakeLength-10){const c=Math.min(Math.floor(this.snakeLength)-1,this.history.length-1),d=this.history[c];if(d&&Math.sqrt((this.headX-d.x)**2+(this.headY-d.y)**2)<.2){this.isOuroboros=!0;const g=Math.atan2(this.headY,this.headX),u=Math.PI*2*this.coils-this.time*.5;this.phaseOffset=g-u,this.currentRadius=Math.sqrt(this.headX**2+this.headY**2),this.lungeOffset=0,this.targetLungeOffset=0}}}}getSnakePoint(t,s){const h=t*Math.PI*2*this.coils-s*.5+this.phaseOffset+this.lungeOffset,n=1-this.perfection,i=this.isOuroboros?this.currentRadius:M.baseRadius*this.size,f=Math.sin(t*Math.PI*8*this.coils+s*2)*.05*this.size*n,o=i+f,l=Math.cos(h)*o,e=Math.sin(h)*o,a=h*2,r=Math.sin(a),c=Math.cos(a),d=1+r*r,m=o*1.4,g=m*c/d,u=m*r*c/d*.7,y=Math.max(0,Math.min(1,(this.perfection-.7)/.3)),p=y*y*(3-2*y),S=l*(1-p)+g*p,b=e*(1-p)+u*p,k=Math.floor((1-t)*Math.min(this.snakeLength,this.history.length-1)),P=this.history[Math.min(k,this.history.length-1)],$=P?P.x:0,C=P?P.y:0,O=this.ouroborosBlend,v=$*(1-O)+S*O,z=C*(1-O)+b*O,L=Math.sin(t*Math.PI*6*this.coils+s*1.5)*.08*this.size*O,I=Math.sin(h)*.15*this.size*O*p,B=L*n+I;return{x:v,y:z,z:B,t}}projectPoint(t){const s=this.ouroborosBlend,h=-(this.mouseX-.5)*Math.PI*2*s,n=Math.cos(h),i=Math.sin(h),f=t.x*n-t.z*i,o=t.x*i+t.z*n,l=-(this.mouseY-.5)*Math.PI*1.5*s,e=Math.cos(l),a=Math.sin(l),r=t.y*e-o*a,c=t.y*a+o*e,d=1/(1-c*.3*s);return{x:f*d,y:r*d,z:c}}render(){const t=this.ctx,s=this.width,h=this.height,n=s/2,i=h/2,f=Math.min(s,h)*.7;t.fillStyle="rgba(0, 0, 0, 0.12)",t.fillRect(0,0,s,h);const o=M.segments,l=[];for(let e=0;e<=o;e++){const a=e/o,r=this.getSnakePoint(a,this.time),c=this.projectPoint(r);l.push({x:n+c.x*f,y:i+c.y*f,z:c.z,t:a})}this.drawSnake(t,l),this.drawCometTail(t,l),this.drawHead(t,l),t.globalCompositeOperation="lighter";for(const e of this.particles){const a=e.life/e.maxLife,r=e.size*a,c=t.createRadialGradient(e.x,e.y,0,e.x,e.y,r*3);c.addColorStop(0,`hsla(${e.hue}, 100%, 70%, ${a})`),c.addColorStop(.5,`hsla(${e.hue}, 100%, 50%, ${a*.4})`),c.addColorStop(1,"transparent"),t.fillStyle=c,t.beginPath(),t.arc(e.x,e.y,r*3,0,Math.PI*2),t.fill()}if(t.globalCompositeOperation="source-over",this.screenFlash>0){const e=this.hueOffset+this.totalEaten*25;t.fillStyle=`hsla(${e}, 100%, 80%, ${this.screenFlash*.3})`,t.fillRect(0,0,s,h)}if(t.fillStyle="rgba(255, 255, 255, 0.4)",t.font="12px monospace",t.textAlign="center",this.isOuroboros){if(t.fillStyle="rgba(255, 255, 255, 0.3)",t.fillText("Click to consume • Drag to rotate",n,h-20),this.totalEaten>0){const e=this.hueOffset;t.fillStyle=`hsla(${e}, 80%, 60%, 0.6)`;const a=Math.floor(this.perfection*100);let r="Circle";this.perfection>=.95?r="∞ Infinity":this.perfection>=.7&&(r="Morphing..."),t.fillText(`Consumed: ${this.totalEaten} • ${r} (${a}%)`,n,30)}}else{const e=Math.floor(this.snakeLength/this.maxSnakeLength*100);if(e<97)t.fillText(`Growing... ${e}%`,n,h-20);else{t.fillText("NOW! Catch the tail!",n,h-20);const a=Math.min(Math.floor(this.snakeLength),this.history.length-1),r=this.history[a];if(r){const c=n+r.x*f,d=i+r.y*f,m=.6+Math.sin(this.time*6)*.4,g=135,u=t.createRadialGradient(c,d,0,c,d,40);u.addColorStop(0,`hsla(${g}, 100%, 70%, ${m})`),u.addColorStop(.5,`hsla(${g}, 100%, 50%, ${m*.5})`),u.addColorStop(1,"transparent"),t.fillStyle=u,t.beginPath(),t.arc(c,d,40,0,Math.PI*2),t.fill()}}}}drawSnake(t,s){if(s.length<2)return;const h=135,n=this.hueOffset+this.totalEaten*25;for(let i=1;i<s.length;i++){const f=s[i-1],o=s[i],l=i/s.length,e=2+l*14+this.totalEaten*.6,a=7+this.totalEaten*.4,r=e*(1-this.perfection)+a*this.perfection,c=1+Math.sin(this.time*2+l*10)*.1*(1-this.perfection),d=this.eatPulse*Math.sin(l*Math.PI*12+this.time*25)*.4,m=r*(c+d),g=.5+(o.z+.5)*.5,u=this.eatPulse*40,y=(n+l*80+Math.sin(this.time*2+l*8)*30)%360,p=h*(1-this.ouroborosBlend)+y*this.ouroborosBlend,S=100*(1-this.ouroborosBlend)+(85+l*15)*this.ouroborosBlend,b=(45+l*15)*(1-this.ouroborosBlend)+(35+l*25+u)*this.ouroborosBlend;t.globalCompositeOperation="lighter",t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(o.x,o.y),t.strokeStyle=`hsla(${p}, 100%, ${b}%, ${.25*g})`,t.lineWidth=m+12,t.lineCap="round",t.stroke(),t.globalCompositeOperation="source-over",t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(o.x,o.y),t.strokeStyle=`hsla(${p}, ${S}%, ${b+10}%, ${g})`,t.lineWidth=m,t.lineCap="round",t.stroke(),t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(o.x,o.y),t.strokeStyle=`hsla(${p}, ${S-10}%, ${Math.min(85,b+30)}%, ${.7*g})`,t.lineWidth=m*.35,t.lineCap="round",t.stroke()}this.drawScales(t,s)}drawScales(t,s){const h=Math.max(3,Math.floor(s.length/50)),n=135,i=this.hueOffset+this.totalEaten*25;t.globalCompositeOperation="lighter";for(let f=h;f<s.length-h;f+=h){const o=s[f],l=f/s.length,e=2+l*5,a=.5+(o.z+.5)*.5,r=(i+l*80)%360,c=n*(1-this.ouroborosBlend)+r*this.ouroborosBlend;t.beginPath(),t.arc(o.x,o.y,e,0,Math.PI*2),t.fillStyle=`hsla(${c+40*this.ouroborosBlend}, 80%, 65%, ${.35*a})`,t.fill()}t.globalCompositeOperation="source-over"}drawCometTail(t,s){if(s.length<M.cometLength)return;const h=135,n=this.hueOffset+this.totalEaten*25;t.globalCompositeOperation="lighter";for(let i=0;i<M.cometLength;i++){const f=s.length-1-i;if(f<0)break;const o=s[f],l=1-i/M.cometLength,e=M.glowSize*(.3+.7*l)*(1+this.eatPulse*.5),a=l*.4*(1+this.eatPulse),r=(n+60+i*2)%360,c=h*(1-this.ouroborosBlend)+r*this.ouroborosBlend,d=t.createRadialGradient(o.x,o.y,0,o.x,o.y,e);d.addColorStop(0,`hsla(${c}, 100%, 60%, ${a})`),d.addColorStop(.5,`hsla(${c+20*this.ouroborosBlend}, 100%, 50%, ${a*.3})`),d.addColorStop(1,"transparent"),t.fillStyle=d,t.beginPath(),t.arc(o.x,o.y,e,0,Math.PI*2),t.fill()}t.globalCompositeOperation="source-over"}drawHead(t,s){if(s.length<2)return;const h=Math.max(0,1-(this.perfection-.7)/.25);if(h<=0)return;const n=s[s.length-1],i=s[s.length-10]||s[s.length-2],f=Math.atan2(n.y-i.y,n.x-i.x),o=(16+this.totalEaten*.6)*(1-this.perfection)+(7+this.totalEaten*.4)*this.perfection,e=(.5+(n.z+.5)*.5)*h,a=135,r=this.hueOffset+this.totalEaten*25,c=(r+80)%360,d=a*(1-this.ouroborosBlend)+c*this.ouroborosBlend,m=60*(1-this.ouroborosBlend)+(60+this.eatPulse*40)*this.ouroborosBlend;t.save(),t.translate(n.x,n.y),t.rotate(f);const g=o*1.8,u=o*1.1;t.beginPath(),t.ellipse(g*.3,0,g,u,0,0,Math.PI*2),t.fillStyle=`hsla(${d}, 100%, ${m}%, ${e})`,t.fill(),t.beginPath(),t.ellipse(g*.2,0,g*.6,u*.6,0,0,Math.PI*2),t.fillStyle=`hsla(${d}, 90%, ${m+15}%, ${e*.6})`,t.fill();const y=(1.2+o*.04)*h,p=g*.4,S=u*.35;t.beginPath(),t.arc(p,-S,y,0,Math.PI*2),t.fillStyle=`hsla(50, 100%, 90%, ${e})`,t.fill(),t.beginPath(),t.ellipse(p,-S,y*.3,y*.6,0,0,Math.PI*2),t.fillStyle=`hsla(0, 0%, 5%, ${e})`,t.fill(),t.beginPath(),t.arc(p,S,y,0,Math.PI*2),t.fillStyle=`hsla(50, 100%, 90%, ${e})`,t.fill(),t.beginPath(),t.ellipse(p,S,y*.3,y*.6,0,0,Math.PI*2),t.fillStyle=`hsla(0, 0%, 5%, ${e})`,t.fill(),t.restore();const b=s[0],k=(r+120)%360,P=a*(1-this.ouroborosBlend)+k*this.ouroborosBlend;t.globalCompositeOperation="lighter";const $=t.createRadialGradient(b.x,b.y,0,b.x,b.y,20);$.addColorStop(0,`hsla(${P}, 100%, 60%, ${.5*h})`),$.addColorStop(1,"transparent"),t.fillStyle=$,t.beginPath(),t.arc(b.x,b.y,20,0,Math.PI*2),t.fill(),t.globalCompositeOperation="source-over"}}function T(w){const t=new E(w);return t.start(),{stop:()=>t.stop(),game:t}}export{T as default};
