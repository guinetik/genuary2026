import{G as k,P,n as Y,i as b,o as g,B as C,E as D,R as _,p as G,q as X,m as F}from"./gcanvas.es-CMQjSjBY.js";const w=Math.sqrt(2),a={animDuration:.8,staggerDelay:.1,colors:{largeTriangle1:"#2196F3",largeTriangle2:"#E91E63",mediumTriangle:"#9C27B0",smallTriangle1:"#FFEB3B",smallTriangle2:"#4CAF50",square:"#E53935",parallelogram:"#FF9800"},strokeColor:"#FFFFFF",strokeWidth:2,button:{width:140,height:40,spacing:20}},l={LARGE_LEG:1/w,MEDIUM_LEG:.5,SMALL_LEG:1/(2*w),SQUARE_SIDE:1/(2*w),PARA_BASE:.5,PARA_HEIGHT:.25},m=l.LARGE_LEG,E=l.MEDIUM_LEG,v=l.SMALL_LEG,I=[{name:"s₀",pieces:[f(0,0,m,225),f(0,0,m,135),f(.5,.5,E,180),f(.25,-.25,v,315),f(0,0,v,45),{x:.25,y:0,rotation:45},{x:-.125,y:.375,rotation:0}]},{name:"s₁",pieces:[f(0,0,m,45),f(0,0,m,135),f(.5,-.5,E,90),f(0,0,v,315),f(-.25,-.25,v,225),{x:0,y:-.25,rotation:45},{x:.375,y:.125,rotation:90}]}],L=[{name:"cat",view:{offsetX:-150,offsetY:-50,scale:.7},pieces:[{x:.416,y:.376,rotation:135},{x:.721,y:.641,rotation:180},{x:.132,y:.23,rotation:315},{x:-.167,y:-.375,rotation:135},{x:.167,y:-.375,rotation:315},{x:0,y:-.124,rotation:45},{x:1.332,y:.751,rotation:0}]},{name:"cat2",view:{offsetX:-50,offsetY:-75,scale:.6},pieces:[{x:.405,y:.958,rotation:180},{x:.307,y:.486,rotation:135},{x:.021,y:.217,rotation:315},{x:.167,y:-.501,rotation:315},{x:-.167,y:-.501,rotation:135},{x:0,y:-.25,rotation:45},{x:-.037,y:.571,rotation:225,scaleX:-1}]},{name:"cat_sitting",view:{offsetX:0,offsetY:0,scale:.8},pieces:[{x:.469,y:.292,rotation:45},{x:-.031,y:.124,rotation:225},{x:-.365,y:.292,rotation:270},{x:.887,y:-.292,rotation:315},{x:.552,y:-.292,rotation:135},{x:.719,y:-.041,rotation:45},{x:-.885,y:.282,rotation:225}]}],M={name:"bear",view:{offsetX:0,offsetY:-85,scale:.9},pieces:[{x:-.737,y:.149,rotation:315},{x:-.335,y:-.116,rotation:0},{x:-.03,y:-.019,rotation:180},{x:.608,y:-.116,rotation:270},{x:-.737,y:.649,rotation:135},{x:.313,y:-.174,rotation:0},{x:.137,y:.326,rotation:225}]},A={name:"custom",view:{offsetX:0,offsetY:0,scale:.8},pieces:[{x:-.501,y:.333,rotation:45},{x:-.026,y:.236,rotation:90},{x:1.083,y:-.167,rotation:270},{x:-.25,y:.584,rotation:225},{x:.182,y:-.117,rotation:180},{x:.388,y:.177,rotation:0},{x:.739,y:0,rotation:135}]},O={name:"camel",view:{offsetX:-175,offsetY:-50,scale:.75},pieces:[{x:.411,y:.413,rotation:135},{x:.963,y:.396,rotation:90},{x:.845,y:.042,rotation:45},{x:.16,y:-.338,rotation:315},{x:-.006,y:-.504,rotation:225},{x:.492,y:-.089,rotation:45},{x:.117,y:.036,rotation:90}]},T=[{name:"house",view:{offsetX:0,offsetY:0,scale:.9},pieces:[{x:.222,y:-.026,rotation:45},{x:-.024,y:.473,rotation:45},{x:-.358,y:.307,rotation:0},{x:.392,y:.39,rotation:315},{x:.227,y:.225,rotation:225},{x:-.206,y:-.287,rotation:0},{x:-.398,y:.016,rotation:0}]},{name:"house2",view:{offsetX:0,offsetY:105,scale:.9},pieces:[{x:.22,y:-.153,rotation:270},{x:-.252,y:-.153,rotation:180},{x:.16,y:.319,rotation:45},{x:-.076,y:.202,rotation:0},{x:.396,y:.202,rotation:90},{x:-.37,y:.26,rotation:90},{x:.442,y:-.416,rotation:90}]}],R={name:"horserider",view:{offsetX:-50,offsetY:-55,scale:.7},pieces:[{x:.034,y:.617,rotation:0},{x:.647,y:.481,rotation:180},{x:.172,y:.214,rotation:270},{x:1,y:.244,rotation:270},{x:.765,y:.833,rotation:90},{x:.006,y:-.369,rotation:45},{x:-.58,y:.507,rotation:0}]},N={name:"horse",view:{offsetX:0,offsetY:-105,scale:.65},pieces:[{x:.167,y:.482,rotation:135},{x:-.235,y:.217,rotation:90},{x:-.353,y:-.489,rotation:45},{x:-.707,y:.149,rotation:45},{x:-.117,y:.924,rotation:180},{x:-.176,y:-.195,rotation:0},{x:.678,y:.835,rotation:225,scaleY:-1}]},B={name:"helicopter",view:{offsetX:-200,offsetY:75,scale:.85},pieces:[{x:.167,y:0,rotation:135},{x:-.167,y:0,rotation:315},{x:-.355,y:-.618,rotation:45},{x:.501,y:.167,rotation:45},{x:.751,y:.083,rotation:225},{x:1.136,y:-.12,rotation:45},{x:.373,y:-.625,rotation:0,scaleX:-1,scaleY:-1}]},H={name:"plane",view:{offsetX:0,offsetY:0,scale:.8},pieces:[{x:.481,y:-.216,rotation:180},{x:-.245,y:-.061,rotation:225},{x:.092,y:.439,rotation:90},{x:-.495,y:.189,rotation:45},{x:-.223,y:-.312,rotation:45},{x:-.745,y:.021,rotation:45},{x:.133,y:.147,rotation:180}]},$={name:"boat",view:{offsetX:0,offsetY:140,scale:.7},pieces:[{x:.157,y:-.166,rotation:135},{x:-.245,y:.006,rotation:180},{x:.157,y:-.832,rotation:270},{x:.24,y:.25,rotation:45},{x:.24,y:.418,rotation:225},{x:.491,y:.083,rotation:45},{x:-.134,y:.459,rotation:0,scaleY:-1}]},z={name:"goose",view:{offsetX:0,offsetY:-80,scale:.72},pieces:[{x:.403,y:.447,rotation:225},{x:.138,y:.751,rotation:270},{x:-.214,y:.633,rotation:315},{x:-.317,y:-.385,rotation:180},{x:-.367,y:.383,rotation:135},{x:-.2,y:.132,rotation:45},{x:-.074,y:-.244,rotation:90}]},W={name:"rabbit",view:{offsetX:0,offsetY:-100,scale:.6},pieces:[{x:-.306,y:.483,rotation:315},{x:.094,y:.954,rotation:270},{x:.026,y:.315,rotation:270},{x:.595,y:-.136,rotation:180},{x:.242,y:.599,rotation:90},{x:.11,y:-.018,rotation:45},{x:-.242,y:-.445,rotation:45}]},V={name:"rocket",view:{offsetX:50,offsetY:0,scale:.6},pieces:[{x:-.054,y:.267,rotation:315},{x:-.222,y:-.233,rotation:135},{x:-.054,y:-.566,rotation:90},{x:-.556,y:.767,rotation:135},{x:-.137,y:-.817,rotation:45},{x:-.389,y:.516,rotation:45},{x:.237,y:.642,rotation:270}]},U={name:"turtle",view:{offsetX:0,offsetY:-90,scale:.7},pieces:[{x:.167,y:.326,rotation:135},{x:-.166,y:.326,rotation:315},{x:-.539,y:-.11,rotation:45},{x:.36,y:.82,rotation:90},{x:-.36,y:.82,rotation:0},{x:0,y:-.423,rotation:45},{x:.542,y:-.162,rotation:315,scaleY:-1}]},q={name:"pyramid",view:{offsetX:0,offsetY:-50,scale:.95},pieces:[{x:.489,y:.373,rotation:45},{x:-.511,y:.373,rotation:45},{x:-.177,y:.206,rotation:90},{x:.073,y:.289,rotation:135},{x:-.011,y:-.293,rotation:45},{x:.239,y:.04,rotation:45},{x:-.136,y:-.084,rotation:0}]},K={name:"custom",view:{offsetX:0,offsetY:-100,scale:.75},pieces:[{x:.169,y:.579,rotation:45},{x:-.033,y:.113,rotation:225},{x:-.027,y:-.173,rotation:45},{x:.386,y:-.472,rotation:90},{x:.269,y:-.355,rotation:270},{x:-.379,y:-.413,rotation:180},{x:.044,y:.871,rotation:180}]},j={name:"seal",view:{offsetX:-100,offsetY:-100,scale:.85},pieces:[{x:.335,y:.286,rotation:180},{x:-.329,y:.38,rotation:225},{x:.924,y:-.303,rotation:45},{x:.688,y:.286,rotation:0},{x:-.711,y:.096,rotation:270},{x:.747,y:-.009,rotation:90},{x:.747,y:.522,rotation:135}]},Q={name:"crab",view:{offsetX:0,offsetY:0,scale:.8},pieces:[{x:.292,y:.044,rotation:180},{x:-.295,y:.16,rotation:0},{x:.646,y:-.369,rotation:135},{x:-.648,y:-.546,rotation:180},{x:.409,y:.398,rotation:90},{x:0,y:-.25,rotation:90},{x:-.531,y:-.25,rotation:225}]},Z={name:"giraffe",view:{offsetX:0,offsetY:-200,scale:.53},pieces:[{x:.086,y:1.127,rotation:315},{x:-.415,y:1.127,rotation:315},{x:.419,y:-.29,rotation:270},{x:.169,y:-.124,rotation:315},{x:-.164,y:.877,rotation:135},{x:.003,y:.626,rotation:45},{x:.127,y:.252,rotation:270}]},J={name:"crow",view:{offsetX:-275,offsetY:-125,scale:.8},pieces:[{x:.765,y:.236,rotation:90},{x:.501,y:-.166,rotation:45},{x:1.167,y:.333,rotation:270},{x:.931,y:.804,rotation:45},{x:-.249,y:-.083,rotation:45},{x:0,y:-.25,rotation:45},{x:1.376,y:.625,rotation:180,scaleY:-1}]},p=[...I,...L,...T,V,W,z,$,R,O,M,A,J,Z,Q,U,q,K,j,N,B,H],S=I[1],tt={offsetX:0,offsetY:0,scale:1};function et(c,t,e){const i=e*Math.PI/180;return{x:c*Math.cos(i)-t*Math.sin(i),y:c*Math.sin(i)+t*Math.cos(i)}}function f(c,t,e,i){const s={x:-e/3,y:-e/3},o=et(s.x,s.y,i);return{x:c-o.x,y:t-o.y,rotation:i}}function it(c){return c.view??tt}function st(c,t=45){return(Math.round(c/t)*t%360+360)%360}class ot extends F{constructor(t,e,i={}){super(t,i),this.shape=e,this.baseSize=i.baseSize||100,this.scaleX=1,this.scaleY=1,this.interactive=!0,this._calculateHitSize(),this._calculateLocalVertices()}_calculateHitSize(){const t=this.shape;t.leg!==void 0?(this.width=t.leg,this.height=t.leg):t.side!==void 0?(this.width=t.side,this.height=t.side):t.width!==void 0?(this.width=t.width+(t.slant||0),this.height=t.height||t.width):(this.width=50,this.height=50)}_calculateLocalVertices(){const t=this.shape;if(t.leg!==void 0){const e=t.leg,i=e/3,s=e/3;this._localVertices=[{x:-i,y:-s},{x:e-i,y:-s},{x:-i,y:e-s}]}else if(t.side!==void 0){const e=t.side/2;this._localVertices=[{x:-e,y:-e},{x:e,y:-e},{x:e,y:e},{x:-e,y:e}]}else if(t.width!==void 0){const e=t.width,i=t.height,s=t.slant||0;this._localVertices=[{x:-e/2,y:i/2},{x:e/2,y:i/2},{x:e/2+s,y:-i/2},{x:-e/2+s,y:-i/2}]}else this._localVertices=[]}getWorldVertices(){const t=this._rotationDeg!==void 0?this._rotationDeg*Math.PI/180:this.rotation,e=Math.cos(t),i=Math.sin(t);return this._localVertices.map(s=>({x:this.x+s.x*e-s.y*i,y:this.y+s.x*i+s.y*e}))}getBounds(){const t=this.width*Math.abs(this.scaleX),e=this.height*Math.abs(this.scaleY);return{x:this.x,y:this.y,width:t,height:e}}animateTo(t,e=0){g.killTarget(this),g.to(this,{x:t.x*this.baseSize,y:t.y*this.baseSize,rotation:t.rotation,scaleX:t.scaleX??1,scaleY:t.scaleY??1},a.animDuration,D.easeOutBack,{delay:e})}setPosition(t){this.x=t.x*this.baseSize,this.y=t.y*this.baseSize,this.rotation=t.rotation,this.scaleX=t.scaleX??1,this.scaleY=t.scaleY??1}draw(){super.draw(),this.shape.draw()}}class nt extends k{constructor(t){super(t),this.configIndex=0,this.draggingPiece=null,this.selectedPiece=null,this._onKeyDown=null,this._onCanvasClick=null,this._dragCleanups=[],this.shuffledIndices=[],this.shufflePosition=0}init(){super.init(),P.init(this.ctx),this.baseSize=Math.min(this.width,this.height)*.8,this.scene=new Y(this,{x:this.width/2,y:this.height/2}),this.pieces=this.createPieces();for(const t of this.pieces)this.scene.add(t);this.pipeline.add(this.scene),this.createButtons(),this.initStateMachine(),this.initKeyboardHandler(),this.canvas.tabIndex=0,this.canvas.style.outline="none",this.canvas.addEventListener("pointerdown",()=>this.canvas.focus()),this.canvas.focus()}initStateMachine(){this.fsm=new b({initial:"menu",context:this,states:{menu:{enter:()=>{this.showButtons(!0),this.removeCanvasClickHandler(),this.disableDragging(),this.configuration=p[0],this.applyConfiguration(!1)},exit:()=>{this.showButtons(!1)}},showcase:{enter:()=>{this.shuffleConfigs(),this.configIndex=this.shuffledIndices[0],this.shufflePosition=0,this.configuration=p[this.configIndex],this.applyConfiguration(!1),this.assignDistinctColors(),this.setupCanvasClickHandler(()=>this.toggleShowcase()),this.disableDragging()},exit:()=>{this.removeCanvasClickHandler()}},design:{enter:()=>{for(const t of this.pieces)g.killTarget(t);g.killTarget(this.scene),this.scene.x=this.width/2,this.scene.y=this.height/2,S?(this.loadDesignConfig(S),console.log(`[Design Mode] Loaded config: ${S.name}`)):(this.scene.scaleX=1,this.scene.scaleY=1,this._designScale=1,this.scatterPieces()),this.enableDragging(),this.enableWheelZoom(),console.log("[Design Mode] Q/E rotate, W/S flip (mirror), Wheel zoom, Drag to pan, P print")},exit:()=>{this.disableDragging(),this.disableWheelZoom()}}}})}createButtons(){const{width:t,height:e,spacing:i}=a.button,s=this.width/2,o=this.height/2;this.showcaseBtn=new C(this,{x:s-t/2-i/2,y:o,width:t,height:e,text:"Showcase",onClick:()=>this.fsm.setState("showcase")}),this.designBtn=new C(this,{x:s+t/2+i/2,y:o,width:t,height:e,text:"Design",onClick:()=>this.fsm.setState("design")}),this.backBtn=new C(this,{x:80,y:30,width:100,height:30,text:"← Back",onClick:()=>this.fsm.setState("menu")}),this.pipeline.add(this.showcaseBtn),this.pipeline.add(this.designBtn),this.pipeline.add(this.backBtn)}showButtons(t){this.showcaseBtn&&(this.showcaseBtn.visible=t,this.designBtn.visible=t,this.backBtn.visible=!t,this.showcaseBtn.interactive=t,this.designBtn.interactive=t,this.backBtn.interactive=!t)}initKeyboardHandler(){this._onKeyDown=e=>{const i=e.key.toLowerCase();if(this.fsm.is("design")&&this.selectedPiece){if(i==="q"||i==="e"){e.preventDefault(),e.stopPropagation(),this.selectedPiece._rotationDeg===void 0&&(this.selectedPiece._rotationDeg=0);const s=i==="q"?-45:45;this.selectedPiece._rotationDeg+=s,console.log(`[Rotate] ${i.toUpperCase()}: ${this.selectedPiece._rotationDeg-s}° -> ${this.selectedPiece._rotationDeg}°`),this.selectedPiece.rotation=this.selectedPiece._rotationDeg;return}if(i==="w"||i==="s"){e.preventDefault(),e.stopPropagation(),i==="w"?(this.selectedPiece.scaleX*=-1,console.log(`[Flip] Horizontal: scaleX = ${this.selectedPiece.scaleX}`)):(this.selectedPiece.scaleY*=-1,console.log(`[Flip] Vertical: scaleY = ${this.selectedPiece.scaleY}`));return}}if(i==="p"&&this.fsm.is("design")){e.preventDefault(),e.stopPropagation(),this.printConfiguration();return}i==="escape"&&!this.fsm.is("menu")&&(e.preventDefault(),this.fsm.setState("menu"))},window.addEventListener("keydown",this._onKeyDown,{capture:!0})}setupCanvasClickHandler(t){this.removeCanvasClickHandler(),this._onCanvasClick=t,this.canvas.addEventListener("click",this._onCanvasClick)}removeCanvasClickHandler(){this._onCanvasClick&&(this.canvas.removeEventListener("click",this._onCanvasClick),this._onCanvasClick=null)}enableDragging(){this.disableDragging();for(const t of this.pieces){t.interactive=!0,t._dragOffset={x:0,y:0},t._isDragging=!1;const e=o=>{t._isDragging=!0,this.draggingPiece=t,this.selectPiece(t);const n=this.scene.scaleX||1,r=(o.x-this.scene.x)/n,h=(o.y-this.scene.y)/n;t._dragOffset.x=t.x-r,t._dragOffset.y=t.y-h},i=o=>{if(!t._isDragging)return;const n=this.scene.scaleX||1,r=(o.x-this.scene.x)/n,h=(o.y-this.scene.y)/n;t.x=r+t._dragOffset.x,t.y=h+t._dragOffset.y},s=()=>{t._isDragging&&(t._isDragging=!1,this.draggingPiece=null,this.snapPieceToNearby(t))};t.on("inputdown",e),this.events.on("inputmove",i),this.events.on("inputup",s),this._dragCleanups.push(()=>{t.off("inputdown",e),this.events.off("inputmove",i),this.events.off("inputup",s),delete t._dragOffset,delete t._isDragging})}this._clickedPiece=!1,this._isDraggingCanvas=!1,this._canvasDragStart={x:0,y:0},this._sceneDragStart={x:0,y:0},this._onDesignCanvasDown=t=>{this._clickedPiece=!1,setTimeout(()=>{!this._clickedPiece&&!this.draggingPiece&&(this._isDraggingCanvas=!0,this._canvasDragStart.x=t.x,this._canvasDragStart.y=t.y,this._sceneDragStart.x=this.scene.x,this._sceneDragStart.y=this.scene.y)},0)},this._onDesignCanvasMove=t=>{if(this._isDraggingCanvas){const e=t.x-this._canvasDragStart.x,i=t.y-this._canvasDragStart.y;this.scene.x=this._sceneDragStart.x+e,this.scene.y=this._sceneDragStart.y+i}},this._onDesignCanvasUp=()=>{!this._clickedPiece&&!this.draggingPiece&&!this._isDraggingCanvas&&this.deselectPiece(),this._isDraggingCanvas=!1};for(const t of this.pieces){const e=()=>{this._clickedPiece=!0};t.on("inputdown",e),this._dragCleanups.push(()=>t.off("inputdown",e))}this.events.on("inputdown",this._onDesignCanvasDown),this.events.on("inputmove",this._onDesignCanvasMove),this.events.on("inputup",this._onDesignCanvasUp),this._dragCleanups.push(()=>{this.events.off("inputdown",this._onDesignCanvasDown),this.events.off("inputmove",this._onDesignCanvasMove),this.events.off("inputup",this._onDesignCanvasUp)})}selectPiece(t){this.selectedPiece&&this.selectedPiece!==t&&this.restorePieceStroke(this.selectedPiece),this.selectedPiece=t,this.scene.bringToFront(t),t._originalStroke||(t._originalStroke=t.shape.stroke,t._originalLineWidth=t.shape.lineWidth),t.shape.stroke="#0f0",t.shape.lineWidth=4}restorePieceStroke(t){t._originalStroke!==void 0&&(t.shape.stroke=t._originalStroke,t.shape.lineWidth=t._originalLineWidth)}deselectPiece(){this.selectedPiece&&(this.restorePieceStroke(this.selectedPiece),this.selectedPiece=null)}disableDragging(){for(const t of this._dragCleanups)typeof t=="function"&&t();this._dragCleanups=[],this.draggingPiece=null,this.deselectPiece()}enableWheelZoom(){this._onWheel=t=>{t.preventDefault();const e=.05,i=t.deltaY>0?-e:e;this._designScale=Math.max(.3,Math.min(1,this._designScale+i)),this.scene.scaleX=this._designScale,this.scene.scaleY=this._designScale},this.canvas.addEventListener("wheel",this._onWheel,{passive:!1})}disableWheelZoom(){this._onWheel&&(this.canvas.removeEventListener("wheel",this._onWheel),this._onWheel=null)}snapPieceToNearby(t){const i=t.getWorldVertices();if(i.length===0)return;let s=null,o=25;for(const n of this.pieces){if(n===t)continue;const r=n.getWorldVertices();for(const h of i)for(const y of r){const x=y.x-h.x,d=y.y-h.y,u=Math.sqrt(x*x+d*d);u<o&&(o=u,s={dx:x,dy:d})}}s&&(t.x+=s.dx,t.y+=s.dy,console.log(`[Snap] Snapped piece by (${s.dx.toFixed(1)}, ${s.dy.toFixed(1)})`))}scatterPieces(){const t=this.baseSize*.25,e=4,i=-t*1.5,s=-t;for(let o=0;o<this.pieces.length;o++){const n=this.pieces[o],r=o%e,h=Math.floor(o/e);n.x=i+r*t,n.y=s+h*t,n.rotation=0,n._rotationDeg=0,n.scaleX=n.scaleY=1}}loadDesignConfig(t){const e=t.view??{scale:1};this._designScale=e.scale,this.scene.scaleX=e.scale,this.scene.scaleY=e.scale;for(let i=0;i<this.pieces.length;i++){const s=this.pieces[i],o=t.pieces[i];s.x=o.x*this.baseSize,s.y=o.y*this.baseSize,s.rotation=o.rotation,s._rotationDeg=o.rotation,s.scaleX=o.scaleX??1,s.scaleY=o.scaleY??1}}printConfiguration(){const t=["Large 1","Large 2","Medium","Small 1","Small 2","Square","Parallelogram"];console.log(`
=== TANGRAM CONFIGURATION ===`),console.log(`Copy this into ALL_CONFIGS:
`);const i=`{
  name: "custom",
  view: { offsetX: 0, offsetY: 0, scale: ${(this._designScale??1).toFixed(2)} },
  pieces: [
${this.pieces.map((s,o)=>{const n=(s.x/this.baseSize).toFixed(3),r=(s.y/this.baseSize).toFixed(3),h=s._rotationDeg!==void 0?s._rotationDeg:s.rotation*180/Math.PI,y=st(h,45),x=s.scaleX??1,d=s.scaleY??1;let u="";return x!==1&&(u+=`, scaleX: ${x}`),d!==1&&(u+=`, scaleY: ${d}`),`    // ${t[o]}
    { x: ${n}, y: ${r}, rotation: ${y}${u} },`}).join(`
`)}
  ],
}`;console.log(i),console.log(`
=============================
`)}applySceneView(t=!0){const e=it(this.configuration),o=Math.min(this.width,this.height)/800,n={x:this.width/2+e.offsetX*o,y:this.height/2+e.offsetY*o,scaleX:e.scale,scaleY:e.scale};g.killTarget(this.scene),t?g.to(this.scene,n,a.animDuration,D.easeOutBack):(this.scene.x=n.x,this.scene.y=n.y,this.scene.scaleX=n.scaleX,this.scene.scaleY=n.scaleY)}toggleShowcase(){this.nextConfiguration(),this.assignDistinctColors()}assignDistinctColors(){const t=this.pieces.length,e=30,i=[];let s=Math.random()*360;for(let o=0;o<t;o++)i.push(s%360),s+=e+Math.random()*40;for(let o=i.length-1;o>0;o--){const n=Math.floor(Math.random()*(o+1));[i[o],i[n]]=[i[n],i[o]]}for(let o=0;o<t;o++){const n=Math.round(i[o]),r=70+Math.random()*25,h=45+Math.random()*20,y=`hsl(${n}, ${r.toFixed(0)}%, ${h.toFixed(0)}%)`;this.pieces[o].shape.color=y,this.pieces[o].shape.fill=y}}scatterPiecesAnimated(){const t={offsetX:0,offsetY:0,scale:1};this.configuration={view:t},this.applySceneView(!0);for(let e=0;e<this.pieces.length;e++){const i=this.pieces[e];g.killTarget(i),i._originalColor||(i._originalColor=i.shape.color);const s=(Math.random()-.5)*this.baseSize*1.2,o=(Math.random()-.5)*this.baseSize*1.2,n=Math.floor(Math.random()*8)*45,r=P.colors.randomColorHSL();i.shape.color=r,i.shape.fill=r,g.to(i,{x:s,y:o,rotation:n},a.animDuration,D.easeOutBack,{delay:e*a.staggerDelay})}}restoreOriginalColors(){for(const t of this.pieces)t._originalColor&&(t.shape.color=t._originalColor,t.shape.fill=t._originalColor)}createPieces(){const t=this.baseSize,e=[],i=o=>new ot(this,o,{baseSize:t}),s=o=>({color:o,stroke:a.strokeColor,lineWidth:a.strokeWidth,lineJoin:"round"});return e.push(i(new _(l.LARGE_LEG*t,s(a.colors.largeTriangle1)))),e.push(i(new _(l.LARGE_LEG*t,s(a.colors.largeTriangle2)))),e.push(i(new _(l.MEDIUM_LEG*t,s(a.colors.mediumTriangle)))),e.push(i(new _(l.SMALL_LEG*t,s(a.colors.smallTriangle1)))),e.push(i(new _(l.SMALL_LEG*t,s(a.colors.smallTriangle2)))),e.push(i(new G(l.SQUARE_SIDE*t,s(a.colors.square)))),e.push(i(new X({width:l.PARA_BASE*t,height:l.PARA_HEIGHT*t,slant:l.PARA_HEIGHT*t,...s(a.colors.parallelogram)}))),e}applyConfiguration(t=!0){const e=this.configuration;for(let i=0;i<this.pieces.length;i++){const s=e.pieces[i];t?this.pieces[i].animateTo(s,i*a.staggerDelay):this.pieces[i].setPosition(s)}this.applySceneView(t)}shuffleConfigs(){const t=p.length;this.shuffledIndices=Array.from({length:t},(e,i)=>i);for(let e=t-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[this.shuffledIndices[e],this.shuffledIndices[i]]=[this.shuffledIndices[i],this.shuffledIndices[e]]}console.log(`[Showcase] Shuffled ${t} configs: ${this.shuffledIndices.map(e=>p[e].name).join(", ")}`)}nextConfiguration(){const t=p.length;t!==0&&(this.shufflePosition++,this.shufflePosition>=t&&(this.shuffleConfigs(),this.shufflePosition=0),this.configIndex=this.shuffledIndices[this.shufflePosition],this.configuration=p[this.configIndex],console.log(`Assembling: ${this.configuration.name} (${this.shufflePosition+1}/${t})`),this.applyConfiguration(!0))}update(t){super.update(t),g.updateAll(t),this.fsm.update(t)}stop(){this._onKeyDown&&window.removeEventListener("keydown",this._onKeyDown,{capture:!0}),this.removeCanvasClickHandler(),this.disableDragging(),super.stop()}}function rt(c){const t=new nt(c);return t.start(),{stop:()=>t.stop(),game:t}}export{rt as default};
