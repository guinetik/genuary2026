import{G as R}from"./gcanvas.es-BF2N4r4i.js";const i={cellSize:3,stepsPerFrame:80,trailLength:300,hueSpeed:30,saturation:100,lightness:45,particleLife:.8,particleSpeed:100},k=[0,1,0,-1],A=[-1,0,1,0];class H extends R{constructor(t){super(t),this.backgroundColor="#000"}init(){super.init(),this.cols=Math.floor(this.width/i.cellSize),this.rows=Math.floor(this.height/i.cellSize);const t=Math.random()*360,l=Math.random()*360;this.grid1=new Array(this.cols*this.rows).fill(!1),this.ant1={x:Math.floor(this.cols/3),y:Math.floor(this.rows/2),dir:0,hue:t,baseHue:t,trail:[]},this.grid2=new Array(this.cols*this.rows).fill(!1),this.ant2={x:Math.floor(this.cols*2/3),y:Math.floor(this.rows/2),dir:2,hue:l,baseHue:l,trail:[]},this.stepCount=0,this.time=0,this.particles=[],this.gridCanvas1=document.createElement("canvas"),this.gridCanvas1.width=this.cols*i.cellSize,this.gridCanvas1.height=this.rows*i.cellSize,this.gridCtx1=this.gridCanvas1.getContext("2d"),this.gridCtx1.fillStyle="#000",this.gridCtx1.fillRect(0,0,this.gridCanvas1.width,this.gridCanvas1.height),this.gridCanvas2=document.createElement("canvas"),this.gridCanvas2.width=this.cols*i.cellSize,this.gridCanvas2.height=this.rows*i.cellSize,this.gridCtx2=this.gridCanvas2.getContext("2d"),this.gridCtx2.fillStyle="#000",this.gridCtx2.fillRect(0,0,this.gridCanvas2.width,this.gridCanvas2.height)}stepAnt(t,l,a,r){const o=t.y*this.cols+t.x,n=l[o];t.trail.push({x:t.x,y:t.y,hue:t.hue}),t.trail.length>i.trailLength&&t.trail.shift(),n?t.dir=(t.dir+3)%4:t.dir=(t.dir+1)%4,l[o]=!n;const c=l[o]?i.lightness:3;a.fillStyle=`hsl(${t.hue}, ${i.saturation}%, ${c}%)`,a.fillRect(t.x*i.cellSize,t.y*i.cellSize,i.cellSize,i.cellSize);const S=t.x*i.cellSize+i.cellSize/2,f=t.y*i.cellSize+i.cellSize/2;if(Math.random()<.3){const d=Math.random()*Math.PI*2;this.particles.push({x:S,y:f,vx:Math.cos(d)*i.particleSpeed*(.5+Math.random()),vy:Math.sin(d)*i.particleSpeed*(.5+Math.random()),life:i.particleLife,maxLife:i.particleLife,hue:t.hue,isLight:r})}t.x+=k[t.dir],t.y+=A[t.dir],t.x<0&&(t.x=this.cols-1),t.x>=this.cols&&(t.x=0),t.y<0&&(t.y=this.rows-1),t.y>=this.rows&&(t.y=0)}step(){this.stepAnt(this.ant1,this.grid1,this.gridCtx1,!0),this.stepAnt(this.ant2,this.grid2,this.gridCtx2,!1),this.stepCount++}update(t){for(super.update(t),this.time+=t,this.ant1.hue=(this.ant1.baseHue+this.time*i.hueSpeed)%360,this.ant2.hue=(this.ant2.baseHue+this.time*i.hueSpeed)%360;this.ant1.trail.length>i.trailLength;)this.ant1.trail.shift();for(;this.ant2.trail.length>i.trailLength;)this.ant2.trail.shift();for(let l=0;l<i.stepsPerFrame;l++)this.step();for(let l=this.particles.length-1;l>=0;l--){const a=this.particles[l];a.x+=a.vx*t,a.y+=a.vy*t,a.vx*=.95,a.vy*=.95,a.life-=t,a.life<=0&&this.particles.splice(l,1)}this.particles.length>500&&(this.particles=this.particles.slice(-400))}render(){const t=this.ctx,l=this.width,a=this.height;t.fillStyle="rgba(0, 0, 0, 0.1)",t.fillRect(0,0,l,a);const r=(l-this.gridCanvas1.width)/2,o=(a-this.gridCanvas1.height)/2,n=e=>{if(t.save(),t.globalCompositeOperation="source-over",e.trail.length>1){t.beginPath(),t.moveTo(r+e.trail[0].x*i.cellSize+i.cellSize/2,o+e.trail[0].y*i.cellSize+i.cellSize/2);for(let h=1;h<e.trail.length;h++)t.lineTo(r+e.trail[h].x*i.cellSize+i.cellSize/2,o+e.trail[h].y*i.cellSize+i.cellSize/2);const s=t.createLinearGradient(r+e.trail[0].x*i.cellSize,o+e.trail[0].y*i.cellSize,r+e.trail[e.trail.length-1].x*i.cellSize,o+e.trail[e.trail.length-1].y*i.cellSize);s.addColorStop(0,`hsla(${e.trail[0].hue}, 100%, 50%, 0)`),s.addColorStop(1,`hsla(${e.hue}, 100%, 70%, 1)`),t.strokeStyle=s,t.lineWidth=i.cellSize*.8,t.lineCap="round",t.lineJoin="round",t.stroke()}t.restore()},c=i.cellSize*25,S=(e,s,h)=>{t.save(),t.globalCompositeOperation="lighter";const P=25,u=e.trail;for(let z=0;z<Math.min(u.length,P);z++){const C=u[u.length-1-z],I=1-z/P,G=c*(.4+.6*I),O=I*.3,y=r+C.x*i.cellSize+i.cellSize/2,m=o+C.y*i.cellSize+i.cellSize/2,v=t.createRadialGradient(y,m,0,y,m,G);v.addColorStop(0,`hsla(${C.hue}, ${i.saturation}%, 55%, ${O})`),v.addColorStop(1,`hsla(${C.hue}, ${i.saturation}%, 50%, 0)`),t.fillStyle=v,t.beginPath(),t.arc(y,m,G,0,Math.PI*2),t.fill()}const g=e.hue,p=t.createRadialGradient(s,h,0,s,h,c);p.addColorStop(0,`hsla(${g}, 100%, 60%, 0.6)`),p.addColorStop(.4,`hsla(${g}, 100%, 50%, 0.2)`),p.addColorStop(1,`hsla(${g}, 100%, 50%, 0)`),t.fillStyle=p,t.beginPath(),t.arc(s,h,c,0,Math.PI*2),t.fill();const L=c*1.5,x=t.createRadialGradient(s,h,0,s,h,L);x.addColorStop(0,`hsla(${g}, 100%, 50%, 0.1)`),x.addColorStop(1,`hsla(${g}, 100%, 50%, 0)`),t.fillStyle=x,t.beginPath(),t.arc(s,h,L,0,Math.PI*2),t.fill(),t.restore()},f=(e,s,h)=>{t.save(),t.shadowColor="rgba(0,0,0,0.8)",t.shadowBlur=10,t.beginPath(),t.arc(e,s,i.cellSize*1.5,0,Math.PI*2),t.fillStyle=`hsl(${h}, ${i.saturation}%, 90%)`,t.fill(),t.beginPath(),t.arc(e,s,i.cellSize*1.5,0,Math.PI*2),t.strokeStyle="#000",t.lineWidth=1,t.stroke(),t.restore()};t.globalCompositeOperation="screen",t.drawImage(this.gridCanvas1,r,o),t.globalCompositeOperation="exclusion",t.drawImage(this.gridCanvas2,r,o);const d=r+this.ant1.x*i.cellSize+i.cellSize/2,M=o+this.ant1.y*i.cellSize+i.cellSize/2;n(this.ant1),S(this.ant1,d,M);const b=r+this.ant2.x*i.cellSize+i.cellSize/2,$=o+this.ant2.y*i.cellSize+i.cellSize/2;n(this.ant2),S(this.ant2,b,$),t.globalCompositeOperation="lighter";for(const e of this.particles){const s=e.life/e.maxLife,h=6*(e.life/e.maxLife);t.fillStyle=`hsla(${e.hue}, 100%, 80%, ${s})`,t.beginPath(),t.arc(r+e.x,o+e.y,h,0,Math.PI*2),t.fill()}t.globalCompositeOperation="source-over",t.fillStyle="#fff",f(d,M,this.ant1.hue),f(b,$,this.ant2.hue)}}function F(w){const t=new H(w);return t.start(),{stop:()=>t.stop(),game:t}}export{F as default};
