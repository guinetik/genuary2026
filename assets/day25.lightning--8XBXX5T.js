import{o as C}from"./index-BTdpBHxc.js";class T extends C{constructor(t,i={}){super(t,i),this.width=t.width,this.height=t.height,this.flash=null,this.timer=i.interval||4,this.interval=i.interval||4,this.variance=i.variance||2,this.radius=i.radius||150,this.energy=i.energy||.4,this.onStrike=i.onStrike||null,this.zIndex=i.zIndex||100}generateBolt(t,i,s,e,a=0){const l=[],n=a===0?8+Math.floor(Math.random()*5):4+Math.floor(Math.random()*3);let d=t,f=i;const b=(s-t)/n,y=(e-i)/n,g=a===0?40:20,x=a===0?3:1.5;for(let h=0;h<n;h++){let o=t+b*(h+1),r=i+y*(h+1);h<n-1&&(o+=(Math.random()-.5)*g,r+=(Math.random()-.5)*g*.3);const u=h/n,M=x*(1-u*.5);if(l.push({x1:d,y1:f,x2:o,y2:r,width:M}),a<3&&Math.random()<.3-a*.1){const m=30+Math.random()*50,v=(Math.random()-.5)*Math.PI*.5,p=o+Math.cos(v+Math.PI/2)*m*(Math.random()<.5?1:-1),k=r+m*.7,S=this.generateBolt(o,r,p,k,a+1);l.push(...S)}d=o,f=r}return l}strike(t,i){const s=t??this.width*(.2+Math.random()*.6),e=i??this.height*(.3+Math.random()*.3),a=s+(Math.random()-.5)*80,c=this.generateBolt(a,-20,s,e);this.flash={x:s,y:e,intensity:1,bolts:c},this.onStrike&&this.onStrike(s,e,this.radius,this.energy)}update(t){super.update(t),this.timer-=t,this.timer<=0&&(this.strike(),this.timer=this.interval+(Math.random()-.5)*this.variance*2),this.flash&&(this.flash.intensity-=t*3,this.flash.intensity<=0&&(this.flash=null))}render(){if(!this.flash||!this.visible)return;const t=this.game.ctx,i=this.flash.intensity;if(this.flash.bolts&&i>.1){t.save(),t.lineCap="round",t.lineJoin="round",t.globalCompositeOperation="lighter";for(const s of this.flash.bolts)t.strokeStyle=`rgba(100, 150, 255, ${i*.3})`,t.lineWidth=s.width*6,t.beginPath(),t.moveTo(s.x1,s.y1),t.lineTo(s.x2,s.y2),t.stroke();for(const s of this.flash.bolts)t.strokeStyle=`rgba(180, 200, 255, ${i*.6})`,t.lineWidth=s.width*3,t.beginPath(),t.moveTo(s.x1,s.y1),t.lineTo(s.x2,s.y2),t.stroke();for(const s of this.flash.bolts)t.strokeStyle=`rgba(255, 255, 255, ${i})`,t.lineWidth=s.width,t.beginPath(),t.moveTo(s.x1,s.y1),t.lineTo(s.x2,s.y2),t.stroke();t.globalCompositeOperation="source-over",t.restore()}if(i>.1){t.save();const s=200*i,e=t.createRadialGradient(this.flash.x,this.flash.y,0,this.flash.x,this.flash.y,s);e.addColorStop(0,`rgba(200, 220, 255, ${i*.8})`),e.addColorStop(.3,`rgba(150, 180, 255, ${i*.4})`),e.addColorStop(1,"transparent"),t.globalCompositeOperation="lighter",t.fillStyle=e,t.beginPath(),t.arc(this.flash.x,this.flash.y,s,0,Math.PI*2),t.fill(),t.globalCompositeOperation="source-over",t.restore()}}}export{T as Lightning};
