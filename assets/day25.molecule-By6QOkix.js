import{o as Y,P as Z,z,t as D}from"./index-3oaVaAML.js";import{TAU as b,CONFIG as e}from"./day25.config-DGqoq7tn.js";import{MOLECULES as w,ATOMS as X}from"./day25.chemistry-DIw6AqoQ.js";class W extends Y{constructor(t,s,h={}){const o=h.width??50,i=h.height??40;if(super(t,{...h,width:o,height:i}),this.templateKey=s,this.template=w[s],!this.template){console.warn(`Molecule2D: Unknown template key "${s}"`),this.moleculeScale=1;return}let m=1/0,n=-1/0,d=1/0,p=-1/0;for(const l of this.template.atoms){const g=X[l.element],c=g?g.radius:10;m=Math.min(m,l.x-c),n=Math.max(n,l.x+c),d=Math.min(d,l.y-c),p=Math.max(p,l.y+c)}this.molWidth=n-m,this.molHeight=p-d,this.molCenterX=(m+n)/2,this.molCenterY=(d+p)/2;const f=4,M=o-f*2,a=i-f*2,r=M/this.molWidth,u=a/this.molHeight;this.moleculeScale=Math.min(r,u,1)}draw(){if(super.draw(),!this.template)return;const t=Z.ctx,s=this.moleculeScale;t.strokeStyle="rgba(0, 255, 100, 0.7)",t.lineWidth=Math.max(1,1.5*s),t.lineCap="round";for(const h of this.template.bonds){const o=this.template.atoms[h.from],i=this.template.atoms[h.to],m=(o.x-this.molCenterX)*s,n=(o.y-this.molCenterY)*s,d=(i.x-this.molCenterX)*s,p=(i.y-this.molCenterY)*s;t.beginPath(),t.moveTo(m,n),t.lineTo(d,p),t.stroke()}for(const h of this.template.atoms){const o=X[h.element];if(!o)continue;const i=(h.x-this.molCenterX)*s,m=(h.y-this.molCenterY)*s,n=Math.max(2,o.radius*s*.55);t.fillStyle=`hsl(${o.hue}, ${o.sat}%, ${o.light}%)`,t.beginPath(),t.arc(i,m,n,0,b),t.fill()}}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}}class B extends Y{constructor(t,s,h={}){super(t,h),this.templateKey=s,this.template=w[s],this.name=this.template.name,this.label=this.template.label,this.tier=this.template.tier,this.x=h.x??0,this.y=h.y??0,this.z=h.z??0,this.vx=(Math.random()-.5)*e.baseSpeed,this.vy=(Math.random()-.5)*e.baseSpeed,this.vz=(Math.random()-.5)*e.baseSpeed,this.temperature=.5,this.reactionCooldown=0,this.flash=0,this.rotX=Math.random()*b,this.rotY=Math.random()*b,this.rotZ=Math.random()*b,this.rotSpeedX=(Math.random()-.5)*.08,this.rotSpeedY=(Math.random()-.5)*.08,this.rotSpeedZ=(Math.random()-.5)*.05,this.turbulencePhase=Math.random()*Math.PI*2,this.atomData=this.template.atoms.map(i=>({element:i.element,localX:i.x,localY:i.y,localZ:i.z,props:X[i.element],screenX:0,screenY:0,screenScale:1,worldZ:0})),this.bonds=this.template.bonds;let o=0;for(const i of this.atomData){const m=Math.sqrt(i.localX**2+i.localY**2+i.localZ**2);o=Math.max(o,m+i.props.radius)}this.boundingRadius=o}update(t){super.update(t);const s=this.game,h=s.worldHeight/2,o=s.totalTime,i=(this.y+h)/s.worldHeight;this.temperature=z(Math.max(0,Math.min(1,i)),this.temperature,{heatZone:e.heatZone,coolZone:e.coolZone,rate:e.heatRate});const m=D(this.temperature,e.neutralTemp,e.buoyancyStrength);this.vy-=m*t;const n=o*.3+i*2.5+this.turbulencePhase,d=e.convectionCurrentX*(.6+this.temperature*.4);this.vx+=Math.sin(n)*d*t;const p=o*.2+i*1.8+this.turbulencePhase+1.5,f=e.convectionZ*(.5+this.temperature*.5);this.vz+=Math.sin(p)*f*t;const M=this.turbulencePhase+o,a=e.convectionTurbulence*(.4+this.temperature*.3);this.vx+=Math.sin(M*1.3)*a*t,this.vy+=Math.sin(M*1.7+1.5)*a*.3*t,this.vz+=Math.sin(M*1.1+3)*a*.8*t;const r=e.brownianStrength;this.vx+=(Math.random()-.5)*r*t*60,this.vy+=(Math.random()-.5)*r*t*60,this.vz+=(Math.random()-.5)*r*t*60;const u=Math.pow(e.damping,t*60);this.vx*=u,this.vy*=u,this.vz*=u,this.x+=this.vx*t,this.y+=this.vy*t,this.z+=this.vz*t;const l=Math.sqrt(this.vx*this.vx+this.vy*this.vy+this.vz*this.vz),g=.015+Math.min(l*.001,.02);this.rotX+=(this.vy*.003+this.rotSpeedX)*g*t*60,this.rotY+=(this.vx*.003+this.rotSpeedY)*g*t*60,this.rotZ+=(this.vz*.002+this.rotSpeedZ)*g*t*60,this.rotSpeedX*=.98,this.rotSpeedY*=.98,this.rotSpeedZ*=.98;const c=.15;this.rotSpeedX=Math.max(-c,Math.min(c,this.rotSpeedX)),this.rotSpeedY=Math.max(-c,Math.min(c,this.rotSpeedY)),this.rotSpeedZ=Math.max(-c,Math.min(c,this.rotSpeedZ)),this.reactionCooldown>0&&(this.reactionCooldown-=t),this.flash>0&&(this.flash-=t*.5)}render(t,s){if(!this.visible)return;const h=Z.ctx,o=this.game.camera,i=Math.cos(this.rotX),m=Math.sin(this.rotX),n=Math.cos(this.rotY),d=Math.sin(this.rotY),p=Math.cos(this.rotZ),f=Math.sin(this.rotZ);for(const a of this.atomData){let r=a.localX,u=a.localY,l=a.localZ,g=u*i-l*m,c=u*m+l*i;u=g,l=c;let S=r*n+l*d;c=-r*d+l*n,r=S,l=c,S=r*p-u*f,g=r*f+u*p,r=S,u=g;const y=this.x+r,x=this.y+u,C=this.z+l,v=o.project(y,x,C);a.screenX=t+v.x,a.screenY=s+v.y,a.screenScale=v.scale,a.worldZ=v.z}const M=[...this.atomData].sort((a,r)=>a.worldZ-r.worldZ);this._renderBonds(h);for(const a of M)this._renderAtom(h,a)}_renderBonds(t){for(const s of this.bonds){const h=this.atomData[s.from],o=this.atomData[s.to];if(h.screenScale<=0||o.screenScale<=0)continue;const i=(h.screenScale+o.screenScale)/2,m=(h.worldZ+o.worldZ)/2,n=e.bondDepthClamp,d=Math.max(-n,Math.min(n,m/e.bondDepthDivisor)),p=Math.round(e.hueBase+(this.temperature-.5)*e.hueRange),f=Math.round(e.bondBaseLightness+d+this.temperature*e.bondTempLightMult),M=Math.round(e.bondBaseSaturation+this.temperature*e.bondTempSatMult);if(t.strokeStyle=`hsl(${p}, ${M}%, ${f}%)`,t.lineWidth=e.bondSingleWidth*i,t.lineCap="round",s.order===1)t.beginPath(),t.moveTo(h.screenX,h.screenY),t.lineTo(o.screenX,o.screenY),t.stroke();else if(s.order>=2){const a=o.screenX-h.screenX,r=o.screenY-h.screenY,u=Math.sqrt(a*a+r*r)||1,l=e.bondMultiGap*i,g=-r/u*l,c=a/u*l;t.lineWidth=e.bondMultiWidth*i;for(let S=0;S<s.order;S++){const y=S-(s.order-1)/2;t.beginPath(),t.moveTo(h.screenX+g*y,h.screenY+c*y),t.lineTo(o.screenX+g*y,o.screenY+c*y),t.stroke()}}}}_renderAtom(t,s){if(s.screenScale<=0)return;const h=s.props,o=h.radius*s.screenScale,i=Math.max(e.atomDepthClampMin,Math.min(e.atomDepthClampMax,s.worldZ/e.atomDepthDivisor)),m=(this.temperature-.5)*e.atomTempLightMult,n=h.hue,d=h.sat,p=Math.round(Math.max(e.atomLightMin,Math.min(e.atomLightMax,h.light+i+m))),f=e.atomHighlightOffset,M=t.createRadialGradient(s.screenX-o*f,s.screenY-o*f,0,s.screenX,s.screenY,o),a=e.atomGradientStops,r=Math.round(Math.min(d+e.atomHighlightSatBoost,100)),u=Math.round(Math.min(p+e.atomHighlightLightBoost,e.atomLightMax)),l=Math.round(Math.max(p-e.atomMidLightDrop,e.atomLightMin)),g=Math.round(Math.min(d+e.atomEdgeSatBoost,100)),c=Math.round(Math.max(p-e.atomEdgeLightDrop,10));if(M.addColorStop(a[0],`hsl(${n}, ${r}%, ${u}%)`),M.addColorStop(a[1],`hsl(${n}, ${d}%, ${p}%)`),M.addColorStop(a[2],`hsl(${n}, ${d}%, ${l}%)`),M.addColorStop(a[3],`hsl(${n}, ${g}%, ${c}%)`),t.fillStyle=M,t.beginPath(),t.arc(s.screenX,s.screenY,o,0,b),t.fill(),this.flash>0){const[S,y,x]=e.flashColor;t.strokeStyle=`rgba(${S}, ${y}, ${x}, ${Math.min(1,this.flash*e.flashAlphaMult)})`,t.lineWidth=e.flashWidthBase*s.screenScale*(e.flashWidthMin+this.flash*e.flashWidthRange),t.stroke()}else t.strokeStyle=`hsla(${n}, ${d}%, ${p}%, ${e.atomOutlineAlpha})`,t.lineWidth=e.atomOutlineWidth,t.stroke()}getBounds(){return{x:this.x,y:this.y,width:this.boundingRadius*2,height:this.boundingRadius*2}}}export{W as Molecule2D,B as Molecule3D};
