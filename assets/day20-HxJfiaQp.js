import{G as v,P as k}from"./gcanvas.es-BF2N4r4i.js";const p={colors:{bg:"#000"},segments:300,baseRadius:.6,growthDuration:8,hueSpeed:20,glowSize:40,cometLength:30};class z extends v{constructor(t){super(t),this.backgroundColor=p.colors.bg}init(){super.init(),k.init(this.ctx),this.container=this.canvas.parentElement,this.container&&this.enableFluidSize(this.container),this.time=0,this.mouseX=.5,this.mouseY=.5,this.size=.05,this.targetSize=.05,this.snakeLength=20,this.maxSnakeLength=350,this.isOuroboros=!1,this.ouroborosBlend=0,this.perfection=0,this.eatPulse=0,this.totalEaten=0,this.eatAngleOffset=0,this.coils=1,this.targetCoils=1,this.lungeOffset=0,this.targetLungeOffset=0,this.phaseOffset=0,this.currentRadius=0,this.hueOffset=Math.random()*360,this.screenFlash=0,this.particles=[],this.maxHistory=400,this.history=[];for(let t=0;t<this.maxHistory;t++)this.history.push({x:0,y:0});this.headX=0,this.headY=0,this.headAngle=0,this.targetX=0,this.targetY=0,this.canvas.addEventListener("mousemove",t=>{const e=this.canvas.getBoundingClientRect();this.mouseX=(t.clientX-e.left)/e.width,this.mouseY=(t.clientY-e.top)/e.height,this.targetX=(this.mouseX-.5)*1.4,this.targetY=(this.mouseY-.5)*1.4}),this.canvas.addEventListener("click",t=>{this.isOuroboros&&this.doEat(t)}),this.canvas.addEventListener("touchstart",t=>{t.preventDefault(),this.isOuroboros&&this.doEat(t.touches[0])}),this.canvas.addEventListener("touchmove",t=>{t.preventDefault();const e=t.touches[0],a=this.canvas.getBoundingClientRect();this.mouseX=(e.clientX-a.left)/a.width,this.mouseY=(e.clientY-a.top)/a.height})}doEat(){this.eatPulse=1,this.screenFlash=1,this.targetLungeOffset+=.5,this.targetCoils+=.08,this.totalEaten+=1;const t=this.getSnakePoint(1,this.time),e=this.projectPoint(t),a=this.width/2,o=this.height/2,h=Math.min(this.width,this.height)*.7,l=a+e.x*h,s=o+e.y*h;for(let r=0;r<25;r++){const i=Math.random()*Math.PI*2,n=100+Math.random()*200;this.particles.push({x:l,y:s,vx:Math.cos(i)*n,vy:Math.sin(i)*n,life:1,maxLife:1,hue:this.hueOffset+this.totalEaten*25+Math.random()*60,size:4+Math.random()*8})}}update(t){super.update(t),this.time+=t;const e=p.hueSpeed+this.totalEaten*3;this.hueOffset=(this.hueOffset+e*t)%360;const a=(this.maxSnakeLength-20)/p.growthDuration;if(!this.isOuroboros&&this.snakeLength<this.maxSnakeLength&&(this.snakeLength=Math.min(this.maxSnakeLength,this.snakeLength+t*a)),this.targetSize=Math.min(1,.05+this.snakeLength/this.maxSnakeLength*.95),this.size+=(this.targetSize-this.size)*.02,this.isOuroboros){this.ouroborosBlend=Math.min(1,this.ouroborosBlend+t*.8);const o=Math.min(1,this.totalEaten/15);this.perfection+=(o-this.perfection)*t*.5,this.lungeOffset+=(this.targetLungeOffset-this.lungeOffset)*t*5,this.coils+=(this.targetCoils-this.coils)*t*2;const h=p.baseRadius*this.size;this.currentRadius+=(h-this.currentRadius)*t*2}this.eatPulse>0&&(this.eatPulse=Math.max(0,this.eatPulse-t*3)),this.screenFlash>0&&(this.screenFlash=Math.max(0,this.screenFlash-t*4));for(let o=this.particles.length-1;o>=0;o--){const h=this.particles[o];h.x+=h.vx*t,h.y+=h.vy*t,h.vx*=.96,h.vy*=.96,h.life-=t*1.5,h.life<=0&&this.particles.splice(o,1)}if(!this.isOuroboros){const o=this.targetX-this.headX,h=this.targetY-this.headY;let s=Math.atan2(h,o)-this.headAngle;for(;s>Math.PI;)s-=Math.PI*2;for(;s<-Math.PI;)s+=Math.PI*2;this.headAngle+=s*.08;const r=Math.sin(this.time*8)*.4,i=this.headAngle+r,n=.012*(.5+this.size*.5);this.headX+=Math.cos(i)*n,this.headY+=Math.sin(i)*n,this.history.unshift({x:this.headX,y:this.headY});const c=Math.floor(this.snakeLength)+10;for(;this.history.length>c;)this.history.pop();if(this.snakeLength>=this.maxSnakeLength-10){const g=Math.min(Math.floor(this.snakeLength)-1,this.history.length-1),f=this.history[g];if(f&&Math.sqrt((this.headX-f.x)**2+(this.headY-f.y)**2)<.2){this.isOuroboros=!0;const m=Math.atan2(this.headY,this.headX),u=Math.PI*2*this.coils-this.time*.5;this.phaseOffset=m-u,this.currentRadius=Math.sqrt(this.headX**2+this.headY**2),this.lungeOffset=0,this.targetLungeOffset=0}}}}getSnakePoint(t,e){const a=t*Math.PI*2*this.coils-e*.5+this.phaseOffset+this.lungeOffset,o=1-this.perfection,h=this.isOuroboros?this.currentRadius:p.baseRadius*this.size,l=Math.sin(t*Math.PI*8*this.coils+e*2)*.05*this.size*o,s=h+l,r=Math.cos(a)*s,i=Math.sin(a)*s,n=Math.floor((1-t)*Math.min(this.snakeLength,this.history.length-1)),c=this.history[Math.min(n,this.history.length-1)],g=c?c.x:0,f=c?c.y:0,d=this.ouroborosBlend,m=g*(1-d)+r*d,u=f*(1-d)+i*d,y=Math.sin(t*Math.PI*6*this.coils+e*1.5)*.08*this.size*d*o;return{x:m,y:u,z:y,t}}projectPoint(t){const e=this.ouroborosBlend,a=(this.mouseX-.5)*Math.PI*.8*e,o=Math.cos(a),h=Math.sin(a),l=t.x*o-t.z*h,s=t.x*h+t.z*o,r=(this.mouseY-.5)*Math.PI*.6*e,i=Math.cos(r),n=Math.sin(r),c=t.y*i-s*n,g=t.y*n+s*i,f=1/(1-g*.3*e);return{x:l*f,y:c*f,z:g}}render(){const t=this.ctx,e=this.width,a=this.height,o=e/2,h=a/2,l=Math.min(e,a)*.7;t.fillStyle="rgba(0, 0, 0, 0.12)",t.fillRect(0,0,e,a);const s=p.segments,r=[];for(let i=0;i<=s;i++){const n=i/s,c=this.getSnakePoint(n,this.time),g=this.projectPoint(c);r.push({x:o+g.x*l,y:h+g.y*l,z:g.z,t:n})}this.drawSnake(t,r),this.drawCometTail(t,r),this.drawHead(t,r),t.globalCompositeOperation="lighter";for(const i of this.particles){const n=i.life/i.maxLife,c=i.size*n,g=t.createRadialGradient(i.x,i.y,0,i.x,i.y,c*3);g.addColorStop(0,`hsla(${i.hue}, 100%, 70%, ${n})`),g.addColorStop(.5,`hsla(${i.hue}, 100%, 50%, ${n*.4})`),g.addColorStop(1,"transparent"),t.fillStyle=g,t.beginPath(),t.arc(i.x,i.y,c*3,0,Math.PI*2),t.fill()}if(t.globalCompositeOperation="source-over",this.screenFlash>0){const i=this.hueOffset+this.totalEaten*25;t.fillStyle=`hsla(${i}, 100%, 80%, ${this.screenFlash*.3})`,t.fillRect(0,0,e,a)}if(t.fillStyle="rgba(255, 255, 255, 0.4)",t.font="12px monospace",t.textAlign="center",this.isOuroboros){if(t.fillStyle="rgba(255, 255, 255, 0.3)",t.fillText("Click to consume • Drag to rotate",o,a-20),this.totalEaten>0){const i=this.hueOffset;t.fillStyle=`hsla(${i}, 80%, 60%, 0.6)`;const n=Math.floor(this.perfection*100);t.fillText(`Consumed: ${this.totalEaten} • Form: ${n}%`,o,30)}}else{const i=Math.floor(this.snakeLength/this.maxSnakeLength*100);if(i<97)t.fillText(`Growing... ${i}%`,o,a-20);else{t.fillText("NOW! Catch the tail!",o,a-20);const n=Math.min(Math.floor(this.snakeLength),this.history.length-1),c=this.history[n];if(c){const g=o+c.x*l,f=h+c.y*l,d=.6+Math.sin(this.time*6)*.4,m=this.hueOffset+60,u=t.createRadialGradient(g,f,0,g,f,40);u.addColorStop(0,`hsla(${m}, 100%, 70%, ${d})`),u.addColorStop(.5,`hsla(${m+30}, 100%, 50%, ${d*.5})`),u.addColorStop(1,"transparent"),t.fillStyle=u,t.beginPath(),t.arc(g,f,40,0,Math.PI*2),t.fill()}}}}drawSnake(t,e){if(e.length<2)return;const a=this.hueOffset+this.totalEaten*25;for(let o=1;o<e.length;o++){const h=e[o-1],l=e[o],s=o/e.length,r=2+s*14+this.totalEaten*.6,i=7+this.totalEaten*.4,n=r*(1-this.perfection)+i*this.perfection,c=1+Math.sin(this.time*2+s*10)*.1*(1-this.perfection),g=this.eatPulse*Math.sin(s*Math.PI*12+this.time*25)*.4,f=n*(c+g),d=.5+(l.z+.5)*.5,m=this.eatPulse*40,u=(a+s*80+Math.sin(this.time*2+s*8)*30)%360,y=85+s*15,M=35+s*25+m;t.globalCompositeOperation="lighter",t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(l.x,l.y),t.strokeStyle=`hsla(${u}, 100%, ${M}%, ${.25*d})`,t.lineWidth=f+12,t.lineCap="round",t.stroke(),t.globalCompositeOperation="source-over",t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(l.x,l.y),t.strokeStyle=`hsla(${u}, ${y}%, ${M+10}%, ${d})`,t.lineWidth=f,t.lineCap="round",t.stroke(),t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(l.x,l.y),t.strokeStyle=`hsla(${u}, ${y-10}%, ${Math.min(85,M+30)}%, ${.7*d})`,t.lineWidth=f*.35,t.lineCap="round",t.stroke()}this.drawScales(t,e)}drawScales(t,e){const a=Math.max(3,Math.floor(e.length/50)),o=this.hueOffset+this.totalEaten*25;t.globalCompositeOperation="lighter";for(let h=a;h<e.length-a;h+=a){const l=e[h],s=h/e.length,r=2+s*5,i=.5+(l.z+.5)*.5,n=(o+s*80)%360;t.beginPath(),t.arc(l.x,l.y,r,0,Math.PI*2),t.fillStyle=`hsla(${n+40}, 80%, 65%, ${.35*i})`,t.fill()}t.globalCompositeOperation="source-over"}drawCometTail(t,e){if(e.length<p.cometLength)return;const a=this.hueOffset+this.totalEaten*25;t.globalCompositeOperation="lighter";for(let o=0;o<p.cometLength;o++){const h=e.length-1-o;if(h<0)break;const l=e[h],s=1-o/p.cometLength,r=p.glowSize*(.3+.7*s)*(1+this.eatPulse*.5),i=s*.4*(1+this.eatPulse),n=(a+60+o*2)%360,c=t.createRadialGradient(l.x,l.y,0,l.x,l.y,r);c.addColorStop(0,`hsla(${n}, 100%, 60%, ${i})`),c.addColorStop(.5,`hsla(${n+20}, 100%, 50%, ${i*.3})`),c.addColorStop(1,"transparent"),t.fillStyle=c,t.beginPath(),t.arc(l.x,l.y,r,0,Math.PI*2),t.fill()}t.globalCompositeOperation="source-over"}drawHead(t,e){if(e.length<2)return;const a=e[e.length-1],o=e[e.length-10]||e[e.length-2],h=Math.atan2(a.y-o.y,a.x-o.x),l=1-this.perfection*.2,s=(10+12*this.size)*l*(1+this.eatPulse*.2),r=.5+(a.z+.5)*.5,i=this.hueOffset+this.totalEaten*25,n=(i+60)%360;t.save(),t.translate(a.x,a.y),t.rotate(h),t.globalCompositeOperation="lighter";const c=s*3*(1+this.eatPulse*.5),g=t.createRadialGradient(0,0,0,0,0,c);g.addColorStop(0,`hsla(${n}, 100%, 65%, ${.6*r})`),g.addColorStop(.4,`hsla(${n+30}, 100%, 50%, ${.2*r})`),g.addColorStop(1,"transparent"),t.fillStyle=g,t.beginPath(),t.arc(0,0,c,0,Math.PI*2),t.fill(),t.globalCompositeOperation="source-over",t.beginPath(),t.moveTo(s,0),t.lineTo(-s*.5,-s*.6),t.lineTo(-s*.5,s*.6),t.closePath(),t.fillStyle=`hsla(${n}, 85%, 50%, ${r})`,t.fill(),t.beginPath(),t.moveTo(s*.8,0),t.lineTo(-s*.3,-s*.35),t.lineTo(-s*.3,s*.35),t.closePath(),t.fillStyle=`hsla(${n}, 70%, 65%, ${.5*r})`,t.fill();const f=s*.2,d=-s*.2,u=Math.max(2,4*(1-this.perfection*.4))*(1+this.eatPulse*.5);t.globalCompositeOperation="lighter";const y=t.createRadialGradient(f,d,0,f,d,u*3);y.addColorStop(0,`hsla(50, 100%, 80%, ${.8+this.eatPulse*.2})`),y.addColorStop(1,"transparent"),t.fillStyle=y,t.beginPath(),t.arc(f,d,u*3,0,Math.PI*2),t.fill(),t.globalCompositeOperation="source-over",t.beginPath(),t.arc(f,d,u,0,Math.PI*2),t.fillStyle=`hsla(50, 100%, 85%, ${r})`,t.fill();const M=.2*(1-this.perfection),$=this.eatPulse*.6,O=Math.max(.03,M+$);t.beginPath(),t.moveTo(s,0),t.lineTo(s*.25,-s*O),t.lineTo(s*.25,s*O),t.closePath(),t.fillStyle=`hsla(0, 60%, 20%, ${r})`,t.fill(),t.restore();const S=e[0],C=(i+120)%360;t.globalCompositeOperation="lighter";const P=t.createRadialGradient(S.x,S.y,0,S.x,S.y,25);P.addColorStop(0,`hsla(${C}, 100%, 60%, 0.6)`),P.addColorStop(.5,`hsla(${C+40}, 100%, 50%, 0.2)`),P.addColorStop(1,"transparent"),t.fillStyle=P,t.beginPath(),t.arc(S.x,S.y,25,0,Math.PI*2),t.fill(),t.globalCompositeOperation="source-over"}}function w(b){const t=new z(b);return t.start(),{stop:()=>t.stop(),game:t}}export{w as default};
