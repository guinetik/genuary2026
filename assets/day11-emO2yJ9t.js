import{G as M,P as g}from"./index-QcdZ2uQe.js";const o={cell:{w:11,h:18},tick:70,tail:{min:25,max:50},mouse:{radius:180,slowRadius:120},glow:{blur:10,color:"#0f0"}};class C extends M{constructor(t){super(t),this.backgroundColor="#000",this.source="",this.lines=[],this.ready=!1}async init(){super.init(),g.init(this.ctx);try{const s=await fetch(import.meta.url);this.source=await s.text()}catch{this.source=`// Could not fetch source
// Run via HTTP server: npm run dev
import { Game, Painter } from "@guinetik/gcanvas";
const CONFIG = { cell: { w: 11, h: 18 } };
class QuineDemo extends Game {
  async init() {
    const response = await fetch(import.meta.url);
    this.source = await response.text();
  }
}`}this.lines=this.source.split(`
`).map(s=>s.trimEnd()).filter(s=>s.length>0),this.columns=[],this.mouseX=-1e3,this.mouseY=-1e3,this.tickAccum=0;const t=Math.ceil(this.width/o.cell.w);this.numRows=Math.ceil(this.height/o.cell.h);for(let s=0;s<t;s++)this.columns.push(this.createDrop());this.canvas.addEventListener("mousemove",s=>{const e=this.canvas.getBoundingClientRect();this.mouseX=s.clientX-e.left,this.mouseY=s.clientY-e.top}),this.canvas.addEventListener("mouseleave",()=>{this.mouseX=-1e3,this.mouseY=-1e3}),this.canvas.addEventListener("click",()=>{this.reset()}),this.ready=!0}reset(){const t=Math.ceil(this.width/o.cell.w);this.columns=[];for(let s=0;s<t;s++)this.columns.push(this.createDrop())}createDrop(){const t=this.lines[Math.floor(Math.random()*this.lines.length)];return{y:-Math.floor(Math.random()*30),line:t,charIndex:0,tailLen:o.tail.min+Math.floor(Math.random()*(o.tail.max-o.tail.min)),chars:[]}}update(t){if(super.update(t),!!this.ready&&(this.tickAccum+=t*1e3,!(this.tickAccum<o.tick))){this.tickAccum=0;for(let s=0;s<this.columns.length;s++){const e=this.columns[s],r=s*o.cell.w+o.cell.w/2,i=e.y*o.cell.h,l=r-this.mouseX,a=i-this.mouseY;if(Math.sqrt(l*l+a*a)<o.mouse.slowRadius&&this.mouseX>0){if(e.slowCounter=(e.slowCounter||0)+1,e.slowCounter<3)continue;e.slowCounter=0}if(e.y++,e.charIndex<e.line.length){const n=e.line[e.charIndex];e.chars.unshift({row:Math.floor(e.y),char:n,age:0}),e.charIndex++}for(const n of e.chars)n.age++;e.chars=e.chars.filter(n=>n.age<e.tailLen);const u=e.charIndex>=e.line.length,m=e.y>this.numRows+e.tailLen;if(u||m||Math.random()>.995){const n=e.chars;this.columns[s]=this.createDrop(),this.columns[s].chars=n}}}}render(){g.useCtx(t=>{if(t.fillStyle="#000",t.fillRect(0,0,this.width,this.height),!this.ready){t.font="16px 'Fira Code', monospace",t.fillStyle="#0f0",t.textAlign="center",t.fillText("Fetching source...",this.width/2,this.height/2);return}t.font="14px 'Fira Code', monospace",t.textBaseline="top",t.textAlign="left";for(let s=0;s<this.columns.length;s++){const e=this.columns[s],r=s*o.cell.w;for(const i of e.chars){const l=i.row*o.cell.h;if(l<0||l>this.height)continue;const a=r-this.mouseX,f=l-this.mouseY,u=Math.sqrt(a*a+f*f),m=u<o.mouse.radius&&this.mouseX>0,n=m?1-u/o.mouse.radius:0;if(i.age<=1)t.shadowColor=o.glow.color,t.shadowBlur=o.glow.blur,t.fillStyle="#fff",t.fillText(i.char,r,l),t.shadowBlur=0;else{const c=1-i.age/e.tailLen;if(m){const h=n*.8,p=Math.floor(200*h),w=Math.floor(255*(c+h*(1-c))),y=Math.floor(200*h);t.fillStyle=`rgba(${p}, ${w}, ${y}, ${Math.min(1,c+h)})`}else{const h=Math.floor(255*c);t.fillStyle=`rgba(0, ${h}, 50, ${c})`}t.fillText(i.char,r,l)}}}t.fillStyle="rgba(0, 255, 50, 0.08)";for(let s=0;s<15;s++){const e=Math.floor(Math.random()*this.columns.length)*o.cell.w,r=Math.floor(Math.random()*this.numRows)*o.cell.h,i=this.source[Math.floor(Math.random()*this.source.length)];i!==`
`&&i!=="\r"&&t.fillText(i,e,r)}if(this.mouseX>0){const s=t.createRadialGradient(this.mouseX,this.mouseY,0,this.mouseX,this.mouseY,o.mouse.radius);s.addColorStop(0,"rgba(255, 255, 255, 0.08)"),s.addColorStop(.4,"rgba(150, 255, 200, 0.05)"),s.addColorStop(1,"transparent"),t.fillStyle=s,t.beginPath(),t.arc(this.mouseX,this.mouseY,o.mouse.radius,0,Math.PI*2),t.fill()}})}}function S(d){const t=new C(d);return t.start(),{stop:()=>t.stop(),game:t}}export{S as default};
