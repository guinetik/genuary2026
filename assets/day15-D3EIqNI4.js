import{G,P as E,C as j,r as I,s as B}from"./gcanvas.es-CMQjSjBY.js";const i={bhMass:1,starCount:800,starFieldRadius:1200,lensEffectRadius:600,lensStrength:180,lensFalloff:.007,occlusionRadius:2.6,diskInnerRadius:1.8,diskOuterRadius:8,diskParticles:3e3,diskThickness:.15,baseOrbitalSpeed:.6,colorHot:{r:255,g:250,b:220},colorMid:{r:255,g:160,b:50},colorCool:{r:180,g:40,b:20},particleSizeMin:.5,particleSizeMax:1,particleScale:.0025,perspective:800,initialTilt:.4},O=[{size:1.5,brightness:1},{size:1,brightness:.7},{size:.6,brightness:.5}];class L extends G{constructor(t){super(t),this.backgroundColor="#000"}init(){super.init(),E.init(this.ctx);const t=Math.min(this.width,this.height);this.baseScale=t,this.bhRadius=t*.06,this.camera=new j({perspective:i.perspective,rotationX:i.initialTilt,rotationY:0,sensitivity:.004,inertia:!0,friction:.92,clampX:!1,autoRotate:!0,autoRotateSpeed:.08,autoRotateAxis:"y"}),this.camera.enableMouseControl(this.canvas),this.time=0,this.lensingStrength=1,this.initStarfield(),this.initAccretionDisk(),this.canvas.addEventListener("click",()=>this.burstMatter()),this.canvas.addEventListener("touchend",e=>{this.camera._isDragging||this.burstMatter()})}initStarfield(){this.stars=[];for(let t=0;t<i.starCount;t++){const e=Math.random()*Math.PI*2,o=Math.acos(2*Math.random()-1),r=i.starFieldRadius*(.5+Math.random()*.5),a=O[Math.floor(Math.random()*O.length)];this.stars.push({x:r*Math.sin(o)*Math.cos(e),y:r*Math.sin(o)*Math.sin(e),z:r*Math.cos(o),type:a,twinkleSpeed:1+Math.random()*2,twinklePhase:Math.random()*Math.PI*2})}}initAccretionDisk(){this.diskParticles=[];const t=this.bhRadius*i.diskInnerRadius,e=this.bhRadius*i.diskOuterRadius;for(let o=0;o<i.diskParticles;o++){const r=Math.pow(Math.random(),.5),a=t+(e-t)*r,s=Math.random()*Math.PI*2,n=I(a,i.bhMass,i.baseOrbitalSpeed,e),l=(Math.random()-.5)*this.bhRadius*i.diskThickness;this.diskParticles.push({angle:s,distance:a,yOffset:l,speed:n,size:i.particleSizeMin+Math.random()*(i.particleSizeMax-i.particleSizeMin),baseColor:this.getHeatColor(a,t,e)})}}getHeatColor(t,e,o){const r=(t-e)/(o-e);let a,s,n;if(r<.5){const l=r*2;a=i.colorHot.r+(i.colorMid.r-i.colorHot.r)*l,s=i.colorHot.g+(i.colorMid.g-i.colorHot.g)*l,n=i.colorHot.b+(i.colorMid.b-i.colorHot.b)*l}else{const l=(r-.5)*2;a=i.colorMid.r+(i.colorCool.r-i.colorMid.r)*l,s=i.colorMid.g+(i.colorCool.g-i.colorMid.g)*l,n=i.colorMid.b+(i.colorCool.b-i.colorMid.b)*l}return{r:Math.round(a),g:Math.round(s),b:Math.round(n)}}burstMatter(){const t=this.bhRadius*i.diskInnerRadius,e=this.bhRadius*i.diskOuterRadius,o=Math.random()*Math.PI*2;for(let r=0;r<100;r++){const a=Math.pow(Math.random(),.5),s=t+(e-t)*a,n=o+(Math.random()-.5)*.5,l=I(s,i.bhMass,i.baseOrbitalSpeed,e),M=(Math.random()-.5)*this.bhRadius*i.diskThickness*2;this.diskParticles.push({angle:n,distance:s,yOffset:M,speed:l*(.8+Math.random()*.4),size:i.particleSizeMin+Math.random()*(i.particleSizeMax-i.particleSizeMin),baseColor:this.getHeatColor(s,t,e),age:0,maxAge:8+Math.random()*4})}this.diskParticles.length>3e3&&(this.diskParticles=this.diskParticles.slice(-2500))}update(t){super.update(t),this.time+=t,this.camera.update(t);for(let e=this.diskParticles.length-1;e>=0;e--){const o=this.diskParticles[e];o.angle+=o.speed*t,o.age!==void 0&&(o.age+=t,o.age>o.maxAge&&this.diskParticles.splice(e,1))}}render(){const t=this.ctx,e=this.width,o=this.height,r=e/2,a=o/2;t.fillStyle="rgba(0, 0, 0, 0.12)",t.fillRect(0,0,e,o),this.renderStarfield(t,r,a),this.renderDisk(t,r,a),this.renderBlackHole(t,r,a)}renderStarfield(t,e,o){const r=this.time;for(const a of this.stars){const s=this.camera.project(a.x,a.y,a.z);if(s.scale<=0)continue;let n=s.x,l=s.y;if(s.z>0&&this.lensingStrength>0){const b=B(n,l,i.lensEffectRadius,i.lensStrength*this.lensingStrength,i.lensFalloff,5);n=b.x,l=b.y}const M=Math.sqrt(n*n+l*l),g=this.bhRadius*i.occlusionRadius;if(M<g)continue;const p=e+n,c=o+l;if(p<-10||p>this.width+10||c<-10||c>this.height+10)continue;const u=.5+.5*Math.sin(r*a.twinkleSpeed+a.twinklePhase);if(u<.1)continue;const f=a.type.size*s.scale*a.type.brightness,d=Math.round(180+a.type.brightness*75);t.globalAlpha=u*.8,t.fillStyle=`rgb(${d}, ${d}, ${d})`,t.beginPath(),t.arc(p,c,Math.max(.5,f),0,Math.PI*2),t.fill()}t.globalAlpha=1}renderDisk(t,e,o){const r=[],a=Math.abs(Math.sin(this.camera.rotationX));for(const s of this.diskParticles){const n=Math.cos(s.angle)*s.distance,l=s.yOffset,M=Math.sin(s.angle)*s.distance,g=Math.cos(this.camera.rotationY),p=Math.sin(this.camera.rotationY);let c=n*g-M*p,h=n*p+M*g;const u=Math.cos(this.camera.rotationX),f=Math.sin(this.camera.rotationX);let d=l*u-h*f;h=l*f+h*u;const b=Math.sqrt(c*c+d*d),R=h>0;if(this.lensingStrength>0&&b<this.bhRadius*6){const P=this.bhRadius*1.8,w=Math.exp(-b/(this.bhRadius*1.8)),$=w*1.2*this.lensingStrength,D=s.angle+this.camera.rotationY,H=Math.sin(D)>0,F=1-a;if(b>0){let m=$;!H&&R&&(m*=1-F*.6);const S=(b+P*m)/b;c*=S,d*=S}if(a>.05){const m=this.bhRadius*5,S=c/m,C=Math.max(0,Math.cos(S*Math.PI*.5)),T=R?Math.min(1,h/(this.bhRadius*3)):Math.min(1,Math.abs(h)/(this.bhRadius*3)),z=this.bhRadius*2*w*T*a;R?H?d-=z*C:d+=z*C*.5:d+=z*C*.4}}const k=this.camera.perspective/(this.camera.perspective+h);if(h<-this.camera.perspective+10)continue;const A=c*k,X=d*k,Y=1+Math.cos(s.angle+this.camera.rotationY)*.4;let v=1;if(s.age!==void 0){const P=s.age/s.maxAge;v=1-Math.pow(P,2)}r.push({x:A,y:X,z:h,scale:k,color:s.baseColor,doppler:Y,alpha:v,size:s.size})}r.sort((s,n)=>n.z-s.z);for(const s of r){const{r:n,g:l,b:M}=s.color,g=this.baseScale*i.particleScale*s.scale*s.size;if(g<.1)continue;const p=Math.min(255,Math.round(n*s.doppler)),c=Math.min(255,Math.round(l*s.doppler)),h=Math.min(255,Math.round(M*s.doppler)),u=Math.max(0,Math.min(1,s.alpha*s.doppler*.8));t.fillStyle=`rgba(${p}, ${c}, ${h}, ${u})`,t.beginPath(),t.arc(e+s.x,o+s.y,g,0,Math.PI*2),t.fill(),s.doppler>1.1&&s.alpha>.5&&(t.globalCompositeOperation="screen",t.fillStyle=`rgba(${p}, ${c}, ${h}, ${u*.3})`,t.beginPath(),t.arc(e+s.x,o+s.y,g*1.5,0,Math.PI*2),t.fill(),t.globalCompositeOperation="source-over")}}renderBlackHole(t,e,o){const r=this.camera.project(0,0,0),a=this.bhRadius*r.scale,s=t.createRadialGradient(e,o,0,e,o,a*1.2);s.addColorStop(0,"rgba(0, 0, 0, 1)"),s.addColorStop(.7,"rgba(0, 0, 0, 1)"),s.addColorStop(.9,"rgba(0, 0, 0, 0.8)"),s.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fillStyle=s,t.beginPath(),t.arc(e,o,a*1.2,0,Math.PI*2),t.fill();const n=t.createRadialGradient(e,o,a*.95,e,o,a*1.15);n.addColorStop(0,"rgba(0, 50, 30, 0)"),n.addColorStop(.5,"rgba(0, 80, 50, 0.08)"),n.addColorStop(1,"rgba(0, 50, 30, 0)"),t.fillStyle=n,t.beginPath(),t.arc(e,o,a*1.15,0,Math.PI*2),t.fill()}}function _(y){const t=new L(y);return t.start(),{stop:()=>t.stop(),game:t}}export{_ as default};
