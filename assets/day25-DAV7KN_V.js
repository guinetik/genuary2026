import{G as I,P as G,C as Z,Z as A,d as E,o as F,z as j,t as N,M as O,E as P}from"./index-hWCNwS5W.js";const H=Math.PI*2,l={baseMolecules:40,minMolecules:20,maxMolecules:200,perspective:800,heatZone:.85,coolZone:.15,heatRate:.008,buoyancyStrength:80,neutralTemp:.5,baseSpeed:15,damping:.97,floatRadius:60,floatSpeed:.4,floatRandomness:.7,tideStrength:100,tidePeriod:8,heatTransferDist:80,heatTransferRate:.02,reactionDistance:100,reactionCooldown:.3,baseReactionChance:.4,separationPadding:0,separationStiffness:.5,collisionDamping:.25,lightningInterval:4,lightningVariance:2,lightningEnergy:.4,lightningRadius:150,bgColor:"#050510",ventGlow:.4,bubbleCount:40,particleCount:60,causticSpeed:.3},R={PRIMORDIAL:0,PRECURSOR:1,AMINO_ACID:2,PEPTIDE:3},k={C:{radius:18,hue:30,sat:10,light:35,name:"Carbon"},H:{radius:10,hue:200,sat:5,light:90,name:"Hydrogen"},O:{radius:16,hue:0,sat:70,light:50,name:"Oxygen"},N:{radius:15,hue:220,sat:70,light:55,name:"Nitrogen"},S:{radius:20,hue:55,sat:75,light:50,name:"Sulfur"}},T={water:{name:"H₂O",label:"Water",tier:R.PRIMORDIAL,atoms:[{element:"O",x:0,y:0,z:0},{element:"H",x:-15,y:12,z:0},{element:"H",x:15,y:12,z:0}],bonds:[{from:0,to:1,order:1},{from:0,to:2,order:1}]},methane:{name:"CH₄",label:"Methane",tier:R.PRIMORDIAL,atoms:[{element:"C",x:0,y:0,z:0},{element:"H",x:20,y:20,z:20},{element:"H",x:-20,y:-20,z:20},{element:"H",x:-20,y:20,z:-20},{element:"H",x:20,y:-20,z:-20}],bonds:[{from:0,to:1,order:1},{from:0,to:2,order:1},{from:0,to:3,order:1},{from:0,to:4,order:1}]},ammonia:{name:"NH₃",label:"Ammonia",tier:R.PRIMORDIAL,atoms:[{element:"N",x:0,y:-8,z:0},{element:"H",x:18,y:10,z:0},{element:"H",x:-9,y:10,z:16},{element:"H",x:-9,y:10,z:-16}],bonds:[{from:0,to:1,order:1},{from:0,to:2,order:1},{from:0,to:3,order:1}]},hydrogen:{name:"H₂",label:"Hydrogen",tier:R.PRIMORDIAL,atoms:[{element:"H",x:-12,y:0,z:0},{element:"H",x:12,y:0,z:0}],bonds:[{from:0,to:1,order:1}]},carbonDioxide:{name:"CO₂",label:"Carbon Dioxide",tier:R.PRIMORDIAL,atoms:[{element:"C",x:0,y:0,z:0},{element:"O",x:-28,y:0,z:0},{element:"O",x:28,y:0,z:0}],bonds:[{from:0,to:1,order:2},{from:0,to:2,order:2}]},hydrogenSulfide:{name:"H₂S",label:"Hydrogen Sulfide",tier:R.PRIMORDIAL,atoms:[{element:"S",x:0,y:0,z:0},{element:"H",x:-12,y:16,z:0},{element:"H",x:12,y:16,z:0}],bonds:[{from:0,to:1,order:1},{from:0,to:2,order:1}]},formaldehyde:{name:"CH₂O",label:"Formaldehyde",tier:R.PRECURSOR,atoms:[{element:"C",x:0,y:0,z:0},{element:"O",x:0,y:-24,z:0},{element:"H",x:-18,y:14,z:0},{element:"H",x:18,y:14,z:0}],bonds:[{from:0,to:1,order:2},{from:0,to:2,order:1},{from:0,to:3,order:1}]},hydrogenCyanide:{name:"HCN",label:"Hydrogen Cyanide",tier:R.PRECURSOR,atoms:[{element:"H",x:-30,y:0,z:0},{element:"C",x:0,y:0,z:0},{element:"N",x:26,y:0,z:0}],bonds:[{from:0,to:1,order:1},{from:1,to:2,order:3}]},glycine:{name:"Glycine",label:"Glycine",tier:R.AMINO_ACID,atoms:[{element:"N",x:-35,y:0,z:0},{element:"C",x:-5,y:0,z:0},{element:"C",x:30,y:0,z:0},{element:"O",x:45,y:-18,z:0},{element:"O",x:45,y:18,z:0},{element:"H",x:-50,y:-10,z:0},{element:"H",x:-50,y:10,z:0},{element:"H",x:-5,y:18,z:10},{element:"H",x:-5,y:18,z:-10},{element:"H",x:58,y:25,z:0}],bonds:[{from:0,to:1,order:1},{from:1,to:2,order:1},{from:2,to:3,order:2},{from:2,to:4,order:1},{from:0,to:5,order:1},{from:0,to:6,order:1},{from:1,to:7,order:1},{from:1,to:8,order:1},{from:4,to:9,order:1}]},alanine:{name:"Alanine",label:"Alanine",tier:R.AMINO_ACID,atoms:[{element:"N",x:-40,y:0,z:0},{element:"C",x:-10,y:0,z:0},{element:"C",x:25,y:0,z:0},{element:"O",x:40,y:-18,z:0},{element:"O",x:40,y:18,z:0},{element:"C",x:-10,y:0,z:28},{element:"H",x:-55,y:-10,z:0},{element:"H",x:-55,y:10,z:0},{element:"H",x:-10,y:20,z:0},{element:"H",x:53,y:25,z:0},{element:"H",x:-10,y:10,z:40},{element:"H",x:-20,y:-8,z:35},{element:"H",x:0,y:-8,z:35}],bonds:[{from:0,to:1,order:1},{from:1,to:2,order:1},{from:2,to:3,order:2},{from:2,to:4,order:1},{from:1,to:5,order:1},{from:0,to:6,order:1},{from:0,to:7,order:1},{from:1,to:8,order:1},{from:4,to:9,order:1},{from:5,to:10,order:1},{from:5,to:11,order:1},{from:5,to:12,order:1}]},diglycine:{name:"Gly-Gly",label:"Peptide",tier:R.PEPTIDE,atoms:[{element:"N",x:-60,y:0,z:0},{element:"C",x:-35,y:0,z:0},{element:"C",x:-10,y:0,z:0},{element:"O",x:-10,y:-22,z:0},{element:"N",x:15,y:0,z:0},{element:"C",x:40,y:0,z:0},{element:"C",x:65,y:0,z:0},{element:"O",x:80,y:-18,z:0},{element:"O",x:80,y:18,z:0}],bonds:[{from:0,to:1,order:1},{from:1,to:2,order:1},{from:2,to:3,order:2},{from:2,to:4,order:1},{from:4,to:5,order:1},{from:5,to:6,order:1},{from:6,to:7,order:2},{from:6,to:8,order:1}]}},D=["water","methane","ammonia","hydrogen","carbonDioxide","hydrogenSulfide"],_=[{reactants:["methane","water"],products:["formaldehyde","hydrogen"],minTemp:.35,energy:.15},{reactants:["ammonia","methane"],products:["hydrogenCyanide","hydrogen","hydrogen"],minTemp:.4,energy:.2},{reactants:["carbonDioxide","hydrogen"],products:["formaldehyde"],minTemp:.35,energy:.15},{reactants:["formaldehyde","hydrogenCyanide"],products:["glycine"],minTemp:.45,energy:.25},{reactants:["formaldehyde","ammonia"],products:["glycine","water"],minTemp:.5,energy:.3},{reactants:["hydrogenCyanide","ammonia"],products:["alanine"],minTemp:.5,energy:.3},{reactants:["glycine","glycine"],products:["diglycine","water"],minTemp:.55,energy:.4},{reactants:["glycine","alanine"],products:["diglycine","water"],minTemp:.55,energy:.4}];class L extends F{constructor(t,e,o={}){super(t,o),this.templateKey=e,this.template=T[e],this.name=this.template.name,this.label=this.template.label,this.tier=this.template.tier,this.x=o.x??0,this.y=o.y??0,this.z=o.z??0,this.vx=(Math.random()-.5)*l.baseSpeed,this.vy=(Math.random()-.5)*l.baseSpeed,this.vz=(Math.random()-.5)*l.baseSpeed,this.temperature=.5,this.reactionCooldown=0,this.flash=0,this.rotX=Math.random()*H,this.rotY=Math.random()*H,this.rotZ=Math.random()*H,this.rotSpeedX=(Math.random()-.5)*.5,this.rotSpeedY=(Math.random()-.5)*.5,this.rotSpeedZ=(Math.random()-.5)*.2,this.timeOffset=Math.random()*100,this.tideOffset=Math.random()*l.tidePeriod,this.baseX=this.x,this.baseY=this.y,this.baseZ=this.z,this.atomData=this.template.atoms.map(i=>({element:i.element,localX:i.x,localY:i.y,localZ:i.z,props:k[i.element],screenX:0,screenY:0,screenScale:1,worldZ:0})),this.bonds=this.template.bonds;let s=0;for(const i of this.atomData){const n=Math.sqrt(i.localX**2+i.localY**2+i.localZ**2);s=Math.max(s,n+i.props.radius)}this.boundingRadius=s}update(t){super.update(t);const e=this.game,o=e.worldHeight/2,s=e.totalTime,i=(this.baseY+o)/e.worldHeight;this.temperature=j(Math.max(0,Math.min(1,i)),this.temperature,{heatZone:l.heatZone,coolZone:l.coolZone,rate:l.heatRate});const n=N(this.temperature,l.neutralTemp,l.buoyancyStrength);this.vy-=n*t;const r=Math.pow(l.damping,t*60);this.vx*=r,this.vy*=r,this.vz*=r,this.baseX+=this.vx*t,this.baseY+=this.vy*t,this.baseZ+=this.vz*t;const m=s+this.timeOffset,h=l.floatRadius*(.7+this.temperature*.6),x=O.float({x:0,y:0},m,15,l.floatSpeed*(.8+this.temperature*.4),l.floatRandomness,h,!0,P.smoothstep),p=s+this.tideOffset,c=O.oscillate(-100,l.tideStrength,p,l.tidePeriod,!0,P.easeInOutSine),y=1-i*.4,g=c.value*y;this.x=this.baseX+x.offsetX+g,this.y=this.baseY+x.offsetY*.3,this.z=this.baseZ+x.offsetY*.5;const u=.02+Math.sqrt(this.vx*this.vx+this.vy*this.vy+this.vz*this.vz)*.008;this.rotX+=(this.vy*.015+this.rotSpeedX*.3)*u*t*60,this.rotY+=(this.vx*.015+this.rotSpeedY*.3)*u*t*60,this.rotZ+=(this.vz*.01+this.rotSpeedZ*.2)*u*t*60,this.reactionCooldown>0&&(this.reactionCooldown-=t),this.flash>0&&(this.flash-=t*2)}render(t,e){if(!this.visible)return;const o=G.ctx,s=this.game.camera,i=Math.cos(this.rotX),n=Math.sin(this.rotX),r=Math.cos(this.rotY),m=Math.sin(this.rotY),h=Math.cos(this.rotZ),x=Math.sin(this.rotZ);for(const c of this.atomData){let y=c.localX,g=c.localY,M=c.localZ,u=g*i-M*n,z=g*n+M*i;g=u,M=z;let C=y*r+M*m;z=-y*m+M*r,y=C,M=z,C=y*h-g*x,u=y*x+g*h,y=C,g=u;const v=this.x+y,a=this.y+g,d=this.z+M,f=s.project(v,a,d);c.screenX=t+f.x,c.screenY=e+f.y,c.screenScale=f.scale,c.worldZ=f.z}const p=[...this.atomData].sort((c,y)=>c.worldZ-y.worldZ);this._renderBonds(o);for(const c of p)this._renderAtom(o,c)}_renderBonds(t){for(const e of this.bonds){const o=this.atomData[e.from],s=this.atomData[e.to];if(o.screenScale<=0||s.screenScale<=0)continue;const i=(o.screenScale+s.screenScale)/2,n=(o.worldZ+s.worldZ)/2,r=Math.max(-10,Math.min(10,n/40)),m=200-this.temperature*180,h=45+r;if(t.strokeStyle=`hsl(${m}, 35%, ${h}%)`,t.lineWidth=3*i,t.lineCap="round",e.order===1)t.beginPath(),t.moveTo(o.screenX,o.screenY),t.lineTo(s.screenX,s.screenY),t.stroke();else if(e.order>=2){const x=s.screenX-o.screenX,p=s.screenY-o.screenY,c=Math.sqrt(x*x+p*p)||1,y=4*i,g=-p/c*y,M=x/c*y;t.lineWidth=2*i;for(let u=0;u<e.order;u++){const z=u-(e.order-1)/2;t.beginPath(),t.moveTo(o.screenX+g*z,o.screenY+M*z),t.lineTo(s.screenX+g*z,s.screenY+M*z),t.stroke()}}}}_renderAtom(t,e){if(e.screenScale<=0)return;const o=e.props,s=o.radius*e.screenScale,i=Math.max(-15,Math.min(10,e.worldZ/30)),n=(this.temperature-.5)*40,r=o.hue+n,m=o.sat+this.temperature*20,h=o.light+i;if(this.flash>0){const p=s*(2+this.flash),c=t.createRadialGradient(e.screenX,e.screenY,0,e.screenX,e.screenY,p);c.addColorStop(0,`rgba(255, 255, 200, ${this.flash*.9})`),c.addColorStop(.4,`rgba(255, 180, 80, ${this.flash*.5})`),c.addColorStop(1,"transparent"),t.fillStyle=c,t.beginPath(),t.arc(e.screenX,e.screenY,p,0,H),t.fill()}const x=t.createRadialGradient(e.screenX-s*.3,e.screenY-s*.3,0,e.screenX,e.screenY,s);x.addColorStop(0,`hsl(${r}, ${m*.3}%, ${Math.min(h+35,95)}%)`),x.addColorStop(.4,`hsl(${r}, ${m}%, ${h}%)`),x.addColorStop(1,`hsl(${r}, ${m+10}%, ${Math.max(h-20,10)}%)`),t.fillStyle=x,t.beginPath(),t.arc(e.screenX,e.screenY,s,0,H),t.fill()}getBounds(){return{x:this.x,y:this.y,width:this.boundingRadius*2,height:this.boundingRadius*2}}}class B extends I{constructor(t){super(t),this.backgroundColor=l.bgColor}init(){super.init(),G.init(this.ctx),this.camera=new Z({perspective:l.perspective,rotationX:.2,rotationY:0,inertia:!0,friction:.95,clampX:!1,clampY:!1}),this.camera.enableMouseControl(this.canvas),this.canvas.removeEventListener("dblclick",this.camera._boundHandlers.dblclick),this.molecules=[],this.cx=this.width/2,this.cy=this.height/2,this.reactionLog=[],this.totalTime=0,this.nextLightning=l.lightningInterval,this.stats={reactions:0,maxTier:0},this.worldWidth=this.width*.8,this.worldHeight=this.height*.9;const t=1920*1080,o=this.width*this.height/t;this.moleculeCount=Math.floor(Math.min(l.maxMolecules,Math.max(l.minMolecules,l.baseMolecules*o)));const s=Math.floor(l.bubbleCount*Math.max(.5,o)),i=Math.floor(l.particleCount*Math.max(.5,o));console.log(`[Day25] Canvas: ${this.width}x${this.height}, scale: ${o.toFixed(2)}, molecules: ${this.moleculeCount}, bubbles: ${s}, particles: ${i}`),this.bubbles=[];for(let r=0;r<s;r++)this.bubbles.push(this.createBubble(!0));this.particles=[];for(let r=0;r<i;r++)this.particles.push(this.createParticle());for(let r=0;r<this.moleculeCount;r++)this.spawnMolecule(!0);let n=null;this.canvas.addEventListener("mousedown",r=>{n={x:r.clientX,y:r.clientY}}),this.canvas.addEventListener("mouseup",r=>{if(n){const b=r.clientX-n.x,w=r.clientY-n.y;if(Math.abs(b)>5||Math.abs(w)>5){n=null;return}}n=null;const m=this.canvas.getBoundingClientRect(),h=r.clientX-m.left-this.width/2,x=r.clientY-m.top-this.height/2,p=Math.cos(-this.camera.rotationX),c=Math.sin(-this.camera.rotationX),y=Math.cos(-this.camera.rotationY),g=Math.sin(-this.camera.rotationY);let M=h,u=x,z=(Math.random()-.5)*100;const C=M*y-z*g,v=M*g+z*y;M=C,z=v;const a=u*p-z*c,d=u*c+z*p;u=a,z=d;const f=this.spawnMolecule(!0,M,u,z,void 0,!0);f&&(this.reactionLog.unshift({text:`+ ${f.label} (${f.name})`,time:2}),this.reactionLog.length>5&&this.reactionLog.pop())})}createBubble(t=!1){const e=this.width*.3;return{x:this.width/2+(Math.random()-.5)*e,y:t?Math.random()*this.height:this.height+Math.random()*50,size:2+Math.random()*6,speed:30+Math.random()*50,wobblePhase:Math.random()*H,wobbleSpeed:1+Math.random()*2,alpha:.1+Math.random()*.3}}createParticle(){return{x:Math.random()*this.width,y:Math.random()*this.height,z:(Math.random()-.5)*400,size:1+Math.random()*2,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*5,alpha:.05+Math.random()*.15,hue:Math.random()<.3?30:200}}spawnMolecule(t=!1,e,o,s,i,n=!1){const r=Math.min(l.maxMolecules,(this.moleculeCount||l.baseMolecules)*3);if(!n&&this.molecules.length>=r)return null;const m=i||(t?D[Math.floor(Math.random()*D.length)]:Object.keys(T)[Math.floor(Math.random()*Object.keys(T).length)]),h=e??(Math.random()-.5)*this.worldWidth,x=o??(Math.random()-.5)*this.worldHeight,p=s??(Math.random()-.5)*200,c=new L(this,m,{x:h,y:x,z:p});return this.molecules.push(c),c}lightning(){const t=(Math.random()-.5)*this.worldWidth,e=(Math.random()-.5)*this.worldHeight*.5,o=(Math.random()-.5)*150;for(const s of this.molecules){const i=s.x-t,n=s.y-e,r=s.z-o,m=Math.sqrt(i*i+n*n+r*r);if(m<l.lightningRadius){const h=1-m/l.lightningRadius;s.temperature=Math.min(1,s.temperature+l.lightningEnergy*h),s.flash=Math.max(s.flash,h*.5)}}this.lightningFlash={x:t,y:e,z:o,intensity:1}}checkReactions(){const t=new Set,e=[];for(let o=0;o<this.molecules.length;o++){const s=this.molecules[o];if(!(s.reactionCooldown>0||t.has(o)))for(let i=o+1;i<this.molecules.length;i++){const n=this.molecules[i];if(n.reactionCooldown>0||t.has(i))continue;const r=n.x-s.x,m=n.y-s.y,h=n.z-s.z;if(Math.sqrt(r*r+m*m+h*h)>l.reactionDistance)continue;const p=(s.temperature+n.temperature)/2;for(const c of _){const[y,g]=c.reactants;if(!(s.templateKey===y&&n.templateKey===g||s.templateKey===g&&n.templateKey===y))continue;const u=l.baseReactionChance*(p/c.minTemp);if(p<c.minTemp*.8||Math.random()>u)continue;t.add(o),t.add(i);const z=(s.x+n.x)/2,C=(s.y+n.y)/2,v=(s.z+n.z)/2;for(const b of c.products){if(!T[b])continue;const w=(Math.random()-.5)*20,S=new L(this,b,{x:z+w,y:C+w,z:v+w});S.temperature=p,S.flash=c.energy,S.reactionCooldown=l.reactionCooldown,S.vx=(s.vx+n.vx)/2+(Math.random()-.5)*15,S.vy=(s.vy+n.vy)/2+(Math.random()-.5)*15,S.vz=(s.vz+n.vz)/2+(Math.random()-.5)*15,e.push(S),this.stats.maxTier=Math.max(this.stats.maxTier,S.tier)}this.stats.reactions++;const a=b=>`${b.label} (${b.name})`,d=[a(s),a(n)].join(" + "),f=c.products.map(b=>{const w=T[b];return w?`${w.label} (${w.name})`:b}).join(" + ");this.reactionLog.unshift({text:`${d} → ${f}`,time:4}),this.reactionLog.length>5&&this.reactionLog.pop();break}}}this.molecules=this.molecules.filter((o,s)=>!t.has(s));for(const o of e)this.molecules.push(o)}applySeparation(t){const e=l.separationPadding,o=l.separationStiffness,s=l.collisionDamping;for(let i=0;i<this.molecules.length;i++){const n=this.molecules[i],r=n.boundingRadius+e;for(let m=i+1;m<this.molecules.length;m++){const h=this.molecules[m],x=h.boundingRadius+e,p=h.x-n.x,c=h.y-n.y,y=h.z-n.z,g=p*p+c*c+y*y,M=r+x;if(g<M*M&&g>.001){const u=Math.sqrt(g),z=M-u,C=p/u,v=c/u,a=y/u,d=z*o*.5;n.baseX-=C*d,n.baseY-=v*d,n.baseZ-=a*d,h.baseX+=C*d,h.baseY+=v*d,h.baseZ+=a*d;const f=n.vx*C+n.vy*v+n.vz*a,b=h.vx*C+h.vy*v+h.vz*a;if(f>b){const S=(f-b)*s;n.vx-=C*S*.5,n.vy-=v*S*.5,n.vz-=a*S*.5,h.vx+=C*S*.5,h.vy+=v*S*.5,h.vz+=a*S*.5}}}}}heatTransfer(){for(let t=0;t<this.molecules.length;t++){const e=this.molecules[t];for(let o=t+1;o<this.molecules.length;o++){const s=this.molecules[o],i=s.x-e.x,n=s.y-e.y,r=s.z-e.z,m=Math.sqrt(i*i+n*n+r*r);if(m<l.heatTransferDist){const h=A(e.temperature,s.temperature,m,l.heatTransferDist,l.heatTransferRate,1);e.temperature=Math.max(0,Math.min(1,e.temperature+h)),s.temperature=Math.max(0,Math.min(1,s.temperature-h))}}}}update(t){super.update(t),this.camera.update(t),this.totalTime+=t,this.nextLightning-=t,this.nextLightning<=0&&(this.lightning(),this.nextLightning=l.lightningInterval+(Math.random()-.5)*l.lightningVariance*2),this.lightningFlash&&(this.lightningFlash.intensity-=t*3,this.lightningFlash.intensity<=0&&(this.lightningFlash=null));for(const e of this.bubbles)e.y-=e.speed*t,e.wobblePhase+=e.wobbleSpeed*t,e.x+=Math.sin(e.wobblePhase)*.5,e.y<-20&&Object.assign(e,this.createBubble(!1));for(const e of this.particles)e.x+=e.vx*t,e.y+=e.vy*t,e.vx+=(Math.sin(this.totalTime*.5+e.y*.01)*2-e.vx*.1)*t,e.vy+=(Math.cos(this.totalTime*.3+e.x*.01)*1-e.vy*.1)*t,e.x<0&&(e.x=this.width),e.x>this.width&&(e.x=0),e.y<0&&(e.y=this.height),e.y>this.height&&(e.y=0);for(const e of this.molecules){e.update(t);const o=50;e.x<-this.worldWidth/2-o&&(e.vx+=50*t),e.x>this.worldWidth/2+o&&(e.vx-=50*t),e.y<-this.worldHeight/2-o&&(e.vy+=50*t),e.y>this.worldHeight/2+o&&(e.vy-=50*t),e.z<-200&&(e.vz+=30*t),e.z>200&&(e.vz-=30*t)}this.applySeparation(t),this.heatTransfer(),this.checkReactions();for(const e of this.reactionLog)e.time-=t;this.reactionLog=this.reactionLog.filter(e=>e.time>0)}render(){const t=this.ctx,e=this.width,o=this.height,s=e/2,i=o/2,n=t.createLinearGradient(0,0,0,o);n.addColorStop(0,"#030612"),n.addColorStop(.5,"#050510"),n.addColorStop(.8,"#0a0508"),n.addColorStop(1,"#1a0505"),t.fillStyle=n,t.fillRect(0,0,e,o),t.globalAlpha=.03;const r=120,m=this.totalTime*l.causticSpeed;for(let a=0;a<5;a++){const d=a*1.3+m,f=e*.3+Math.sin(d)*e*.2,b=o*.2+Math.cos(d*.7)*o*.1,w=e*.7+Math.sin(d*.8+2)*e*.2,S=o*.3+Math.cos(d*.5+1)*o*.1,$=t.createRadialGradient(f,b,0,f,b,r);$.addColorStop(0,"rgba(100, 180, 255, 1)"),$.addColorStop(1,"transparent"),t.fillStyle=$,t.fillRect(0,0,e,o);const X=t.createRadialGradient(w,S,0,w,S,r*.8);X.addColorStop(0,"rgba(150, 200, 255, 1)"),X.addColorStop(1,"transparent"),t.fillStyle=X,t.fillRect(0,0,e,o)}t.globalAlpha=1;const h=t.createRadialGradient(s,o+50,0,s,o+50,o*.7);h.addColorStop(0,`rgba(255, 100, 30, ${l.ventGlow})`),h.addColorStop(.3,`rgba(255, 60, 10, ${l.ventGlow*.5})`),h.addColorStop(.6,`rgba(200, 30, 5, ${l.ventGlow*.2})`),h.addColorStop(1,"transparent"),t.fillStyle=h,t.fillRect(0,0,e,o);const x=t.createRadialGradient(s-e*.2,o+30,0,s-e*.2,o+30,o*.3);x.addColorStop(0,`rgba(255, 80, 20, ${l.ventGlow*.4})`),x.addColorStop(1,"transparent"),t.fillStyle=x,t.fillRect(0,0,e,o);const p=t.createRadialGradient(s+e*.25,o+40,0,s+e*.25,o+40,o*.35);p.addColorStop(0,`rgba(255, 60, 10, ${l.ventGlow*.3})`),p.addColorStop(1,"transparent"),t.fillStyle=p,t.fillRect(0,0,e,o);for(const a of this.particles){const d=.5+(a.z+200)/400*.5;t.fillStyle=`hsla(${a.hue}, 30%, 60%, ${a.alpha*d})`,t.beginPath(),t.arc(a.x,a.y,a.size*d,0,H),t.fill()}if(this.lightningFlash){const a=this.camera.project(this.lightningFlash.x,this.lightningFlash.y,this.lightningFlash.z),d=s+a.x,f=i+a.y,b=t.createRadialGradient(d,f,0,d,f,250);b.addColorStop(0,`rgba(220, 240, 255, ${this.lightningFlash.intensity*.9})`),b.addColorStop(.2,`rgba(180, 210, 255, ${this.lightningFlash.intensity*.5})`),b.addColorStop(.5,`rgba(100, 150, 255, ${this.lightningFlash.intensity*.2})`),b.addColorStop(1,"transparent"),t.fillStyle=b,t.fillRect(0,0,e,o)}const c=[...this.molecules].sort((a,d)=>{const f=this.camera.project(a.x,a.y,a.z),b=this.camera.project(d.x,d.y,d.z);return f.z-b.z});for(const a of c)a.render(s,i);for(const a of this.bubbles){const d=t.createRadialGradient(a.x-a.size*.3,a.y-a.size*.3,0,a.x,a.y,a.size);d.addColorStop(0,`rgba(255, 255, 255, ${a.alpha*.8})`),d.addColorStop(.5,`rgba(200, 220, 255, ${a.alpha*.3})`),d.addColorStop(1,`rgba(150, 180, 220, ${a.alpha*.1})`),t.fillStyle=d,t.beginPath(),t.arc(a.x,a.y,a.size,0,H),t.fill(),t.fillStyle=`rgba(255, 255, 255, ${a.alpha*.6})`,t.beginPath(),t.arc(a.x-a.size*.3,a.y-a.size*.3,a.size*.25,0,H),t.fill()}const y=t.createRadialGradient(s,i,Math.min(e,o)*.3,s,i,Math.max(e,o)*.8);y.addColorStop(0,"transparent"),y.addColorStop(1,"rgba(0, 5, 15, 0.6)"),t.fillStyle=y,t.fillRect(0,0,e,o);const g=E.isMobile,M=g?9:11,u=g?14:18,z=g?e-30:e*.5;t.font=`${M}px "Fira Code", monospace`,t.textAlign="left";let C=25;for(const a of this.reactionLog){const d=Math.min(1,a.time);t.fillStyle=`rgba(255, 200, 100, ${d*.9})`;let f=a.text;if(g&&t.measureText(f).width>z){for(;t.measureText(f+"…").width>z&&f.length>10;)f=f.slice(0,-1);f+="…"}t.fillText(f,15,C),C+=u}t.fillStyle="rgba(150, 180, 200, 0.6)",t.textAlign="right",t.fillText(`Molecules: ${this.molecules.length}`,e-15,25),t.fillText(`Reactions: ${this.stats.reactions}`,e-15,25+u);const v=["Primordial","Precursors","Amino Acids","Peptides"];t.fillText(`Max tier: ${v[this.stats.maxTier]||"???"}`,e-15,25+u*2)}}function q(Y){const t=new B(Y);return t.start(),{stop:()=>t.stop(),game:t}}export{q as default};
