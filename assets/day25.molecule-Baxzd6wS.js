import{o as Y,z as $,t as z,P as w}from"./index-DMqzgpv5.js";import{CONFIG as e,TAU as y}from"./day25.config-DJwhhKHN.js";import{MOLECULES as x,ATOMS as D}from"./day25.chemistry-fLO6Y1II.js";class B extends Y{constructor(t,s,o={}){super(t,o),this.templateKey=s,this.template=x[s],this.name=this.template.name,this.label=this.template.label,this.tier=this.template.tier,this.x=o.x??0,this.y=o.y??0,this.z=o.z??0,this.vx=(Math.random()-.5)*e.baseSpeed,this.vy=(Math.random()-.5)*e.baseSpeed,this.vz=(Math.random()-.5)*e.baseSpeed,this.temperature=.5,this.reactionCooldown=0,this.flash=0,this.rotX=Math.random()*y,this.rotY=Math.random()*y,this.rotZ=Math.random()*y,this.rotSpeedX=(Math.random()-.5)*.15,this.rotSpeedY=(Math.random()-.5)*.15,this.rotSpeedZ=(Math.random()-.5)*.1,this.turbulencePhase=Math.random()*Math.PI*2,this.atomData=this.template.atoms.map(i=>({element:i.element,localX:i.x,localY:i.y,localZ:i.z,props:D[i.element],screenX:0,screenY:0,screenScale:1,worldZ:0})),this.bonds=this.template.bonds;let h=0;for(const i of this.atomData){const g=Math.sqrt(i.localX**2+i.localY**2+i.localZ**2);h=Math.max(h,g+i.props.radius)}this.boundingRadius=h}update(t){super.update(t);const s=this.game,o=s.worldHeight/2,h=s.totalTime,i=(this.y+o)/s.worldHeight;this.temperature=$(Math.max(0,Math.min(1,i)),this.temperature,{heatZone:e.heatZone,coolZone:e.coolZone,rate:e.heatRate});const g=z(this.temperature,e.neutralTemp,e.buoyancyStrength);this.vy-=g*t;const d=h*.3+i*2.5+this.turbulencePhase,p=e.convectionCurrentX*(.6+this.temperature*.4);this.vx+=Math.sin(d)*p*t;const M=h*.2+i*1.8+this.turbulencePhase+1.5,S=e.convectionZ*(.5+this.temperature*.5);this.vz+=Math.sin(M)*S*t;const m=this.turbulencePhase+h,a=e.convectionTurbulence*(.4+this.temperature*.3);this.vx+=Math.sin(m*1.3)*a*t,this.vy+=Math.sin(m*1.7+1.5)*a*.3*t,this.vz+=Math.sin(m*1.1+3)*a*.8*t;const n=e.brownianStrength;this.vx+=(Math.random()-.5)*n*t*60,this.vy+=(Math.random()-.5)*n*t*60,this.vz+=(Math.random()-.5)*n*t*60;const r=Math.pow(e.damping,t*60);this.vx*=r,this.vy*=r,this.vz*=r,this.x+=this.vx*t,this.y+=this.vy*t,this.z+=this.vz*t;const c=Math.sqrt(this.vx*this.vx+this.vy*this.vy+this.vz*this.vz),u=.025+Math.min(c*.002,.04);this.rotX+=(this.vy*.005+this.rotSpeedX)*u*t*60,this.rotY+=(this.vx*.005+this.rotSpeedY)*u*t*60,this.rotZ+=(this.vz*.004+this.rotSpeedZ)*u*t*60,this.rotSpeedX*=.985,this.rotSpeedY*=.985,this.rotSpeedZ*=.985;const l=.25;this.rotSpeedX=Math.max(-l,Math.min(l,this.rotSpeedX)),this.rotSpeedY=Math.max(-l,Math.min(l,this.rotSpeedY)),this.rotSpeedZ=Math.max(-l,Math.min(l,this.rotSpeedZ)),this.reactionCooldown>0&&(this.reactionCooldown-=t),this.flash>0&&(this.flash-=t*.5)}render(t,s){if(!this.visible)return;const o=w.ctx,h=this.game.camera,i=Math.cos(this.rotX),g=Math.sin(this.rotX),d=Math.cos(this.rotY),p=Math.sin(this.rotY),M=Math.cos(this.rotZ),S=Math.sin(this.rotZ);for(const a of this.atomData){let n=a.localX,r=a.localY,c=a.localZ,u=r*i-c*g,l=r*g+c*i;r=u,c=l;let f=n*d+c*p;l=-n*p+c*d,n=f,c=l,f=n*M-r*S,u=n*S+r*M,n=f,r=u;const b=this.x+n,Z=this.y+r,X=this.z+c,v=h.project(b,Z,X);a.screenX=t+v.x,a.screenY=s+v.y,a.screenScale=v.scale,a.worldZ=v.z}const m=[...this.atomData].sort((a,n)=>a.worldZ-n.worldZ);this._renderBonds(o);for(const a of m)this._renderAtom(o,a)}_renderBonds(t){for(const s of this.bonds){const o=this.atomData[s.from],h=this.atomData[s.to];if(o.screenScale<=0||h.screenScale<=0)continue;const i=(o.screenScale+h.screenScale)/2,g=(o.worldZ+h.worldZ)/2,d=e.bondDepthClamp,p=Math.max(-d,Math.min(d,g/e.bondDepthDivisor)),M=Math.round(e.hueBase+(this.temperature-.5)*e.hueRange),S=Math.round(e.bondBaseLightness+p+this.temperature*e.bondTempLightMult),m=Math.round(e.bondBaseSaturation+this.temperature*e.bondTempSatMult);if(t.strokeStyle=`hsl(${M}, ${m}%, ${S}%)`,t.lineWidth=e.bondSingleWidth*i,t.lineCap="round",s.order===1)t.beginPath(),t.moveTo(o.screenX,o.screenY),t.lineTo(h.screenX,h.screenY),t.stroke();else if(s.order>=2){const a=h.screenX-o.screenX,n=h.screenY-o.screenY,r=Math.sqrt(a*a+n*n)||1,c=e.bondMultiGap*i,u=-n/r*c,l=a/r*c;t.lineWidth=e.bondMultiWidth*i;for(let f=0;f<s.order;f++){const b=f-(s.order-1)/2;t.beginPath(),t.moveTo(o.screenX+u*b,o.screenY+l*b),t.lineTo(h.screenX+u*b,h.screenY+l*b),t.stroke()}}}}_renderAtom(t,s){if(s.screenScale<=0)return;const o=s.props,h=o.radius*s.screenScale,i=Math.max(e.atomDepthClampMin,Math.min(e.atomDepthClampMax,s.worldZ/e.atomDepthDivisor)),g=(this.temperature-.5)*e.atomTempLightMult,d=o.hue,p=o.sat,M=Math.round(Math.max(e.atomLightMin,Math.min(e.atomLightMax,o.light+i+g))),S=e.atomHighlightOffset,m=t.createRadialGradient(s.screenX-h*S,s.screenY-h*S,0,s.screenX,s.screenY,h),a=e.atomGradientStops,n=Math.round(Math.min(p+e.atomHighlightSatBoost,100)),r=Math.round(Math.min(M+e.atomHighlightLightBoost,e.atomLightMax)),c=Math.round(Math.max(M-e.atomMidLightDrop,e.atomLightMin)),u=Math.round(Math.min(p+e.atomEdgeSatBoost,100)),l=Math.round(Math.max(M-e.atomEdgeLightDrop,10));if(m.addColorStop(a[0],`hsl(${d}, ${n}%, ${r}%)`),m.addColorStop(a[1],`hsl(${d}, ${p}%, ${M}%)`),m.addColorStop(a[2],`hsl(${d}, ${p}%, ${c}%)`),m.addColorStop(a[3],`hsl(${d}, ${u}%, ${l}%)`),t.fillStyle=m,t.beginPath(),t.arc(s.screenX,s.screenY,h,0,y),t.fill(),this.flash>0){const[f,b,Z]=e.flashColor;t.strokeStyle=`rgba(${f}, ${b}, ${Z}, ${Math.min(1,this.flash*e.flashAlphaMult)})`,t.lineWidth=e.flashWidthBase*s.screenScale*(e.flashWidthMin+this.flash*e.flashWidthRange),t.stroke()}else t.strokeStyle=`hsla(${d}, ${p}%, ${M}%, ${e.atomOutlineAlpha})`,t.lineWidth=e.atomOutlineWidth,t.stroke()}getBounds(){return{x:this.x,y:this.y,width:this.boundingRadius*2,height:this.boundingRadius*2}}}export{B as Molecule3D};
