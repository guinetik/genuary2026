import{G as v,N as x,C as M,c as R,U as d,b as S,P as y,M as b,E as w}from"./gcanvas.es-C8KsZzA1.js";const s={background:"#0a0a12",trailAlpha:.08,hueBase:195,hueRange:25,perspective:800,initialRotationX:0,initialRotationY:0,radiusRatio:.38,rings:24,slices:48,waves:12,exponent:2.4,flow:6,speed:1.2,noiseScale:.008,noiseSpeed:.3,noiseStrengthBase:15,noiseStrengthMax:80,energyKick:.4,energyDecay:.92,amplitudeRatioBase:.08,amplitudeRatioMax:.25,lineWidth:.8,maxParticles:1500,excitationRate:40,excitationLifetime:{min:.5,max:1.5},excitationSize:{min:1,max:2},excitationDamping:.95},k=Math.PI*2;function A(g,t,i){return Math.max(t,Math.min(i,g))}class C extends v{constructor(t){super(t),this.backgroundColor=s.background}init(){super.init(),this.time=0,this.energy=0,this.seed=Math.floor(Math.random()*65535),x.seed(this.seed),this._radius=Math.min(this.width,this.height)*s.radiusRatio,this._amplitudeBase=this._radius*s.amplitudeRatioBase,this._amplitudeMax=this._radius*s.amplitudeRatioMax,this.amplitude=this._amplitudeBase,this.noiseStrength=s.noiseStrengthBase,this.breath=1,this._exciteAccum=0,this._meshFrame=0,this.camera=new M({perspective:s.perspective,rotationX:s.initialRotationX,rotationY:s.initialRotationY,inertia:!0,friction:.95,clampX:!1}),this.camera.enableMouseControl(this.canvas),this.camera.update(0),this.initMesh(),this.particles=new R(this,{camera:this.camera,depthSort:!0,maxParticles:s.maxParticles,blendMode:"screen",updaters:[d.velocity,d.damping(s.excitationDamping),d.fadeOut,d.shrink(.15),d.lifetime]}),this.particles.addEmitter("excite",new S({rate:0,position:{x:0,y:0,z:0},velocity:{x:0,y:0,z:40},velocitySpread:{x:60,y:60,z:60},lifetime:s.excitationLifetime,size:s.excitationSize,color:{r:100,g:200,b:255,a:1},shape:"circle"})),this.pipeline.add(this.particles),this._onClick=t=>{if(!this.camera._isDragging){if(t.shiftKey){this.seed=Math.floor(Math.random()*65535),x.seed(this.seed);return}this.energy=Math.min(1,this.energy+s.energyKick)}},this.canvas.addEventListener("click",this._onClick)}cleanup(){this._onClick&&this.canvas.removeEventListener("click",this._onClick),this._onClick=null}initMesh(){const{rings:t,slices:i}=s,o=this._radius;this._verts=new Array((t+1)*i),this._edges=[],this._faces=[];for(let r=0;r<=t;r++){const e=r/t,n=e*o;for(let a=0;a<i;a++){const h=a/i*k,c=n*Math.cos(h),l=n*Math.sin(h),m=r*i+a;if(this._verts[m]={x:c,y:l,theta:h,rRatio:e},r<t){const p=m,u=(r+1)*i+a,f=r*i+(a+1)%i,_=(r+1)*i+(a+1)%i;this._edges.push([p,u]),this._edges.push([p,f]),this._faces.push([p,u,f]),this._faces.push([f,u,_])}}}}heightAt(t){if(!t)return 0;const i=t.rRatio??0,e=(t.theta??0)*s.waves+(i*s.flow-this.time*s.speed),n=Math.pow(i,s.exponent)*this.amplitude*Math.sin(e),a=this.time*s.noiseSpeed,h=x.simplex3(t.x*s.noiseScale+a,t.y*s.noiseScale+a,n*.01);return n+h*this.noiseStrength*i}clear(){y.useCtx(t=>{t.fillStyle=`rgba(0, 0, 0, ${s.trailAlpha})`,t.fillRect(0,0,this.width,this.height);const i=this.width,o=this.height,r=Math.max(i,o)*.75,e=t.createRadialGradient(i/2,o/2,r*.15,i/2,o/2,r);e.addColorStop(0,"rgba(0, 0, 0, 0)"),e.addColorStop(1,"rgba(0, 0, 0, 0.28)"),t.fillStyle=e,t.fillRect(0,0,i,o)},{saveState:!0})}update(t){super.update(t),this.time+=t,this.camera.update(t),this.energy*=s.energyDecay,this.energy<.001&&(this.energy=0);const i=this._amplitudeBase+this.energy*(this._amplitudeMax-this._amplitudeBase),o=s.noiseStrengthBase+this.energy*(s.noiseStrengthMax-s.noiseStrengthBase),r=1-Math.pow(.02,t);this.amplitude+=(i-this.amplitude)*r,this.noiseStrength+=(o-this.noiseStrength)*r,this.breath=b.pulse(.92,1.08,this.time,3.2,!0,!0,w.smootherstep).value,this.emitExcitations(t)}emitExcitations(t){if(!this._verts||this._verts.length===0||this.energy<=0)return;this._exciteAccum+=s.excitationRate*this.energy*t;const i=Math.floor(this._exciteAccum);if(i<=0)return;this._exciteAccum-=i;const o=this.particles.particles.length;this.particles.burst(i,"excite");const r=this.particles.particles.length;for(let e=o;e<r;e++){const n=this.particles.particles[e],a=this._verts[Math.floor(Math.random()*this._verts.length)],h=this.heightAt(a)*this.breath;n.x=a.x,n.y=a.y,n.z=h,n.color.r=Math.floor(80+40*this.energy),n.color.g=Math.floor(180+50*a.rRatio),n.color.b=255,n.color.a=.85}}render(){y.setContext(this.ctx),this.running&&this.clear(),this._meshFrame++,this._verts&&this._edges&&this._meshFrame%2===0&&this.renderMesh(),this.pipeline.render()}renderMesh(){const t=this.width/2,i=this.height/2,o=new Array(this._verts.length);for(let e=0;e<this._verts.length;e++){const n=this._verts[e],a=this.heightAt(n)*this.breath,h=this.camera.project(n.x,n.y,a);o[e]={x:h.x,y:h.y,z:a,rRatio:n.rRatio}}const r=[];for(const[e,n]of this._edges){const a=o[e],h=o[n];if(!a||!h||!Number.isFinite(a.x)||!Number.isFinite(h.x))continue;const c=(a.z+h.z)/2,l=(a.rRatio+h.rRatio)/2;r.push({p1:a,p2:h,avgZ:c,avgR:l})}r.sort((e,n)=>e.avgZ-n.avgZ),y.useCtx(e=>{e.save(),e.translate(t,i),e.lineWidth=s.lineWidth;for(const n of r){const{p1:a,p2:h,avgR:c,avgZ:l}=n,m=s.hueBase+c*s.hueRange,p=40+l*.08,u=70+c*20;e.globalAlpha=.4+c*.5,e.strokeStyle=`hsl(${m}, ${u}%, ${A(p,30,65)}%)`,e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(h.x,h.y),e.stroke()}e.globalAlpha=1,e.restore()},{saveState:!0})}}function z(g){const t=new C(g);return t.start(),{stop:()=>{var i;(i=t.cleanup)==null||i.call(t),t.stop()},game:t}}export{z as default};
