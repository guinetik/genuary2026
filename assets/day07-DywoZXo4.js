import{G as B,d as p,P as L}from"./index-CdMqmSx5.js";const M={animation:{zoomSpeed:.08,zoomMin:.5,zoomMax:4,rotationSpeed:.05,colorCycleSpeed:15,pulseSpeed:.5},mouse:{radius:.2,warpStrength:30}},R=[{name:"SIERPINSKI MIRROR",desc:"(x & y) interlocked",fn:(n,t,s)=>{const e=Math.floor(s*15),i=128,o=(n+e)%i,a=(t+e)%i,c=(o&a)===0,h=i-1-o,d=i-1-a,f=(h&d)===0;return c||f}},{name:"XOR PULSE",desc:"(x ^ y) + pulse",fn:(n,t,s)=>{const e=Math.sin(s*3)*40,i=100+Math.sin(s*1.5)*50;return((n^t)+e&255)<i}},{name:"NESTED BREATHING",desc:"(x^y) & ((x>>s)^(y>>s))",fn:(n,t,s)=>{const e=1+Math.floor((Math.sin(s*.8)+1)*2);return((n^t)&(n>>e^t>>e))===0}},{name:"RULE 90 FLOW",desc:"(x^y) & ((x>>2)^(y>>2)) + drift",fn:(n,t,s)=>{const e=Math.floor(s*30),i=n+e,o=t+e;return((i^o)&(i>>2^o>>2))===0}},{name:"BOOLEAN WEAVE",desc:"(x&y) ^ (x|y) + wave",fn:(n,t,s)=>{const e=Math.sin(s*2+(n+t)*.01)*30;return((n&t^(n|t))+e&255)<128}},{name:"MODULAR DANCE",desc:"(x^y) % n, n varies",fn:(n,t,s)=>{const e=11+Math.floor(Math.sin(s*.5)*6),i=e/2+Math.sin(s*2)*2;return(n^t)%e<i}},{name:"NAND LATTICE",desc:"~(x&y) & ~(x|y)",fn:(n,t,s)=>{const e=Math.floor(s*20),i=n+e,o=t+e,a=~(i&o),c=~(i|o);return((a^c)&63)<32}},{name:"FRACTAL MORPH",desc:"(x|y) & (x^y) blend",fn:(n,t,s)=>{const e=(Math.sin(s)+1)/2,i=(n|t)&(n^t)&255,o=(n&t|n^t)&255;return i*e+o*(1-e)<100}},{name:"QUAD SIERPINSKI",desc:"4-way tiled",fn:(n,t,s)=>{const e=Math.floor(s*20),i=128,o=((n+e)%i+i)%i,a=((t+e)%i+i)%i,c=i/2,h=o<c?o:i-1-o,d=a<c?a:i-1-a;return(h&d)===0}},{name:"WAVE XOR",desc:"(x^y) + sin(x) + cos(y)",fn:(n,t,s)=>{const e=Math.sin(s*2+n*.02)*30,i=Math.cos(s*1.5+t*.02)*30;return((n^t)+e+i&255)<128}}];class Y extends B{constructor(t){super(t),this.backgroundColor="#000"}init(){super.init(),p.init(this),L.init(this.ctx),this.container=this.canvas.parentElement,this.container&&this.enableFluidSize(this.container),this.time=0,this.formulaIndex=0,this.zoom=1,this.zoomDir=1,this.rotation=0,this.hueOffset=0,this.mouseX=-1,this.mouseY=-1,this.mouseActive=!1,this.scaleFactor=p.responsive(4,3,2),this.ditherAmount=p.responsive(0,.3,.6),this.formulaTimer=0,this.formulaInterval=20,this.handleResize(),this.canvas.addEventListener("click",()=>{this.formulaIndex=(this.formulaIndex+1)%R.length,this.formulaTimer=0}),p.isTouchPrimary()||(this.canvas.addEventListener("mousemove",t=>{const s=this.canvas.getBoundingClientRect();this.mouseX=(t.clientX-s.left)/s.width,this.mouseY=(t.clientY-s.top)/s.height,this.mouseActive=!0}),this.canvas.addEventListener("mouseleave",()=>{this.mouseActive=!1}))}handleResize(){this._lastCanvasW=this.width,this._lastCanvasH=this.height,this.scaleFactor=p.responsive(4,3,2),this.ditherAmount=p.responsive(0,.3,.6),this.renderWidth=Math.max(1,Math.floor(this.width/this.scaleFactor)),this.renderHeight=Math.max(1,Math.floor(this.height/this.scaleFactor)),this.imageData=L.img.createImageData(this.renderWidth,this.renderHeight)}update(t){super.update(t),this.time+=t,this.formulaTimer+=t,this.formulaTimer>=this.formulaInterval&&(this.formulaIndex=(this.formulaIndex+1)%R.length,this.formulaTimer=0),(this.width!==this._lastCanvasW||this.height!==this._lastCanvasH)&&this.handleResize(),this.zoom+=M.animation.zoomSpeed*this.zoomDir*t,this.zoom>M.animation.zoomMax?this.zoomDir=-1:this.zoom<M.animation.zoomMin&&(this.zoomDir=1),this.rotation+=M.animation.rotationSpeed*t,this.hueOffset+=M.animation.colorCycleSpeed*t}render(){const t=this.ctx,s=this.width,e=this.height;this.renderFractal(),t.putImageData(this.imageData,0,0),t.imageSmoothingEnabled=!1,t.drawImage(t.canvas,0,0,this.renderWidth,this.renderHeight,0,0,s,e),this.drawOverlay(t,s,e)}renderFractal(){const t=this.imageData.data,s=this.renderWidth,e=this.renderHeight,i=R[this.formulaIndex],o=this.time,a=s/2,c=e/2,h=Math.min(s,e)*this.zoom,d=Math.cos(this.rotation),f=Math.sin(this.rotation),F=Math.sin(o*M.animation.pulseSpeed*Math.PI*2)*.5+.5,l=this.mouseX*s,P=this.mouseY*e,I=Math.min(s,e)*M.mouse.radius,A=this.ditherAmount,D=A>0,W=I*I,N=!this.mouseActive||p.isTouchPrimary();for(let v=0;v<e;v++)for(let y=0;y<s;y++){const r=(v*s+y)*4;let w=(y-a)/h,z=(v-c)/h;const H=w*d-z*f,X=w*f+z*d;if(!N){const x=y-l,m=v-P,u=x*x+m*m;if(u<W&&u>0){const g=Math.sqrt(u),S=(1-g/I)*M.mouse.warpStrength;w+=x/g*S/h,z+=m/g*S/h}}const C=256,b=Math.floor((H+2)*C)&65535,E=Math.floor((X+2)*C)&65535;if(i.fn(b,E,o)){const x=((b^E)&255)/255,m=.5+x*.5*F,u=(120+this.hueOffset+x*30)%360,[g,S,O]=this.hslToRgb(u/360,.9,.3+m*.4);if(D){const T=(Math.random()-.5)*A;t[r]=Math.max(0,Math.min(255,g+T)),t[r+1]=Math.max(0,Math.min(255,S+T)),t[r+2]=Math.max(0,Math.min(255,O+T))}else t[r]=g,t[r+1]=S,t[r+2]=O}else{const m=5+(b+E&15)/15*10;if(D){const u=(Math.random()-.5)*A;t[r]=Math.max(0,Math.min(255,m*.2+u)),t[r+1]=Math.max(0,Math.min(255,m*.5+u)),t[r+2]=Math.max(0,Math.min(255,m*.3+u))}else t[r]=m*.2,t[r+1]=m*.5,t[r+2]=m*.3}t[r+3]=255}}drawOverlay(t,s,e){const i=R[this.formulaIndex];t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(10,10,220,50),t.font='16px "Fira Code", monospace',t.fillStyle="#fff",t.textAlign="left",t.textBaseline="top",t.fillText(i.name,20,18),t.font='12px "Fira Code", monospace',t.fillStyle="rgba(255, 255, 255, 0.7)",t.fillText(i.desc,20,40),t.font='10px "Fira Code", monospace',t.fillStyle="rgba(255, 255, 255, 0.4)",t.textAlign="right",t.fillText("click to change formula",s-15,e-15)}hslToRgb(t,s,e){let i,o,a;if(s===0)i=o=a=e;else{const c=(f,F,l)=>(l<0&&(l+=1),l>1&&(l-=1),l<.16666666666666666?f+(F-f)*6*l:l<.5?F:l<.6666666666666666?f+(F-f)*(.6666666666666666-l)*6:f),h=e<.5?e*(1+s):e+s-e*s,d=2*e-h;i=c(d,h,t+1/3),o=c(d,h,t),a=c(d,h,t-1/3)}return[Math.round(i*255),Math.round(o*255),Math.round(a*255)]}}function G(n){const t=new Y(n);return t.start(),{stop:()=>t.stop(),game:t}}export{G as default};
