import{G as d,P as u}from"./gcanvas.es-C8KsZzA1.js";const i={cell:{w:11,h:18},tick:70,tail:{min:25,max:50},mouse:{radius:100,force:5},glow:{blur:10,color:"#0f0"}};class g extends d{constructor(t){super(t),this.backgroundColor="#000",this.source="",this.lines=[],this.ready=!1}async init(){super.init(),u.init(this.ctx);try{const e=await fetch(import.meta.url);this.source=await e.text()}catch{this.source=`// Could not fetch source
// Run via HTTP server: npm run dev
import { Game, Painter } from "@guinetik/gcanvas";
const CONFIG = { cell: { w: 11, h: 18 } };
class QuineDemo extends Game {
  async init() {
    const response = await fetch(import.meta.url);
    this.source = await response.text();
  }
}`}this.lines=this.source.split(`
`).map(e=>e.trimEnd()).filter(e=>e.length>0),this.columns=[],this.mouseX=-1e3,this.mouseY=-1e3,this.tickAccum=0;const t=Math.ceil(this.width/i.cell.w);this.numRows=Math.ceil(this.height/i.cell.h);for(let e=0;e<t;e++)this.columns.push(this.createDrop());this.canvas.addEventListener("mousemove",e=>{const s=this.canvas.getBoundingClientRect();this.mouseX=e.clientX-s.left,this.mouseY=e.clientY-s.top}),this.canvas.addEventListener("mouseleave",()=>{this.mouseX=-1e3,this.mouseY=-1e3}),this.ready=!0}createDrop(){const t=this.lines[Math.floor(Math.random()*this.lines.length)];return{y:-Math.floor(Math.random()*30),line:t,charIndex:0,tailLen:i.tail.min+Math.floor(Math.random()*(i.tail.max-i.tail.min)),chars:[]}}update(t){if(super.update(t),!!this.ready&&(this.tickAccum+=t*1e3,!(this.tickAccum<i.tick))){this.tickAccum=0;for(let e=0;e<this.columns.length;e++){const s=this.columns[e],r=e*i.cell.w+i.cell.w/2,o=s.y*i.cell.h,n=r-this.mouseX,a=o-this.mouseY,h=Math.sqrt(n*n+a*a);if(h<i.mouse.radius&&h>0&&(s.y-=i.mouse.force*(1-h/i.mouse.radius)),s.y++,s.charIndex<s.line.length){const l=s.line[s.charIndex];s.chars.unshift({row:Math.floor(s.y),char:l,age:0}),s.charIndex++}for(const l of s.chars)l.age++;s.chars=s.chars.filter(l=>l.age<s.tailLen);const m=s.charIndex>=s.line.length,f=s.y>this.numRows+s.tailLen;if(m||f||Math.random()>.995){const l=s.chars;this.columns[e]=this.createDrop(),this.columns[e].chars=l}}}}render(){u.useCtx(t=>{if(t.fillStyle="#000",t.fillRect(0,0,this.width,this.height),!this.ready){t.font="16px 'Fira Code', monospace",t.fillStyle="#0f0",t.textAlign="center",t.fillText("Fetching source...",this.width/2,this.height/2);return}t.font="14px 'Fira Code', monospace",t.textBaseline="top",t.textAlign="left";for(let e=0;e<this.columns.length;e++){const s=this.columns[e],r=e*i.cell.w;for(const o of s.chars){const n=o.row*i.cell.h;if(!(n<0||n>this.height))if(o.age<=1)t.shadowColor=i.glow.color,t.shadowBlur=i.glow.blur,t.fillStyle="#fff",t.fillText(o.char,r,n),t.shadowBlur=0;else{const a=1-o.age/s.tailLen,h=Math.floor(255*a);t.fillStyle=`rgba(0, ${h}, 50, ${a})`,t.fillText(o.char,r,n)}}}t.fillStyle="rgba(0, 255, 50, 0.08)";for(let e=0;e<15;e++){const s=Math.floor(Math.random()*this.columns.length)*i.cell.w,r=Math.floor(Math.random()*this.numRows)*i.cell.h,o=this.source[Math.floor(Math.random()*this.source.length)];o!==`
`&&o!=="\r"&&t.fillText(o,s,r)}if(this.mouseX>0){const e=t.createRadialGradient(this.mouseX,this.mouseY,0,this.mouseX,this.mouseY,i.mouse.radius);e.addColorStop(0,"rgba(0, 255, 100, 0.05)"),e.addColorStop(1,"transparent"),t.fillStyle=e,t.beginPath(),t.arc(this.mouseX,this.mouseY,i.mouse.radius,0,Math.PI*2),t.fill()}})}}function w(c){const t=new g(c);return t.start(),{stop:()=>t.stop(),game:t}}export{w as default};
