import{G as T,P as E,C as B,r as O,s as G}from"./gcanvas.es-CMQjSjBY.js";const i={bhMass:1,starCount:800,starFieldRadius:1200,lensEffectRadius:600,lensStrength:180,lensFalloff:.007,occlusionRadius:2.6,diskInnerRadius:1.8,diskOuterRadius:8,diskParticles:3e3,diskThickness:.15,baseOrbitalSpeed:.6,colorHot:{r:255,g:250,b:220},colorMid:{r:255,g:160,b:50},colorCool:{r:180,g:40,b:20},particleSizeMin:.5,particleSizeMax:1,particleScale:.0025,perspective:800,initialTilt:.4},x=[{size:1.5,brightness:1},{size:1,brightness:.7},{size:.6,brightness:.5}];class L extends T{constructor(t){super(t),this.backgroundColor="#000"}init(){super.init(),E.init(this.ctx);const t=Math.min(this.width,this.height);this.baseScale=t,this.bhRadius=t*.06,this.camera=new B({perspective:i.perspective,rotationX:i.initialTilt,rotationY:0,sensitivity:.004,inertia:!0,friction:.92,clampX:!1,autoRotate:!0,autoRotateSpeed:.08,autoRotateAxis:"y"}),this.camera.enableMouseControl(this.canvas),this.time=0,this.lensingStrength=1,this.initStarfield(),this.initAccretionDisk(),this.canvas.addEventListener("click",()=>this.burstMatter()),this.canvas.addEventListener("touchend",e=>{this.camera._isDragging||this.burstMatter()})}initStarfield(){this.stars=[];for(let t=0;t<i.starCount;t++){const e=Math.random()*Math.PI*2,o=Math.acos(2*Math.random()-1),n=i.starFieldRadius*(.5+Math.random()*.5),a=x[Math.floor(Math.random()*x.length)];this.stars.push({x:n*Math.sin(o)*Math.cos(e),y:n*Math.sin(o)*Math.sin(e),z:n*Math.cos(o),type:a,twinkleSpeed:1+Math.random()*2,twinklePhase:Math.random()*Math.PI*2})}}initAccretionDisk(){this.diskParticles=[];const t=this.bhRadius*i.diskInnerRadius,e=this.bhRadius*i.diskOuterRadius;for(let o=0;o<i.diskParticles;o++){const n=Math.pow(Math.random(),.5),a=t+(e-t)*n,s=Math.random()*Math.PI*2,c=O(a,i.bhMass,i.baseOrbitalSpeed,e),r=(Math.random()-.5)*this.bhRadius*i.diskThickness;this.diskParticles.push({angle:s,distance:a,yOffset:r,speed:c,size:i.particleSizeMin+Math.random()*(i.particleSizeMax-i.particleSizeMin),baseColor:this.getHeatColor(a,t,e)})}}getHeatColor(t,e,o){const n=(t-e)/(o-e);let a,s,c;if(n<.5){const r=n*2;a=i.colorHot.r+(i.colorMid.r-i.colorHot.r)*r,s=i.colorHot.g+(i.colorMid.g-i.colorHot.g)*r,c=i.colorHot.b+(i.colorMid.b-i.colorHot.b)*r}else{const r=(n-.5)*2;a=i.colorMid.r+(i.colorCool.r-i.colorMid.r)*r,s=i.colorMid.g+(i.colorCool.g-i.colorMid.g)*r,c=i.colorMid.b+(i.colorCool.b-i.colorMid.b)*r}return{r:Math.round(a),g:Math.round(s),b:Math.round(c)}}burstMatter(){const t=this.bhRadius*i.diskInnerRadius,e=this.bhRadius*i.diskOuterRadius,o=Math.random()*Math.PI*2;for(let n=0;n<100;n++){const a=Math.pow(Math.random(),.5),s=t+(e-t)*a,c=o+(Math.random()-.5)*.5,r=O(s,i.bhMass,i.baseOrbitalSpeed,e),M=(Math.random()-.5)*this.bhRadius*i.diskThickness*2;this.diskParticles.push({angle:c,distance:s,yOffset:M,speed:r*(.8+Math.random()*.4),size:i.particleSizeMin+Math.random()*(i.particleSizeMax-i.particleSizeMin),baseColor:this.getHeatColor(s,t,e),age:0,maxAge:8+Math.random()*4})}this.diskParticles.length>3e3&&(this.diskParticles=this.diskParticles.slice(-2500))}update(t){super.update(t),this.time+=t,this.camera.update(t);for(let e=this.diskParticles.length-1;e>=0;e--){const o=this.diskParticles[e];o.angle+=o.speed*t,o.age!==void 0&&(o.age+=t,o.age>o.maxAge&&this.diskParticles.splice(e,1))}}render(){const t=this.ctx,e=this.width,o=this.height,n=e/2,a=o/2;t.fillStyle="rgba(0, 0, 0, 0.12)",t.fillRect(0,0,e,o),this.renderStarfield(t,n,a),this.renderDisk(t,n,a),this.renderBlackHole(t,n,a)}renderStarfield(t,e,o){const n=this.time;for(const a of this.stars){const s=this.camera.project(a.x,a.y,a.z);if(s.scale<=0)continue;let c=s.x,r=s.y;if(s.z>0&&this.lensingStrength>0){const f=G(c,r,i.lensEffectRadius,i.lensStrength*this.lensingStrength,i.lensFalloff,5);c=f.x,r=f.y}const M=Math.sqrt(c*c+r*r),u=this.bhRadius*i.occlusionRadius;if(M<u)continue;const p=e+c,l=o+r;if(p<-10||p>this.width+10||l<-10||l>this.height+10)continue;const g=.5+.5*Math.sin(n*a.twinkleSpeed+a.twinklePhase);if(g<.1)continue;const m=a.type.size*s.scale*a.type.brightness,d=Math.round(180+a.type.brightness*75);t.globalAlpha=g*.8,t.fillStyle=`rgb(${d}, ${d}, ${d})`,t.beginPath(),t.arc(p,l,Math.max(.5,m),0,Math.PI*2),t.fill()}t.globalAlpha=1}renderDisk(t,e,o){const n=[],a=Math.abs(Math.sin(this.camera.rotationX));for(const s of this.diskParticles){const c=Math.cos(s.angle)*s.distance,r=s.yOffset,M=Math.sin(s.angle)*s.distance,u=Math.cos(this.camera.rotationY),p=Math.sin(this.camera.rotationY);let l=c*u-M*p,h=c*p+M*u;const g=Math.cos(this.camera.rotationX),m=Math.sin(this.camera.rotationX);let d=r*g-h*m;h=r*m+h*g;const f=Math.sqrt(l*l+d*d),R=h>0;if(this.lensingStrength>0&&f<this.bhRadius*6){const z=this.bhRadius*1.8,w=Math.exp(-f/(this.bhRadius*1.8)),Y=w*1.2*this.lensingStrength,$=s.angle+this.camera.rotationY,H=Math.sin($)>0,D=1-a;if(f>0){let b=Y;!H&&R&&(b*=1-D*.6);const k=(f+z*b)/f;l*=k,d*=k}if(a>.05){const b=this.bhRadius*5,k=l/b,P=Math.max(0,Math.cos(k*Math.PI*.5)),F=R?Math.min(1,h/(this.bhRadius*3)):Math.min(1,Math.abs(h)/(this.bhRadius*3)),y=this.bhRadius*2*w*F*a;R?H?d-=y*P:d+=y*P*.5:d+=y*P*.4}}const S=this.camera.perspective/(this.camera.perspective+h);if(h<-this.camera.perspective+10)continue;const I=l*S,A=d*S,X=1+Math.cos(s.angle+this.camera.rotationY)*.4;let v=1;if(s.age!==void 0){const z=s.age/s.maxAge;v=1-Math.pow(z,2)}n.push({x:I,y:A,z:h,scale:S,color:s.baseColor,doppler:X,alpha:v,size:s.size})}n.sort((s,c)=>c.z-s.z);for(const s of n){const{r:c,g:r,b:M}=s.color,u=this.baseScale*i.particleScale*s.scale*s.size;if(u<.1)continue;const p=Math.min(255,Math.round(c*s.doppler)),l=Math.min(255,Math.round(r*s.doppler)),h=Math.min(255,Math.round(M*s.doppler)),g=Math.max(0,Math.min(1,s.alpha*s.doppler*.8));t.fillStyle=`rgba(${p}, ${l}, ${h}, ${g})`,t.beginPath(),t.arc(e+s.x,o+s.y,u,0,Math.PI*2),t.fill(),s.doppler>1.1&&s.alpha>.5&&(t.globalCompositeOperation="screen",t.fillStyle=`rgba(${p}, ${l}, ${h}, ${g*.3})`,t.beginPath(),t.arc(e+s.x,o+s.y,u*1.5,0,Math.PI*2),t.fill(),t.globalCompositeOperation="source-over")}}renderBlackHole(t,e,o){}}function W(C){const t=new L(C);return t.start(),{stop:()=>t.stop(),game:t}}export{W as default};
