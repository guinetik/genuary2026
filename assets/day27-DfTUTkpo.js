import{G as A,P as F}from"./gcanvas.es-DYEWWlgH.js";const S=Math.PI*2,l={coreRadius:40,coreGlow:120,ribbonStartCount:2,ribbonMaxCount:12,ribbonSegments:80,ribbonWidth:6,ribbonOrbitRadius:100,ribbonSpeedMultiplier:5,foodParticlesPerClick:10,foodDriftSpeed:60,foodAbsorbRadius:50,complexityPerParticle:.002,gasCloudParticles:120,gasCloudSpeed:.5,shieldRadiusMin:120,shieldRadiusMax:180,membraneDeformRadius:120,membraneDeformStrength:45,particleCount:150,particleRadius:180,starCount:300,timeScale:.4,ribbonPokeRadius:100,ribbonPokeStrength:800,ribbonReturnSpeed:2,ribbonDamping:.95,complexityDecayRate:.003,vitalityDecayRate:.05,vitalityRecoveryRate:.3,nebulaCount:5,nebulaMinSize:150,nebulaMaxSize:300,nebulaAlpha:.08};function P(R,t,s,o){const e=Math.cos(o),i=Math.sin(o);return{x:R*e+s*i,y:t,z:-R*i+s*e}}function w(R,t,s,o){const e=Math.cos(o),i=Math.sin(o);return{x:R,y:t*e-s*i,z:t*i+s*e}}function q(R,t,s,o){const e=Math.cos(o),i=Math.sin(o);return{x:R*e-t*i,y:R*i+t*e,z:s}}class T extends A{constructor(t){super(t),this.backgroundColor="#000"}init(){super.init(),F.init(this.ctx),this.time=0,this.rotationY=0,this.rotationX=.3,this.hue=Math.random()*360,this.ribbons=[],this.complexity=0,this.vitality=1;for(let s=0;s<l.ribbonStartCount;s++){const o=this.createRibbon(!1);o.growth=1,this.ribbons.push(o)}this.foodParticles=[],this.currentFoodHue=Math.random()*360,this.lastFeedTime=0,this.gasCloud=[];for(let s=0;s<l.gasCloudParticles;s++)this.gasCloud.push(this.createGasParticle());this.particles=[];for(let s=0;s<l.particleCount;s++){const o=Math.random()*S,e=Math.acos(2*Math.random()-1),i=l.particleRadius*(.5+Math.random()*.5);this.particles.push({x:i*Math.sin(e)*Math.cos(o),y:i*Math.sin(e)*Math.sin(o),z:i*Math.cos(e),vx:0,vy:0,vz:0,orbitRadius:i,size:1+Math.random()*2,twinkleSpeed:1+Math.random()*2,twinklePhase:Math.random()*S,orbitSpeed:(.2+Math.random()*.3)*(Math.random()<.5?1:-1),orbitAxis:{x:Math.random()-.5,y:Math.random()-.5,z:Math.random()-.5}})}this.nebulae=[];for(let s=0;s<l.nebulaCount;s++){const o=Math.random()*S,e=Math.acos(2*Math.random()-1),i=400+Math.random()*200;this.nebulae.push({x:i*Math.sin(e)*Math.cos(o),y:i*Math.sin(e)*Math.sin(o),z:i*Math.cos(e),size:l.nebulaMinSize+Math.random()*(l.nebulaMaxSize-l.nebulaMinSize),hue:Math.random()*360,drift:(Math.random()-.5)*.1,pulse:Math.random()*S,pulseSpeed:.2+Math.random()*.3})}this.stars=[];const t=800;for(let s=0;s<l.starCount;s++){const o=Math.random()*S,e=Math.acos(2*Math.random()-1);this.stars.push({x:t*Math.sin(e)*Math.cos(o),y:t*Math.sin(e)*Math.sin(o),z:t*Math.cos(e),size:.5+Math.random()*1.5,brightness:.3+Math.random()*.7,twinkleSpeed:.5+Math.random()*2,twinklePhase:Math.random()*S})}this.mouseX=this.width/2,this.mouseY=this.height/2,this.mouseActive=!1,this.membraneDeform={x:this.width/2,y:this.height/2,intensity:0,vx:0,vy:0,vIntensity:0},this.corePulse=0,this.lastFoodHue=this.hue,this.isDragging=!1,this.lastMouseX=0,this.lastMouseY=0,this.velocityX=0,this.velocityY=.1,this.canvas.addEventListener("mousedown",s=>{this.isDragging=!0,this.lastMouseX=s.clientX,this.lastMouseY=s.clientY}),this.canvas.addEventListener("mouseenter",()=>{this.mouseActive=!0}),this.canvas.addEventListener("mousemove",s=>{const o=this.canvas.getBoundingClientRect();if(this.mouseX=s.clientX-o.left,this.mouseY=s.clientY-o.top,this.mouseActive=!0,this.isDragging){const e=s.clientX-this.lastMouseX,i=s.clientY-this.lastMouseY;this.velocityY=e*.005,this.velocityX=i*.005,this.lastMouseX=s.clientX,this.lastMouseY=s.clientY}}),this.canvas.addEventListener("mouseup",()=>{this.isDragging=!1}),this.canvas.addEventListener("mouseleave",()=>{this.isDragging=!1,this.velocityY=.1,this.mouseX=this.width/2,this.mouseY=this.height/2,this.mouseActive=!1}),this.canvas.addEventListener("click",s=>{const o=this.canvas.getBoundingClientRect(),e=s.clientX-o.left,i=s.clientY-o.top,a=this.width/2,n=this.height/2;if(Math.sqrt((e-a)**2+(i-n)**2)>this.getShieldRadius()){let c=null;for(const u of this.nebulae){if(u.screenX===void 0)continue;const d=e-u.screenX,b=i-u.screenY;if(Math.sqrt(d*d+b*b)<u.screenSize*.8){c=u;break}}this.spawnFood(e,i,c)}})}update(t){if(super.update(t),this.time+=t*l.timeScale,this.rotationX+=this.velocityX,this.rotationY+=this.velocityY,this.isDragging||(this.velocityX*=.95,this.velocityY*=.95,Math.abs(this.velocityY)<.001&&Math.abs(this.velocityX)<.001&&(this.velocityY=.002)),this.updateFood(t),this.complexity>0){this.complexity-=l.complexityDecayRate*t,this.complexity=Math.max(0,this.complexity);const s=l.ribbonStartCount+Math.floor(this.complexity);let o=this.ribbons.filter(e=>e.targetGrowth===1).length;for(;o>s&&o>l.ribbonStartCount;)for(let e=this.ribbons.length-1;e>=0;e--)if(this.ribbons[e].targetGrowth===1){this.ribbons[e].targetGrowth=0,o--;break}}if(this.complexity===0&&this.ribbons.filter(s=>s.targetGrowth===1).length<=l.ribbonStartCount){if(this.vitality-=l.vitalityDecayRate*t,this.vitality=Math.max(0,this.vitality),this.vitality<.5&&this.ribbons.filter(o=>o.targetGrowth===1).length>1){for(let o=this.ribbons.length-1;o>=0;o--)if(this.ribbons[o].targetGrowth===1){this.ribbons[o].targetGrowth=0;break}}if(this.vitality<.2)for(const s of this.ribbons)s.targetGrowth=0}this.updateRibbonGrowth(t),this.updateMembranePhysics(t),this.updateParticles(t),this.corePulse*=.92}updateRibbonGrowth(t){for(let s=this.ribbons.length-1;s>=0;s--){const o=this.ribbons[s];o.growth<o.targetGrowth?(o.growth+=o.growthSpeed*t,o.growth=Math.min(o.growth,o.targetGrowth)):o.growth>o.targetGrowth&&(o.growth-=o.growthSpeed*.7*t,o.growth=Math.max(o.growth,o.targetGrowth),o.growth<=.01&&this.ribbons.splice(s,1))}}updateParticles(t){const s=80*this.vitality,o=30*(1-this.vitality);for(const e of this.particles){const i=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);if(i<1)continue;const a=e.x/i,n=e.y/i,r=e.z/i;if(this.vitality>.2){const d=e.orbitRadius*(.8+this.vitality*.4),b=(i-d)*2*t;e.vx-=a*b*s*t,e.vy-=n*b*s*t,e.vz-=r*b*s*t;const f=e.orbitAxis.y*r-e.orbitAxis.z*n,h=e.orbitAxis.z*a-e.orbitAxis.x*r,y=e.orbitAxis.x*n-e.orbitAxis.y*a,m=Math.sqrt(f*f+h*h+y*y)||1;e.vx+=f/m*e.orbitSpeed*this.vitality*t*50,e.vy+=h/m*e.orbitSpeed*this.vitality*t*50,e.vz+=y/m*e.orbitSpeed*this.vitality*t*50}else e.vx+=a*o*t,e.vy+=n*o*t+10*t,e.vz+=r*o*t;e.vx*=.98,e.vy*=.98,e.vz*=.98,e.x+=e.vx*t,e.y+=e.vy*t,e.z+=e.vz*t;const c=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),u=l.particleRadius*2.5;if(c>u){const d=u/c;e.x*=d,e.y*=d,e.z*=d,e.vx*=-.3,e.vy*=-.3,e.vz*=-.3}}}updateMembranePhysics(t){const s=this.width/2,o=this.height/2,e=this.membraneDeform,i=this.getShieldRadius(),a=this.mouseX-s,n=this.mouseY-o,r=Math.sqrt(a*a+n*n);this.mouseActive&&r>i*.5&&r<i*1.5?(e.x=this.mouseX,e.y=this.mouseY,e.intensity=1,e.vx=0,e.vy=0,e.vIntensity=0):(e.vx+=(s-e.x)*5*t,e.vy+=(o-e.y)*5*t,e.vIntensity+=(0-e.intensity)*4*t,e.vx*=.92,e.vy*=.92,e.vIntensity*=.85,e.x+=e.vx,e.y+=e.vy,e.intensity+=e.vIntensity),e.intensity=Math.max(-.5,Math.min(1.5,e.intensity))}updateFood(t){const s=this.width/2,o=this.height/2;for(let e=this.foodParticles.length-1;e>=0;e--){const i=this.foodParticles[e],a=s-i.x,n=o-i.y,r=Math.sqrt(a*a+n*n);if(r>1){const c=a/r*l.foodDriftSpeed,u=n/r*l.foodDriftSpeed;i.vx+=c*t,i.vy+=u*t}i.vx*=.98,i.vy*=.98,i.x+=i.vx*t,i.y+=i.vy*t,r<this.getShieldRadius()&&(i.size*=.97,i.alpha*=.98),(r<l.foodAbsorbRadius||i.size<1||i.alpha<.05)&&(this.corePulse=Math.min(this.corePulse+.3,1),this.lastFoodHue=i.hue,this.foodParticles.splice(e,1),this.onFoodAbsorbed())}}onFoodAbsorbed(){if(this.vitality+=l.vitalityRecoveryRate,this.vitality=Math.min(1,this.vitality),this.ribbons.length<l.ribbonStartCount&&this.ribbons.push(this.createRibbon(!1)),this.complexity+=l.complexityPerParticle,this.ribbons.length<l.ribbonMaxCount){const t=l.ribbonStartCount+Math.floor(this.complexity);this.ribbons.length<t&&this.ribbons.push(this.createRibbon(!0))}for(const t of this.ribbons)t.speed=Math.min(t.speed*1.001,1.2)}createRibbon(t=!1){const s=[];for(let o=0;o<=l.ribbonSegments;o++)s.push({offsetX:0,offsetY:0,velocityX:0,velocityY:0});return t?{tiltX:(Math.random()-.5)*3,tiltZ:(Math.random()-.5)*3,phase:Math.random()*S,speed:.3+Math.random()*.7,radius:l.ribbonOrbitRadius*(.5+Math.random()*.7),freqA:1+Math.floor(Math.random()*4),freqB:1+Math.floor(Math.random()*5),freqC:1+Math.floor(Math.random()*4),deformState:s,growth:0,targetGrowth:1,growthSpeed:.8+Math.random()*.4}:{tiltX:(Math.random()-.5)*1.5,tiltZ:(Math.random()-.5)*1.5,phase:Math.random()*S,speed:.2+Math.random()*.3,radius:l.ribbonOrbitRadius*(.8+Math.random()*.4),freqA:1,freqB:2,freqC:1,deformState:s,growth:0,targetGrowth:1,growthSpeed:.6+Math.random()*.3}}spawnFood(t,s,o=null){const e=performance.now();o?this.currentFoodHue=o.hue:e-this.lastFeedTime>500&&(this.currentFoodHue=Math.random()*360),this.lastFeedTime=e;for(let i=0;i<l.foodParticlesPerClick;i++){const a=Math.random()*S,n=Math.random()*20,r=t+Math.cos(a)*n,c=s+Math.sin(a)*n;this.foodParticles.push({x:r,y:c,size:3+Math.random()*5,alpha:.5+Math.random()*.4,hue:this.currentFoodHue+(Math.random()-.5)*15,vx:0,vy:0})}}getShieldRadius(){const t=l.ribbonMaxCount-l.ribbonStartCount,s=Math.min(this.complexity/t,1);return l.shieldRadiusMin+s*(l.shieldRadiusMax-l.shieldRadiusMin)}resetRibbonDeform(){for(const t of this.ribbons)for(const s of t.deformState)s.velocityX=0,s.velocityY=0,s.offsetX=0,s.offsetY=0}createGasParticle(t=!0){const s=Math.random()*S,o=Math.acos(2*Math.random()-1),e=this.getShieldRadius()*(.9+Math.random()*.3);return{theta:s,phi:o,radius:e,life:t?Math.random():0,maxLife:1,size:25+Math.random()*40,baseAlpha:.05+Math.random()*.06,speed:25+Math.random()*35,drift:(Math.random()-.5)*.3}}render(){const t=this.ctx,s=this.width,o=this.height,e=s/2,i=o/2;t.fillStyle="#010208",t.fillRect(0,0,s,o),this.renderNebulae(t,s,o),this.renderStars(t,s,o),this.renderFood(t),this.renderGasCloud(t,e,i);const a=t.createRadialGradient(e,i,0,e,i,l.coreGlow*2);a.addColorStop(0,`hsla(${this.hue}, 70%, 70%, 0.15)`),a.addColorStop(.5,`hsla(${this.hue}, 60%, 50%, 0.05)`),a.addColorStop(1,"transparent"),t.fillStyle=a,t.fillRect(0,0,s,o),this.renderShield(t,e,i,!1),this.renderParticles(t,e,i),this.renderRibbons(t,e,i),this.renderCore(t,e,i),this.renderShield(t,e,i,!0)}renderNebulae(t,s,o){const e=s/2,i=o/2,a=this.time;for(const n of this.nebulae){const r=w(n.x,n.y,n.z,this.rotationX),c=P(r.x,r.y,r.z,this.rotationY);if(c.z<100)continue;const u=600/c.z,d=e+c.x*u,b=i+c.y*u,f=n.size*u;if(d<-f||d>s+f||b<-f||b>o+f)continue;const h=.8+.2*Math.sin(a*n.pulseSpeed+n.pulse),y=l.nebulaAlpha*h,m=3;for(let p=0;p<m;p++){const M=f*(.6+p*.3),g=y*(1-p*.3),C=Math.sin(a*.1+p+n.pulse)*f*.1,v=Math.cos(a*.08+p+n.pulse)*f*.1,z=t.createRadialGradient(d+C,b+v,0,d+C,b+v,M);z.addColorStop(0,`hsla(${n.hue+p*15}, 60%, 50%, ${g})`),z.addColorStop(.3,`hsla(${n.hue+p*10}, 50%, 40%, ${g*.5})`),z.addColorStop(.6,`hsla(${n.hue}, 40%, 30%, ${g*.2})`),z.addColorStop(1,"transparent"),t.fillStyle=z,t.beginPath(),t.arc(d+C,b+v,M,0,S),t.fill()}n.screenX=d,n.screenY=b,n.screenSize=f}}renderStars(t,s,o){const e=this.time,i=s/2,a=o/2;for(const n of this.stars){const r=w(n.x,n.y,n.z,this.rotationX),c=P(r.x,r.y,r.z,this.rotationY);if(c.z<0)continue;const u=i+c.x*(s/800),d=a+c.y*(o/800);if(u<0||u>s||d<0||d>o)continue;const b=.5+.5*Math.sin(e*n.twinkleSpeed+n.twinklePhase),f=n.brightness*(.4+b*.6),h=n.twinklePhase,y=200+Math.sin(h)*55,m=210+Math.sin(h+1)*45,p=230+Math.sin(h+2)*25;t.fillStyle=`rgba(${Math.floor(y)}, ${Math.floor(m)}, ${Math.floor(p)}, ${f})`,t.beginPath(),t.arc(u,d,n.size,0,S),t.fill(),n.brightness>.6&&n.size>1&&(t.fillStyle=`rgba(${Math.floor(y)}, ${Math.floor(m)}, ${Math.floor(p)}, ${f*.2})`,t.beginPath(),t.arc(u,d,n.size*3,0,S),t.fill())}}renderCore(t,s,o){const e=this.corePulse,i=this.vitality;if(i<.3){const h=l.coreRadius*.8,y=.15+i/.3*.15,m=t.createRadialGradient(s,o,0,s,o,h);m.addColorStop(0,"transparent"),m.addColorStop(.5,"transparent"),m.addColorStop(.7,`hsla(${this.hue}, 30%, 40%, ${y*.5})`),m.addColorStop(.85,`hsla(${this.hue}, 40%, 50%, ${y})`),m.addColorStop(1,"transparent"),t.fillStyle=m,t.beginPath(),t.arc(s,o,h,0,S),t.fill();const p=t.createRadialGradient(s,o,h*.8,s,o,h*2);p.addColorStop(0,"transparent"),p.addColorStop(.3,`hsla(${this.hue}, 30%, 35%, ${y*.3})`),p.addColorStop(.6,`hsla(${this.hue}, 25%, 30%, ${y*.15})`),p.addColorStop(1,"transparent"),t.fillStyle=p,t.beginPath(),t.arc(s,o,h*2,0,S),t.fill();return}const a=l.coreGlow*(1+e*.5)*(.3+i*.7),n=l.coreRadius*(1+e*.3)*(.5+i*.5),r=30+i*70,c=20+i*60,u=.2+i*.8,d=t.createRadialGradient(s,o,0,s,o,a);if(d.addColorStop(0,`rgba(255, 255, 255, ${u})`),d.addColorStop(.2,`hsla(${this.hue}, ${c}%, ${r}%, ${.8*u})`),d.addColorStop(.4,`hsla(${this.hue}, ${c*.9}%, ${r*.6}%, ${.4*u})`),d.addColorStop(.7,`hsla(${this.hue}, ${c*.8}%, ${r*.5}%, ${.1*u})`),d.addColorStop(1,"transparent"),t.fillStyle=d,t.beginPath(),t.arc(s,o,a,0,S),t.fill(),e>.05){const h=t.createRadialGradient(s,o,0,s,o,a*.8);h.addColorStop(0,`hsla(${this.lastFoodHue}, 80%, 70%, ${e*.6})`),h.addColorStop(.5,`hsla(${this.lastFoodHue}, 70%, 50%, ${e*.3})`),h.addColorStop(1,"transparent"),t.fillStyle=h,t.beginPath(),t.arc(s,o,a*.8,0,S),t.fill()}const b=t.createRadialGradient(s,o,0,s,o,n),f=Math.floor(100+i*155);b.addColorStop(0,`rgba(${f}, ${f}, ${f}, ${u})`),b.addColorStop(.4,`hsla(${this.hue}, ${c}%, ${r}%, ${.8*u})`),b.addColorStop(.7,`hsla(${this.hue}, ${c*.9}%, ${r*.7}%, ${.3*u})`),b.addColorStop(1,"transparent"),t.fillStyle=b,t.beginPath(),t.arc(s,o,n,0,S),t.fill()}renderRibbons(t,s,o){const e=this.time,i=1/60;for(const a of this.ribbons){if(a.growth<=.01)continue;const n=[];for(let h=0;h<=l.ribbonSegments;h++){const m=h/l.ribbonSegments*S+e*a.speed*l.ribbonSpeedMultiplier+a.phase;let p=Math.cos(m*a.freqA)*a.radius,M=Math.sin(m*a.freqB)*a.radius*.6,g=Math.sin(m*a.freqC)*a.radius*.8;const C=w(p,M,g,a.tiltX),v=q(C.x,C.y,C.z,a.tiltZ),z=w(v.x,v.y,v.z,this.rotationX),$=P(z.x,z.y,z.z,this.rotationY);n.push({x:$.x,y:$.y,z:$.z,t:h/l.ribbonSegments})}const r=a.growth,c=n.map((h,y)=>{const m=s+h.x,p=o+h.y,M=a.deformState[y];if(this.mouseActive){const G=m-this.mouseX,x=p-this.mouseY,Y=Math.sqrt(G*G+x*x),D=l.ribbonPokeRadius;if(Y<D&&Y>1){const k=Math.pow(1-Y/D,2)*l.ribbonPokeStrength*i;M.velocityX+=G/Y*k,M.velocityY+=x/Y*k}}M.velocityX-=M.offsetX*l.ribbonReturnSpeed*i,M.velocityY-=M.offsetY*l.ribbonReturnSpeed*i,M.velocityX*=l.ribbonDamping,M.velocityY*=l.ribbonDamping,M.offsetX+=M.velocityX*i,M.offsetY+=M.velocityY*i;let g=m+M.offsetX,C=p+M.offsetY;const v=g-s,z=C-o,$=Math.sqrt(v*v+z*z),X=this.getShieldRadius()-10;return $>X&&(g=s+v/$*X,C=o+z/$*X,M.offsetX=g-m,M.offsetY=C-p,M.velocityX*=-.3,M.velocityY*=-.3),{x:g,y:C,z:h.z}});t.lineCap="round",t.lineJoin="round";const u=c.length-1,d=Math.floor(r*u),b=r>=.99?u:Math.min(d,Math.floor(u*.4)),f=r>=.99?0:Math.max(0,d-b);for(let h=3;h>=0;h--){const y=l.ribbonWidth+h*6,m=h===0?.9:.15/(h+1);t.strokeStyle=`hsla(${this.hue}, 70%, 65%, ${m})`,t.lineWidth=y,t.beginPath();let p=!1;for(let M=f;M<=d&&M<c.length;M++){const g=c[M];p?t.lineTo(g.x,g.y):(t.moveTo(g.x,g.y),p=!0)}t.stroke()}t.globalCompositeOperation="lighter";for(let h=f;h<d&&h<c.length-1;h++){const y=c[h],m=c[h+1];if(n[h].z>0){const p=n[h].z/a.radius*.5;t.strokeStyle=`rgba(255, 255, 255, ${p})`,t.lineWidth=l.ribbonWidth*.5,t.beginPath(),t.moveTo(y.x,y.y),t.lineTo(m.x,m.y),t.stroke()}}t.globalCompositeOperation="source-over"}}renderParticles(t,s,o){const e=this.time;t.globalCompositeOperation="lighter";for(const i of this.particles){const a=w(i.x,i.y,i.z,this.rotationX),n=P(a.x,a.y,a.z,this.rotationY),r=s+n.x,c=o+n.y,u=.3+.7*(.5+.5*Math.sin(e*i.twinkleSpeed+i.twinklePhase)),d=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z),b=.3+.7*((n.z+d)/(d*2+1)),f=u*b*.6;t.fillStyle=`hsla(${this.hue}, 70%, 75%, ${f})`,t.beginPath(),t.arc(r,c,i.size,0,S),t.fill()}t.globalCompositeOperation="source-over"}renderFood(t){t.globalCompositeOperation="lighter";for(const s of this.foodParticles){const o=t.createRadialGradient(s.x,s.y,0,s.x,s.y,s.size);o.addColorStop(0,`hsla(${s.hue}, 80%, 60%, ${s.alpha})`),o.addColorStop(.4,`hsla(${s.hue}, 70%, 50%, ${s.alpha*.5})`),o.addColorStop(1,"transparent"),t.fillStyle=o,t.beginPath(),t.arc(s.x,s.y,s.size,0,S),t.fill()}t.globalCompositeOperation="source-over"}renderGasCloud(t,s,o){if(this.vitality<.1)return;const e=1/60;t.globalCompositeOperation="lighter";for(let i=0;i<this.gasCloud.length;i++){const a=this.gasCloud[i];if(a.life+=e*l.gasCloudSpeed,a.radius+=a.speed*e,a.theta+=a.drift*e,a.life>=a.maxLife){this.gasCloud[i]=this.createGasParticle(!1);continue}const n=a.life/a.maxLife,r=Math.min(n*4,1),c=1-Math.pow(n,2),u=r*c;let d=a.radius*Math.sin(a.phi)*Math.cos(a.theta),b=a.radius*Math.sin(a.phi)*Math.sin(a.theta),f=a.radius*Math.cos(a.phi);const h=w(d,b,f,this.rotationX),y=P(h.x,h.y,h.z,this.rotationY),m=s+y.x,p=o+y.y,M=.4+.6*((y.z+a.radius)/(a.radius*2)),g=a.baseAlpha*u*M*this.vitality,C=a.size*(1+n*.8),v=t.createRadialGradient(m,p,0,m,p,C);v.addColorStop(0,`hsla(${this.hue}, 70%, 70%, ${g})`),v.addColorStop(.3,`hsla(${this.hue}, 60%, 55%, ${g*.6})`),v.addColorStop(.6,`hsla(${this.hue}, 50%, 45%, ${g*.25})`),v.addColorStop(1,"transparent"),t.fillStyle=v,t.beginPath(),t.arc(m,p,C,0,S),t.fill()}t.globalCompositeOperation="source-over"}getMembraneDeform(t,s,o,e){const i=this.membraneDeform;if(Math.abs(i.intensity)<.01)return{x:0,y:0};const a=t-i.x,n=s-i.y,r=Math.sqrt(a*a+n*n),c=l.membraneDeformRadius;if(r>c)return{x:0,y:0};const d=Math.cos(r/c*Math.PI*.5)*l.membraneDeformStrength*i.intensity,b=t-o,f=s-e,h=Math.sqrt(b*b+f*f)||1;return{x:b/h*d,y:f/h*d}}renderShield(t,s,o,e){const i=this.getShieldRadius();t.globalCompositeOperation="lighter";const a=8;for(let r=1;r<a;r++){const c=r/a*Math.PI,u=Math.sin(c)*i,d=Math.cos(c)*i,b=48;t.beginPath();let f=!1;for(let y=0;y<=b;y++){const m=y/b*S;let p=Math.cos(m)*u,M=Math.sin(m)*u;const C=w(p,M,d,this.rotationX),v=P(C.x,C.y,C.z,this.rotationY);if(e&&v.z<0){f=!1;continue}if(!e&&v.z>=0){f=!1;continue}let z=s+v.x,$=o+v.y;const X=this.getMembraneDeform(z,$,s,o);z+=X.x,$+=X.y,f?t.lineTo(z,$):(t.moveTo(z,$),f=!0)}const h=Math.sin(c)*.3;t.strokeStyle=`hsla(${this.hue}, 60%, 65%, ${h})`,t.lineWidth=1,t.stroke()}const n=12;for(let r=0;r<n;r++){const c=r/n*S,u=32;t.beginPath();let d=!1;for(let b=0;b<=u;b++){const f=b/u*Math.PI;let h=Math.sin(f)*Math.cos(c)*i,y=Math.sin(f)*Math.sin(c)*i,m=Math.cos(f)*i;const p=w(h,y,m,this.rotationX),M=P(p.x,p.y,p.z,this.rotationY);if(e&&M.z<0){d=!1;continue}if(!e&&M.z>=0){d=!1;continue}let g=s+M.x,C=o+M.y;const v=this.getMembraneDeform(g,C,s,o);g+=v.x,C+=v.y,d?t.lineTo(g,C):(t.moveTo(g,C),d=!0)}t.strokeStyle=`hsla(${this.hue}, 60%, 65%, 0.2)`,t.lineWidth=1,t.stroke()}if(e){const r=t.createRadialGradient(s,o,i*.7,s,o,i*1.1);r.addColorStop(0,"transparent"),r.addColorStop(.7,`hsla(${this.hue}, 60%, 65%, 0.05)`),r.addColorStop(.9,`hsla(${this.hue}, 60%, 65%, 0.15)`),r.addColorStop(1,"transparent"),t.fillStyle=r,t.beginPath(),t.arc(s,o,i*1.1,0,S),t.fill()}t.globalCompositeOperation="source-over"}}function I(R){const t=new T(R);return t.start(),{stop:()=>t.stop(),game:t}}export{I as default};
