import{G as M,N as f,C as y,c as S,U as m,b as w,P as v,M as R,E as b}from"./index-B0ivFyqO.js";const s={background:"#000",trailAlpha:.08,hueBase:135,hueRange:20,perspective:800,initialRotationX:0,initialRotationY:0,radiusRatio:.42,rings:32,slices:64,waves:18,waves2:7,exponent:3.2,flow:4,speed:.8,noiseScale:.008,noiseSpeed:.3,noiseStrengthBase:15,noiseStrengthMax:80,energyKick:.4,energyDecay:.92,amplitudeRatioBase:.22,amplitudeRatioMax:.4,lineWidth:.8,maxParticles:2e3,excitationRate:30,excitationLifetime:{min:2.5,max:5},excitationSize:{min:1.5,max:3},excitationSpeed:120,excitationDamping:.98},k=Math.PI*2;function A(g,t,e){return Math.max(t,Math.min(e,g))}class D extends M{constructor(t){super(t),this.backgroundColor=s.background}init(){var e;super.init(),this.time=0,this.energy=0,this.seed=Math.floor(Math.random()*65535),f.seed(this.seed),this._radius=Math.min(this.width,this.height)*s.radiusRatio,this._amplitudeBase=this._radius*s.amplitudeRatioBase,this._amplitudeMax=this._radius*s.amplitudeRatioMax,this.amplitude=this._amplitudeBase,this.noiseStrength=s.noiseStrengthBase,this.breath=1,this._exciteAccum=0,this._meshFrame=0,this.camera=new y({perspective:s.perspective,rotationX:s.initialRotationX,rotationY:s.initialRotationY,inertia:!0,friction:.95,clampX:!1,autoRotate:!0,autoRotateSpeed:.075,autoRotateAxis:"z"}),this.camera.enableMouseControl(this.canvas),this.camera.update(0),(e=this.camera._boundHandlers)!=null&&e.dblclick&&this.canvas.removeEventListener("dblclick",this.camera._boundHandlers.dblclick),this.initMesh(),this.particles=new S(this,{camera:this.camera,depthSort:!0,maxParticles:s.maxParticles,blendMode:"screen",updaters:[m.velocity,m.damping(s.excitationDamping),m.fadeOut,m.shrink(.3),m.lifetime]});const t=s.excitationSpeed;this.particles.addEmitter("excite",new w({rate:0,position:{x:0,y:0,z:0},velocity:{x:0,y:0,z:t*.5},velocitySpread:{x:t,y:t,z:t},lifetime:s.excitationLifetime,size:s.excitationSize,color:{r:0,g:255,b:0,a:1},shape:"circle"})),this.pipeline.add(this.particles),this._clickStart=null,this._onMouseDown=o=>{this._clickStart={x:o.clientX,y:o.clientY,time:Date.now()}},this._onMouseUp=o=>{if(!this._clickStart)return;const n=o.clientX-this._clickStart.x,i=o.clientY-this._clickStart.y,h=Math.sqrt(n*n+i*i),a=Date.now()-this._clickStart.time;h<5&&a<300&&(o.shiftKey?(this.seed=Math.floor(Math.random()*65535),f.seed(this.seed)):this.energy=Math.min(1,this.energy+s.energyKick)),this._clickStart=null},this.canvas.addEventListener("mousedown",this._onMouseDown),this.canvas.addEventListener("mouseup",this._onMouseUp)}cleanup(){this._onMouseDown&&this.canvas.removeEventListener("mousedown",this._onMouseDown),this._onMouseUp&&this.canvas.removeEventListener("mouseup",this._onMouseUp),this._onMouseDown=null,this._onMouseUp=null}initMesh(){const{rings:t,slices:e}=s,o=this._radius;this._verts=new Array((t+1)*e),this._edges=[],this._faces=[];for(let n=0;n<=t;n++){const i=n/t,h=i*o;for(let a=0;a<e;a++){const r=a/e*k,c=h*Math.cos(r),u=h*Math.sin(r),d=n*e+a;if(this._verts[d]={x:c,y:u,theta:r,rRatio:i},n<t){const l=d,p=(n+1)*e+a,_=n*e+(a+1)%e,x=(n+1)*e+(a+1)%e;this._edges.push([l,p]),this._edges.push([l,_]),this._faces.push([l,p,_]),this._faces.push([_,p,x])}}}}heightAt(t){if(!t)return 0;const e=t.rRatio??0,o=t.theta??0,n=Math.pow(e,s.exponent),i=o*s.waves+(e*s.flow-this.time*s.speed),h=Math.sin(i),a=o*s.waves2-(e*s.flow*.7+this.time*s.speed*1.3),r=Math.sin(a)*.4,c=o*(s.waves*2)+this.time*s.speed*.5,u=Math.sin(c)*.15*e,d=n*this.amplitude*(h+r+u),l=this.time*s.noiseSpeed,p=f.simplex3(t.x*s.noiseScale+l,t.y*s.noiseScale+l,e*2);return d+p*this.noiseStrength*n}clear(){v.useCtx(t=>{t.fillStyle=`rgba(0, 0, 0, ${s.trailAlpha})`,t.fillRect(0,0,this.width,this.height);const e=this.width,o=this.height,n=Math.max(e,o)*.75,i=t.createRadialGradient(e/2,o/2,n*.15,e/2,o/2,n);i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(1,"rgba(0, 0, 0, 0.28)"),t.fillStyle=i,t.fillRect(0,0,e,o)},{saveState:!0})}update(t){super.update(t),this.time+=t,this.camera.update(t),this.energy*=s.energyDecay,this.energy<.001&&(this.energy=0);const e=this._amplitudeBase+this.energy*(this._amplitudeMax-this._amplitudeBase),o=s.noiseStrengthBase+this.energy*(s.noiseStrengthMax-s.noiseStrengthBase),n=1-Math.pow(.02,t);this.amplitude+=(e-this.amplitude)*n,this.noiseStrength+=(o-this.noiseStrength)*n,this.breath=R.pulse(.92,1.08,this.time,3.2,!0,!0,b.smootherstep).value,this.emitExcitations(t)}emitExcitations(t){if(!this._verts||this._verts.length===0||this.energy<=0)return;this._exciteAccum+=s.excitationRate*this.energy*t;const e=Math.floor(this._exciteAccum);if(e<=0)return;this._exciteAccum-=e;const o=this.particles.particles.length;this.particles.burst(e,"excite");const n=this.particles.particles.length;for(let i=o;i<n;i++){const h=this.particles.particles[i],a=this._verts[Math.floor(Math.random()*this._verts.length)],r=this.heightAt(a)*this.breath;h.x=a.x,h.y=a.y,h.z=r,h.color.r=0,h.color.g=Math.floor(180+75*(1-a.rRatio*.4)),h.color.b=Math.floor(0+20*this.energy),h.color.a=.85}}render(){v.setContext(this.ctx),this.running&&this.clear(),this._meshFrame++,this._verts&&this._edges&&this._meshFrame%2===0&&this.renderMesh(),this.pipeline.render()}renderMesh(){const t=this.width/2,e=this.height/2,o=new Array(this._verts.length);for(let i=0;i<this._verts.length;i++){const h=this._verts[i],a=this.heightAt(h)*this.breath,r=this.camera.project(h.x,h.y,a);o[i]={x:r.x,y:r.y,z:a,rRatio:h.rRatio}}const n=[];for(const[i,h]of this._edges){const a=o[i],r=o[h];if(!a||!r||!Number.isFinite(a.x)||!Number.isFinite(r.x))continue;const c=(a.z+r.z)/2,u=(a.rRatio+r.rRatio)/2;n.push({p1:a,p2:r,avgZ:c,avgR:u})}n.sort((i,h)=>i.avgZ-h.avgZ),v.useCtx(i=>{i.save(),i.translate(t,e),i.lineWidth=s.lineWidth;for(const h of n){const{p1:a,p2:r,avgR:c,avgZ:u}=h,d=s.hueBase+c*s.hueRange,l=35+u*.1+c*15,p=90+c*10;i.globalAlpha=.4+c*.5,i.strokeStyle=`hsl(${d}, ${p}%, ${A(l,30,65)}%)`,i.beginPath(),i.moveTo(a.x,a.y),i.lineTo(r.x,r.y),i.stroke()}i.globalAlpha=1,i.restore()},{saveState:!0})}}function z(g){const t=new D(g);return t.start(),{stop:()=>{var e;(e=t.cleanup)==null||e.call(t),t.stop()},game:t}}export{z as default};
