import{G as I,P as B}from"./index-Qp5ATCeA.js";const M={colors:{bg:"#000"},segments:300,baseRadius:.6,growthDuration:8,hueSpeed:20,glowSize:40,cometLength:30};class E extends I{constructor(t){super(t),this.backgroundColor=M.colors.bg}init(){super.init(),B.init(this.ctx),this.container=this.canvas.parentElement,this.container&&this.enableFluidSize(this.container),this.time=0,this.mouseX=.5,this.mouseY=.5,this.size=.05,this.targetSize=.05,this.snakeLength=20,this.maxSnakeLength=350,this.isOuroboros=!1,this.ouroborosBlend=0,this.perfection=0,this.eatPulse=0,this.totalEaten=0,this.eatAngleOffset=0,this.coils=1,this.targetCoils=1,this.lungeOffset=0,this.targetLungeOffset=0,this.phaseOffset=0,this.currentRadius=0,this.hueOffset=Math.random()*360,this.screenFlash=0,this.particles=[],this.maxHistory=400,this.history=[];for(let t=0;t<this.maxHistory;t++)this.history.push({x:0,y:0});this.headX=0,this.headY=0,this.headAngle=0,this.targetX=0,this.targetY=0,this.canvas.addEventListener("mousemove",t=>{const s=this.canvas.getBoundingClientRect();this.mouseX=(t.clientX-s.left)/s.width,this.mouseY=(t.clientY-s.top)/s.height,this.targetX=(this.mouseX-.5)*1.4,this.targetY=(this.mouseY-.5)*1.4}),this.canvas.addEventListener("click",t=>{this.isOuroboros&&this.doEat(t)}),this.canvas.addEventListener("touchstart",t=>{t.preventDefault();const s=t.touches[0],i=this.canvas.getBoundingClientRect();this.mouseX=(s.clientX-i.left)/i.width,this.mouseY=(s.clientY-i.top)/i.height,this.targetX=(this.mouseX-.5)*1.4,this.targetY=(this.mouseY-.5)*1.4,this.isOuroboros&&this.doEat(s)}),this.canvas.addEventListener("touchmove",t=>{t.preventDefault();const s=t.touches[0],i=this.canvas.getBoundingClientRect();this.mouseX=(s.clientX-i.left)/i.width,this.mouseY=(s.clientY-i.top)/i.height,this.targetX=(this.mouseX-.5)*1.4,this.targetY=(this.mouseY-.5)*1.4})}doEat(){this.eatPulse=1,this.screenFlash=1,this.targetLungeOffset+=.5,this.targetCoils+=.08,this.totalEaten+=1;const t=this.getSnakePoint(1,this.time),s=this.projectPoint(t),i=this.width/2,n=this.height/2,o=Math.min(this.width,this.height)*.7,f=i+s.x*o,h=n+s.y*o;for(let l=0;l<25;l++){const e=Math.random()*Math.PI*2,a=100+Math.random()*200;this.particles.push({x:f,y:h,vx:Math.cos(e)*a,vy:Math.sin(e)*a,life:1,maxLife:1,hue:this.hueOffset+this.totalEaten*25+Math.random()*60,size:4+Math.random()*8})}}update(t){super.update(t),this.time+=t;const s=M.hueSpeed+this.totalEaten*3;this.hueOffset=(this.hueOffset+s*t)%360;const i=(this.maxSnakeLength-20)/M.growthDuration;if(!this.isOuroboros&&this.snakeLength<this.maxSnakeLength&&(this.snakeLength=Math.min(this.maxSnakeLength,this.snakeLength+t*i)),this.targetSize=Math.min(1,.05+this.snakeLength/this.maxSnakeLength*.95),this.size+=(this.targetSize-this.size)*.02,this.isOuroboros){this.ouroborosBlend=Math.min(1,this.ouroborosBlend+t*.8);const n=Math.min(1,this.totalEaten/15);this.perfection+=(n-this.perfection)*t*.5,this.lungeOffset+=(this.targetLungeOffset-this.lungeOffset)*t*5,this.coils+=(this.targetCoils-this.coils)*t*2;const o=M.baseRadius*this.size;this.currentRadius+=(o-this.currentRadius)*t*2}this.eatPulse>0&&(this.eatPulse=Math.max(0,this.eatPulse-t*3)),this.screenFlash>0&&(this.screenFlash=Math.max(0,this.screenFlash-t*4));for(let n=this.particles.length-1;n>=0;n--){const o=this.particles[n];o.x+=o.vx*t,o.y+=o.vy*t,o.vx*=.96,o.vy*=.96,o.life-=t*1.5,o.life<=0&&this.particles.splice(n,1)}if(!this.isOuroboros){const n=this.targetX-this.headX,o=this.targetY-this.headY;let h=Math.atan2(o,n)-this.headAngle;for(;h>Math.PI;)h-=Math.PI*2;for(;h<-Math.PI;)h+=Math.PI*2;this.headAngle+=h*.08;const l=Math.sin(this.time*8)*.4,e=this.headAngle+l,a=.012*(.5+this.size*.5);this.headX+=Math.cos(e)*a,this.headY+=Math.sin(e)*a,this.history.unshift({x:this.headX,y:this.headY});const r=Math.floor(this.snakeLength)+10;for(;this.history.length>r;)this.history.pop();if(this.snakeLength>=this.maxSnakeLength-10){const c=Math.min(Math.floor(this.snakeLength)-1,this.history.length-1),u=this.history[c];if(u&&Math.sqrt((this.headX-u.x)**2+(this.headY-u.y)**2)<.2){this.isOuroboros=!0;const g=Math.atan2(this.headY,this.headX),d=Math.PI*2*this.coils-this.time*.5;this.phaseOffset=g-d,this.currentRadius=Math.sqrt(this.headX**2+this.headY**2),this.lungeOffset=0,this.targetLungeOffset=0}}}}getSnakePoint(t,s){const i=t*Math.PI*2*this.coils-s*.5+this.phaseOffset+this.lungeOffset,n=1-this.perfection,o=this.isOuroboros?this.currentRadius:M.baseRadius*this.size,f=Math.sin(t*Math.PI*8*this.coils+s*2)*.05*this.size*n,h=o+f,l=Math.cos(i)*h,e=Math.sin(i)*h,a=i*2,r=Math.sin(a),c=Math.cos(a),u=1+r*r,p=h*1.4,g=p*c/u,d=p*r*c/u*.7,y=Math.max(0,Math.min(1,(this.perfection-.7)/.3)),m=y*y*(3-2*y),S=l*(1-m)+g*m,b=e*(1-m)+d*m,k=Math.floor((1-t)*Math.min(this.snakeLength,this.history.length-1)),P=this.history[Math.min(k,this.history.length-1)],$=P?P.x:0,C=P?P.y:0,O=this.ouroborosBlend,v=$*(1-O)+S*O,z=C*(1-O)+b*O,L=Math.sin(t*Math.PI*6*this.coils+s*1.5)*.08*this.size*O,X=Math.sin(i)*.15*this.size*O*m,Y=L*n+X;return{x:v,y:z,z:Y,t}}projectPoint(t){const s=this.ouroborosBlend,i=-(this.mouseX-.5)*Math.PI*2*s,n=Math.cos(i),o=Math.sin(i),f=t.x*n-t.z*o,h=t.x*o+t.z*n,l=-(this.mouseY-.5)*Math.PI*1.5*s,e=Math.cos(l),a=Math.sin(l),r=t.y*e-h*a,c=t.y*a+h*e,u=1/(1-c*.3*s);return{x:f*u,y:r*u,z:c}}render(){const t=this.ctx,s=this.width,i=this.height,n=s/2,o=i/2,f=Math.min(s,i)*.7;t.fillStyle="rgba(0, 0, 0, 0.12)",t.fillRect(0,0,s,i);const h=M.segments,l=[];for(let e=0;e<=h;e++){const a=e/h,r=this.getSnakePoint(a,this.time),c=this.projectPoint(r);l.push({x:n+c.x*f,y:o+c.y*f,z:c.z,t:a})}this.drawSnake(t,l),this.drawCometTail(t,l),this.drawHead(t,l),t.globalCompositeOperation="lighter";for(const e of this.particles){const a=e.life/e.maxLife,r=e.size*a,c=t.createRadialGradient(e.x,e.y,0,e.x,e.y,r*3);c.addColorStop(0,`hsla(${e.hue}, 100%, 70%, ${a})`),c.addColorStop(.5,`hsla(${e.hue}, 100%, 50%, ${a*.4})`),c.addColorStop(1,"transparent"),t.fillStyle=c,t.beginPath(),t.arc(e.x,e.y,r*3,0,Math.PI*2),t.fill()}if(t.globalCompositeOperation="source-over",this.screenFlash>0){const e=this.hueOffset+this.totalEaten*25;t.fillStyle=`hsla(${e}, 100%, 80%, ${this.screenFlash*.3})`,t.fillRect(0,0,s,i)}if(t.fillStyle="rgba(255, 255, 255, 0.4)",t.font="12px monospace",t.textAlign="center",this.isOuroboros){if(t.fillStyle="rgba(255, 255, 255, 0.3)",t.fillText("Click to consume • Drag to rotate",n,i-20),this.totalEaten>0){const e=this.hueOffset;t.fillStyle=`hsla(${e}, 80%, 60%, 0.6)`;const a=Math.floor(this.perfection*100);let r="Circle";this.perfection>=.95?r="∞ Infinity":this.perfection>=.7&&(r="Morphing..."),t.fillText(`Consumed: ${this.totalEaten} • ${r} (${a}%)`,n,30)}}else{const e=Math.floor(this.snakeLength/this.maxSnakeLength*100);if(e<97)t.fillText(`Growing... ${e}%`,n,i-20);else{t.fillText("NOW! Catch the tail!",n,i-20);const a=Math.min(Math.floor(this.snakeLength),this.history.length-1),r=this.history[a];if(r){const c=n+r.x*f,u=o+r.y*f,p=.6+Math.sin(this.time*6)*.4,g=135,d=t.createRadialGradient(c,u,0,c,u,40);d.addColorStop(0,`hsla(${g}, 100%, 70%, ${p})`),d.addColorStop(.5,`hsla(${g}, 100%, 50%, ${p*.5})`),d.addColorStop(1,"transparent"),t.fillStyle=d,t.beginPath(),t.arc(c,u,40,0,Math.PI*2),t.fill()}}}}drawSnake(t,s){if(s.length<2)return;const i=135,n=this.hueOffset+this.totalEaten*25;for(let o=1;o<s.length;o++){const f=s[o-1],h=s[o],l=o/s.length,e=2+l*14+this.totalEaten*.6,a=7+this.totalEaten*.4,r=e*(1-this.perfection)+a*this.perfection,c=1+Math.sin(this.time*2+l*10)*.1*(1-this.perfection),u=this.eatPulse*Math.sin(l*Math.PI*12+this.time*25)*.4,p=r*(c+u),g=.5+(h.z+.5)*.5,d=this.eatPulse*40,y=(n+l*80+Math.sin(this.time*2+l*8)*30)%360,m=i*(1-this.ouroborosBlend)+y*this.ouroborosBlend,S=100*(1-this.ouroborosBlend)+(85+l*15)*this.ouroborosBlend,b=(45+l*15)*(1-this.ouroborosBlend)+(35+l*25+d)*this.ouroborosBlend;t.globalCompositeOperation="lighter",t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(h.x,h.y),t.strokeStyle=`hsla(${m}, 100%, ${b}%, ${.25*g})`,t.lineWidth=p+12,t.lineCap="round",t.stroke(),t.globalCompositeOperation="source-over",t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(h.x,h.y),t.strokeStyle=`hsla(${m}, ${S}%, ${b+10}%, ${g})`,t.lineWidth=p,t.lineCap="round",t.stroke(),t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(h.x,h.y),t.strokeStyle=`hsla(${m}, ${S-10}%, ${Math.min(85,b+30)}%, ${.7*g})`,t.lineWidth=p*.35,t.lineCap="round",t.stroke()}this.drawScales(t,s)}drawScales(t,s){const i=Math.max(3,Math.floor(s.length/50)),n=135,o=this.hueOffset+this.totalEaten*25;t.globalCompositeOperation="lighter";for(let f=i;f<s.length-i;f+=i){const h=s[f],l=f/s.length,e=2+l*5,a=.5+(h.z+.5)*.5,r=(o+l*80)%360,c=n*(1-this.ouroborosBlend)+r*this.ouroborosBlend;t.beginPath(),t.arc(h.x,h.y,e,0,Math.PI*2),t.fillStyle=`hsla(${c+40*this.ouroborosBlend}, 80%, 65%, ${.35*a})`,t.fill()}t.globalCompositeOperation="source-over"}drawCometTail(t,s){if(s.length<M.cometLength)return;const i=135,n=this.hueOffset+this.totalEaten*25;t.globalCompositeOperation="lighter";for(let o=0;o<M.cometLength;o++){const f=s.length-1-o;if(f<0)break;const h=s[f],l=1-o/M.cometLength,e=M.glowSize*(.3+.7*l)*(1+this.eatPulse*.5),a=l*.4*(1+this.eatPulse),r=(n+60+o*2)%360,c=i*(1-this.ouroborosBlend)+r*this.ouroborosBlend,u=t.createRadialGradient(h.x,h.y,0,h.x,h.y,e);u.addColorStop(0,`hsla(${c}, 100%, 60%, ${a})`),u.addColorStop(.5,`hsla(${c+20*this.ouroborosBlend}, 100%, 50%, ${a*.3})`),u.addColorStop(1,"transparent"),t.fillStyle=u,t.beginPath(),t.arc(h.x,h.y,e,0,Math.PI*2),t.fill()}t.globalCompositeOperation="source-over"}drawHead(t,s){if(s.length<2)return;const i=Math.max(0,1-(this.perfection-.7)/.25);if(i<=0)return;const n=s[s.length-1],o=s[s.length-10]||s[s.length-2],f=Math.atan2(n.y-o.y,n.x-o.x),h=(16+this.totalEaten*.6)*(1-this.perfection)+(7+this.totalEaten*.4)*this.perfection,e=(.5+(n.z+.5)*.5)*i,a=135,r=this.hueOffset+this.totalEaten*25,c=(r+80)%360,u=a*(1-this.ouroborosBlend)+c*this.ouroborosBlend,p=60*(1-this.ouroborosBlend)+(60+this.eatPulse*40)*this.ouroborosBlend;t.save(),t.translate(n.x,n.y),t.rotate(f);const g=h*1.8,d=h*1.1;t.beginPath(),t.ellipse(g*.3,0,g,d,0,0,Math.PI*2),t.fillStyle=`hsla(${u}, 100%, ${p}%, ${e})`,t.fill(),t.beginPath(),t.ellipse(g*.2,0,g*.6,d*.6,0,0,Math.PI*2),t.fillStyle=`hsla(${u}, 90%, ${p+15}%, ${e*.6})`,t.fill();const y=(1.2+h*.04)*i,m=g*.4,S=d*.35;t.beginPath(),t.arc(m,-S,y,0,Math.PI*2),t.fillStyle=`hsla(50, 100%, 90%, ${e})`,t.fill(),t.beginPath(),t.ellipse(m,-S,y*.3,y*.6,0,0,Math.PI*2),t.fillStyle=`hsla(0, 0%, 5%, ${e})`,t.fill(),t.beginPath(),t.arc(m,S,y,0,Math.PI*2),t.fillStyle=`hsla(50, 100%, 90%, ${e})`,t.fill(),t.beginPath(),t.ellipse(m,S,y*.3,y*.6,0,0,Math.PI*2),t.fillStyle=`hsla(0, 0%, 5%, ${e})`,t.fill(),t.restore();const b=s[0],k=(r+120)%360,P=a*(1-this.ouroborosBlend)+k*this.ouroborosBlend;t.globalCompositeOperation="lighter";const $=t.createRadialGradient(b.x,b.y,0,b.x,b.y,20);$.addColorStop(0,`hsla(${P}, 100%, 60%, ${.5*i})`),$.addColorStop(1,"transparent"),t.fillStyle=$,t.beginPath(),t.arc(b.x,b.y,20,0,Math.PI*2),t.fill(),t.globalCompositeOperation="source-over"}}function T(w){const t=new E(w);return t.start(),{stop:()=>t.stop(),game:t}}export{T as default};
