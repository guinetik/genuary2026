import{G as p,P as w}from"./index-Qp5ATCeA.js";const o={cellSize:12,updateInterval:.08,colors:{bg:"#000",empty:"#0a0a0a",wire:"#0a0",wireHighlight:"#0f0",electronHead:"#fff",electronTail:"#0f0",text:"#0f0",textDim:"rgba(0, 255, 0, 0.5)"}},c=0,a=1,d=2,u=3,f=[{name:"CLOCK + DIODES",desc:"Oscillator feeding into one-way diodes",width:60,height:30,pattern:`
......................................................
......................................................
....HTWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW....
....W................................................W....
....W................................................W....
....W.....WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW......W....
....W.....W......................................W......W....
....W.....W......................................W......W....
....W.....W.....WWWWWWWWWWWWWWWWWWWWWWWWWWW......W......W....
....W.....W.....W..........................W......W......W....
....WWWWWWWWWWWWW..........................WWWWWWWWWWWWWWW....
......................................................
......................................................
`},{name:"XOR GATE",desc:"Two inputs, XOR logic output",width:50,height:25,pattern:`
..................................................
..................................................
.....WWWWWWWWWWWWWWWW.............................
.....W...............WWWWW........................
.....W...............W...WWWWWWWWWWWWWWWWWWWWWW...
.....W...............W...W....................W...
.....W..........WWWWWWWWWW....................W...
.....W..........W.....W.......................W...
.....WWWWWWWWWWWW.....W.......................W...
......................W.......................W...
......................W.......................W...
.....WWWWWWWWWWWW.....W.......................W...
.....W..........W.....W.......................W...
.....W..........WWWWWWWWWWW...................W...
.....W...............W...W....................W...
.....W...............W...WWWWWWWWWWWWWWWWWWWWWW...
.....W...............WWWWW........................
.....WWWWWWWWWWWWWWWW.............................
..................................................
`},{name:"SIGNAL RACE",desc:"Electrons race through parallel paths",width:70,height:20,pattern:`
......................................................................
......................................................................
....HTWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW....
..........W......................................................W....
..........W......................................................W....
..........WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW....
..........W......................................................W....
..........W......................................................W....
....WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW....
......................................................................
`},{name:"CLOCK PULSER",desc:"Simple 4-cycle clock generator",width:30,height:15,pattern:`
..............................
..............................
.....HTWW.....................
.....W..W.....................
.....W..WWWWWWWWWWWWWWWWWWW...
.....W..W.................W...
.....W..W.................W...
.....WWWW.................W...
..........................W...
..........................W...
..............................
`},{name:"BINARY COUNTER",desc:"Pulses generate counting pattern",width:80,height:35,pattern:`
................................................................................
................................................................................
.....HTW........................................................................
.....W.W........................................................................
.....W.WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW.....
.....W.W.....................................................................W.....
.....W.W.....................................................................W.....
.....W.W........WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW...W.....
.....W.W........W........................................................W...W.....
.....W.W........W........................................................W...W.....
.....W.W........W.......WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW...W...W.....
.....W.W........W.......W............................................W...W...W.....
.....W.W........W.......W............................................W...W...W.....
.....W.W........W.......W......WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW...W...W...W.....
.....W.W........W.......W......W..................................W...W...W...W.....
.....W.W........W.......W......W..................................W...W...W...W.....
.....W.WWWWWWWWWWWWWWWWWWWWWWWWWW..................................W...W...W...W.....
.....W.W........W.......W......W..................................W...W...W...W.....
.....WWW........W.......W......W..................................W...W...W...W.....
................W.......W......WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW.....
................W.......W............................................W...W...W.....
................W.......WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW.....
................W........................................................W...W.....
................WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW.....
.....................................................................W...W.....
.....................................................................WWWWW.....
................................................................................
`},{name:"NEURON NETWORK",desc:"Interconnected oscillators",width:60,height:40,pattern:`
............................................................
............................................................
.....HTW....................................................
.....W.W....................................................
.....W.WWWWWWWWWWWWWWWWWWWWWWWWWWWWWW......................
.....W.W............................W......................
.....WWW............................W......................
................................WWWWWWWWW...................
................................W.......W...................
.....HTW........................W.......W...................
.....W.W........................W.......WWWWWWWWWWWWWWWWW...
.....W.WWWWWWWWWWWWWWWWWWWWWWWWWW.......W...............W...
.....W.W............................W...W...............W...
.....WWW............................W...W...............W...
................................WWWWW...W...............W...
................................W.......W...............W...
.....HTW........................W.......W...............W...
.....W.W........................W.......WWWWWWWWWWWWWWWWW...
.....W.WWWWWWWWWWWWWWWWWWWWWWWWWW.......W...................
.....W.W............................W...W...................
.....WWW............................WWWWW...................
............................................................
............................................................
`}];class m{constructor(W,t){this.width=W,this.height=t,this.cells=new Uint8Array(W*t)}index(W,t){return t*this.width+W}get(W,t){return W<0||W>=this.width||t<0||t>=this.height?c:this.cells[this.index(W,t)]}set(W,t,e){W<0||W>=this.width||t<0||t>=this.height||(this.cells[this.index(W,t)]=e)}countHeadNeighbors(W,t){let e=0;for(let s=-1;s<=1;s++)for(let i=-1;i<=1;i++)i===0&&s===0||this.get(W+i,t+s)===d&&e++;return e}step(){const W=new Uint8Array(this.width*this.height);for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++){const s=this.get(e,t);let i=s;switch(s){case c:i=c;break;case d:i=u;break;case u:i=a;break;case a:const l=this.countHeadNeighbors(e,t);i=l===1||l===2?d:a;break}W[this.index(e,t)]=i}this.cells=W}loadPattern(W,t=0,e=0){const s=W.trim().split(`
`);for(let i=0;i<s.length;i++){const l=s[i];for(let h=0;h<l.length;h++){const r=l[h];let n=c;switch(r){case"W":n=a;break;case"H":n=d;break;case"T":n=u;break;default:n=c}this.set(h+t,i+e,n)}}}clear(){this.cells.fill(c)}injectElectron(W,t){return this.get(W,t)===a?(this.set(W,t,d),!0):!1}}class S extends p{constructor(W){super(W),this.backgroundColor=o.colors.bg}init(){super.init(),w.init(this.ctx),this.container=this.canvas.parentElement,this.container&&this.enableFluidSize(this.container),this.cellSize=o.cellSize,this.circuitIndex=0,this.updateTimer=0,this.stepCount=0,this.setupGrid(),this.loadCircuit(this.circuitIndex),this.mouseX=-1,this.mouseY=-1,this.canvas.addEventListener("click",W=>{const t=this.canvas.getBoundingClientRect(),e=W.clientX-t.left,s=W.clientY-t.top,i=Math.floor((e-this.offsetX)/this.cellSize),l=Math.floor((s-this.offsetY)/this.cellSize);this.world.injectElectron(i,l)||(this.circuitIndex=(this.circuitIndex+1)%f.length,this.loadCircuit(this.circuitIndex))}),this.canvas.addEventListener("mousemove",W=>{const t=this.canvas.getBoundingClientRect();this.mouseX=Math.floor((W.clientX-t.left-this.offsetX)/this.cellSize),this.mouseY=Math.floor((W.clientY-t.top-this.offsetY)/this.cellSize)}),this.canvas.addEventListener("mouseleave",()=>{this.mouseX=-1,this.mouseY=-1}),window.addEventListener("keydown",W=>{W.key==="ArrowRight"||W.key===" "?(this.circuitIndex=(this.circuitIndex+1)%f.length,this.loadCircuit(this.circuitIndex)):W.key==="ArrowLeft"?(this.circuitIndex=(this.circuitIndex-1+f.length)%f.length,this.loadCircuit(this.circuitIndex)):(W.key==="r"||W.key==="R")&&this.loadCircuit(this.circuitIndex)})}setupGrid(){this.gridWidth=Math.floor(this.width/this.cellSize),this.gridHeight=Math.floor(this.height/this.cellSize),this.world=new m(this.gridWidth,this.gridHeight)}loadCircuit(W){const t=f[W];this.world.clear(),this.stepCount=0;const e=t.pattern.trim().split(`
`),s=e.length,i=Math.max(...e.map(r=>r.length)),l=Math.floor((this.gridWidth-i)/2),h=Math.floor((this.gridHeight-s)/2);this.world.loadPattern(t.pattern,l,h)}update(W){super.update(W);const t=Math.floor(this.width/this.cellSize),e=Math.floor(this.height/this.cellSize);(t!==this.gridWidth||e!==this.gridHeight)&&(this.setupGrid(),this.loadCircuit(this.circuitIndex)),this.updateTimer+=W,this.updateTimer>=o.updateInterval&&(this.world.step(),this.stepCount++,this.updateTimer=0)}render(){const W=this.ctx,t=this.cellSize;W.fillStyle=o.colors.bg,W.fillRect(0,0,this.width,this.height),this.offsetX=(this.width-this.gridWidth*t)/2,this.offsetY=(this.height-this.gridHeight*t)/2;for(let e=0;e<this.gridHeight;e++)for(let s=0;s<this.gridWidth;s++){const i=this.world.get(s,e),l=this.offsetX+s*t,h=this.offsetY+e*t;let r=o.colors.empty;switch(i){case a:s===this.mouseX&&e===this.mouseY?r=o.colors.wireHighlight:r=o.colors.wire;break;case d:r=o.colors.electronHead;break;case u:r=o.colors.electronTail;break}i!==c&&(W.fillStyle=r,W.fillRect(l+1,h+1,t-2,t-2),i===d?(W.shadowColor="#0f0",W.shadowBlur=12,W.fillRect(l+1,h+1,t-2,t-2),W.shadowBlur=0):i===u&&(W.shadowColor="#0f0",W.shadowBlur=6,W.fillRect(l+1,h+1,t-2,t-2),W.shadowBlur=0))}this.mouseX>=0&&this.mouseY>=0&&this.mouseX<this.gridWidth&&this.mouseY<this.gridHeight&&this.world.get(this.mouseX,this.mouseY)===a&&(W.strokeStyle="#0f0",W.lineWidth=2,W.shadowColor="#0f0",W.shadowBlur=8,W.strokeRect(this.offsetX+this.mouseX*t,this.offsetY+this.mouseY*t,t,t),W.shadowBlur=0),this.drawOverlay(W)}drawOverlay(W){const t=f[this.circuitIndex],e=20;W.fillStyle="rgba(0, 0, 0, 0.85)",W.fillRect(e-5,e-5,260,70),W.font='bold 18px "Fira Code", monospace',W.fillStyle=o.colors.text,W.textAlign="left",W.textBaseline="top",W.fillText(t.name,e,e),W.font='12px "Fira Code", monospace',W.fillStyle=o.colors.textDim,W.fillText(t.desc,e,e+25),W.fillText(`Step: ${this.stepCount}`,e,e+45),this.drawLegend(W),W.font='10px "Fira Code", monospace',W.fillStyle=o.colors.textDim,W.textAlign="right",W.fillText("click wire: inject electron | click empty: next circuit | arrows: navigate",this.width-e,this.height-e)}drawLegend(W){const t=this.width-140,e=20,s=14,i=22;W.fillStyle="rgba(0, 0, 0, 0.85)",W.fillRect(t-10,e-10,130,100);const l=[{label:"Wire",color:o.colors.wire},{label:"Head",color:o.colors.electronHead},{label:"Tail",color:o.colors.electronTail}];W.font='11px "Fira Code", monospace',W.textAlign="left",W.textBaseline="middle",l.forEach((h,r)=>{const n=e+r*i;W.fillStyle=h.color,W.fillRect(t,n,s,s),W.fillStyle=o.colors.textDim,W.fillText(h.label,t+s+8,n+s/2)})}}function T(g){const W=new S(g);return W.start(),{stop:()=>W.stop(),game:W}}export{T as default};
