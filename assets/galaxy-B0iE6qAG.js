import{G as A,P,C as v}from"./index-Qp5ATCeA.js";const t={numArms:2,starCount:3e3,galaxyRadius:350,armWidth:40,spiralTightness:.25,spiralStart:30,baseRotationSpeed:.033,rotationFalloff:.35,blackHoleRadius:12,accretionDiskRadius:50,accretionHue:30,armHue:210,coreStarHue:50,perspective:600,initialTiltX:.6,maxTilt:1.4},p=Math.PI*2;class X extends A{constructor(a){super(a),this.backgroundColor="#000"}init(){super.init(),P.init(this.ctx),this.time=0,this.paused=!1,this.galaxyRotation=0,this.camera=new v({perspective:t.perspective,rotationX:t.initialTiltX,rotationY:0,sensitivity:.002,inertia:!0,friction:.92}),this.camera.enableMouseControl(this.canvas),this.stars=[],this.generateSpiralArms(),this.canvas.addEventListener("click",()=>{this.camera._isDragging||(this.paused=!this.paused)})}generateSpiralArms(){const a=Math.floor(t.starCount/t.numArms);for(let i=0;i<t.numArms;i++){const e=i/t.numArms*p;for(let s=0;s<a;s++){const o=s/a,n=o*p*2.5,r=t.spiralStart*Math.exp(t.spiralTightness*n);if(r>t.galaxyRadius)continue;const l=n+e,c=(Math.random()-.5+Math.random()-.5)*t.armWidth,d=l+Math.PI/2,f=(Math.random()-.5)*20,m=Math.cos(l)*(r+f)+Math.cos(d)*c,u=Math.sin(l)*(r+f)+Math.sin(d)*c,b=8*(1-o*.7),y=(Math.random()-.5)*b,g=Math.sqrt(m*m+u*u),C=Math.atan2(u,m),R=t.baseRotationSpeed/Math.pow(Math.max(g,20)/20,t.rotationFalloff),S=g/t.galaxyRadius,H=t.coreStarHue+(t.armHue-t.coreStarHue)*Math.pow(S,.6),k=.4+Math.random()*.6,w=1.5-S*.8+Math.random()*1.2;this.stars.push({radius:g,angle:C,y,rotationSpeed:R,hue:H,brightness:k,size:w,twinklePhase:Math.random()*p})}}const h=Math.floor(t.starCount*.15);for(let i=0;i<h;i++){const e=Math.random()*p,s=Math.sqrt(Math.random())*t.galaxyRadius,o=(Math.random()-.5)*15,n=t.baseRotationSpeed/Math.pow(Math.max(s,20)/20,t.rotationFalloff);this.stars.push({radius:s,angle:e,y:o,rotationSpeed:n,hue:t.armHue+Math.random()*30,brightness:.2+Math.random()*.4,size:.5+Math.random()*.8,twinklePhase:Math.random()*p})}}update(a){if(super.update(a),this.camera.rotationX>t.maxTilt&&(this.camera.rotationX=t.maxTilt),this.camera.rotationX<-1.4&&(this.camera.rotationX=-1.4),this.camera.update(a),!this.paused){this.time+=a,this.galaxyRotation+=a*.02;for(const h of this.stars)h.angle+=h.rotationSpeed*a}}render(){const a=this.ctx,h=this.width,i=this.height,e=h/2,s=i/2;a.fillStyle="#000",a.fillRect(0,0,h,i),this.drawGalacticHaze(a,e,s),this.drawStars(a,e,s),this.drawBlackHole(a,e,s)}drawGalacticHaze(a,h,i){const e=this.camera.project(0,0,0),s=h+e.x,o=i+e.y,n=Math.cos(this.camera.rotationX),r=t.galaxyRadius*e.scale*.9;a.save(),a.translate(s,o),a.scale(1,Math.max(.15,Math.abs(n)));const l=a.createRadialGradient(0,0,0,0,0,r);l.addColorStop(0,`hsla(${t.accretionHue}, 70%, 50%, 0.1)`),l.addColorStop(.2,`hsla(${t.armHue}, 50%, 40%, 0.06)`),l.addColorStop(.5,`hsla(${t.armHue}, 40%, 30%, 0.03)`),l.addColorStop(1,"transparent"),a.beginPath(),a.arc(0,0,r,0,p),a.fillStyle=l,a.fill(),a.restore()}drawStars(a,h,i){const e=[];for(const s of this.stars){const o=Math.cos(s.angle)*s.radius,n=Math.sin(s.angle)*s.radius,r=this.camera.project(o,s.y,n);e.push({star:s,p:r,x:o,z:n})}e.sort((s,o)=>s.p.z-o.p.z);for(const{star:s,p:o}of e){if(o.scale<.02)continue;const n=h+o.x,r=i+o.y,l=.7+.3*Math.sin(this.time*2.5+s.twinklePhase),c=s.brightness*l*Math.min(1,o.scale*1.5),d=Math.max(.4,s.size*o.scale);a.globalAlpha=c,a.fillStyle=`hsl(${s.hue}, 60%, ${55+s.brightness*35}%)`,a.beginPath(),a.arc(n,r,d,0,p),a.fill(),d>1.2&&s.brightness>.6&&(a.globalAlpha=c*.25,a.beginPath(),a.arc(n,r,d*2.5,0,p),a.fill())}a.globalAlpha=1}drawBlackHole(a,h,i){const e=this.camera.project(0,0,0),s=h+e.x,o=i+e.y,n=t.accretionDiskRadius*e.scale,r=t.blackHoleRadius*e.scale,l=Math.cos(this.camera.rotationX);a.save(),a.translate(s,o),a.globalCompositeOperation="lighter";const c=a.createRadialGradient(0,0,r,0,0,n);c.addColorStop(0,`hsla(${t.accretionHue+20}, 100%, 70%, 0.9)`),c.addColorStop(.3,`hsla(${t.accretionHue}, 100%, 60%, 0.6)`),c.addColorStop(.6,`hsla(${t.accretionHue-10}, 90%, 50%, 0.3)`),c.addColorStop(1,"transparent"),a.scale(1,Math.max(.1,Math.abs(l))),a.beginPath(),a.arc(0,0,n,0,p),a.fillStyle=c,a.fill(),a.restore(),a.globalCompositeOperation="source-over",a.save(),a.translate(s,o),a.scale(1,Math.max(.3,Math.abs(l))),a.beginPath(),a.arc(0,0,r,0,p),a.fillStyle="#000",a.fill(),a.strokeStyle=`hsla(${t.accretionHue+10}, 100%, 75%, 0.8)`,a.lineWidth=2*e.scale,a.stroke(),a.restore(),a.globalCompositeOperation="lighter",a.save(),a.translate(s,o),a.scale(1,Math.max(.3,Math.abs(l)));const d=a.createRadialGradient(0,0,r*.9,0,0,r*1.5);d.addColorStop(0,"transparent"),d.addColorStop(.5,`hsla(${t.accretionHue}, 100%, 80%, 0.5)`),d.addColorStop(1,"transparent"),a.beginPath(),a.arc(0,0,r*1.5,0,p),a.fillStyle=d,a.fill(),a.restore(),a.globalCompositeOperation="source-over"}}function G(M){const a=new X(M);return a.start(),{stop:()=>a.stop(),game:a}}export{G as default};
