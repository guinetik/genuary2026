import{G as P,P as z,C as I,ac as v,k as C,E as A}from"./index-BHpYPlok.js";const p={background:"#000",atlas:{size:120,hoverAmplitude:5,hoverSpeed:.4},orb:{radius:25,pulseMin:.8,pulseMax:1.2,pulseSpeed:1.5,glowRadius:80},glyphs:{nodeCount:16,lineWidth:1.5,flickerSpeed:3},stars:{count:200,radius:500},figures:{count:16,orbitRadius:220,orbitSpeed:.08,scale:.15},colors:{glow:"#ff2200",glowBright:"#ff4422",orb:"#ff0000",orbCore:"#ffffff",glyph:"#ff3311"},commune:{duration:2},transcendence:{clicksRequired:16,zoomInDuration:6,flashDuration:1.5,tunnelDuration:10,fadeToBlackDuration:2,iterationDuration:3,atlasAppearDuration:2,starsAppearDuration:1.5,figuresAppearDuration:5},camera:{perspective:600,autoRotateSpeed:.08,friction:.95,initialTilt:0,initialRotationY:-2.3879}};class k{constructor(e){this.size=e;const s=e*.7,a=e*1.6,t=e*.9;this.vertices=[{x:0,y:-s,z:0},{x:0,y:a,z:0},{x:-t,y:0,z:0},{x:t,y:0,z:0},{x:0,y:0,z:-t},{x:0,y:0,z:t}],this.faces=[[0,5,3],[0,3,4],[0,4,2],[0,2,5],[1,3,5],[1,4,3],[1,2,4],[1,5,2]],this.glyphs=this.faces.map(()=>this.generateGlyphPattern())}generateGlyphPattern(){const e=[],s=[],a=Math.floor(p.glyphs.nodeCount/8)+2;for(let t=0;t<a;t++){let n=Math.random(),c=Math.random();n+c>1&&(n=1-n,c=1-c),e.push({u:n,v:c,w:1-n-c,flicker:Math.random()*Math.PI*2})}for(let t=0;t<e.length-1;t++)if(Math.random()<.7){const n=Math.min(t+1+Math.floor(Math.random()*2),e.length-1);s.push({from:t,to:n})}return Math.random()<.5&&s.push({edge:!0,t1:Math.random()*.3,t2:.3+Math.random()*.4,side:Math.floor(Math.random()*3)}),{nodes:e,lines:s}}}class O extends P{constructor(e){super(e),this.backgroundColor=null}init(){var e;super.init(),z.init(this.ctx),this.camera=new I({perspective:p.camera.perspective,rotationX:p.camera.initialTilt,rotationY:p.camera.initialRotationY,autoRotate:!0,autoRotateSpeed:p.camera.autoRotateSpeed,autoRotateAxis:"y",inertia:!0,friction:p.camera.friction,sensitivity:.003}),this.camera.enableMouseControl(this.canvas),(e=this.camera._boundHandlers)!=null&&e.dblclick&&this.canvas.removeEventListener("dblclick",this.camera._boundHandlers.dblclick),this.octahedron=new k(p.atlas.size),this.orbFaceIndex=4,this.time=0,this.communeTime=-10,this.communeActive=!1,this.clickCount=0,this.transcendenceFSM=null,this.tunnelTime=0,this.tunnelParticles=[],this.stars=[];for(let s=0;s<p.stars.count;s++){const a=Math.random()*Math.PI*2,t=Math.acos(2*Math.random()-1),n=p.stars.radius*(.8+Math.random()*.4);this.stars.push({x:n*Math.sin(t)*Math.cos(a),y:n*Math.sin(t)*Math.sin(a),z:n*Math.cos(t),size:.5+Math.random()*1.5,brightness:.3+Math.random()*.7})}this.figures=[];for(let s=0;s<p.figures.count;s++){const a=s/p.figures.count*Math.PI*2,t=s%2===0?.2:-.2;this.figures.push({index:s,baseAngle:a,tilt:t,figure:new v(p.figures.scale,{stroke:"#ffffff",headColor:"#ffffff",jointColor:"#ffffff",lineWidth:1,showJoints:!1})})}this.canvas.addEventListener("mouseup",()=>{console.log(`Camera rotation - X: ${this.camera.rotationX.toFixed(4)}, Y: ${this.camera.rotationY.toFixed(4)}`),console.log(`CONFIG: initialTilt: ${this.camera.rotationX.toFixed(4)}, initialRotationY: ${this.camera.rotationY.toFixed(4)}`)}),this.tunnelMouseX=this.width/2,this.tunnelMouseY=this.height/2,this.tunnelOffsetX=0,this.tunnelOffsetY=0,this.tunnelTargetOffsetX=0,this.tunnelTargetOffsetY=0,this.canvas.addEventListener("mousemove",s=>{const a=this.canvas.getBoundingClientRect();this.tunnelMouseX=s.clientX-a.left,this.tunnelMouseY=s.clientY-a.top;const t=this.width/2,n=this.height/2;this.tunnelTargetOffsetX=(this.tunnelMouseX-t)*.5,this.tunnelTargetOffsetY=(this.tunnelMouseY-n)*.5}),this.canvas.addEventListener("mouseleave",()=>{this.tunnelTargetOffsetX=0,this.tunnelTargetOffsetY=0}),this.canvas.addEventListener("click",()=>{this.transcendenceFSM||(this.clickCount++,this.communeTime=this.time,this.communeActive=!0,this.clickCount>=p.transcendence.clicksRequired&&this.startTranscendence())})}startTranscendence(){const{transcendence:e}=p;this.restoreState={atlasAlpha:0,starsAlpha:0,visibleFigures:0},this.iterationBase||(this.iterationBase=1e4+Math.floor(Math.random()*9e4)),this.iterationBase++,this.iterationNumber=this.iterationBase,this.zoomInState={startRotationX:this.camera.rotationX,startRotationY:this.camera.rotationY,scale:1},this.camera.autoRotate=!1,this.transcendenceFSM=C.fromSequence([{name:"zoomIn",duration:e.zoomInDuration,update:s=>this.updateZoomIn(s)},{name:"flash",duration:e.flashDuration,enter:()=>this.initFlashPhase()},{name:"tunnel",duration:e.tunnelDuration,enter:()=>this.initTunnelPhase(),update:s=>this.updateTunnel(s)},{name:"fadeToBlack",duration:e.fadeToBlackDuration,update:s=>this.updateTunnel(s)},{name:"iteration",duration:e.iterationDuration},{name:"atlasAppear",duration:e.atlasAppearDuration,enter:()=>{this.restoreState.atlasAlpha=0}},{name:"starsAppear",duration:e.starsAppearDuration,enter:()=>{this.restoreState.starsAlpha=0}},{name:"figuresAppear",duration:e.figuresAppearDuration,enter:()=>{this.restoreState.visibleFigures=0,this.restoreState.startRotationX=this.camera.rotationX,this.restoreState.startRotationY=this.camera.rotationY},update:s=>this.updateFiguresAppear(s)}],{context:this,onComplete:()=>this.resetScene()})}initFlashPhase(){}updateZoomIn(e){const s=this.transcendenceFSM.progress,{startRotationX:a,startRotationY:t}=this.zoomInState,n=A.easeInBack(s),c=-2.3879,h=.3;this.camera.rotationX=a+(h-a)*n,this.camera.rotationY=t+(c-t)*n,this.zoomInState.scale=1+n*2,this.zoomInState.offsetY=n*80}initTunnelPhase(){this.tunnelTime=2,this.tunnelParticles=[];for(let e=0;e<500;e++)this.tunnelParticles.push({angle:Math.random()*Math.PI*2,z:Math.random()*1e3,radius:50+Math.random()*300,speed:100+Math.random()*400,hue:Math.random()*360,size:2+Math.random()*8,type:Math.floor(Math.random()*4)});this.kaleidoSegments=8+Math.floor(Math.random()*8),this.tunnelRings=[];for(let e=0;e<20;e++)this.tunnelRings.push({z:e*100,hue:e*30%360,thickness:2+Math.random()*6})}updateFiguresAppear(e){const s=this.transcendenceFSM.progress,{startRotationX:a,startRotationY:t}=this.restoreState,n=1-Math.pow(1-s,2),c=p.camera.initialTilt,h=p.camera.initialRotationY;this.camera.rotationX=a+(c-a)*n,this.camera.rotationY=t+(h-t)*n}updateTunnel(e){this.tunnelTime+=e*3;const s=1-Math.pow(.05,e);this.tunnelOffsetX+=(this.tunnelTargetOffsetX-this.tunnelOffsetX)*s,this.tunnelOffsetY+=(this.tunnelTargetOffsetY-this.tunnelOffsetY)*s;for(const a of this.tunnelParticles)a.z-=a.speed*e*2.5,a.z<-100&&(a.z=1e3,a.hue=(a.hue+30)%360),a.angle+=e*(1.5+a.speed/300);for(const a of this.tunnelRings)a.z-=500*e,a.z<-50&&(a.z=2e3,a.hue=(a.hue+60)%360)}resetScene(){this.clickCount=0,this.transcendenceFSM=null,this.communeActive=!1,this.communeTime=-10,this.tunnelParticles=[],this.tunnelRings=[],this.tunnelTime=0,this.camera.autoRotate=!0,this.camera.perspective=p.camera.perspective,this.camera.rotationX=p.camera.initialTilt,this.camera.rotationY=p.camera.initialRotationY,this.octahedron.glyphs=this.octahedron.faces.map(()=>this.octahedron.generateGlyphPattern())}update(e){super.update(e),this.time+=e;const s=this.transcendenceFSM&&["atlasAppear","starsAppear","figuresAppear"].includes(this.transcendenceFSM.state);(!this.transcendenceFSM||s)&&this.camera.update(e),this.communeActive&&this.time-this.communeTime>p.commune.duration&&(this.communeActive=!1),this.transcendenceFSM&&this.transcendenceFSM.update(e)}render(){const e=this.ctx,s=this.width,a=this.height,t=s/2,n=a/2;if(this.transcendenceFSM){this.renderTranscendence(e,t,n,s,a);return}e.fillStyle=p.background,e.fillRect(0,0,s,a);const c=e.createRadialGradient(t,n,0,t,n,Math.max(s,a)*.7);c.addColorStop(0,"rgba(60, 5, 0, 0.3)"),c.addColorStop(.5,"rgba(30, 2, 0, 0.2)"),c.addColorStop(1,"transparent"),e.fillStyle=c,e.fillRect(0,0,s,a),this.renderStars(e,t,n),this.renderFigures(e,t,n);const h=Math.sin(this.time*p.atlas.hoverSpeed)*p.atlas.hoverAmplitude,r=this.projectFaces(t,n,h),o=r.find(m=>m.faceIndex===this.orbFaceIndex),i=o?this.getOrbPosition(o.verts):{x:t,y:n},l=o?o.depth:0;let d=!1;for(const m of r){!d&&m.depth<l&&(this.renderOrb(e,i.x,i.y),d=!0);const u=m.faceIndex===this.orbFaceIndex;this.renderFace(e,m,u)}d||this.renderOrb(e,i.x,i.y),this.communeActive&&this.renderCommuneEffect(e,i.x,i.y);const f=e.createRadialGradient(t,n,0,t,n,Math.max(s,a)*.7);f.addColorStop(0,"transparent"),f.addColorStop(.7,"transparent"),f.addColorStop(1,"rgba(0, 0, 0, 0.7)"),e.fillStyle=f,e.fillRect(0,0,s,a),this.clickCount>0&&(e.fillStyle=`rgba(255, 50, 20, ${.3+this.clickCount/32})`,e.font="12px monospace",e.textAlign="center",e.fillText(`${this.clickCount}/16`,t,a-20))}getFaceCenter(e){return{x:(e[0].x+e[1].x+e[2].x)/3,y:(e[0].y+e[1].y+e[2].y)/3}}getOrbPosition(e){return{x:e[0].x*.15+e[1].x*.425+e[2].x*.425,y:e[0].y*.15+e[1].y*.425+e[2].y*.425}}renderStars(e,s,a){for(const t of this.stars){const n=this.camera.project(t.x,t.y,t.z),c=s+n.x,h=a+n.y;if(n.scale<=0)continue;const r=t.size*n.scale,o=t.brightness*Math.min(1,n.scale);e.beginPath(),e.arc(c,h,r,0,Math.PI*2),e.fillStyle=`rgba(255, 220, 220, ${o})`,e.fill()}}renderFigures(e,s,a){const{figures:t}=p,n=this.communeActive?Math.max(0,1-(this.time-this.communeTime)/p.commune.duration):0,c=this.figures.map(h=>{const r=h.baseAngle+this.time*t.orbitSpeed,o=h.tilt,i=Math.cos(r)*t.orbitRadius,l=Math.sin(r)*t.orbitRadius,d=Math.sin(r)*t.orbitRadius*o,f=this.camera.project(i,d,l);return{...h,screenX:s+f.x,screenY:a+f.y,scale:f.scale,depth:f.z}});c.sort((h,r)=>r.depth-h.depth);for(const h of c){if(h.scale<=0)continue;const r=h.scale*(1+n*.3),o=Math.min(1,h.scale)*(.7+n*.3);e.save(),e.translate(h.screenX,h.screenY),e.scale(r,r),e.globalAlpha=o,e.shadowColor="#ffffff",e.shadowBlur=5+n*15,h.figure.draw(),e.restore()}e.shadowBlur=0,e.globalAlpha=1}renderFiguresPartial(e,s,a,t,n){const{figures:c}=p,h=this.figures.slice(0,t).map((r,o)=>{const i=r.baseAngle+this.time*c.orbitSpeed,l=r.tilt,d=Math.cos(i)*c.orbitRadius,f=Math.sin(i)*c.orbitRadius,m=Math.sin(i)*c.orbitRadius*l,u=this.camera.project(d,m,f),g=n*p.figures.count,b=Math.min(1,Math.max(0,g-o));return{...r,screenX:s+u.x,screenY:a+u.y,scale:u.scale,depth:u.z,fadeIn:b}});h.sort((r,o)=>o.depth-r.depth);for(const r of h){if(r.scale<=0||r.fadeIn<=0)continue;const o=.5+r.fadeIn*.5,i=r.scale*o,l=Math.min(1,r.scale)*r.fadeIn*.7;e.save(),e.translate(r.screenX,r.screenY),e.scale(i,i),e.globalAlpha=l;const d=r.fadeIn<1?15:5;e.shadowColor="#ffffff",e.shadowBlur=d,r.figure.draw(),e.restore()}e.shadowBlur=0,e.globalAlpha=1}projectFaces(e,s,a=0){const t=this.octahedron,n=[];for(let c=0;c<t.faces.length;c++){const h=t.faces[c],r=h.map(l=>{const d=t.vertices[l],f=this.camera.project(d.x,d.y+a,d.z);return{x:e+f.x,y:s+f.y,z:f.z,scale:f.scale,world:d}}),o=r.reduce((l,d)=>l+d.z,0)/3,i=this.calculateNormal(t.vertices[h[0]],t.vertices[h[1]],t.vertices[h[2]]);n.push({verts:r,depth:o,normal:i,faceIndex:c,glyph:t.glyphs[c]})}return n.sort((c,h)=>h.depth-c.depth),n}calculateNormal(e,s,a){const t=s.x-e.x,n=s.y-e.y,c=s.z-e.z,h=a.x-e.x,r=a.y-e.y,o=a.z-e.z,i=n*o-c*r,l=c*h-t*o,d=t*r-n*h,f=Math.sqrt(i*i+l*l+d*d);return{x:i/f,y:l/f,z:d/f}}renderFace(e,s,a=!1){const t=this.communeActive?Math.max(0,1-(this.time-this.communeTime)/p.commune.duration):0,{verts:n,normal:c,glyph:h}=s,r={x:.3,y:-.5,z:.8},o=c.x*r.x+c.y*r.y+c.z*r.z,i=.3+Math.max(0,o)*.4,l=Math.floor(26*(i+t*.5)),d=a?.7:1,f=a?`rgba(${l+t*40}, ${l}, ${l}, ${d})`:`rgb(${l+t*40}, ${l}, ${l})`;e.beginPath(),e.moveTo(n[0].x,n[0].y),e.lineTo(n[1].x,n[1].y),e.lineTo(n[2].x,n[2].y),e.closePath(),e.fillStyle=f,e.fill(),e.strokeStyle=`rgba(100, 100, 100, ${.6+t*.4})`,e.lineWidth=1.5,e.stroke(),this.renderGlyphs(e,n,h,t)}renderGlyphs(e,s,a,t){const{nodes:n,lines:c}=a,h=(r,o,i)=>({x:s[0].x*i+s[1].x*r+s[2].x*o,y:s[0].y*i+s[1].y*r+s[2].y*o});e.strokeStyle=p.colors.glyph,e.lineWidth=p.glyphs.lineWidth,e.shadowColor=p.colors.glow,e.shadowBlur=8+t*12;for(const r of c)if(r.edge){const o=r.side,i=s[o],l=s[(o+1)%3],d=i.x+(l.x-i.x)*r.t1,f=i.y+(l.y-i.y)*r.t1,m=i.x+(l.x-i.x)*r.t2,u=i.y+(l.y-i.y)*r.t2;e.beginPath(),e.moveTo(d,f),e.lineTo(m,u),e.stroke()}else{const o=n[r.from],i=n[r.to],l=h(o.u,o.v,o.w),d=h(i.u,i.v,i.w),f=(l.x+d.x)/2+(Math.random()-.5)*5;e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(f,l.y),e.lineTo(f,d.y),e.lineTo(d.x,d.y),e.stroke()}for(const r of n){const o=h(r.u,r.v,r.w),l=.4+Math.sin(this.time*p.glyphs.flickerSpeed+r.flicker)*.3+t*.3;e.beginPath(),e.arc(o.x,o.y,2+t*2,0,Math.PI*2),e.fillStyle=`rgba(255, 50, 20, ${l})`,e.fill()}e.shadowBlur=0}renderOrb(e,s,a){const{orb:t,colors:n}=p,c=this.communeActive?Math.max(0,1-(this.time-this.communeTime)/p.commune.duration):0,h=t.pulseMin+(Math.sin(this.time*t.pulseSpeed)*.5+.5)*(t.pulseMax-t.pulseMin),r=t.radius*h*(1+c*.5),o=this.camera.project(0,0,0),i=s+o.x,l=a+o.y,d=e.createRadialGradient(i,l,0,i,l,t.glowRadius*(1+c));d.addColorStop(0,`rgba(255, 30, 0, ${.6+c*.4})`),d.addColorStop(.3,`rgba(255, 20, 0, ${.3+c*.2})`),d.addColorStop(.6,`rgba(200, 10, 0, ${.1+c*.1})`),d.addColorStop(1,"transparent"),e.beginPath(),e.arc(i,l,t.glowRadius*(1+c),0,Math.PI*2),e.fillStyle=d,e.fill();const f=e.createRadialGradient(i-r*.2,l-r*.2,0,i,l,r);f.addColorStop(0,n.orbCore),f.addColorStop(.3,n.glowBright),f.addColorStop(.7,n.orb),f.addColorStop(1,"rgba(150, 0, 0, 0.8)"),e.beginPath(),e.arc(i,l,r,0,Math.PI*2),e.fillStyle=f,e.fill(),e.save(),e.translate(i,l),e.rotate(this.time*.5),e.strokeStyle=`rgba(255, 100, 50, ${.3+c*.3})`,e.lineWidth=1,e.beginPath();for(let m=0;m<3;m++){const u=m/3*Math.PI*2,g=r*.3,M=r*.7;e.moveTo(Math.cos(u)*g,Math.sin(u)*g),e.quadraticCurveTo(Math.cos(u+.5)*r*.5,Math.sin(u+.5)*r*.5,Math.cos(u+1)*M,Math.sin(u+1)*M)}e.stroke(),e.restore()}renderCommuneEffect(e,s,a){const t=(this.time-this.communeTime)/p.commune.duration,n=Math.pow(1-t,2);e.fillStyle=`rgba(255, 50, 20, ${n*.15})`,e.fillRect(0,0,this.width,this.height);const c=t*300,h=(1-t)*.5;e.strokeStyle=`rgba(255, 100, 50, ${h})`,e.lineWidth=3*(1-t),e.beginPath(),e.arc(s,a,c,0,Math.PI*2),e.stroke()}renderTranscendence(e,s,a,t,n){const c=this.transcendenceFSM.state,h=this.transcendenceFSM.progress,r=this.tunnelTime;if(c==="zoomIn"){e.fillStyle=p.background,e.fillRect(0,0,t,n);const o=this.zoomInState.scale||1,i=this.zoomInState.offsetY||0;e.save(),e.translate(s,a+i),e.scale(o,o),e.translate(-s,-(a+i));const l=e.createRadialGradient(s,a,0,s,a,Math.max(t,n)*.7);l.addColorStop(0,"rgba(60, 5, 0, 0.3)"),l.addColorStop(.5,"rgba(30, 2, 0, 0.2)"),l.addColorStop(1,"transparent"),e.fillStyle=l,e.fillRect(0,0,t,n),this.renderStars(e,s,a),this.renderFigures(e,s,a);const d=Math.sin(this.time*p.atlas.hoverSpeed)*p.atlas.hoverAmplitude,f=this.projectFaces(s,a,d),m=f.find(b=>b.faceIndex===this.orbFaceIndex),u=m?this.getOrbPosition(m.verts):{x:s,y:a},g=m?m.depth:0;let M=!1;for(const b of f)!M&&b.depth<g&&(this.renderOrb(e,u.x,u.y),M=!0),this.renderFace(e,b,b.faceIndex===this.orbFaceIndex);M||this.renderOrb(e,u.x,u.y),e.restore();return}if(c==="flash"){(!this.tunnelParticles||this.tunnelParticles.length===0)&&this.initTunnelPhase();const o=.2+h*h*.8,i=.016;this.tunnelTime+=i*3*o;for(const S of this.tunnelParticles)S.z-=S.speed*i*2.5*o,S.z<-100&&(S.z=1e3,S.hue=(S.hue+30)%360),S.angle+=i*(1.5+S.speed/300)*o;for(const S of this.tunnelRings)S.z-=500*i*o,S.z<-50&&(S.z=2e3,S.hue=(S.hue+60)%360);e.fillStyle="#000",e.fillRect(0,0,t,n),e.save(),e.globalAlpha=h;const l=s+(this.tunnelOffsetX||0),d=a+(this.tunnelOffsetY||0);this.renderDomainWarp(e,l,d,t,n,this.tunnelTime),this.renderKaleidoscope(e,l,d,t,n,this.tunnelTime),this.renderTunnelRings(e,l,d,t,n,this.tunnelTime),this.renderTunnelParticles(e,l,d,t,n,this.tunnelTime),this.renderVortex(e,l,d,this.tunnelTime),e.restore(),e.save(),e.globalAlpha=1-h;const f=this.zoomInState.scale||1,m=this.zoomInState.offsetY||0;e.translate(s,a+m),e.scale(f,f),e.translate(-s,-(a+m));const u=Math.sin(this.time*p.atlas.hoverSpeed)*p.atlas.hoverAmplitude,g=this.projectFaces(s,a,u),M=g.find(S=>S.faceIndex===this.orbFaceIndex),b=M?this.getOrbPosition(M.verts):{x:s,y:a},y=M?M.depth:0;let R=!1;for(const S of g)!R&&S.depth<y&&(this.renderOrb(e,b.x,b.y),R=!0),this.renderFace(e,S,S.faceIndex===this.orbFaceIndex);R||this.renderOrb(e,b.x,b.y),e.restore();return}if(c==="tunnel"){e.fillStyle="rgba(0, 0, 0, 0.15)",e.fillRect(0,0,t,n);const o=s+this.tunnelOffsetX,i=a+this.tunnelOffsetY,l=1+h*2;if(e.save(),e.translate(o,i),e.scale(l,l),e.translate(-o,-i),this.renderDomainWarp(e,o,i,t,n,r),this.renderKaleidoscope(e,o,i,t,n,r),this.renderTunnelRings(e,o,i,t,n,r),this.renderTunnelParticles(e,o,i,t,n,r),this.renderVortex(e,o,i,r),e.restore(),this.renderScreenEffects(e,s,a,t,n,r),h>.9){const d=(h-.9)/.1;e.fillStyle=`rgba(255, 255, 255, ${d})`,e.fillRect(0,0,t,n)}return}if(c==="fadeToBlack"){const o=1-h;e.fillStyle="#000",e.fillRect(0,0,t,n),e.fillStyle=`rgba(255, 255, 255, ${o})`,e.fillRect(0,0,t,n);return}if(c==="iteration"){e.fillStyle="#000",e.fillRect(0,0,t,n);let o;h<.3?o=h/.3:h>.7?o=(1-h)/.3:o=1,e.save(),e.globalAlpha=o,e.fillStyle="#ff2200",e.font="bold 24px monospace",e.textAlign="center",e.textBaseline="middle",e.shadowColor="#ff2200",e.shadowBlur=20,e.fillText(`ITERATION #${this.iterationNumber}`,s,a),e.fillText(`ITERATION #${this.iterationNumber}`,s,a),e.restore();return}if(c==="atlasAppear"){e.fillStyle="#000",e.fillRect(0,0,t,n),e.globalAlpha=h;const o=Math.sin(this.time*p.atlas.hoverSpeed)*p.atlas.hoverAmplitude,i=this.projectFaces(s,a,o),l=i.find(u=>u.faceIndex===this.orbFaceIndex),d=l?this.getOrbPosition(l.verts):{x:s,y:a},f=l?l.depth:0;let m=!1;for(const u of i)!m&&u.depth<f&&(this.renderOrb(e,d.x,d.y),m=!0),this.renderFace(e,u,u.faceIndex===this.orbFaceIndex);m||this.renderOrb(e,d.x,d.y),e.globalAlpha=1;return}if(c==="starsAppear"){e.fillStyle="#000",e.fillRect(0,0,t,n),e.globalAlpha=h;const o=e.createRadialGradient(s,a,0,s,a,Math.max(t,n)*.7);o.addColorStop(0,"rgba(60, 5, 0, 0.3)"),o.addColorStop(.5,"rgba(30, 2, 0, 0.2)"),o.addColorStop(1,"transparent"),e.fillStyle=o,e.fillRect(0,0,t,n),this.renderStars(e,s,a),e.globalAlpha=1;const i=Math.sin(this.time*p.atlas.hoverSpeed)*p.atlas.hoverAmplitude,l=this.projectFaces(s,a,i),d=l.find(g=>g.faceIndex===this.orbFaceIndex),f=d?this.getOrbPosition(d.verts):{x:s,y:a},m=d?d.depth:0;let u=!1;for(const g of l)!u&&g.depth<m&&(this.renderOrb(e,f.x,f.y),u=!0),this.renderFace(e,g,g.faceIndex===this.orbFaceIndex);u||this.renderOrb(e,f.x,f.y);return}if(c==="figuresAppear"){e.fillStyle="#000",e.fillRect(0,0,t,n);const o=e.createRadialGradient(s,a,0,s,a,Math.max(t,n)*.7);o.addColorStop(0,"rgba(60, 5, 0, 0.3)"),o.addColorStop(.5,"rgba(30, 2, 0, 0.2)"),o.addColorStop(1,"transparent"),e.fillStyle=o,e.fillRect(0,0,t,n),this.renderStars(e,s,a);const i=p.figures.count,l=Math.floor(h*i)+1;this.renderFiguresPartial(e,s,a,Math.min(l,i),h);const d=Math.sin(this.time*p.atlas.hoverSpeed)*p.atlas.hoverAmplitude,f=this.projectFaces(s,a,d),m=f.find(y=>y.faceIndex===this.orbFaceIndex),u=m?this.getOrbPosition(m.verts):{x:s,y:a},g=m?m.depth:0;let M=!1;for(const y of f)!M&&y.depth<g&&(this.renderOrb(e,u.x,u.y),M=!0),this.renderFace(e,y,y.faceIndex===this.orbFaceIndex);M||this.renderOrb(e,u.x,u.y);const b=e.createRadialGradient(s,a,0,s,a,Math.max(t,n)*.7);b.addColorStop(0,"transparent"),b.addColorStop(.7,"transparent"),b.addColorStop(1,"rgba(0, 0, 0, 0.7)"),e.fillStyle=b,e.fillRect(0,0,t,n);return}}renderDomainWarp(e,s,a,t,n,c){const r=Math.ceil(t/40)+2,o=Math.ceil(n/40)+2;for(let i=0;i<r;i++)for(let l=0;l<o;l++){const d=i*40,f=l*40,m=Math.sin(f*.01+c*2)*30+Math.sin(c*3+i*.5)*20,u=Math.cos(d*.01+c*1.5)*30+Math.cos(c*2.5+l*.5)*20,g=d+m,M=f+u,b=g-s,y=M-a,R=Math.sqrt(b*b+y*y),S=(R*.5+c*100+i*10+l*10)%360,F=30+Math.sin(R*.02-c*3)*20;e.fillStyle=`hsla(${S}, 100%, ${F}%, 0.3)`,e.fillRect(g-40/2,M-40/2,40,40)}}renderKaleidoscope(e,s,a,t,n,c){const h=this.kaleidoSegments||12,r=Math.PI*2/h;e.save(),e.translate(s,a);for(let o=0;o<h;o++){e.save(),e.rotate(o*r+c*.3),o%2===1&&e.scale(-1,1);for(let i=0;i<8;i++){const l=50+i*40+Math.sin(c*2+i)*20,d=20+Math.sin(c*3+i*.5)*10,f=(c*50+i*45+o*30)%360;e.fillStyle=`hsla(${f}, 100%, 60%, 0.6)`,e.beginPath();const m=(i+o)%4;if(m===0)e.arc(l,0,d,0,Math.PI*2);else if(m===1)e.rect(l-d/2,-d/2,d,d);else if(m===2)e.moveTo(l,-d),e.lineTo(l+d,d),e.lineTo(l-d,d),e.closePath();else{for(let u=0;u<5;u++){const g=u*Math.PI*2/5-Math.PI/2,M=u%2===0?d:d/2,b=l+Math.cos(g)*M,y=Math.sin(g)*M;u===0?e.moveTo(b,y):e.lineTo(b,y)}e.closePath()}e.fill()}e.restore()}e.restore()}renderTunnelRings(e,s,a,t,n,c){if(this.tunnelRings)for(const h of this.tunnelRings){const r=1e3/(h.z+100);if(r<.1||r>20)continue;const o=100*r,i=(h.hue+c*30)%360,l=Math.min(1,r*.3);e.strokeStyle=`hsla(${i}, 100%, 70%, ${l})`,e.lineWidth=h.thickness*r,e.beginPath(),e.arc(s,a,o,0,Math.PI*2),e.stroke();const d=e.createRadialGradient(s,a,o*.8,s,a,o*1.2);d.addColorStop(0,"transparent"),d.addColorStop(.5,`hsla(${i}, 100%, 50%, ${l*.3})`),d.addColorStop(1,"transparent"),e.fillStyle=d,e.fillRect(0,0,t,n)}}renderTunnelParticles(e,s,a,t,n,c){if(this.tunnelParticles){e.save(),e.globalCompositeOperation="lighter";for(const h of this.tunnelParticles){const r=800/(h.z+50);if(r<.05||r>30)continue;const o=s+Math.cos(h.angle)*h.radius*r,i=a+Math.sin(h.angle)*h.radius*r,l=h.size*r,d=(h.hue+c*60)%360,f=Math.min(1,r*.5);if(e.fillStyle=`hsla(${d}, 100%, 70%, ${f})`,e.beginPath(),h.type===0)e.arc(o,i,l,0,Math.PI*2);else if(h.type===1)e.rect(o-l/2,i-l/2,l,l);else if(h.type===2){const m=l*3,u=Math.atan2(a-i,s-o);e.moveTo(o,i),e.lineTo(o+Math.cos(u)*m,i+Math.sin(u)*m),e.lineWidth=l/2,e.strokeStyle=`hsla(${d}, 100%, 70%, ${f})`,e.stroke()}else e.moveTo(o,i-l),e.lineTo(o+l,i),e.lineTo(o,i+l),e.lineTo(o-l,i),e.closePath();e.fill()}e.restore()}}renderVortex(e,s,a,t){e.save(),e.translate(s,a),e.rotate(t*2),e.globalCompositeOperation="lighter";for(let r=0;r<6;r++){const o=r/6*Math.PI*2,i=(r*60+t*100)%360;e.strokeStyle=`hsla(${i}, 100%, 60%, 0.8)`,e.lineWidth=3,e.beginPath();for(let l=0;l<=100;l++){const d=l/100,f=o+d*3*Math.PI*2,m=d*150+Math.sin(t*5+d*10)*10,u=Math.cos(f)*m,g=Math.sin(f)*m;l===0?e.moveTo(u,g):e.lineTo(u,g)}e.stroke()}const h=e.createRadialGradient(0,0,0,0,0,50);h.addColorStop(0,"rgba(255, 255, 255, 1)"),h.addColorStop(.3,`hsla(${t*100%360}, 100%, 70%, 0.8)`),h.addColorStop(1,"transparent"),e.fillStyle=h,e.fillRect(-50,-50,100,100),e.restore()}renderScreenEffects(e,s,a,t,n,c){e.fillStyle="rgba(0, 0, 0, 0.1)";for(let o=0;o<n;o+=4)e.fillRect(0,o,t,2);const h=.5+Math.sin(c*3)*.2,r=e.createRadialGradient(s,a,0,s,a,Math.max(t,n)*.7);r.addColorStop(0,"transparent"),r.addColorStop(.5,"transparent"),r.addColorStop(1,`rgba(0, 0, 0, ${h})`),e.fillStyle=r,e.fillRect(0,0,t,n),Math.random()<.05&&(e.fillStyle=`rgba(255, 255, 255, ${Math.random()*.3})`,e.fillRect(0,0,t,n))}}function $(T){const e=new O(T);return e.start(),{stop:()=>e.stop(),game:e}}export{$ as default};
