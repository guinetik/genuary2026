import{G as A,P as F}from"./index-39bQyOgn.js";const S=Math.PI*2,l={coreRadius:40,coreGlow:120,ribbonStartCount:2,ribbonMaxCount:12,ribbonSegments:80,ribbonWidth:6,ribbonOrbitRadius:100,ribbonSpeedMultiplier:5,foodParticlesPerClick:10,foodDriftSpeed:60,foodAbsorbRadius:50,complexityPerParticle:.002,gasCloudParticles:120,gasCloudSpeed:.5,shieldRadiusMin:120,shieldRadiusMax:180,membraneDeformRadius:120,membraneDeformStrength:45,particleCount:150,particleRadius:180,starCount:300,timeScale:.4,ribbonPokeRadius:100,ribbonPokeStrength:800,ribbonReturnSpeed:2,ribbonDamping:.95,complexityDecayRate:.003,vitalityDecayRate:.05,vitalityRecoveryRate:.3,nebulaCount:5,nebulaMinSize:150,nebulaMaxSize:300,nebulaAlpha:.08};function $(R,t,s,i){const e=Math.cos(i),o=Math.sin(i);return{x:R*e+s*o,y:t,z:-R*o+s*e}}function Y(R,t,s,i){const e=Math.cos(i),o=Math.sin(i);return{x:R,y:t*e-s*o,z:t*o+s*e}}function q(R,t,s,i){const e=Math.cos(i),o=Math.sin(i);return{x:R*e-t*o,y:R*o+t*e,z:s}}class T extends A{constructor(t){super(t),this.backgroundColor="#000"}init(){super.init(),F.init(this.ctx),this.time=0,this.rotationY=0,this.rotationX=.3,this.hue=Math.random()*360,this.ribbons=[],this.complexity=0,this.vitality=1;for(let s=0;s<l.ribbonStartCount;s++){const i=this.createRibbon(!1);i.growth=1,this.ribbons.push(i)}this.foodParticles=[],this.currentFoodHue=Math.random()*360,this.lastFeedTime=0,this.gasCloud=[];for(let s=0;s<l.gasCloudParticles;s++)this.gasCloud.push(this.createGasParticle());this.particles=[];for(let s=0;s<l.particleCount;s++){const i=Math.random()*S,e=Math.acos(2*Math.random()-1),o=l.particleRadius*(.5+Math.random()*.5);this.particles.push({x:o*Math.sin(e)*Math.cos(i),y:o*Math.sin(e)*Math.sin(i),z:o*Math.cos(e),vx:0,vy:0,vz:0,orbitRadius:o,size:1+Math.random()*2,twinkleSpeed:1+Math.random()*2,twinklePhase:Math.random()*S,orbitSpeed:(.2+Math.random()*.3)*(Math.random()<.5?1:-1),orbitAxis:{x:Math.random()-.5,y:Math.random()-.5,z:Math.random()-.5}})}this.nebulae=[];for(let s=0;s<l.nebulaCount;s++){const i=Math.random()*S,e=Math.acos(2*Math.random()-1),o=400+Math.random()*200;this.nebulae.push({x:o*Math.sin(e)*Math.cos(i),y:o*Math.sin(e)*Math.sin(i),z:o*Math.cos(e),size:l.nebulaMinSize+Math.random()*(l.nebulaMaxSize-l.nebulaMinSize),hue:Math.random()*360,drift:(Math.random()-.5)*.1,pulse:Math.random()*S,pulseSpeed:.2+Math.random()*.3})}this.stars=[];const t=800;for(let s=0;s<l.starCount;s++){const i=Math.random()*S,e=Math.acos(2*Math.random()-1);this.stars.push({x:t*Math.sin(e)*Math.cos(i),y:t*Math.sin(e)*Math.sin(i),z:t*Math.cos(e),size:.5+Math.random()*1.5,brightness:.3+Math.random()*.7,twinkleSpeed:.5+Math.random()*2,twinklePhase:Math.random()*S})}this.mouseX=this.width/2,this.mouseY=this.height/2,this.mouseActive=!1,this.membraneDeform={x:this.width/2,y:this.height/2,intensity:0,vx:0,vy:0,vIntensity:0},this.corePulse=0,this.lastFoodHue=this.hue,this.isDragging=!1,this.lastMouseX=0,this.lastMouseY=0,this.velocityX=0,this.velocityY=.1,this.touchStartX=0,this.touchStartY=0,this.touchStartTime=0,this.hasMoved=!1,this.canvas.addEventListener("mousedown",s=>{this.isDragging=!0,this.lastMouseX=s.clientX,this.lastMouseY=s.clientY}),this.canvas.addEventListener("mouseenter",()=>{this.mouseActive=!0}),this.canvas.addEventListener("mousemove",s=>{const i=this.canvas.getBoundingClientRect();if(this.mouseX=s.clientX-i.left,this.mouseY=s.clientY-i.top,this.mouseActive=!0,this.isDragging){const e=s.clientX-this.lastMouseX,o=s.clientY-this.lastMouseY;this.velocityY=e*.005,this.velocityX=o*.005,this.lastMouseX=s.clientX,this.lastMouseY=s.clientY}}),this.canvas.addEventListener("mouseup",()=>{this.isDragging=!1}),this.canvas.addEventListener("mouseleave",()=>{this.isDragging=!1,this.velocityY=.1,this.mouseX=this.width/2,this.mouseY=this.height/2,this.mouseActive=!1}),this.canvas.addEventListener("click",s=>{const i=this.canvas.getBoundingClientRect(),e=s.clientX-i.left,o=s.clientY-i.top;this.handleFeedClick(e,o)}),this.canvas.addEventListener("touchstart",s=>{s.preventDefault();const i=s.touches[0],e=this.canvas.getBoundingClientRect();this.touchStartX=i.clientX,this.touchStartY=i.clientY,this.touchStartTime=performance.now(),this.hasMoved=!1,this.mouseX=i.clientX-e.left,this.mouseY=i.clientY-e.top,this.mouseActive=!0,this.isDragging=!0,this.lastMouseX=i.clientX,this.lastMouseY=i.clientY},{passive:!1}),this.canvas.addEventListener("touchmove",s=>{s.preventDefault();const i=s.touches[0],e=this.canvas.getBoundingClientRect();this.mouseX=i.clientX-e.left,this.mouseY=i.clientY-e.top,this.mouseActive=!0;const o=i.clientX-this.touchStartX,a=i.clientY-this.touchStartY;if(Math.sqrt(o*o+a*a)>10&&(this.hasMoved=!0),this.isDragging){const r=i.clientX-this.lastMouseX,d=i.clientY-this.lastMouseY;this.velocityY=r*.005,this.velocityX=d*.005,this.lastMouseX=i.clientX,this.lastMouseY=i.clientY}},{passive:!1}),this.canvas.addEventListener("touchend",s=>{s.preventDefault();const i=performance.now()-this.touchStartTime;if(!this.hasMoved&&i<300){this.canvas.getBoundingClientRect();const e=this.mouseX,o=this.mouseY;this.handleFeedClick(e,o)}this.isDragging=!1,this.mouseX=this.width/2,this.mouseY=this.height/2,this.mouseActive=!1},{passive:!1}),this.canvas.addEventListener("touchcancel",()=>{this.isDragging=!1,this.mouseX=this.width/2,this.mouseY=this.height/2,this.mouseActive=!1})}update(t){if(super.update(t),this.time+=t*l.timeScale,this.rotationX+=this.velocityX,this.rotationY+=this.velocityY,this.isDragging||(this.velocityX*=.95,this.velocityY*=.95,Math.abs(this.velocityY)<.001&&Math.abs(this.velocityX)<.001&&(this.velocityY=.002)),this.updateFood(t),this.complexity>0){this.complexity-=l.complexityDecayRate*t,this.complexity=Math.max(0,this.complexity);const s=l.ribbonStartCount+Math.floor(this.complexity);let i=this.ribbons.filter(e=>e.targetGrowth===1).length;for(;i>s&&i>l.ribbonStartCount;)for(let e=this.ribbons.length-1;e>=0;e--)if(this.ribbons[e].targetGrowth===1){this.ribbons[e].targetGrowth=0,i--;break}}if(this.complexity===0&&this.ribbons.filter(s=>s.targetGrowth===1).length<=l.ribbonStartCount){if(this.vitality-=l.vitalityDecayRate*t,this.vitality=Math.max(0,this.vitality),this.vitality<.5&&this.ribbons.filter(i=>i.targetGrowth===1).length>1){for(let i=this.ribbons.length-1;i>=0;i--)if(this.ribbons[i].targetGrowth===1){this.ribbons[i].targetGrowth=0;break}}if(this.vitality<.2)for(const s of this.ribbons)s.targetGrowth=0}this.updateRibbonGrowth(t),this.updateMembranePhysics(t),this.updateParticles(t),this.corePulse*=.92}updateRibbonGrowth(t){for(let s=this.ribbons.length-1;s>=0;s--){const i=this.ribbons[s];i.growth<i.targetGrowth?(i.growth+=i.growthSpeed*t,i.growth=Math.min(i.growth,i.targetGrowth)):i.growth>i.targetGrowth&&(i.growth-=i.growthSpeed*.7*t,i.growth=Math.max(i.growth,i.targetGrowth),i.growth<=.01&&this.ribbons.splice(s,1))}}updateParticles(t){const s=80*this.vitality,i=30*(1-this.vitality);for(const e of this.particles){const o=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);if(o<1)continue;const a=e.x/o,n=e.y/o,r=e.z/o;if(this.vitality>.2){const c=e.orbitRadius*(.8+this.vitality*.4),M=(o-c)*2*t;e.vx-=a*M*s*t,e.vy-=n*M*s*t,e.vz-=r*M*s*t;const u=e.orbitAxis.y*r-e.orbitAxis.z*n,h=e.orbitAxis.z*a-e.orbitAxis.x*r,g=e.orbitAxis.x*n-e.orbitAxis.y*a,p=Math.sqrt(u*u+h*h+g*g)||1;e.vx+=u/p*e.orbitSpeed*this.vitality*t*50,e.vy+=h/p*e.orbitSpeed*this.vitality*t*50,e.vz+=g/p*e.orbitSpeed*this.vitality*t*50}else e.vx+=a*i*t,e.vy+=n*i*t+10*t,e.vz+=r*i*t;e.vx*=.98,e.vy*=.98,e.vz*=.98,e.x+=e.vx*t,e.y+=e.vy*t,e.z+=e.vz*t;const d=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),b=l.particleRadius*2.5;if(d>b){const c=b/d;e.x*=c,e.y*=c,e.z*=c,e.vx*=-.3,e.vy*=-.3,e.vz*=-.3}}}updateMembranePhysics(t){const s=this.width/2,i=this.height/2,e=this.membraneDeform,o=this.getShieldRadius(),a=this.mouseX-s,n=this.mouseY-i,r=Math.sqrt(a*a+n*n);this.mouseActive&&r>o*.5&&r<o*1.5?(e.x=this.mouseX,e.y=this.mouseY,e.intensity=1,e.vx=0,e.vy=0,e.vIntensity=0):(e.vx+=(s-e.x)*5*t,e.vy+=(i-e.y)*5*t,e.vIntensity+=(0-e.intensity)*4*t,e.vx*=.92,e.vy*=.92,e.vIntensity*=.85,e.x+=e.vx,e.y+=e.vy,e.intensity+=e.vIntensity),e.intensity=Math.max(-.5,Math.min(1.5,e.intensity))}updateFood(t){const s=this.width/2,i=this.height/2;for(let e=this.foodParticles.length-1;e>=0;e--){const o=this.foodParticles[e],a=s-o.x,n=i-o.y,r=Math.sqrt(a*a+n*n);if(r>1){const d=a/r*l.foodDriftSpeed,b=n/r*l.foodDriftSpeed;o.vx+=d*t,o.vy+=b*t}o.vx*=.98,o.vy*=.98,o.x+=o.vx*t,o.y+=o.vy*t,r<this.getShieldRadius()&&(o.size*=.97,o.alpha*=.98),(r<l.foodAbsorbRadius||o.size<1||o.alpha<.05)&&(this.corePulse=Math.min(this.corePulse+.3,1),this.lastFoodHue=o.hue,this.foodParticles.splice(e,1),this.onFoodAbsorbed())}}onFoodAbsorbed(){if(this.vitality+=l.vitalityRecoveryRate,this.vitality=Math.min(1,this.vitality),this.ribbons.length<l.ribbonStartCount&&this.ribbons.push(this.createRibbon(!1)),this.complexity+=l.complexityPerParticle,this.ribbons.length<l.ribbonMaxCount){const t=l.ribbonStartCount+Math.floor(this.complexity);this.ribbons.length<t&&this.ribbons.push(this.createRibbon(!0))}for(const t of this.ribbons)t.speed=Math.min(t.speed*1.001,1.2)}createRibbon(t=!1){const s=[];for(let i=0;i<=l.ribbonSegments;i++)s.push({offsetX:0,offsetY:0,velocityX:0,velocityY:0});return t?{tiltX:(Math.random()-.5)*3,tiltZ:(Math.random()-.5)*3,phase:Math.random()*S,speed:.3+Math.random()*.7,radius:l.ribbonOrbitRadius*(.5+Math.random()*.7),freqA:1+Math.floor(Math.random()*4),freqB:1+Math.floor(Math.random()*5),freqC:1+Math.floor(Math.random()*4),deformState:s,growth:0,targetGrowth:1,growthSpeed:.8+Math.random()*.4}:{tiltX:(Math.random()-.5)*1.5,tiltZ:(Math.random()-.5)*1.5,phase:Math.random()*S,speed:.2+Math.random()*.3,radius:l.ribbonOrbitRadius*(.8+Math.random()*.4),freqA:1,freqB:2,freqC:1,deformState:s,growth:0,targetGrowth:1,growthSpeed:.6+Math.random()*.3}}handleFeedClick(t,s){const i=this.width/2,e=this.height/2;if(Math.sqrt((t-i)**2+(s-e)**2)>this.getShieldRadius()){let a=null;for(const n of this.nebulae){if(n.screenX===void 0)continue;const r=t-n.screenX,d=s-n.screenY;if(Math.sqrt(r*r+d*d)<n.screenSize*.8){a=n;break}}this.spawnFood(t,s,a)}}spawnFood(t,s,i=null){const e=performance.now();i?this.currentFoodHue=i.hue:e-this.lastFeedTime>500&&(this.currentFoodHue=Math.random()*360),this.lastFeedTime=e;for(let o=0;o<l.foodParticlesPerClick;o++){const a=Math.random()*S,n=Math.random()*20,r=t+Math.cos(a)*n,d=s+Math.sin(a)*n;this.foodParticles.push({x:r,y:d,size:3+Math.random()*5,alpha:.5+Math.random()*.4,hue:this.currentFoodHue+(Math.random()-.5)*15,vx:0,vy:0})}}getShieldRadius(){const t=l.ribbonMaxCount-l.ribbonStartCount,s=Math.min(this.complexity/t,1);return l.shieldRadiusMin+s*(l.shieldRadiusMax-l.shieldRadiusMin)}resetRibbonDeform(){for(const t of this.ribbons)for(const s of t.deformState)s.velocityX=0,s.velocityY=0,s.offsetX=0,s.offsetY=0}createGasParticle(t=!0){const s=Math.random()*S,i=Math.acos(2*Math.random()-1),e=this.getShieldRadius()*(.9+Math.random()*.3);return{theta:s,phi:i,radius:e,life:t?Math.random():0,maxLife:1,size:25+Math.random()*40,baseAlpha:.05+Math.random()*.06,speed:25+Math.random()*35,drift:(Math.random()-.5)*.3}}render(){const t=this.ctx,s=this.width,i=this.height,e=s/2,o=i/2;t.fillStyle="#010208",t.fillRect(0,0,s,i),this.renderNebulae(t,s,i),this.renderStars(t,s,i),this.renderFood(t),this.renderGasCloud(t,e,o);const a=t.createRadialGradient(e,o,0,e,o,l.coreGlow*2);a.addColorStop(0,`hsla(${this.hue}, 70%, 70%, 0.15)`),a.addColorStop(.5,`hsla(${this.hue}, 60%, 50%, 0.05)`),a.addColorStop(1,"transparent"),t.fillStyle=a,t.fillRect(0,0,s,i),this.renderShield(t,e,o,!1),this.renderParticles(t,e,o),this.renderRibbons(t,e,o),this.renderCore(t,e,o),this.renderShield(t,e,o,!0)}renderNebulae(t,s,i){const e=s/2,o=i/2,a=this.time;for(const n of this.nebulae){const r=Y(n.x,n.y,n.z,this.rotationX),d=$(r.x,r.y,r.z,this.rotationY);if(d.z<100)continue;const b=600/d.z,c=e+d.x*b,M=o+d.y*b,u=n.size*b;if(c<-u||c>s+u||M<-u||M>i+u)continue;const h=.8+.2*Math.sin(a*n.pulseSpeed+n.pulse),g=l.nebulaAlpha*h,p=3;for(let f=0;f<p;f++){const m=u*(.6+f*.3),y=g*(1-f*.3),C=Math.sin(a*.1+f+n.pulse)*u*.1,v=Math.cos(a*.08+f+n.pulse)*u*.1,z=t.createRadialGradient(c+C,M+v,0,c+C,M+v,m);z.addColorStop(0,`hsla(${n.hue+f*15}, 60%, 50%, ${y})`),z.addColorStop(.3,`hsla(${n.hue+f*10}, 50%, 40%, ${y*.5})`),z.addColorStop(.6,`hsla(${n.hue}, 40%, 30%, ${y*.2})`),z.addColorStop(1,"transparent"),t.fillStyle=z,t.beginPath(),t.arc(c+C,M+v,m,0,S),t.fill()}n.screenX=c,n.screenY=M,n.screenSize=u}}renderStars(t,s,i){const e=this.time,o=s/2,a=i/2;for(const n of this.stars){const r=Y(n.x,n.y,n.z,this.rotationX),d=$(r.x,r.y,r.z,this.rotationY);if(d.z<0)continue;const b=o+d.x*(s/800),c=a+d.y*(i/800);if(b<0||b>s||c<0||c>i)continue;const M=.5+.5*Math.sin(e*n.twinkleSpeed+n.twinklePhase),u=n.brightness*(.4+M*.6),h=n.twinklePhase,g=200+Math.sin(h)*55,p=210+Math.sin(h+1)*45,f=230+Math.sin(h+2)*25;t.fillStyle=`rgba(${Math.floor(g)}, ${Math.floor(p)}, ${Math.floor(f)}, ${u})`,t.beginPath(),t.arc(b,c,n.size,0,S),t.fill(),n.brightness>.6&&n.size>1&&(t.fillStyle=`rgba(${Math.floor(g)}, ${Math.floor(p)}, ${Math.floor(f)}, ${u*.2})`,t.beginPath(),t.arc(b,c,n.size*3,0,S),t.fill())}}renderCore(t,s,i){const e=this.corePulse,o=this.vitality;if(o<.3){const h=l.coreRadius*.8,g=.15+o/.3*.15,p=t.createRadialGradient(s,i,0,s,i,h);p.addColorStop(0,"transparent"),p.addColorStop(.5,"transparent"),p.addColorStop(.7,`hsla(${this.hue}, 30%, 40%, ${g*.5})`),p.addColorStop(.85,`hsla(${this.hue}, 40%, 50%, ${g})`),p.addColorStop(1,"transparent"),t.fillStyle=p,t.beginPath(),t.arc(s,i,h,0,S),t.fill();const f=t.createRadialGradient(s,i,h*.8,s,i,h*2);f.addColorStop(0,"transparent"),f.addColorStop(.3,`hsla(${this.hue}, 30%, 35%, ${g*.3})`),f.addColorStop(.6,`hsla(${this.hue}, 25%, 30%, ${g*.15})`),f.addColorStop(1,"transparent"),t.fillStyle=f,t.beginPath(),t.arc(s,i,h*2,0,S),t.fill();return}const a=l.coreGlow*(1+e*.5)*(.3+o*.7),n=l.coreRadius*(1+e*.3)*(.5+o*.5),r=30+o*70,d=20+o*60,b=.2+o*.8,c=t.createRadialGradient(s,i,0,s,i,a);if(c.addColorStop(0,`rgba(255, 255, 255, ${b})`),c.addColorStop(.2,`hsla(${this.hue}, ${d}%, ${r}%, ${.8*b})`),c.addColorStop(.4,`hsla(${this.hue}, ${d*.9}%, ${r*.6}%, ${.4*b})`),c.addColorStop(.7,`hsla(${this.hue}, ${d*.8}%, ${r*.5}%, ${.1*b})`),c.addColorStop(1,"transparent"),t.fillStyle=c,t.beginPath(),t.arc(s,i,a,0,S),t.fill(),e>.05){const h=t.createRadialGradient(s,i,0,s,i,a*.8);h.addColorStop(0,`hsla(${this.lastFoodHue}, 80%, 70%, ${e*.6})`),h.addColorStop(.5,`hsla(${this.lastFoodHue}, 70%, 50%, ${e*.3})`),h.addColorStop(1,"transparent"),t.fillStyle=h,t.beginPath(),t.arc(s,i,a*.8,0,S),t.fill()}const M=t.createRadialGradient(s,i,0,s,i,n),u=Math.floor(100+o*155);M.addColorStop(0,`rgba(${u}, ${u}, ${u}, ${b})`),M.addColorStop(.4,`hsla(${this.hue}, ${d}%, ${r}%, ${.8*b})`),M.addColorStop(.7,`hsla(${this.hue}, ${d*.9}%, ${r*.7}%, ${.3*b})`),M.addColorStop(1,"transparent"),t.fillStyle=M,t.beginPath(),t.arc(s,i,n,0,S),t.fill()}renderRibbons(t,s,i){const e=this.time,o=1/60;for(const a of this.ribbons){if(a.growth<=.01)continue;const n=[];for(let h=0;h<=l.ribbonSegments;h++){const p=h/l.ribbonSegments*S+e*a.speed*l.ribbonSpeedMultiplier+a.phase;let f=Math.cos(p*a.freqA)*a.radius,m=Math.sin(p*a.freqB)*a.radius*.6,y=Math.sin(p*a.freqC)*a.radius*.8;const C=Y(f,m,y,a.tiltX),v=q(C.x,C.y,C.z,a.tiltZ),z=Y(v.x,v.y,v.z,this.rotationX),X=$(z.x,z.y,z.z,this.rotationY);n.push({x:X.x,y:X.y,z:X.z,t:h/l.ribbonSegments})}const r=a.growth,d=n.map((h,g)=>{const p=s+h.x,f=i+h.y,m=a.deformState[g];if(this.mouseActive){const D=p-this.mouseX,G=f-this.mouseY,P=Math.sqrt(D*D+G*G),k=l.ribbonPokeRadius;if(P<k&&P>1){const x=Math.pow(1-P/k,2)*l.ribbonPokeStrength*o;m.velocityX+=D/P*x,m.velocityY+=G/P*x}}m.velocityX-=m.offsetX*l.ribbonReturnSpeed*o,m.velocityY-=m.offsetY*l.ribbonReturnSpeed*o,m.velocityX*=l.ribbonDamping,m.velocityY*=l.ribbonDamping,m.offsetX+=m.velocityX*o,m.offsetY+=m.velocityY*o;let y=p+m.offsetX,C=f+m.offsetY;const v=y-s,z=C-i,X=Math.sqrt(v*v+z*z),w=this.getShieldRadius()-10;return X>w&&(y=s+v/X*w,C=i+z/X*w,m.offsetX=y-p,m.offsetY=C-f,m.velocityX*=-.3,m.velocityY*=-.3),{x:y,y:C,z:h.z}});t.lineCap="round",t.lineJoin="round";const b=d.length-1,c=Math.floor(r*b),M=r>=.99?b:Math.min(c,Math.floor(b*.4)),u=r>=.99?0:Math.max(0,c-M);for(let h=3;h>=0;h--){const g=l.ribbonWidth+h*6,p=h===0?.9:.15/(h+1);t.strokeStyle=`hsla(${this.hue}, 70%, 65%, ${p})`,t.lineWidth=g,t.beginPath();let f=!1;for(let m=u;m<=c&&m<d.length;m++){const y=d[m];f?t.lineTo(y.x,y.y):(t.moveTo(y.x,y.y),f=!0)}t.stroke()}t.globalCompositeOperation="lighter";for(let h=u;h<c&&h<d.length-1;h++){const g=d[h],p=d[h+1];if(n[h].z>0){const f=n[h].z/a.radius*.5;t.strokeStyle=`rgba(255, 255, 255, ${f})`,t.lineWidth=l.ribbonWidth*.5,t.beginPath(),t.moveTo(g.x,g.y),t.lineTo(p.x,p.y),t.stroke()}}t.globalCompositeOperation="source-over"}}renderParticles(t,s,i){const e=this.time;t.globalCompositeOperation="lighter";for(const o of this.particles){const a=Y(o.x,o.y,o.z,this.rotationX),n=$(a.x,a.y,a.z,this.rotationY),r=s+n.x,d=i+n.y,b=.3+.7*(.5+.5*Math.sin(e*o.twinkleSpeed+o.twinklePhase)),c=Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z),M=.3+.7*((n.z+c)/(c*2+1)),u=b*M*.6;t.fillStyle=`hsla(${this.hue}, 70%, 75%, ${u})`,t.beginPath(),t.arc(r,d,o.size,0,S),t.fill()}t.globalCompositeOperation="source-over"}renderFood(t){t.globalCompositeOperation="lighter";for(const s of this.foodParticles){const i=t.createRadialGradient(s.x,s.y,0,s.x,s.y,s.size);i.addColorStop(0,`hsla(${s.hue}, 80%, 60%, ${s.alpha})`),i.addColorStop(.4,`hsla(${s.hue}, 70%, 50%, ${s.alpha*.5})`),i.addColorStop(1,"transparent"),t.fillStyle=i,t.beginPath(),t.arc(s.x,s.y,s.size,0,S),t.fill()}t.globalCompositeOperation="source-over"}renderGasCloud(t,s,i){if(this.vitality<.1)return;const e=1/60;t.globalCompositeOperation="lighter";for(let o=0;o<this.gasCloud.length;o++){const a=this.gasCloud[o];if(a.life+=e*l.gasCloudSpeed,a.radius+=a.speed*e,a.theta+=a.drift*e,a.life>=a.maxLife){this.gasCloud[o]=this.createGasParticle(!1);continue}const n=a.life/a.maxLife,r=Math.min(n*4,1),d=1-Math.pow(n,2),b=r*d;let c=a.radius*Math.sin(a.phi)*Math.cos(a.theta),M=a.radius*Math.sin(a.phi)*Math.sin(a.theta),u=a.radius*Math.cos(a.phi);const h=Y(c,M,u,this.rotationX),g=$(h.x,h.y,h.z,this.rotationY),p=s+g.x,f=i+g.y,m=.4+.6*((g.z+a.radius)/(a.radius*2)),y=a.baseAlpha*b*m*this.vitality,C=a.size*(1+n*.8),v=t.createRadialGradient(p,f,0,p,f,C);v.addColorStop(0,`hsla(${this.hue}, 70%, 70%, ${y})`),v.addColorStop(.3,`hsla(${this.hue}, 60%, 55%, ${y*.6})`),v.addColorStop(.6,`hsla(${this.hue}, 50%, 45%, ${y*.25})`),v.addColorStop(1,"transparent"),t.fillStyle=v,t.beginPath(),t.arc(p,f,C,0,S),t.fill()}t.globalCompositeOperation="source-over"}getMembraneDeform(t,s,i,e){const o=this.membraneDeform;if(Math.abs(o.intensity)<.01)return{x:0,y:0};const a=t-o.x,n=s-o.y,r=Math.sqrt(a*a+n*n),d=l.membraneDeformRadius;if(r>d)return{x:0,y:0};const c=Math.cos(r/d*Math.PI*.5)*l.membraneDeformStrength*o.intensity,M=t-i,u=s-e,h=Math.sqrt(M*M+u*u)||1;return{x:M/h*c,y:u/h*c}}renderShield(t,s,i,e){const o=this.getShieldRadius();t.globalCompositeOperation="lighter";const a=8;for(let r=1;r<a;r++){const d=r/a*Math.PI,b=Math.sin(d)*o,c=Math.cos(d)*o,M=48;t.beginPath();let u=!1;for(let g=0;g<=M;g++){const p=g/M*S;let f=Math.cos(p)*b,m=Math.sin(p)*b;const C=Y(f,m,c,this.rotationX),v=$(C.x,C.y,C.z,this.rotationY);if(e&&v.z<0){u=!1;continue}if(!e&&v.z>=0){u=!1;continue}let z=s+v.x,X=i+v.y;const w=this.getMembraneDeform(z,X,s,i);z+=w.x,X+=w.y,u?t.lineTo(z,X):(t.moveTo(z,X),u=!0)}const h=Math.sin(d)*.3;t.strokeStyle=`hsla(${this.hue}, 60%, 65%, ${h})`,t.lineWidth=1,t.stroke()}const n=12;for(let r=0;r<n;r++){const d=r/n*S,b=32;t.beginPath();let c=!1;for(let M=0;M<=b;M++){const u=M/b*Math.PI;let h=Math.sin(u)*Math.cos(d)*o,g=Math.sin(u)*Math.sin(d)*o,p=Math.cos(u)*o;const f=Y(h,g,p,this.rotationX),m=$(f.x,f.y,f.z,this.rotationY);if(e&&m.z<0){c=!1;continue}if(!e&&m.z>=0){c=!1;continue}let y=s+m.x,C=i+m.y;const v=this.getMembraneDeform(y,C,s,i);y+=v.x,C+=v.y,c?t.lineTo(y,C):(t.moveTo(y,C),c=!0)}t.strokeStyle=`hsla(${this.hue}, 60%, 65%, 0.2)`,t.lineWidth=1,t.stroke()}if(e){const r=t.createRadialGradient(s,i,o*.7,s,i,o*1.1);r.addColorStop(0,"transparent"),r.addColorStop(.7,`hsla(${this.hue}, 60%, 65%, 0.05)`),r.addColorStop(.9,`hsla(${this.hue}, 60%, 65%, 0.15)`),r.addColorStop(1,"transparent"),t.fillStyle=r,t.beginPath(),t.arc(s,i,o*1.1,0,S),t.fill()}t.globalCompositeOperation="source-over"}}function I(R){const t=new T(R);return t.start(),{stop:()=>t.stop(),game:t}}export{I as default};
