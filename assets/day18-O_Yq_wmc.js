import{G as T}from"./index-plo7o7PE.js";const e={cellSize:3,baseStepsPerFrame:150,trailLength:300,hueSpeed:30,saturation:100,lightness:45,particleLife:.8,particleSpeed:100,proximityThreshold:40,sparkCooldown:.15},A=[0,1,0,-1],H=[-1,0,1,0];class R extends T{constructor(t){super(t),this.backgroundColor="#000"}init(){super.init(),this.cols=Math.floor(this.width/e.cellSize),this.rows=Math.floor(this.height/e.cellSize);const t=Math.random()*360,n=Math.random()*360;this.grid1=new Array(this.cols*this.rows).fill(!1),this.ant1={x:Math.floor(this.cols/3),y:Math.floor(this.rows/2),dir:0,hue:t,baseHue:t,trail:[]},this.grid2=new Array(this.cols*this.rows).fill(!1),this.ant2={x:Math.floor(this.cols*2/3),y:Math.floor(this.rows/2),dir:2,hue:n,baseHue:n,trail:[]},this.stepCount=0,this.time=0,this.particles=[],this.sparkCooldown=0;const s=this.width*this.height,d=1280*720;this.speedMultiplier=Math.max(1,s/d),this.stepsPerFrame=Math.floor(e.baseStepsPerFrame*this.speedMultiplier),this.gridCanvas1=document.createElement("canvas"),this.gridCanvas1.width=this.cols*e.cellSize,this.gridCanvas1.height=this.rows*e.cellSize,this.gridCtx1=this.gridCanvas1.getContext("2d"),this.gridCtx1.fillStyle="#000",this.gridCtx1.fillRect(0,0,this.gridCanvas1.width,this.gridCanvas1.height),this.gridCanvas2=document.createElement("canvas"),this.gridCanvas2.width=this.cols*e.cellSize,this.gridCanvas2.height=this.rows*e.cellSize,this.gridCtx2=this.gridCanvas2.getContext("2d"),this.gridCtx2.fillStyle="#000",this.gridCtx2.fillRect(0,0,this.gridCanvas2.width,this.gridCanvas2.height),this._keyHandler||(this._keyHandler=p=>{(p.key==="r"||p.key==="R")&&this.init()},window.addEventListener("keydown",this._keyHandler))}stepAnt(t,n,s,d){const p=t.y*this.cols+t.x,u=n[p];t.trail.push({x:t.x,y:t.y,hue:t.hue}),t.trail.length>e.trailLength&&t.trail.shift(),u?t.dir=(t.dir+3)%4:t.dir=(t.dir+1)%4,n[p]=!u;const y=n[p]?e.lightness:3;s.fillStyle=`hsl(${t.hue}, ${e.saturation}%, ${y}%)`,s.fillRect(t.x*e.cellSize,t.y*e.cellSize,e.cellSize,e.cellSize);const M=t.x*e.cellSize+e.cellSize/2,x=t.y*e.cellSize+e.cellSize/2;if(Math.random()<.3){const m=Math.random()*Math.PI*2;this.particles.push({x:M,y:x,vx:Math.cos(m)*e.particleSpeed*(.5+Math.random()),vy:Math.sin(m)*e.particleSpeed*(.5+Math.random()),life:e.particleLife,maxLife:e.particleLife,hue:t.hue,isLight:d})}t.x+=A[t.dir],t.y+=H[t.dir],t.x<0&&(t.x=this.cols-1),t.x>=this.cols&&(t.x=0),t.y<0&&(t.y=this.rows-1),t.y>=this.rows&&(t.y=0)}step(){this.stepAnt(this.ant1,this.grid1,this.gridCtx1,!0),this.stepAnt(this.ant2,this.grid2,this.gridCtx2,!1);const t=this.ant1.x-this.ant2.x,n=this.ant1.y-this.ant2.y,s=Math.sqrt(t*t+n*n);s<e.proximityThreshold&&this.sparkCooldown<=0&&(this.spawnSparks(s),this.sparkCooldown=e.sparkCooldown),this.stepCount++}spawnSparks(t){const n=(this.ant1.x+this.ant2.x)/2*e.cellSize+e.cellSize/2,s=(this.ant1.y+this.ant2.y)/2*e.cellSize+e.cellSize/2,d=this.ant1.x*e.cellSize+e.cellSize/2,p=this.ant1.y*e.cellSize+e.cellSize/2,u=this.ant2.x*e.cellSize+e.cellSize/2,y=this.ant2.y*e.cellSize+e.cellSize/2,M=u-d,x=y-p,z=Math.atan2(x,M)+Math.PI/2,w=1-t/e.proximityThreshold,C=24;for(let l=0;l<C;l++){const r=l/C*Math.PI*2,o=400+Math.random()*200;this.particles.push({x:n,y:s,vx:Math.cos(r)*o,vy:Math.sin(r)*o,life:.6+Math.random()*.3,maxLife:.8,hue:50+Math.random()*30,isSpark:!0,isShockwave:!0})}for(let l=-1;l<=1;l+=2){const r=z+l*(.2+Math.random()*.3),o=15+Math.floor(w*10);for(let c=0;c<o;c++){const S=(Math.random()-.5)*.8,g=r+S,f=300+Math.random()*400,v=Math.random()*.1;this.particles.push({x:n+Math.cos(g)*5,y:s+Math.sin(g)*5,vx:Math.cos(g)*f,vy:Math.sin(g)*f,life:1+Math.random()*.8,maxLife:1.5,hue:l>0?this.ant1.hue:this.ant2.hue,isSpark:!0,isJet:!0,delay:v})}}const i=12;for(let l=0;l<i;l++){const r=Math.random()*Math.PI*2,o=600+Math.random()*400;this.particles.push({x:n,y:s,vx:Math.cos(r)*o,vy:Math.sin(r)*o,life:.4+Math.random()*.3,maxLife:.6,hue:Math.random()<.5?this.ant1.hue:this.ant2.hue,isSpark:!0,isTracer:!0})}const a=20;for(let l=0;l<a;l++){const r=l/a*Math.PI*2,o=150+Math.random()*150,c=(Math.random()-.5)*400;this.particles.push({x:n,y:s,vx:Math.cos(r)*o,vy:Math.sin(r)*o,life:1.5+Math.random()*1,maxLife:2,hue:(this.ant1.hue+this.ant2.hue)/2+(Math.random()-.5)*60,isSpark:!0,isSpiral:!0,spin:c,angle:r})}const h=30;for(let l=0;l<h;l++){const r=Math.random()*Math.PI*2,o=200+Math.random()*300;this.particles.push({x:n+(Math.random()-.5)*20,y:s+(Math.random()-.5)*20,vx:Math.cos(r)*o,vy:Math.sin(r)*o,life:.3+Math.random()*.4,maxLife:.5,hue:40+Math.random()*20,isSpark:!0,isFlash:!0})}}update(t){for(super.update(t),this.time+=t,this.sparkCooldown>0&&(this.sparkCooldown-=t),this.ant1.hue=(this.ant1.baseHue+this.time*e.hueSpeed)%360,this.ant2.hue=(this.ant2.baseHue+this.time*e.hueSpeed)%360;this.ant1.trail.length>e.trailLength;)this.ant1.trail.shift();for(;this.ant2.trail.length>e.trailLength;)this.ant2.trail.shift();for(let n=0;n<this.stepsPerFrame;n++)this.step();for(let n=this.particles.length-1;n>=0;n--){const s=this.particles[n];if(s.delay&&s.delay>0){s.delay-=t;continue}if(s.isSpiral&&s.spin){s.angle+=s.spin*t*.01;const d=Math.sqrt(s.vx*s.vx+s.vy*s.vy);s.vx=Math.cos(s.angle)*d,s.vy=Math.sin(s.angle)*d}s.x+=s.vx*t,s.y+=s.vy*t,s.isTracer?(s.vx*=.98,s.vy*=.98):s.isShockwave?(s.vx*=.92,s.vy*=.92):(s.vx*=.95,s.vy*=.95),s.life-=t,s.life<=0&&this.particles.splice(n,1)}this.particles.length>2e3&&(this.particles=this.particles.slice(-1500))}render(){const t=this.ctx,n=this.width,s=this.height;t.fillStyle="rgba(0, 0, 0, 0.1)",t.fillRect(0,0,n,s);const d=(n-this.gridCanvas1.width)/2,p=(s-this.gridCanvas1.height)/2,u=i=>{if(t.save(),t.globalCompositeOperation="source-over",i.trail.length>1){t.beginPath(),t.moveTo(d+i.trail[0].x*e.cellSize+e.cellSize/2,p+i.trail[0].y*e.cellSize+e.cellSize/2);for(let h=1;h<i.trail.length;h++)t.lineTo(d+i.trail[h].x*e.cellSize+e.cellSize/2,p+i.trail[h].y*e.cellSize+e.cellSize/2);const a=t.createLinearGradient(d+i.trail[0].x*e.cellSize,p+i.trail[0].y*e.cellSize,d+i.trail[i.trail.length-1].x*e.cellSize,p+i.trail[i.trail.length-1].y*e.cellSize);a.addColorStop(0,`hsla(${i.trail[0].hue}, 100%, 50%, 0)`),a.addColorStop(1,`hsla(${i.hue}, 100%, 70%, 1)`),t.strokeStyle=a,t.lineWidth=e.cellSize*.8,t.lineCap="round",t.lineJoin="round",t.stroke()}t.restore()},y=e.cellSize*25,M=(i,a,h)=>{t.save(),t.globalCompositeOperation="lighter";const l=25,r=i.trail;for(let f=0;f<Math.min(r.length,l);f++){const v=r[r.length-1-f],I=1-f/l,L=y*(.4+.6*I),G=I*.3,$=d+v.x*e.cellSize+e.cellSize/2,P=p+v.y*e.cellSize+e.cellSize/2,k=t.createRadialGradient($,P,0,$,P,L);k.addColorStop(0,`hsla(${v.hue}, ${e.saturation}%, 55%, ${G})`),k.addColorStop(1,`hsla(${v.hue}, ${e.saturation}%, 50%, 0)`),t.fillStyle=k,t.beginPath(),t.arc($,P,L,0,Math.PI*2),t.fill()}const o=i.hue,c=t.createRadialGradient(a,h,0,a,h,y);c.addColorStop(0,`hsla(${o}, 100%, 60%, 0.6)`),c.addColorStop(.4,`hsla(${o}, 100%, 50%, 0.2)`),c.addColorStop(1,`hsla(${o}, 100%, 50%, 0)`),t.fillStyle=c,t.beginPath(),t.arc(a,h,y,0,Math.PI*2),t.fill();const S=y*1.5,g=t.createRadialGradient(a,h,0,a,h,S);g.addColorStop(0,`hsla(${o}, 100%, 50%, 0.1)`),g.addColorStop(1,`hsla(${o}, 100%, 50%, 0)`),t.fillStyle=g,t.beginPath(),t.arc(a,h,S,0,Math.PI*2),t.fill(),t.restore()},x=(i,a,h)=>{t.save(),t.shadowColor="rgba(0,0,0,0.8)",t.shadowBlur=10,t.beginPath(),t.arc(i,a,e.cellSize*1.5,0,Math.PI*2),t.fillStyle=`hsl(${h}, ${e.saturation}%, 90%)`,t.fill(),t.beginPath(),t.arc(i,a,e.cellSize*1.5,0,Math.PI*2),t.strokeStyle="#000",t.lineWidth=1,t.stroke(),t.restore()};t.globalCompositeOperation="screen",t.drawImage(this.gridCanvas1,d,p),t.globalCompositeOperation="exclusion",t.drawImage(this.gridCanvas2,d,p);const m=d+this.ant1.x*e.cellSize+e.cellSize/2,z=p+this.ant1.y*e.cellSize+e.cellSize/2;u(this.ant1),M(this.ant1,m,z);const w=d+this.ant2.x*e.cellSize+e.cellSize/2,C=p+this.ant2.y*e.cellSize+e.cellSize/2;u(this.ant2),M(this.ant2,w,C),t.globalCompositeOperation="lighter";for(const i of this.particles){const a=i.life/i.maxLife;if(i.isSpark){const h=d+i.x,l=p+i.y;if(i.isTracer){const r=Math.sqrt(i.vx*i.vx+i.vy*i.vy),o=Math.min(r*.15,60),c=Math.atan2(i.vy,i.vx);t.strokeStyle=`hsla(${i.hue}, 100%, 85%, ${a})`,t.lineWidth=3*a,t.lineCap="round",t.beginPath(),t.moveTo(h,l),t.lineTo(h-Math.cos(c)*o,l-Math.sin(c)*o),t.stroke(),t.fillStyle=`hsla(${i.hue}, 80%, 95%, ${a})`,t.beginPath(),t.arc(h,l,4*a,0,Math.PI*2),t.fill()}else if(i.isShockwave){const r=6*a;t.fillStyle=`hsla(${i.hue}, 100%, 90%, ${a*.9})`,t.beginPath(),t.arc(h,l,r,0,Math.PI*2),t.fill();const o=15*a,c=t.createRadialGradient(h,l,0,h,l,o);c.addColorStop(0,`hsla(${i.hue}, 100%, 80%, ${a*.5})`),c.addColorStop(1,`hsla(${i.hue}, 100%, 60%, 0)`),t.fillStyle=c,t.beginPath(),t.arc(h,l,o,0,Math.PI*2),t.fill()}else if(i.isJet){const r=Math.sqrt(i.vx*i.vx+i.vy*i.vy),o=Math.min(r*.08,30),c=Math.atan2(i.vy,i.vx),S=t.createLinearGradient(h,l,h-Math.cos(c)*o,l-Math.sin(c)*o);S.addColorStop(0,`hsla(${i.hue}, 100%, 70%, ${a})`),S.addColorStop(1,`hsla(${i.hue}, 100%, 50%, 0)`),t.strokeStyle=S,t.lineWidth=4*a,t.lineCap="round",t.beginPath(),t.moveTo(h,l),t.lineTo(h-Math.cos(c)*o,l-Math.sin(c)*o),t.stroke();const g=12*a,f=t.createRadialGradient(h,l,0,h,l,g);f.addColorStop(0,`hsla(${i.hue}, 100%, 90%, ${a})`),f.addColorStop(.5,`hsla(${i.hue}, 100%, 70%, ${a*.5})`),f.addColorStop(1,`hsla(${i.hue}, 100%, 50%, 0)`),t.fillStyle=f,t.beginPath(),t.arc(h,l,g,0,Math.PI*2),t.fill()}else if(i.isSpiral){const r=5*a,o=(1-a)*60;t.fillStyle=`hsla(${i.hue+o}, 100%, 70%, ${a})`,t.beginPath(),t.arc(h,l,r,0,Math.PI*2),t.fill();const c=10*a,S=t.createRadialGradient(h,l,0,h,l,c);S.addColorStop(0,`hsla(${i.hue+o}, 100%, 60%, ${a*.4})`),S.addColorStop(1,`hsla(${i.hue+o}, 100%, 50%, 0)`),t.fillStyle=S,t.beginPath(),t.arc(h,l,c,0,Math.PI*2),t.fill()}else if(i.isFlash){const r=3*a;t.fillStyle=`rgba(255, 255, 240, ${a})`,t.beginPath(),t.arc(h,l,r,0,Math.PI*2),t.fill()}else{const r=6*a;t.fillStyle=`hsla(${i.hue}, 100%, 80%, ${a})`,t.beginPath(),t.arc(h,l,r,0,Math.PI*2),t.fill()}}else{const h=6*a;t.fillStyle=`hsla(${i.hue}, 100%, 80%, ${a})`,t.beginPath(),t.arc(d+i.x,p+i.y,h,0,Math.PI*2),t.fill()}}t.globalCompositeOperation="source-over",t.fillStyle="#fff",x(m,z,this.ant1.hue),x(w,C,this.ant2.hue)}}function O(b){const t=new R(b);return t.start(),{stop:()=>{t._keyHandler&&(window.removeEventListener("keydown",t._keyHandler),t._keyHandler=null),t.stop()},game:t}}export{O as default};
