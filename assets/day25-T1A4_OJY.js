import{G as V,d as z,P as O,C as E,H as X,e as D,p as W,J as P,Z as A,_ as Y,$ as B,X as H,a0 as I}from"./index-3oaVaAML.js";import{CONFIG as f,TAU as R}from"./day25.config-DGqoq7tn.js";import{PRIMORDIAL_KEYS as k,MOLECULES as L,REACTIONS as j}from"./day25.chemistry-DIw6AqoQ.js";import{Molecule2D as U,Molecule3D as F}from"./day25.molecule-By6QOkix.js";class K extends V{constructor(t){super(t),this.backgroundColor=f.bgColor}init(){super.init(),z.init(this),O.init(this.ctx),this.camera=new E({perspective:f.perspective,rotationX:.2,rotationY:0,inertia:!0,friction:.95,clampX:!1,clampY:!1}),this.camera.enableMouseControl(this.canvas),this.canvas.removeEventListener("dblclick",this.camera._boundHandlers.dblclick),this.molecules=[],this.cx=this.width/2,this.cy=this.height/2,this.reactionLog=[],this.totalTime=0,this.nextLightning=f.lightningInterval,this.stats={reactions:0,maxTier:0},this.discovered=new Set,this.tierRequirements={0:["water","methane","ammonia","hydrogen","carbonDioxide","hydrogenSulfide"],1:["formaldehyde","hydrogenCyanide"],2:["glycine","alanine","serine","asparticAcid","cysteine"],3:["diglycine"]},this.showInfo=!1,this.showLegend=!1,this.worldWidth=this.width*f.worldWidthRatio,this.worldHeight=this.height*f.worldHeightRatio,this.moleculeCount=z.responsive(14,24,36);const t=z.responsive(15,25,35),e=z.responsive(25,40,55);console.log(`[Day25] Screen: ${z.isMobile?"mobile":z.isTablet?"tablet":"desktop"}, molecules: ${this.moleculeCount}`),this.bubbles=[];for(let s=0;s<t;s++)this.bubbles.push(this.createBubble(!0));this.particles=[];for(let s=0;s<e;s++)this.particles.push(this.createParticle());this.reactionBursts=[];for(let s=0;s<this.moleculeCount;s++)this.spawnMolecule(!0);this.leftVent=null,this.rightVent=null,this.loadThermalVents(),this.createUI();let i=null;this.canvas.addEventListener("mousedown",s=>{i={x:s.clientX,y:s.clientY}}),this.mouseWorld={x:0,y:0,z:0,active:!1},this.canvas.addEventListener("mousemove",s=>{const l=this.canvas.getBoundingClientRect(),n=s.clientX-l.left-this.width/2,c=s.clientY-l.top-this.height/2,a=Math.cos(-this.camera.rotationX),r=Math.sin(-this.camera.rotationX),y=Math.cos(-this.camera.rotationY),m=Math.sin(-this.camera.rotationY);let h=n,p=c,g=0,o=p*a-g*r,d=p*r+g*a;p=o,g=d;let b=h*y+g*m;d=-h*m+g*y,h=b,g=d,this.mouseWorld.x=h,this.mouseWorld.y=p,this.mouseWorld.z=g,this.mouseWorld.active=!0}),this.canvas.addEventListener("mouseleave",()=>{this.mouseWorld.active=!1}),this.canvas.addEventListener("mouseup",s=>{if(i){const M=s.clientX-i.x,v=s.clientY-i.y;if(Math.abs(M)>5||Math.abs(v)>5){i=null;return}}i=null;const l=this.canvas.getBoundingClientRect(),n=s.clientX-l.left-this.width/2,c=s.clientY-l.top-this.height/2,a=Math.cos(-this.camera.rotationX),r=Math.sin(-this.camera.rotationX),y=Math.cos(-this.camera.rotationY),m=Math.sin(-this.camera.rotationY);let h=n,p=c,g=(Math.random()-.5)*80,o=p*a-g*r,d=p*r+g*a;p=o,g=d;let b=h*y+g*m;d=-h*m+g*y,h=b,g=d;const u=this.pickSmartMolecule(),x=this.spawnMolecule(!1,h,p,g,u,!0);x&&(this.reactionLog.unshift({text:`+ ${x.label} (${x.name})`,time:2}),this.reactionLog.length>5&&this.reactionLog.pop())})}createBubble(t=!1){const i=Math.random()<.5?this.width*.08:this.width*.92,s=this.width*.05;return{x:i+(Math.random()-.5)*s,y:t?Math.random()*this.height:this.height+Math.random()*20,size:2+Math.random()*6,speed:40+Math.random()*60,wobblePhase:Math.random()*R,wobbleSpeed:1.5+Math.random()*2.5,alpha:.15+Math.random()*.35}}createParticle(){const t=Math.random()<.3;return{x:Math.random()*this.width,y:Math.random()*this.height,z:(Math.random()-.5)*400,size:1+Math.random()*2,vx:(Math.random()-.5)*8,vy:(Math.random()-.5)*4-2,alpha:.04+Math.random()*.12,hue:t?160+Math.random()*40:190+Math.random()*30}}async loadThermalVents(){const t=this.height*.4/2048,e=2048*t;try{this.leftVent=await X.fromURL("./thermal-vent.svg",{x:0,y:this.height-e*.85,scale:t,centerPath:!1,color:"#000"}),this.rightVent=await X.fromURL("./thermal-vent.svg",{x:this.width,y:this.height-e*.85,scale:t,centerPath:!1,color:"#000",scaleX:-1}),console.log("[Day25] Thermal vents loaded")}catch(i){console.warn("[Day25] Failed to load thermal vents:",i)}}createUI(){const t=z.isMobile,e=t?36:44,i=t?'16px "Fira Code", monospace':'18px "Fira Code", monospace',s=this.height-60,l=20;this.infoBtn=new D(this,{text:"i",width:e,height:e,font:i,startToggled:this.showInfo,onToggle:n=>{this.showInfo=n}}),this.infoBtn.x=l+e/2,this.infoBtn.y=s,this.pipeline.add(this.infoBtn),this.legendBtn=new D(this,{text:"?",width:e,height:e,font:i,startToggled:this.showLegend,onToggle:n=>{this.showLegend=n,this.legendScene&&(this.legendScene.visible=n)}}),this.legendBtn.x=l+e+10+e/2,this.legendBtn.y=s,this.pipeline.add(this.legendBtn),this.showStats=!1,this.statsBtn=new D(this,{text:"#",width:e,height:e,font:i,startToggled:this.showStats,onToggle:n=>{this.showStats=n,this.statsScene&&(this.statsScene.visible=n)}}),this.statsBtn.x=l+(e+10)*2+e/2,this.statsBtn.y=s,this.pipeline.add(this.statsBtn),this.createLegendDialog(),this.createStatsDialog()}createLegendDialog(){const t=f.debugLegend,e=z.isMobile,i=e?240:300,s=e?260:320,l=e?12:14;this.legendScene=new W(this,{width:i,height:s}),this.legendScene.x=this.width/2,this.legendScene.y=this.height/2,this.legendScene.visible=!1;const n=new P({x:0,y:0,width:i,height:s,color:"rgba(0, 10, 15, 0.9)",stroke:"#0f0",lineWidth:2}),c=A.create(this,n,{name:"legendBackground"});this.legendScene.add(c);const a=new Y(this,{spacing:e?4:6,padding:8,debug:t,debugColor:"red"});this.legendScene.add(a);const r=new B(this,"PRIMORDIAL MOLECULES",{font:`bold ${l+2}px "Fira Code", monospace`,color:"#0f0",align:"center",baseline:"middle"});a.add(r);const y=e?32:40;for(const m of k){const h=L[m];if(!h)continue;const p=new H(this,{autoSize:!1,width:i-25,height:y,align:"start",spacing:0,padding:0,debug:t,debugColor:"yellow"}),g=new U(this,m,{width:y,height:y,debug:t,debugColor:"green"});p.add(g);const o=new B(this,`${h.name} - ${h.label}`,{font:`${l}px "Fira Code", monospace`,color:"#fff",align:"left",baseline:"middle",debug:t,debugColor:"blue"});p.add(o),a.add(p)}this.pipeline.add(this.legendScene)}createStatsDialog(){const t=z.isMobile,e=t?180:220,i=t?300:380,s=t?10:12;this.statsScene=new W(this,{width:e,height:i}),this.statsScene.x=this.width-e/2-20,this.statsScene.y=this.height/2,this.statsScene.visible=!1;const l=new P({width:e,height:i,color:"rgba(0, 10, 15, 0.9)",stroke:"#0f0",lineWidth:2}),n=A.create(this,l,{name:"statsBackground"});this.statsScene.add(n);const c=new Y(this,{spacing:2,padding:8});this.statsScene.add(c);const a=new B(this,"MOLECULE COUNTS",{font:`bold ${s+2}px "Fira Code", monospace`,color:"#0f0",align:"center",baseline:"middle"});c.add(a),this.statsLabels={};const r=Object.keys(L);for(const y of r){const m=L[y],h=new B(this,`${m.name}: 0`,{font:`${s}px "Fira Code", monospace`,color:"#aaa",align:"left",baseline:"middle"});c.add(h),this.statsLabels[y]=h}this.pipeline.add(this.statsScene)}updateStatsLabels(){if(!this.showStats||!this.statsLabels)return;const t={};for(const e of this.molecules)t[e.templateKey]=(t[e.templateKey]||0)+1;for(const e of Object.keys(L)){const i=L[e],s=t[e]||0,l=this.statsLabels[e];l&&(l.text=`${i.name}: ${s}`,l.color=s>0?"#0f0":"#444")}}spawnMolecule(t=!1,e,i,s,l,n=!1){const c=Math.min(f.maxMolecules,(this.moleculeCount||f.baseMolecules)*3);if(!n&&this.molecules.length>=c)return null;const a=l||(t?k[Math.floor(Math.random()*k.length)]:Object.keys(L)[Math.floor(Math.random()*Object.keys(L).length)]),r=e??(Math.random()-.5)*this.worldWidth,y=i??(Math.random()-.5)*this.worldHeight,m=s??(Math.random()-.5)*f.worldDepth,h=new F(this,a,{x:r,y,z:m});return this.molecules.push(h),this.discovered.add(a),h}isTierDiscovered(t){const e=this.tierRequirements[t];return e?e.every(i=>this.discovered.has(i)):!0}areNucleobasesUnlocked(){return this.isTierDiscovered(0)&&this.isTierDiscovered(1)&&this.isTierDiscovered(2)&&this.isTierDiscovered(3)}pickSmartMolecule(){const t={};for(const h of this.molecules)t[h.templateKey]=(t[h.templateKey]||0)+1;const i=["glycine","alanine","serine","asparticAcid","cysteine"].reduce((h,p)=>h+(t[p]||0),0),s=i>0,l=(t.diglycine||0)>0,n=this.areNucleobasesUnlocked(),c=[...k];s&&(c.push("formaldehyde"),i>=10&&c.push("glycine","alanine")),(l||n)&&c.push("hydrogenCyanide");const a={};for(const h of c)a[h]=1;for(const h of j){const[p,g]=h.reactants,o=t[p]||0,d=t[g]||0;(o>0||d>0)&&(c.includes(p)&&(a[p]+=d*2,o===0&&(a[p]+=5)),c.includes(g)&&(a[g]+=o*2,d===0&&(a[g]+=5)))}s&&(t.glycine||0)>5&&(a.formaldehyde=(a.formaldehyde||0)+10),i>=10&&(t.diglycine||0)===0&&(a.glycine=(a.glycine||0)+15),n&&(a.hydrogenCyanide=(a.hydrogenCyanide||0)+15,a.carbonDioxide=(a.carbonDioxide||0)+8),(t.cytosine||0)>0&&(t.uracil||0)===0&&(a.water=(a.water||0)+15);const r=50;s&&(t.formaldehyde||0)===0&&c.includes("formaldehyde")&&(a.formaldehyde=(a.formaldehyde||0)+r),i>=10&&(t.glycine||0)<3&&c.includes("glycine")&&(a.glycine=(a.glycine||0)+r),n&&(t.hydrogenCyanide||0)===0&&c.includes("hydrogenCyanide")&&(a.hydrogenCyanide=(a.hydrogenCyanide||0)+r);const y=Object.values(a).reduce((h,p)=>h+p,0);let m=Math.random()*y;for(const h of c)if(m-=a[h]||0,m<=0)return h;return k[Math.floor(Math.random()*k.length)]}spawnFromOffscreen(){const t=Math.min(f.maxMolecules,this.moleculeCount*3);if(this.molecules.length>=t)return null;const e=this.pickSmartMolecule(),i=Math.random()<.5,s=100,l=i?-this.worldWidth/2-s:this.worldWidth/2+s,n=(Math.random()-.5)*this.worldHeight*.8,c=(Math.random()-.5)*f.worldDepth*.6,a=new F(this,e,{x:l,y:n,z:c});return a.vx=i?15+Math.random()*10:-15-Math.random()*10,a.vy=(Math.random()-.5)*5,a.vz=(Math.random()-.5)*5,a.temperature=.5,this.molecules.push(a),a}spawnReactionBurst(t,e,i,s){const l=Math.floor(12+s*25),n=250+s*200;for(let c=0;c<l;c++){const a=Math.random()*R,r=Math.acos(2*Math.random()-1),y=n*(.6+Math.random()*.4);this.reactionBursts.push({x:t,y:e,z:i,vx:Math.sin(r)*Math.cos(a)*y,vy:Math.sin(r)*Math.sin(a)*y,vz:Math.cos(r)*y,life:1,size:1.5+Math.random()*2})}}lightning(){const t=(Math.random()-.5)*this.worldWidth,e=(Math.random()-.5)*this.worldHeight*.5,i=(Math.random()-.5)*150;for(const s of this.molecules){const l=s.x-t,n=s.y-e,c=s.z-i,a=Math.sqrt(l*l+n*n+c*c);if(a<f.lightningRadius){const r=1-a/f.lightningRadius;s.temperature=Math.min(1,s.temperature+f.lightningEnergy*r),s.flash=Math.max(s.flash,r*.5)}}this.lightningFlash={x:t,y:e,z:i,intensity:1}}checkReactions(){const t=new Set,e=[];for(let i=0;i<this.molecules.length;i++){const s=this.molecules[i];if(!(s.reactionCooldown>0||t.has(i)))for(let l=i+1;l<this.molecules.length;l++){const n=this.molecules[l];if(n.reactionCooldown>0||t.has(l))continue;const c=n.x-s.x,a=n.y-s.y,r=n.z-s.z;if(Math.sqrt(c*c+a*a+r*r)>f.reactionDistance)continue;const m=(s.temperature+n.temperature)/2;for(const h of j){const[p,g]=h.reactants;if(!(s.templateKey===p&&n.templateKey===g||s.templateKey===g&&n.templateKey===p)||h.products.some(C=>["adenine","cytosine","uracil","guanine"].includes(C))&&!this.areNucleobasesUnlocked())continue;const b=f.baseReactionChance*(m/h.minTemp);if(m<h.minTemp*.8||Math.random()>b)continue;t.add(i),t.add(l);const u=(s.x+n.x)/2,x=(s.y+n.y)/2,M=(s.z+n.z)/2;for(const C of h.products){if(!L[C])continue;const w=(Math.random()-.5)*20,$=new F(this,C,{x:u+w,y:x+w,z:M+w});$.temperature=m,$.flash=1,$.reactionCooldown=f.reactionCooldown,$.vx=(s.vx+n.vx)/2+(Math.random()-.5)*15,$.vy=(s.vy+n.vy)/2+(Math.random()-.5)*15,$.vz=(s.vz+n.vz)/2+(Math.random()-.5)*15,e.push($),this.discovered.add(C),this.stats.maxTier=Math.max(this.stats.maxTier,$.tier)}this.spawnReactionBurst(u,x,M,h.energy),this.stats.reactions++;const v=C=>`${C.label} (${C.name})`,T=[v(s),v(n)].join(" + "),S=h.products.map(C=>{const w=L[C];return w?`${w.label} (${w.name})`:C}).join(" + ");this.reactionLog.unshift({text:`${T} → ${S}`,time:4}),this.reactionLog.length>5&&this.reactionLog.pop(),Math.random()<.5&&this.spawnFromOffscreen();break}}}this.molecules=this.molecules.filter((i,s)=>!t.has(s));for(const i of e)this.molecules.push(i)}applySeparation(t){const e=f.separationPadding,i=f.separationStiffness,s=f.collisionDamping;for(let l=0;l<this.molecules.length;l++){const n=this.molecules[l],c=n.boundingRadius+e;for(let a=l+1;a<this.molecules.length;a++){const r=this.molecules[a],y=r.boundingRadius+e,m=r.x-n.x,h=r.y-n.y,p=r.z-n.z,g=m*m+h*h+p*p,o=c+y;if(g<o*o&&g>.001){const d=Math.sqrt(g),b=o-d,u=m/d,x=h/d,M=p/d,v=b*i*.5;n.x-=u*v,n.y-=x*v,n.z-=M*v,r.x+=u*v,r.y+=x*v,r.z+=M*v;const T=n.vx*u+n.vy*x+n.vz*M,S=r.vx*u+r.vy*x+r.vz*M;if(T>S){const w=(T-S)*s;n.vx-=u*w*.5,n.vy-=x*w*.5,n.vz-=M*w*.5,r.vx+=u*w*.5,r.vy+=x*w*.5,r.vz+=M*w*.5}}}}}heatTransfer(){for(let t=0;t<this.molecules.length;t++){const e=this.molecules[t];for(let i=t+1;i<this.molecules.length;i++){const s=this.molecules[i],l=s.x-e.x,n=s.y-e.y,c=s.z-e.z,a=Math.sqrt(l*l+n*n+c*c);if(a<f.heatTransferDist){const r=I(e.temperature,s.temperature,a,f.heatTransferDist,f.heatTransferRate,1);e.temperature=Math.max(0,Math.min(1,e.temperature+r)),s.temperature=Math.max(0,Math.min(1,s.temperature-r))}}}}update(t){super.update(t),this.camera.update(t),this.totalTime+=t,this.nextLightning-=t,this.nextLightning<=0&&(this.lightning(),this.nextLightning=f.lightningInterval+(Math.random()-.5)*f.lightningVariance*2),this.lightningFlash&&(this.lightningFlash.intensity-=t*3,this.lightningFlash.intensity<=0&&(this.lightningFlash=null));for(const e of this.bubbles)e.y-=e.speed*t,e.wobblePhase+=e.wobbleSpeed*t,e.x+=Math.sin(e.wobblePhase)*.5,e.y<-20&&Object.assign(e,this.createBubble(!1));for(const e of this.particles)e.x+=e.vx*t,e.y+=e.vy*t,e.vx+=(Math.sin(this.totalTime*.5+e.y*.01)*2-e.vx*.1)*t,e.vy+=(Math.cos(this.totalTime*.3+e.x*.01)*1-e.vy*.1)*t,e.x<0&&(e.x=this.width),e.x>this.width&&(e.x=0),e.y<0&&(e.y=this.height),e.y>this.height&&(e.y=0);for(const e of this.reactionBursts)e.x+=e.vx*t,e.y+=e.vy*t,e.z+=e.vz*t,e.life-=t*2.5,e.vx*=.98,e.vy*=.98,e.vz*=.98;this.reactionBursts=this.reactionBursts.filter(e=>e.life>0);for(const e of this.molecules){e.update(t);const i=50,s=80,l=f.worldDepth/2;if(e.x<-this.worldWidth/2-i&&(e.vx+=s*t),e.x>this.worldWidth/2+i&&(e.vx-=s*t),e.y<-this.worldHeight/2-i&&(e.vy+=s*t),e.y>this.worldHeight/2+i&&(e.vy-=s*t),e.z<-l&&(e.vz+=s*.6*t),e.z>l&&(e.vz-=s*.6*t),this.mouseWorld.active){const n=e.x-this.mouseWorld.x,c=e.y-this.mouseWorld.y,a=n*n+c*c,r=150,y=400;if(a<r*r&&a>1){const m=Math.sqrt(a),h=(1-m/r)*y*t;e.vx+=n/m*h,e.vy+=c/m*h,e.vz+=(Math.random()-.5)*h*.3}}}this.applySeparation(t),this.heatTransfer(),this.checkReactions();for(const e of this.reactionLog)e.time-=t;this.reactionLog=this.reactionLog.filter(e=>e.time>0),this.updateStatsLabels()}render(){const t=this.ctx,e=this.width,i=this.height,s=e/2,l=i/2,n=t.createLinearGradient(0,0,0,i);n.addColorStop(0,"#000508"),n.addColorStop(.3,"#001015"),n.addColorStop(.6,"#001a1a"),n.addColorStop(.85,"#002020"),n.addColorStop(1,"#001515"),t.fillStyle=n,t.fillRect(0,0,e,i),t.globalAlpha=.015;const c=this.totalTime*f.causticSpeed;for(let o=0;o<4;o++){const d=o*1.5+c*.5,b=e*(.2+o*.2)+Math.sin(d)*e*.05,u=t.createLinearGradient(b,0,b+e*.1,i*.6);u.addColorStop(0,"rgba(100, 200, 255, 0.8)"),u.addColorStop(.5,"rgba(50, 150, 200, 0.3)"),u.addColorStop(1,"transparent"),t.fillStyle=u,t.fillRect(b-20,0,40,i*.6)}t.globalAlpha=1;const a=e*.08,r=t.createRadialGradient(a,i+30,0,a,i+30,i*.45);r.addColorStop(0,`rgba(255, 100, 20, ${f.ventGlow*.6})`),r.addColorStop(.2,`rgba(255, 60, 10, ${f.ventGlow*.4})`),r.addColorStop(.5,`rgba(100, 40, 10, ${f.ventGlow*.2})`),r.addColorStop(1,"transparent"),t.fillStyle=r,t.fillRect(0,0,e,i);const y=e*.92,m=t.createRadialGradient(y,i+30,0,y,i+30,i*.45);m.addColorStop(0,`rgba(255, 80, 15, ${f.ventGlow*.5})`),m.addColorStop(.2,`rgba(255, 50, 10, ${f.ventGlow*.35})`),m.addColorStop(.5,`rgba(80, 30, 10, ${f.ventGlow*.15})`),m.addColorStop(1,"transparent"),t.fillStyle=m,t.fillRect(0,0,e,i),t.globalAlpha=.02;const h=100;for(let o=0;o<3;o++){const d=o*2.1+c,b=e*(.3+o*.2)+Math.sin(d)*e*.15,u=i*(.3+o*.1)+Math.cos(d*.7)*i*.1,x=t.createRadialGradient(b,u,0,b,u,h);x.addColorStop(0,"rgba(0, 255, 150, 1)"),x.addColorStop(.5,"rgba(0, 200, 100, 0.5)"),x.addColorStop(1,"transparent"),t.fillStyle=x,t.fillRect(0,0,e,i)}t.globalAlpha=1;for(const o of this.bubbles){const d=t.createRadialGradient(o.x-o.size*.3,o.y-o.size*.3,0,o.x,o.y,o.size);d.addColorStop(0,`rgba(200, 230, 255, ${o.alpha*.4})`),d.addColorStop(.4,`rgba(150, 200, 230, ${o.alpha*.15})`),d.addColorStop(.8,`rgba(100, 180, 220, ${o.alpha*.1})`),d.addColorStop(1,`rgba(80, 150, 200, ${o.alpha*.05})`),t.fillStyle=d,t.beginPath(),t.arc(o.x,o.y,o.size,0,R),t.fill(),t.strokeStyle=`rgba(180, 220, 255, ${o.alpha*.3})`,t.lineWidth=.5,t.stroke(),t.fillStyle=`rgba(255, 255, 255, ${o.alpha*.6})`,t.beginPath(),t.arc(o.x-o.size*.3,o.y-o.size*.35,o.size*.2,0,R),t.fill()}this.leftVent&&this.leftVent.render(),this.rightVent&&this.rightVent.render();for(const o of this.particles){const d=.5+(o.z+200)/400*.5;t.fillStyle=`hsla(${o.hue}, ${o.hue>150?60:30}%, ${o.hue>150?60:70}%, ${o.alpha*d})`,t.beginPath(),t.arc(o.x,o.y,o.size*d,0,R),t.fill()}if(this.lightningFlash){const o=this.camera.project(this.lightningFlash.x,this.lightningFlash.y,this.lightningFlash.z),d=s+o.x,b=l+o.y,u=t.createRadialGradient(d,b,0,d,b,250);u.addColorStop(0,`rgba(200, 240, 255, ${this.lightningFlash.intensity*.95})`),u.addColorStop(.15,`rgba(150, 220, 255, ${this.lightningFlash.intensity*.6})`),u.addColorStop(.4,`rgba(80, 180, 255, ${this.lightningFlash.intensity*.25})`),u.addColorStop(1,"transparent"),t.fillStyle=u,t.fillRect(0,0,e,i)}const p=[...this.molecules].sort((o,d)=>{const b=this.camera.project(o.x,o.y,o.z),u=this.camera.project(d.x,d.y,d.z);return b.z-u.z});for(const o of p)o.render(s,l);t.globalCompositeOperation="lighter";for(const o of this.reactionBursts){const d=this.camera.project(o.x,o.y,o.z);if(d.scale<=0)continue;const b=s+d.x,u=l+d.y,x=o.size*d.scale,M=o.life;t.fillStyle=`rgba(255, 255, 255, ${M})`,t.beginPath(),t.arc(b,u,x,0,R),t.fill()}t.globalCompositeOperation="source-over";const g=t.createRadialGradient(s,l,Math.min(e,i)*.35,s,l,Math.max(e,i)*.85);if(g.addColorStop(0,"transparent"),g.addColorStop(.7,"rgba(0, 5, 15, 0.3)"),g.addColorStop(1,"rgba(0, 2, 8, 0.7)"),t.fillStyle=g,t.fillRect(0,0,e,i),this.showInfo){const o=z.isMobile,d=o?9:11,b=o?14:18,u=o?e-30:e*.5;t.font=`${d}px "Fira Code", monospace`,t.textAlign="left";let x=25;for(const v of this.reactionLog){const T=Math.min(1,v.time);t.fillStyle=`rgba(0, 255, 100, ${T*.9})`;let S=v.text;if(o&&t.measureText(S).width>u){for(;t.measureText(S+"…").width>u&&S.length>10;)S=S.slice(0,-1);S+="…"}t.fillText(S,15,x),x+=b}t.fillStyle="rgba(0, 255, 120, 0.7)",t.textAlign="right",t.fillText(`Molecules: ${this.molecules.length}`,e-15,25),t.fillText(`Reactions: ${this.stats.reactions}`,e-15,25+b);const M=["Primordial","Precursors","Amino Acids","Peptides","Nucleobases"];t.fillText(`Max tier: ${M[this.stats.maxTier]||"???"}`,e-15,25+b*2)}this.pipeline.render(t)}}function J(G){const t=new K(G);return t.start(),{stop:()=>t.stop(),game:t}}export{J as default};
