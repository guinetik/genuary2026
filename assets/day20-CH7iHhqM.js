import{G as b,P}from"./gcanvas.es-CMQjSjBY.js";const f={colors:{bg:"#000",baseHue:135},segments:300,baseRadius:.6};class S extends b{constructor(t){super(t),this.backgroundColor=f.colors.bg}init(){super.init(),P.init(this.ctx),this.container=this.canvas.parentElement,this.container&&this.enableFluidSize(this.container),this.time=0,this.mouseX=.5,this.mouseY=.5,this.size=.05,this.targetSize=.05,this.snakeLength=20,this.maxSnakeLength=350,this.isOuroboros=!1,this.ouroborosBlend=0,this.eatPulse=0,this.totalEaten=0,this.eatAngleOffset=0,this.coils=1,this.maxHistory=400,this.history=[];for(let t=0;t<this.maxHistory;t++)this.history.push({x:0,y:0});this.headX=0,this.headY=0,this.headAngle=0,this.targetX=0,this.targetY=0,this.canvas.addEventListener("mousemove",t=>{const s=this.canvas.getBoundingClientRect();this.mouseX=(t.clientX-s.left)/s.width,this.mouseY=(t.clientY-s.top)/s.height,this.targetX=(this.mouseX-.5)*1.4,this.targetY=(this.mouseY-.5)*1.4}),this.canvas.addEventListener("click",()=>{this.isOuroboros&&(this.eatPulse=1,this.eatAngleOffset+=.25,this.coils+=.08,this.totalEaten+=1)}),this.canvas.addEventListener("touchstart",t=>{t.preventDefault(),this.isOuroboros&&(this.eatPulse=1,this.eatAngleOffset+=.25,this.coils+=.08,this.totalEaten+=1)}),this.canvas.addEventListener("touchmove",t=>{t.preventDefault();const s=t.touches[0],i=this.canvas.getBoundingClientRect();this.mouseX=(s.clientX-i.left)/i.width,this.mouseY=(s.clientY-i.top)/i.height})}update(t){if(super.update(t),this.time+=t,!this.isOuroboros&&this.snakeLength<this.maxSnakeLength&&(this.snakeLength=Math.min(this.maxSnakeLength,this.snakeLength+t*15)),this.targetSize=Math.min(1,.05+this.snakeLength/this.maxSnakeLength*.95),this.size+=(this.targetSize-this.size)*.02,this.isOuroboros&&(this.ouroborosBlend=Math.min(1,this.ouroborosBlend+t*.5)),this.eatPulse>0&&(this.eatPulse=Math.max(0,this.eatPulse-t*3)),!this.isOuroboros){const s=this.targetX-this.headX,i=this.targetY-this.headY;let o=Math.atan2(i,s)-this.headAngle;for(;o>Math.PI;)o-=Math.PI*2;for(;o<-Math.PI;)o+=Math.PI*2;this.headAngle+=o*.08;const e=Math.sin(this.time*8)*.4,l=this.headAngle+e,r=.012*(.5+this.size*.5);this.headX+=Math.cos(l)*r,this.headY+=Math.sin(l)*r,this.history.unshift({x:this.headX,y:this.headY});const c=Math.floor(this.snakeLength)+10;for(;this.history.length>c;)this.history.pop();if(this.snakeLength>=this.maxSnakeLength-10){const n=Math.min(Math.floor(this.snakeLength)-1,this.history.length-1),a=this.history[n];a&&Math.sqrt((this.headX-a.x)**2+(this.headY-a.y)**2)<.15&&(this.isOuroboros=!0)}}}getSnakePoint(t,s){const i=t*Math.PI*2*this.coils-s*.5+this.eatAngleOffset,h=f.baseRadius*this.size,o=Math.sin(t*Math.PI*8*this.coils+s*2)*.05*this.size,e=h+o,l=Math.cos(i)*e,r=Math.sin(i)*e,c=Math.floor((1-t)*Math.min(this.snakeLength,this.history.length-1)),n=this.history[Math.min(c,this.history.length-1)],a=n?n.x:0,d=n?n.y:0,g=this.ouroborosBlend,y=a*(1-g)+l*g,u=d*(1-g)+r*g,M=Math.sin(t*Math.PI*6*this.coils+s*1.5)*.08*this.size*g;return{x:y,y:u,z:M,t}}projectPoint(t){const s=this.ouroborosBlend,i=(this.mouseX-.5)*Math.PI*.8*s,h=Math.cos(i),o=Math.sin(i),e=t.x*h-t.z*o,l=t.x*o+t.z*h,r=(this.mouseY-.5)*Math.PI*.6*s,c=Math.cos(r),n=Math.sin(r),a=t.y*c-l*n,d=t.y*n+l*c,g=1/(1-d*.3*s);return{x:e*g,y:a*g,z:d}}render(){const t=this.ctx,s=this.width,i=this.height,h=s/2,o=i/2,e=Math.min(s,i)*.7;t.fillStyle="rgba(0, 0, 0, 0.1)",t.fillRect(0,0,s,i);const l=f.segments,r=[];for(let c=0;c<=l;c++){const n=c/l,a=this.getSnakePoint(n,this.time),d=this.projectPoint(a);r.push({x:h+d.x*e,y:o+d.y*e,z:d.z,t:n})}if(this.drawSnake(t,r),this.drawHead(t,r),t.fillStyle="rgba(255, 255, 255, 0.4)",t.font="12px monospace",t.textAlign="center",this.isOuroboros)t.fillStyle="rgba(255, 255, 255, 0.3)",t.fillText("Click to consume â€¢ Drag to rotate",h,i-20),this.totalEaten>0&&(t.fillStyle=`hsla(${f.colors.baseHue}, 80%, 60%, 0.6)`,t.fillText(`Consumed: ${this.totalEaten}`,h,30));else{const c=Math.floor(this.snakeLength/this.maxSnakeLength*100);if(c<97)t.fillText(`Growing... ${c}%`,h,i-20);else{t.fillText("NOW! Catch the tail!",h,i-20);const n=Math.min(Math.floor(this.snakeLength),this.history.length-1),a=this.history[n];if(a){const d=h+a.x*e,g=o+a.y*e,y=.5+Math.sin(this.time*4)*.3,u=t.createRadialGradient(d,g,0,d,g,30);u.addColorStop(0,`rgba(255, 200, 100, ${y})`),u.addColorStop(1,"transparent"),t.fillStyle=u,t.beginPath(),t.arc(d,g,30,0,Math.PI*2),t.fill()}}}}drawSnake(t,s){if(!(s.length<2)){for(let i=1;i<s.length;i++){const h=s[i-1],o=s[i],e=i/s.length,l=2+e*12+this.totalEaten*.5,r=1+Math.sin(this.time*2+e*10)*.1,c=this.eatPulse*Math.sin(e*Math.PI*8+this.time*20)*.3,n=l*(r+c),a=.5+(o.z+.5)*.5,d=this.eatPulse*30,g=f.colors.baseHue+e*40+Math.sin(this.time+e*5)*10,y=70+e*20,u=40+e*20+d;t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(o.x,o.y),t.strokeStyle=`hsla(${g}, ${y}%, ${u}%, ${.3*a})`,t.lineWidth=n+8,t.lineCap="round",t.stroke(),t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(o.x,o.y),t.strokeStyle=`hsla(${g}, ${y}%, ${u+15}%, ${a})`,t.lineWidth=n,t.lineCap="round",t.stroke(),t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(o.x,o.y),t.strokeStyle=`hsla(${g}, ${y-20}%, ${u+35}%, ${.6*a})`,t.lineWidth=n*.3,t.lineCap="round",t.stroke()}this.drawScales(t,s)}}drawScales(t,s){const i=Math.max(3,Math.floor(s.length/50));for(let h=i;h<s.length-i;h+=i){const o=s[h],e=h/s.length,l=2+e*4,r=.5+(o.z+.5)*.5,c=f.colors.baseHue+e*40;t.beginPath(),t.arc(o.x,o.y,l,0,Math.PI*2),t.fillStyle=`hsla(${c+20}, 60%, 70%, ${.3*r})`,t.fill()}}drawHead(t,s){if(s.length<2)return;const i=s[s.length-1],h=s[s.length-10]||s[s.length-2],o=Math.atan2(i.y-h.y,i.x-h.x),e=8+10*this.size,l=.5+(i.z+.5)*.5;t.save(),t.translate(i.x,i.y),t.rotate(o);const r=t.createRadialGradient(0,0,0,0,0,e*2);r.addColorStop(0,`hsla(${f.colors.baseHue+40}, 100%, 60%, ${.5*l})`),r.addColorStop(1,"transparent"),t.fillStyle=r,t.beginPath(),t.arc(0,0,e*2,0,Math.PI*2),t.fill(),t.beginPath(),t.moveTo(e,0),t.lineTo(-e*.5,-e*.6),t.lineTo(-e*.5,e*.6),t.closePath(),t.fillStyle=`hsla(${f.colors.baseHue+40}, 80%, 55%, ${l})`,t.fill();const c=e*.2,n=-e*.2;t.beginPath(),t.arc(c,n,3,0,Math.PI*2),t.fillStyle=`hsla(60, 100%, 70%, ${l})`,t.fill(),t.beginPath(),t.moveTo(e,0),t.lineTo(e*.3,-e*.15),t.lineTo(e*.3,e*.15),t.closePath(),t.fillStyle=`hsla(0, 70%, 30%, ${l})`,t.fill(),t.restore();const a=s[0],d=t.createRadialGradient(a.x,a.y,0,a.x,a.y,15);d.addColorStop(0,`hsla(${f.colors.baseHue}, 100%, 50%, 0.5)`),d.addColorStop(1,"transparent"),t.fillStyle=d,t.beginPath(),t.arc(a.x,a.y,15,0,Math.PI*2),t.fill()}}function p(m){const t=new S(m);return t.start(),{stop:()=>t.stop(),game:t}}export{p as default};
